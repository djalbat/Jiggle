'use strict';

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

var vectorMaths = require('../maths/vector'),
    arrayUtilities = require('../utilities/array'),
    quaternionUtilities = require('../utilities/quaternion');

var first = arrayUtilities.first,
    second = arrayUtilities.second,
    fourth = arrayUtilities.fourth,
    transform3 = vectorMaths.transform3,
    normalise3 = vectorMaths.normalise3,
    rotateImaginaryQuaternion = quaternionUtilities.rotateImaginaryQuaternion,
    calculateInverseRotationQuaternion = quaternionUtilities.calculateInverseRotationQuaternion;


function rotateVertices(vertices, rotationQuaternion) {
  vertices = vertices.map(function (vertex) {
    vertex = rotateVertex(vertex, rotationQuaternion);

    return vertex;
  });

  return vertices;
}

function rotatePosition(position, rotationQuaternion) {
  var imaginaryQuaternion = imaginaryQuaternionFromPosition(position),
      inverseRotationQuaternion = calculateInverseRotationQuaternion(rotationQuaternion),
      rotatedImaginaryQuaternion = rotateImaginaryQuaternion(imaginaryQuaternion, rotationQuaternion, inverseRotationQuaternion);

  position = positionFromImaginaryQuaternion(rotatedImaginaryQuaternion);

  return position;
}

function rotateVerticesAboutZAxis(vertices, rotationAboutZAxisMatrix) {
  vertices = vertices.map(function (vertex) {
    vertex = rotateVertexAboutZAxis(vertex, rotationAboutZAxisMatrix);

    return vertex;
  });

  return vertices;
}

function rotatePositionAboutZAxis(position, rotationAboutZAxisMatrix) {
  position = transform3(position, rotationAboutZAxisMatrix);

  return position;
}

function calculateRotationAboutZAxisMatrix(maskingEdge) {
  var maskingEdgeExtent = maskingEdge.getExtent(),
      unitMaskingEdgeExtent = normalise3(maskingEdgeExtent),
      unitMaskingEdgeExtentComponents = unitMaskingEdgeExtent,
      ///
  firstUnitMaskingEdgeExtentComponent = first(unitMaskingEdgeExtentComponents),
      secondUnitMaskingEdgeExtentComponent = second(unitMaskingEdgeExtentComponents),
      angleOfRotationCosine = +secondUnitMaskingEdgeExtentComponent,
      ///
  angleOfRotationSine = -firstUnitMaskingEdgeExtentComponent,
      ///
  c = angleOfRotationCosine,
      s = angleOfRotationSine,
      rotationAboutZAxisMatrix = [c, -s, 0, +s, c, 0, 0, 0, 1]; ///

  return rotationAboutZAxisMatrix;
}

function calculateForwardsRotationAboutZAxisMatrix(rotationAboutZAxisMatrix) {
  var forwardsRotationAboutZAxisMatrix = rotationAboutZAxisMatrix; ///

  return forwardsRotationAboutZAxisMatrix;
}

function calculateBackwardsRotationAboutZAxisMatrix(rotationAboutZAxisMatrix) {
  var rotationAboutZAxisMatrixComponents = rotationAboutZAxisMatrix,
      ///
  firstRotationAboutZAxisMatrixComponent = first(rotationAboutZAxisMatrixComponents),
      fourthRotationAboutZAxisMatrixComponent = fourth(rotationAboutZAxisMatrixComponents),
      c = firstRotationAboutZAxisMatrixComponent,
      ///
  s = fourthRotationAboutZAxisMatrixComponent,
      ///
  backwardsRotationAboutZAxisMatrix = [c, +s, 0, -s, c, 0, 0, 0, 1];

  return backwardsRotationAboutZAxisMatrix;
}

module.exports = {
  rotateVertices: rotateVertices,
  rotatePosition: rotatePosition,
  rotateVerticesAboutZAxis: rotateVerticesAboutZAxis,
  rotatePositionAboutZAxis: rotatePositionAboutZAxis,
  calculateRotationAboutZAxisMatrix: calculateRotationAboutZAxisMatrix,
  calculateForwardsRotationAboutZAxisMatrix: calculateForwardsRotationAboutZAxisMatrix,
  calculateBackwardsRotationAboutZAxisMatrix: calculateBackwardsRotationAboutZAxisMatrix
};

function rotateVertex(vertex, rotationQuaternion) {
  vertex = vertex.clone(); ///

  vertex.rotate(rotationQuaternion);

  return vertex;
}

function rotateVertexAboutZAxis(vertex, rotationAboutZAxisMatrix) {
  vertex = vertex.clone();

  vertex.rotateAboutZAxis(rotationAboutZAxisMatrix);

  return vertex;
}

function imaginaryQuaternionFromPosition(position) {
  return [0].concat(_toConsumableArray(position));
} ///

function positionFromImaginaryQuaternion(imaginaryQuaternion) {
  return imaginaryQuaternion.slice(1);
} ///
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvcm90YXRpb24uanMiXSwibmFtZXMiOlsidmVjdG9yTWF0aHMiLCJyZXF1aXJlIiwiYXJyYXlVdGlsaXRpZXMiLCJxdWF0ZXJuaW9uVXRpbGl0aWVzIiwiZmlyc3QiLCJzZWNvbmQiLCJmb3VydGgiLCJ0cmFuc2Zvcm0zIiwibm9ybWFsaXNlMyIsInJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24iLCJjYWxjdWxhdGVJbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uIiwicm90YXRlVmVydGljZXMiLCJ2ZXJ0aWNlcyIsInJvdGF0aW9uUXVhdGVybmlvbiIsIm1hcCIsInZlcnRleCIsInJvdGF0ZVZlcnRleCIsInJvdGF0ZVBvc2l0aW9uIiwicG9zaXRpb24iLCJpbWFnaW5hcnlRdWF0ZXJuaW9uIiwiaW1hZ2luYXJ5UXVhdGVybmlvbkZyb21Qb3NpdGlvbiIsImludmVyc2VSb3RhdGlvblF1YXRlcm5pb24iLCJyb3RhdGVkSW1hZ2luYXJ5UXVhdGVybmlvbiIsInBvc2l0aW9uRnJvbUltYWdpbmFyeVF1YXRlcm5pb24iLCJyb3RhdGVWZXJ0aWNlc0Fib3V0WkF4aXMiLCJyb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgiLCJyb3RhdGVWZXJ0ZXhBYm91dFpBeGlzIiwicm90YXRlUG9zaXRpb25BYm91dFpBeGlzIiwiY2FsY3VsYXRlUm90YXRpb25BYm91dFpBeGlzTWF0cml4IiwibWFza2luZ0VkZ2UiLCJtYXNraW5nRWRnZUV4dGVudCIsImdldEV4dGVudCIsInVuaXRNYXNraW5nRWRnZUV4dGVudCIsInVuaXRNYXNraW5nRWRnZUV4dGVudENvbXBvbmVudHMiLCJmaXJzdFVuaXRNYXNraW5nRWRnZUV4dGVudENvbXBvbmVudCIsInNlY29uZFVuaXRNYXNraW5nRWRnZUV4dGVudENvbXBvbmVudCIsImFuZ2xlT2ZSb3RhdGlvbkNvc2luZSIsImFuZ2xlT2ZSb3RhdGlvblNpbmUiLCJjIiwicyIsImNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4IiwiZm9yd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgiLCJjYWxjdWxhdGVCYWNrd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgiLCJyb3RhdGlvbkFib3V0WkF4aXNNYXRyaXhDb21wb25lbnRzIiwiZmlyc3RSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXhDb21wb25lbnQiLCJmb3VydGhSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXhDb21wb25lbnQiLCJiYWNrd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgiLCJtb2R1bGUiLCJleHBvcnRzIiwiY2xvbmUiLCJyb3RhdGUiLCJyb3RhdGVBYm91dFpBeGlzIiwic2xpY2UiXSwibWFwcGluZ3MiOiJBQUFBOzs7O0FBRUEsSUFBTUEsY0FBY0MsUUFBUSxpQkFBUixDQUFwQjtBQUFBLElBQ01DLGlCQUFpQkQsUUFBUSxvQkFBUixDQUR2QjtBQUFBLElBRU1FLHNCQUFzQkYsUUFBUSx5QkFBUixDQUY1Qjs7SUFJUUcsSyxHQUEwQkYsYyxDQUExQkUsSztJQUFPQyxNLEdBQW1CSCxjLENBQW5CRyxNO0lBQVFDLE0sR0FBV0osYyxDQUFYSSxNO0lBQ2ZDLFUsR0FBMkJQLFcsQ0FBM0JPLFU7SUFBWUMsVSxHQUFlUixXLENBQWZRLFU7SUFDWkMseUIsR0FBa0VOLG1CLENBQWxFTSx5QjtJQUEyQkMsa0MsR0FBdUNQLG1CLENBQXZDTyxrQzs7O0FBRW5DLFNBQVNDLGNBQVQsQ0FBd0JDLFFBQXhCLEVBQWtDQyxrQkFBbEMsRUFBc0Q7QUFDcERELGFBQVdBLFNBQVNFLEdBQVQsQ0FBYSxVQUFTQyxNQUFULEVBQWlCO0FBQ3hDQSxhQUFTQyxhQUFhRCxNQUFiLEVBQXFCRixrQkFBckIsQ0FBVDs7QUFFQyxXQUFPRSxNQUFQO0FBQ0QsR0FKVSxDQUFYOztBQU1BLFNBQU9ILFFBQVA7QUFDRDs7QUFFRCxTQUFTSyxjQUFULENBQXdCQyxRQUF4QixFQUFrQ0wsa0JBQWxDLEVBQXNEO0FBQ3BELE1BQU1NLHNCQUFzQkMs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T0UsTUFBUDtBQUNEOztBQUVELFNBQVNXLHNCQUFULENBQWdDWCxNQUFoQyxFQUF3Q1Usd0JBQXhDLEVBQWtFO0FBQ2hFVixXQUFTQSxPQUFPa0MsS0FBUCxFQUFUOztBQUVBbEMsU0FBT29DLGdCQUFQLENBQXdCMUIsd0JBQXhCOztBQUVBLFNBQU9WLE1BQVA7QUFDRDs7QUFFRCxTQUFTSywrQkFBVCxDQUF5Q0YsUUFBekMsRUFBbUQ7QUFBRSxVQUFRLENBQVIsNEJBQWNBLFFBQWQ7QUFBMEIsQyxDQUFFOztBQUVqRixTQUFTSywrQkFBVCxDQUF5Q0osbUJBQXpDLEVBQThEO0FBQUUsU0FBT0Esb0JBQW9CaUMsS0FBcEIsQ0FBMEIsQ0FBMUIsQ0FBUDtBQUFzQyxDLENBQUUiLCJmaWxlIjoicm90YXRpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHZlY3Rvck1hdGhzID0gcmVxdWlyZSgnLi4vbWF0aHMvdmVjdG9yJyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgcXVhdGVybmlvblV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9xdWF0ZXJuaW9uJyk7XG5cbmNvbnN0IHsgZmlyc3QsIHNlY29uZCwgZm91cnRoIH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgdHJhbnNmb3JtMywgbm9ybWFsaXNlMyB9ID0gdmVjdG9yTWF0aHMsXG4gICAgICB7IHJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24sIGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb24gfSA9IHF1YXRlcm5pb25VdGlsaXRpZXM7XG5cbmZ1bmN0aW9uIHJvdGF0ZVZlcnRpY2VzKHZlcnRpY2VzLCByb3RhdGlvblF1YXRlcm5pb24pIHtcbiAgdmVydGljZXMgPSB2ZXJ0aWNlcy5tYXAoZnVuY3Rpb24odmVydGV4KSB7XG4gICB2ZXJ0ZXggPSByb3RhdGVWZXJ0ZXgodmVydGV4LCByb3RhdGlvblF1YXRlcm5pb24pO1xuXG4gICAgcmV0dXJuIHZlcnRleDtcbiAgfSk7XG5cbiAgcmV0dXJuIHZlcnRpY2VzO1xufVxuXG5mdW5jdGlvbiByb3RhdGVQb3NpdGlvbihwb3NpdGlvbiwgcm90YXRpb25RdWF0ZXJuaW9uKSB7XG4gIGNvbnN0IGltYWdpbmFyeVF1YXRlcm5pb24gPSBpbWFnaW5hcnlRdWF0ZXJuaW9uRnJvbVBvc2l0aW9uKHBvc2l0aW9uKSxcbiAgICAgICAgaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbiA9IGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb24ocm90YXRpb25RdWF0ZXJuaW9uKSxcbiAgICAgICAgcm90YXRlZEltYWdpbmFyeVF1YXRlcm5pb24gPSByb3RhdGVJbWFnaW5hcnlRdWF0ZXJuaW9uKGltYWdpbmFyeVF1YXRlcm5pb24sIHJvdGF0aW9uUXVhdGVybmlvbiwgaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbik7XG5cbiAgcG9zaXRpb24gPSBwb3NpdGlvbkZyb21JbWFnaW5hcnlRdWF0ZXJuaW9uKHJvdGF0ZWRJbWFnaW5hcnlRdWF0ZXJuaW9uKTtcblxuICByZXR1cm4gcG9zaXRpb247XG59XG5cbmZ1bmN0aW9uIHJvdGF0ZVZlcnRpY2VzQWJvdXRaQXhpcyh2ZXJ0aWNlcywgcm90YXRpb25BYm91dFpBeGlzTWF0cml4KSB7XG4gIHZlcnRpY2VzID0gdmVydGljZXMubWFwKGZ1bmN0aW9uKHZlcnRleCkge1xuICAgIHZlcnRleCA9IHJvdGF0ZVZlcnRleEFib3V0WkF4aXModmVydGV4LCByb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgpO1xuXG4gICAgcmV0dXJuIHZlcnRleDtcbiAgfSk7XG5cbiAgcmV0dXJuIHZlcnRpY2VzO1xufVxuXG5mdW5jdGlvbiByb3RhdGVQb3NpdGlvbkFib3V0WkF4aXMocG9zaXRpb24sIHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCkge1xuICBwb3NpdGlvbiA9IHRyYW5zZm9ybTMocG9zaXRpb24sIHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCk7XG5cbiAgcmV0dXJuIHBvc2l0aW9uO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgobWFza2luZ0VkZ2UpIHtcbiAgY29uc3QgbWFza2luZ0VkZ2VFeHRlbnQgPSBtYXNraW5nRWRnZS5nZXRFeHRlbnQoKSxcbiAgICAgICAgdW5pdE1hc2tpbmdFZGdlRXh0ZW50ID0gbm9ybWFsaXNlMyhtYXNraW5nRWRnZUV4dGVudCksXG4gICAgICAgIHVuaXRNYXNraW5nRWRnZUV4dGVudENvbXBvbmVudHMgPSB1bml0TWFza2luZ0VkZ2VFeHRlbnQsICAvLy9cbiAgICAgICAgZmlyc3RVbml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnQgPSBmaXJzdCh1bml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnRzKSxcbiAgICAgICAgc2Vjb25kVW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50ID0gc2Vjb25kKHVuaXRNYXNraW5nRWRnZUV4dGVudENvbXBvbmVudHMpLFxuICAgICAgICBhbmdsZU9mUm90YXRpb25Db3NpbmUgPSArc2Vjb25kVW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50LCAgLy8vXG4gICAgICAgIGFuZ2xlT2ZSb3RhdGlvblNpbmUgPSAtZmlyc3RVbml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnQsIC8vL1xuICAgICAgICBjID0gYW5nbGVPZlJvdGF0aW9uQ29zaW5lLFxuICAgICAgICBzID0gYW5nbGVPZlJvdGF0aW9uU2luZSxcbiAgICAgICAgcm90YXRpb25BYm91dFpBeGlzTWF0cml4ID0gWyBjLCAtcywgMCwgK3MsIGMsIDAsIDAsIDAsIDEgXTsgIC8vL1xuXG4gIHJldHVybiByb3RhdGlvbkFib3V0WkF4aXNNYXRyaXg7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4KHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCkge1xuICBjb25zdCBmb3J3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCA9IHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeDsgLy8vXG5cbiAgcmV0dXJuIGZvcndhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4O1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVCYWNrd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgocm90YXRpb25BYm91dFpBeGlzTWF0cml4KSB7XG4gIGNvbnN0IHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeENvbXBvbmVudHMgPSByb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgsIC8vL1xuICAgICAgICBmaXJzdFJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeENvbXBvbmVudCA9IGZpcnN0KHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeENvbXBvbmVudHMpLFxuICAgICAgICBmb3VydGhSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXhDb21wb25lbnQgPSBmb3VydGgocm90YXRpb25BYm91dFpBeGlzTWF0cml4Q29tcG9uZW50cyksXG4gICAgICAgIGMgPSBmaXJzdFJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeENvbXBvbmVudCwgLy8vXG4gICAgICAgIHMgPSBmb3VydGhSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXhDb21wb25lbnQsICAvLy9cbiAgICAgICAgYmFja3dhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4ID0gWyBjLCArcywgMCwgLXMsIGMsIDAsIDAsIDAsIDEgXTtcblxuICByZXR1cm4gYmFja3dhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgcm90YXRlVmVydGljZXM6IHJvdGF0ZVZlcnRpY2VzLFxuICByb3RhdGVQb3NpdGlvbjogcm90YXRlUG9zaXRpb24sXG4gIHJvdGF0ZVZlcnRpY2VzQWJvdXRaQXhpczogcm90YXRlVmVydGljZXNBYm91dFpBeGlzLFxuICByb3RhdGVQb3NpdGlvbkFib3V0WkF4aXM6IHJvdGF0ZVBvc2l0aW9uQWJvdXRaQXhpcyxcbiAgY2FsY3VsYXRlUm90YXRpb25BYm91dFpBeGlzTWF0cml4OiBjYWxjdWxhdGVSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgsXG4gIGNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4OiBjYWxjdWxhdGVGb3J3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCxcbiAgY2FsY3VsYXRlQmFja3dhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4OiBjYWxjdWxhdGVCYWNrd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXhcbn07XG5cbmZ1bmN0aW9uIHJvdGF0ZVZlcnRleCh2ZXJ0ZXgsIHJvdGF0aW9uUXVhdGVybmlvbikge1xuICB2ZXJ0ZXggPSB2ZXJ0ZXguY2xvbmUoKTsgIC8vL1xuXG4gIHZlcnRleC5yb3RhdGUocm90YXRpb25RdWF0ZXJuaW9uKTtcblxuICByZXR1cm4gdmVydGV4O1xufVxuXG5mdW5jdGlvbiByb3RhdGVWZXJ0ZXhBYm91dFpBeGlzKHZlcnRleCwgcm90YXRpb25BYm91dFpBeGlzTWF0cml4KSB7XG4gIHZlcnRleCA9IHZlcnRleC5jbG9uZSgpO1xuXG4gIHZlcnRleC5yb3RhdGVBYm91dFpBeGlzKHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCk7XG5cbiAgcmV0dXJuIHZlcnRleDtcbn1cblxuZnVuY3Rpb24gaW1hZ2luYXJ5UXVhdGVybmlvbkZyb21Qb3NpdGlvbihwb3NpdGlvbikgeyByZXR1cm4gWzAsIC4uLnBvc2l0aW9uXTsgfSAgLy8vXG5cbmZ1bmN0aW9uIHBvc2l0aW9uRnJvbUltYWdpbmFyeVF1YXRlcm5pb24oaW1hZ2luYXJ5UXVhdGVybmlvbikgeyByZXR1cm4gaW1hZ2luYXJ5UXVhdGVybmlvbi5zbGljZSgxKTsgfSAgLy8vXG4iXX0=