'use strict';

var arrayUtilities = require('../utilities/array'),
    angleUtilities = require('../utilities/angle'),
    vectorUtilities = require('../utilities/vector'),
    approximateUtilities = require('../utilities/approximate');

var dot3 = vectorUtilities.dot3,
    cross3 = vectorUtilities.cross3,
    normalise3 = vectorUtilities.normalise3,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    fourth = arrayUtilities.fourth,
    isApproximatelyEqualToOne = approximateUtilities.isApproximatelyEqualToOne,
    calculateHalfAngleCosine = angleUtilities.calculateHalfAngleCosine,
    calculateHalfAngleSine = angleUtilities.calculateHalfAngleSine;


function rotateImaginaryQuaternion(imaginaryQuaternion, rotationQuaternion, inverseRotationQuaternion) {
  return hamiltonProduct(hamiltonProduct(rotationQuaternion, imaginaryQuaternion), inverseRotationQuaternion);
}

function calculateRotationQuaternion(normal) {
  var unitNormal = normalise3(normal),
      zAxis = [0, 0, 1],
      dotProductOfUnitNormalAndZAxis = dot3(unitNormal, zAxis),
      crossProductOfUnitNormalAndZAxis = cross3(unitNormal, zAxis),
      angleOfRotationCosine = dotProductOfUnitNormalAndZAxis,
      ///
  angleOfRotationCosineAbsoluteValue = Math.abs(angleOfRotationCosine),
      angleOfRotationCosineAbsoluteValueApproximatelyEqualToOne = isApproximatelyEqualToOne(angleOfRotationCosineAbsoluteValue),
      axisOfRotation = angleOfRotationCosineAbsoluteValueApproximatelyEqualToOne ? [1, 0, 0] : ///
  crossProductOfUnitNormalAndZAxis,
      unitAxisOfRotation = normalise3(axisOfRotation),
      halfAngleOfRotationCosine = calculateHalfAngleCosine(angleOfRotationCosine),
      halfAngleOfRotationSine = calculateHalfAngleSine(angleOfRotationCosine),
      unitAxisOfRotationComponents = unitAxisOfRotation,
      ///
  firstAxisOfRotationComponent = first(unitAxisOfRotationComponents),
      secondAxisOfRotationComponent = second(unitAxisOfRotationComponents),
      thirdAxisOfRotationComponent = third(unitAxisOfRotationComponents),
      rotationQuaternion = [halfAngleOfRotationCosine, firstAxisOfRotationComponent * halfAngleOfRotationSine, secondAxisOfRotationComponent * halfAngleOfRotationSine, thirdAxisOfRotationComponent * halfAngleOfRotationSine];

  return rotationQuaternion;
}

function calculateInverseRotationQuaternion(rotationQuaternion) {
  var rotationQuaternionComponents = rotationQuaternion,
      ///
  firstRotationQuaternionComponent = first(rotationQuaternionComponents),
      secondRotationQuaternionComponent = second(rotationQuaternionComponents),
      thirdRotationQuaternionComponent = third(rotationQuaternionComponents),
      fourthRotationQuaternionComponent = fourth(rotationQuaternionComponents),
      inverseRotationQuaternion = [firstRotationQuaternionComponent, -secondRotationQuaternionComponent, -thirdRotationQuaternionComponent, -fourthRotationQuaternionComponent];

  return inverseRotationQuaternion;
}

function calculateForwardsRotationQuaternion(rotationQuaternion) {
  var forwardsRotationQuaternion = rotationQuaternion; ///

  return forwardsRotationQuaternion;
}

function calculateBackwardsRotationQuaternion(rotationQuaternion) {
  var inverseRotationQuaternion = calculateInverseRotationQuaternion(rotationQuaternion),
      backwardsRotationQuaternion = inverseRotationQuaternion; ///

  return backwardsRotationQuaternion;
}

function calculateForwardsRotationAboutZAxisMatrix(rotationAboutZAxisMatrix) {
  var forwardsRotationAboutZAxisMatrix = rotationAboutZAxisMatrix; ///

  return forwardsRotationAboutZAxisMatrix;
}

function calculateBackwardsRotationAboutZAxisMatrix(rotationAboutZAxisMatrix) {
  var rotationAboutZAxisMatrixComponents = rotationAboutZAxisMatrix,
      ///
  firstRotationAboutZAxisMatrixComponent = first(rotationAboutZAxisMatrixComponents),
      fourthRotationAboutZAxisMatrixComponent = fourth(rotationAboutZAxisMatrixComponents),
      c = firstRotationAboutZAxisMatrixComponent,
      ///
  s = fourthRotationAboutZAxisMatrixComponent,
      ///
  backwardsRotationAboutZAxisMatrix = [c, +s, 0, -s, c, 0, 0, 0, 1];

  return backwardsRotationAboutZAxisMatrix;
}

module.exports = {
  rotateImaginaryQuaternion: rotateImaginaryQuaternion,
  calculateRotationQuaternion: calculateRotationQuaternion,
  calculateInverseRotationQuaternion: calculateInverseRotationQuaternion,
  calculateForwardsRotationQuaternion: calculateForwardsRotationQuaternion,
  calculateBackwardsRotationQuaternion: calculateBackwardsRotationQuaternion,
  calculateForwardsRotationAboutZAxisMatrix: calculateForwardsRotationAboutZAxisMatrix,
  calculateBackwardsRotationAboutZAxisMatrix: calculateBackwardsRotationAboutZAxisMatrix
};

function hamiltonProduct(quaternionA, quaternionB) {
  var quaternionAComponents = quaternionA,
      ///
  quaternionBComponents = quaternionB,
      ///
  firstQuaternionAComponent = first(quaternionAComponents),
      secondQuaternionAComponent = second(quaternionAComponents),
      thirdQuaternionAComponent = third(quaternionAComponents),
      fourthQuaternionAComponent = fourth(quaternionAComponents),
      firstQuaternionBComponent = first(quaternionBComponents),
      secondQuaternionBComponent = second(quaternionBComponents),
      thirdQuaternionBComponent = third(quaternionBComponents),
      fourthQuaternionBComponent = fourth(quaternionBComponents),
      a1 = firstQuaternionAComponent,
      ///
  b1 = secondQuaternionAComponent,
      ///
  c1 = thirdQuaternionAComponent,
      ///
  d1 = fourthQuaternionAComponent,
      ///
  a2 = firstQuaternionBComponent,
      ///
  b2 = secondQuaternionBComponent,
      ///
  c2 = thirdQuaternionBComponent,
      ///
  d2 = fourthQuaternionBComponent,
      ///
  a = a1 * a2 - b1 * b2 - c1 * c2 - d1 * d2,
      b = a1 * b2 + b1 * a2 + c1 * d2 - d1 * c2,
      c = a1 * c2 - b1 * d2 + c1 * a2 + d1 * b2,
      d = a1 * d2 + b1 * c2 - c1 * b2 + d1 * a2,
      quaternion = [a, b, c, d];

  return quaternion;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvcm90YXRpb24uanMiXSwibmFtZXMiOlsiYXJyYXlVdGlsaXRpZXMiLCJyZXF1aXJlIiwiYW5nbGVVdGlsaXRpZXMiLCJ2ZWN0b3JVdGlsaXRpZXMiLCJhcHByb3hpbWF0ZVV0aWxpdGllcyIsImRvdDMiLCJjcm9zczMiLCJub3JtYWxpc2UzIiwiZmlyc3QiLCJzZWNvbmQiLCJ0aGlyZCIsImZvdXJ0aCIsImlzQXBwcm94aW1hdGVseUVxdWFsVG9PbmUiLCJjYWxjdWxhdGVIYWxmQW5nbGVDb3NpbmUiLCJjYWxjdWxhdGVIYWxmQW5nbGVTaW5lIiwicm90YXRlSW1hZ2luYXJ5UXVhdGVybmlvbiIsImltYWdpbmFyeVF1YXRlcm5pb24iLCJyb3RhdGlvblF1YXRlcm5pb24iLCJpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uIiwiaGFtaWx0b25Qcm9kdWN0IiwiY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uIiwibm9ybWFsIiwidW5pdE5vcm1hbCIsInpBeGlzIiwiZG90UHJvZHVjdE9mVW5pdE5vcm1hbEFuZFpBeGlzIiwiY3Jvc3NQcm9kdWN0T2ZVbml0Tm9ybWFsQW5kWkF4aXMiLCJhbmdsZU9mUm90YXRpb25Db3NpbmUiLCJhbmdsZU9mUm90YXRpb25Db3NpbmVBYnNvbHV0ZVZhbHVlIiwiTWF0aCIsImFicyIsImFuZ2xlT2ZSb3RhdGlvbkNvc2luZUFic29sdXRlVmFsdWVBcHByb3hpbWF0ZWx5RXF1YWxUb09uZSIsImF4aXNPZlJvdGF0aW9uIiwidW5pdEF4aXNPZlJvdGF0aW9uIiwiaGFsZkFuZ2xlT2ZSb3RhdGlvbkNvc2luZSIsImhhbGZBbmdsZU9mUm90YXRpb25TaW5lIiwidW5pdEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50cyIsImZpcnN0QXhpc09mUm90YXRpb25Db21wb25lbnQiLCJzZWNvbmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCIsInRoaXJkQXhpc09mUm90YXRpb25Db21wb25lbnQiLCJjYWxjdWxhdGVJbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uIiwicm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50cyIsImZpcnN0Um90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50Iiwic2Vjb25kUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50IiwidGhpcmRSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQiLCJmb3VydGhSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQiLCJjYWxjdWxhdGVGb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbiIsImZvcndhcmRzUm90YXRpb25RdWF0ZXJuaW9uIiwiY2FsY3VsYXRlQmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uIiwiYmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uIiwiY2FsY3VsYXRlRm9yd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgiLCJyb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgiLCJmb3J3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCIsImNhbGN1bGF0ZUJhY2t3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCIsInJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeENvbXBvbmVudHMiLCJmaXJzdFJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeENvbXBvbmVudCIsImZvdXJ0aFJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeENvbXBvbmVudCIsImMiLCJzIiwiYmFja3dhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4IiwibW9kdWxlIiwiZXhwb3J0cyIsInF1YXRlcm5pb25BIiwicXVhdGVybmlvbkIiLCJxdWF0ZXJuaW9uQUNvbXBvbmVudHMiLCJxdWF0ZXJuaW9uQkNvbXBvbmVudHMiLCJmaXJzdFF1YXRlcm5pb25BQ29tcG9uZW50Iiwic2Vjb25kUXVhdGVybmlvbkFDb21wb25lbnQiLCJ0aGlyZFF1YXRlcm5pb25BQ29tcG9uZW50IiwiZm91cnRoUXVhdGVybmlvbkFDb21wb25lbnQiLCJmaXJzdFF1YXRlcm5pb25CQ29tcG9uZW50Iiwic2Vjb25kUXVhdGVybmlvbkJDb21wb25lbnQiLCJ0aGlyZFF1YXRlcm5pb25CQ29tcG9uZW50IiwiZm91cnRoUXVhdGVybmlvbkJDb21wb25lbnQiLCJhMSIsImIxIiwiYzEiLCJkMSIsImEyIiwiYjIiLCJjMiIsImQyIiwiYSIsImIiLCJkIiwicXVhdGVybmlvbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsaUJBQWlCQyxRQUFRLG9CQUFSLENBQXZCO0FBQUEsSUFDTUMsaUJBQWlCRCxRQUFRLG9CQUFSLENBRHZCO0FBQUEsSUFFTUUsa0JBQWtCRixRQUFRLHFCQUFSLENBRnhCO0FBQUEsSUFHTUcsdUJBQXVCSCxRQUFRLDBCQUFSLENBSDdCOztJQUtRSSxJLEdBQTZCRixlLENBQTdCRSxJO0lBQU1DLE0sR0FBdUJILGUsQ0FBdkJHLE07SUFBUUMsVSxHQUFlSixlLENBQWZJLFU7SUFDZEMsSyxHQUFpQ1IsYyxDQUFqQ1EsSztJQUFPQyxNLEdBQTBCVCxjLENBQTFCUyxNO0lBQVFDLEssR0FBa0JWLGMsQ0FBbEJVLEs7SUFBT0MsTSxHQUFXWCxjLENBQVhXLE07SUFDdEJDLHlCLEdBQThCUixvQixDQUE5QlEseUI7SUFDQUMsd0IsR0FBcURYLGMsQ0FBckRXLHdCO0lBQTBCQyxzQixHQUEyQlosYyxDQUEzQlksc0I7OztBQUVsQyxTQUFTQyx5QkFBVCxDQUFtQ0MsbUJBQW5DLEVBQXdEQyxrQkFBeEQsRUFBNEVDLHlCQUE1RSxFQUF1RztBQUFFLFNBQU9DLGdCQUFnQkEsZ0JBQWdCRixrQkFBaEIsRUFBb0NELG1CQUFwQyxDQUFoQixFQUEwRUUseUJBQTFFLENBQVA7QUFBOEc7O0FBRXZOLFNBQVNFLDJCQUFULENBQXFDQyxNQUFyQyxFQUE2QztBQUMzQyxNQUFNQyxhQUFhZixXQUFXYyxNQUFYLENBQW5CO0FBQUEsTUFDTUUsUUFBUSxDQUFFLENBQUYsRUFBSyxDQUFMLEVBQVEsQ0FBUixDQURkO0FBQUEsTUFFTUMsaUNBQWlDbkIsS0FBS2lCLFVBQUwsRUFBaUJDLEtBQWpCLENBRnZDO0FBQUEsTUFH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R0FBb0JGLEtBQUtLLEVBQXpCLEdBQThCSixLQUFLRyxFQW5CN0M7QUFBQSxNQW9CTXZCLElBQUlpQixLQUFLTSxFQUFMLEdBQVVMLEtBQUtNLEVBQWYsR0FBb0JMLEtBQUtFLEVBQXpCLEdBQThCRCxLQUFLRSxFQXBCN0M7QUFBQSxNQXFCTUssSUFBSVYsS0FBS08sRUFBTCxHQUFVTixLQUFLSyxFQUFmLEdBQW9CSixLQUFLRyxFQUF6QixHQUE4QkYsS0FBS0MsRUFyQjdDO0FBQUEsTUFzQk1PLGFBQWEsQ0FBRUgsQ0FBRixFQUFLQyxDQUFMLEVBQVExQixDQUFSLEVBQVcyQixDQUFYLENBdEJuQjs7QUF3QkEsU0FBT0MsVUFBUDtBQUNEIiwiZmlsZSI6InJvdGF0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgYW5nbGVVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvYW5nbGUnKSxcbiAgICAgIHZlY3RvclV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy92ZWN0b3InKSxcbiAgICAgIGFwcHJveGltYXRlVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2FwcHJveGltYXRlJyk7XG5cbmNvbnN0IHsgZG90MywgY3Jvc3MzLCBub3JtYWxpc2UzIH0gPSB2ZWN0b3JVdGlsaXRpZXMsXG4gICAgICB7IGZpcnN0LCBzZWNvbmQsIHRoaXJkLCBmb3VydGggfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBpc0FwcHJveGltYXRlbHlFcXVhbFRvT25lIH0gPSBhcHByb3hpbWF0ZVV0aWxpdGllcyxcbiAgICAgIHsgY2FsY3VsYXRlSGFsZkFuZ2xlQ29zaW5lLCBjYWxjdWxhdGVIYWxmQW5nbGVTaW5lIH0gPSBhbmdsZVV0aWxpdGllcztcblxuZnVuY3Rpb24gcm90YXRlSW1hZ2luYXJ5UXVhdGVybmlvbihpbWFnaW5hcnlRdWF0ZXJuaW9uLCByb3RhdGlvblF1YXRlcm5pb24sIGludmVyc2VSb3RhdGlvblF1YXRlcm5pb24pIHsgcmV0dXJuIGhhbWlsdG9uUHJvZHVjdChoYW1pbHRvblByb2R1Y3Qocm90YXRpb25RdWF0ZXJuaW9uLCBpbWFnaW5hcnlRdWF0ZXJuaW9uKSwgaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbik7IH1cblxuZnVuY3Rpb24gY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uKG5vcm1hbCkge1xuICBjb25zdCB1bml0Tm9ybWFsID0gbm9ybWFsaXNlMyhub3JtYWwpLFxuICAgICAgICB6QXhpcyA9IFsgMCwgMCwgMV0sXG4gICAgICAgIGRvdFByb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcyA9IGRvdDModW5pdE5vcm1hbCwgekF4aXMpLFxuICAgICAgICBjcm9zc1Byb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcyA9IGNyb3NzMyh1bml0Tm9ybWFsLCB6QXhpcyksXG4gICAgICAgIGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSA9IGRvdFByb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcywgLy8vXG4gICAgICAgIGFuZ2xlT2ZSb3RhdGlvbkNvc2luZUFic29sdXRlVmFsdWUgPSBNYXRoLmFicyhhbmdsZU9mUm90YXRpb25Db3NpbmUpLFxuICAgICAgICBhbmdsZU9mUm90YXRpb25Db3NpbmVBYnNvbHV0ZVZhbHVlQXBwcm94aW1hdGVseUVxdWFsVG9PbmUgPSBpc0FwcHJveGltYXRlbHlFcXVhbFRvT25lKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZUFic29sdXRlVmFsdWUpLFxuICAgICAgICBheGlzT2ZSb3RhdGlvbiA9IGFuZ2xlT2ZSb3RhdGlvbkNvc2luZUFic29sdXRlVmFsdWVBcHByb3hpbWF0ZWx5RXF1YWxUb09uZSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBbIDEsIDAsIDAgXSA6IC8vL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcm9zc1Byb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcyxcbiAgICAgICAgdW5pdEF4aXNPZlJvdGF0aW9uID0gbm9ybWFsaXNlMyhheGlzT2ZSb3RhdGlvbiksXG4gICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25Db3NpbmUgPSBjYWxjdWxhdGVIYWxmQW5nbGVDb3NpbmUoYW5nbGVPZlJvdGF0aW9uQ29zaW5lKSxcbiAgICAgICAgaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmUgPSBjYWxjdWxhdGVIYWxmQW5nbGVTaW5lKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSksXG4gICAgICAgIHVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMgPSB1bml0QXhpc09mUm90YXRpb24sICAvLy9cbiAgICAgICAgZmlyc3RBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCA9IGZpcnN0KHVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMpLFxuICAgICAgICBzZWNvbmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCA9IHNlY29uZCh1bml0QXhpc09mUm90YXRpb25Db21wb25lbnRzKSxcbiAgICAgICAgdGhpcmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCA9IHRoaXJkKHVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMpLFxuICAgICAgICByb3RhdGlvblF1YXRlcm5pb24gPSBbXG4gICAgICAgICAgaGFsZkFuZ2xlT2ZSb3RhdGlvbkNvc2luZSxcbiAgICAgICAgICBmaXJzdEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50ICogaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmUsXG4gICAgICAgICAgc2Vjb25kQXhpc09mUm90YXRpb25Db21wb25lbnQgKiBoYWxmQW5nbGVPZlJvdGF0aW9uU2luZSxcbiAgICAgICAgICB0aGlyZEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50ICogaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmVcbiAgICAgICAgXTtcblxuICByZXR1cm4gcm90YXRpb25RdWF0ZXJuaW9uO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVJbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uKHJvdGF0aW9uUXVhdGVybmlvbikge1xuICBjb25zdCByb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzID0gcm90YXRpb25RdWF0ZXJuaW9uLCAgLy8vXG4gICAgICAgIGZpcnN0Um90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50ID0gZmlyc3Qocm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCA9IHNlY29uZChyb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzKSxcbiAgICAgICAgdGhpcmRSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQgPSB0aGlyZChyb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzKSxcbiAgICAgICAgZm91cnRoUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50ID0gZm91cnRoKHJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMpLFxuICAgICAgICBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uID0gW1xuICAgICAgICAgIGZpcnN0Um90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50LFxuICAgICAgICAgIC1zZWNvbmRSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQsXG4gICAgICAgICAgLXRoaXJkUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50LFxuICAgICAgICAgIC1mb3VydGhSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRcbiAgICAgICAgXTtcblxuICByZXR1cm4gaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbjtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlRm9yd2FyZHNSb3RhdGlvblF1YXRlcm5pb24ocm90YXRpb25RdWF0ZXJuaW9uKSB7XG4gIGNvbnN0IGZvcndhcmRzUm90YXRpb25RdWF0ZXJuaW9uID0gcm90YXRpb25RdWF0ZXJuaW9uOyAgLy8vXG5cbiAgcmV0dXJuIGZvcndhcmRzUm90YXRpb25RdWF0ZXJuaW9uO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVCYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb24ocm90YXRpb25RdWF0ZXJuaW9uKSB7XG4gIGNvbnN0IGludmVyc2VSb3RhdGlvblF1YXRlcm5pb24gPSBjYWxjdWxhdGVJbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uKHJvdGF0aW9uUXVhdGVybmlvbiksXG4gICAgICAgIGJhY2t3YXJkc1JvdGF0aW9uUXVhdGVybmlvbiA9IGludmVyc2VSb3RhdGlvblF1YXRlcm5pb247ICAvLy9cblxuICByZXR1cm4gYmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uO1xuXG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4KHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCkge1xuICBjb25zdCBmb3J3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCA9IHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeDsgLy8vXG5cbiAgcmV0dXJuIGZvcndhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4O1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVCYWNrd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgocm90YXRpb25BYm91dFpBeGlzTWF0cml4KSB7XG4gIGNvbnN0IHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeENvbXBvbmVudHMgPSByb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgsIC8vL1xuICAgICAgICBmaXJzdFJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeENvbXBvbmVudCA9IGZpcnN0KHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeENvbXBvbmVudHMpLFxuICAgICAgICBmb3VydGhSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXhDb21wb25lbnQgPSBmb3VydGgocm90YXRpb25BYm91dFpBeGlzTWF0cml4Q29tcG9uZW50cyksXG4gICAgICAgIGMgPSBmaXJzdFJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeENvbXBvbmVudCwgLy8vXG4gICAgICAgIHMgPSBmb3VydGhSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXhDb21wb25lbnQsICAvLy9cbiAgICAgICAgYmFja3dhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4ID0gWyBjLCArcywgMCwgLXMsIGMsIDAsIDAsIDAsIDEgXTtcblxuICByZXR1cm4gYmFja3dhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgcm90YXRlSW1hZ2luYXJ5UXVhdGVybmlvbjogcm90YXRlSW1hZ2luYXJ5UXVhdGVybmlvbixcbiAgY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uOiBjYWxjdWxhdGVSb3RhdGlvblF1YXRlcm5pb24sXG4gIGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb246IGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb24sXG4gIGNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25RdWF0ZXJuaW9uOiBjYWxjdWxhdGVGb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbixcbiAgY2FsY3VsYXRlQmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uOiBjYWxjdWxhdGVCYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb24sXG4gIGNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4OiBjYWxjdWxhdGVGb3J3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCxcbiAgY2FsY3VsYXRlQmFja3dhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4OiBjYWxjdWxhdGVCYWNrd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXhcbn07XG5cbmZ1bmN0aW9uIGhhbWlsdG9uUHJvZHVjdChxdWF0ZXJuaW9uQSwgcXVhdGVybmlvbkIpIHtcbiAgY29uc3QgcXVhdGVybmlvbkFDb21wb25lbnRzID0gcXVhdGVybmlvbkEsICAvLy9cbiAgICAgICAgcXVhdGVybmlvbkJDb21wb25lbnRzID0gcXVhdGVybmlvbkIsICAvLy9cbiAgICAgICAgZmlyc3RRdWF0ZXJuaW9uQUNvbXBvbmVudCA9IGZpcnN0KHF1YXRlcm5pb25BQ29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZFF1YXRlcm5pb25BQ29tcG9uZW50ID0gc2Vjb25kKHF1YXRlcm5pb25BQ29tcG9uZW50cyksXG4gICAgICAgIHRoaXJkUXVhdGVybmlvbkFDb21wb25lbnQgPSB0aGlyZChxdWF0ZXJuaW9uQUNvbXBvbmVudHMpLFxuICAgICAgICBmb3VydGhRdWF0ZXJuaW9uQUNvbXBvbmVudCA9IGZvdXJ0aChxdWF0ZXJuaW9uQUNvbXBvbmVudHMpLFxuICAgICAgICBmaXJzdFF1YXRlcm5pb25CQ29tcG9uZW50ID0gZmlyc3QocXVhdGVybmlvbkJDb21wb25lbnRzKSxcbiAgICAgICAgc2Vjb25kUXVhdGVybmlvbkJDb21wb25lbnQgPSBzZWNvbmQocXVhdGVybmlvbkJDb21wb25lbnRzKSxcbiAgICAgICAgdGhpcmRRdWF0ZXJuaW9uQkNvbXBvbmVudCA9IHRoaXJkKHF1YXRlcm5pb25CQ29tcG9uZW50cyksXG4gICAgICAgIGZvdXJ0aFF1YXRlcm5pb25CQ29tcG9uZW50ID0gZm91cnRoKHF1YXRlcm5pb25CQ29tcG9uZW50cyksXG4gICAgICAgIGExID0gZmlyc3RRdWF0ZXJuaW9uQUNvbXBvbmVudCwgLy8vXG4gICAgICAgIGIxID0gc2Vjb25kUXVhdGVybmlvbkFDb21wb25lbnQsICAvLy9cbiAgICAgICAgYzEgPSB0aGlyZFF1YXRlcm5pb25BQ29tcG9uZW50LCAvLy9cbiAgICAgICAgZDEgPSBmb3VydGhRdWF0ZXJuaW9uQUNvbXBvbmVudCwgIC8vL1xuICAgICAgICBhMiA9IGZpcnN0UXVhdGVybmlvbkJDb21wb25lbnQsIC8vL1xuICAgICAgICBiMiA9IHNlY29uZFF1YXRlcm5pb25CQ29tcG9uZW50LCAgLy8vXG4gICAgICAgIGMyID0gdGhpcmRRdWF0ZXJuaW9uQkNvbXBvbmVudCwgLy8vXG4gICAgICAgIGQyID0gZm91cnRoUXVhdGVybmlvbkJDb21wb25lbnQsICAvLy9cbiAgICAgICAgYSA9IGExICogYTIgLSBiMSAqIGIyIC0gYzEgKiBjMiAtIGQxICogZDIsXG4gICAgICAgIGIgPSBhMSAqIGIyICsgYjEgKiBhMiArIGMxICogZDIgLSBkMSAqIGMyLFxuICAgICAgICBjID0gYTEgKiBjMiAtIGIxICogZDIgKyBjMSAqIGEyICsgZDEgKiBiMixcbiAgICAgICAgZCA9IGExICogZDIgKyBiMSAqIGMyIC0gYzEgKiBiMiArIGQxICogYTIsXG4gICAgICAgIHF1YXRlcm5pb24gPSBbIGEsIGIsIGMsIGQgXTtcblxuICByZXR1cm4gcXVhdGVybmlvbjtcbn1cbiJdfQ==