'use strict';

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

var vectorMaths = require('../maths/vector'),
    arrayUtilities = require('../utilities/array'),
    quaternionUtilities = require('../utilities/quaternion');

var first = arrayUtilities.first,
    second = arrayUtilities.second,
    fourth = arrayUtilities.fourth,
    transform3 = vectorMaths.transform3,
    normalise3 = vectorMaths.normalise3,
    rotateImaginaryQuaternion = quaternionUtilities.rotateImaginaryQuaternion,
    calculateInverseRotationQuaternion = quaternionUtilities.calculateInverseRotationQuaternion;


function rotatePosition(position, rotationQuaternion) {
  var imaginaryQuaternion = imaginaryQuaternionFromPosition(position),
      inverseRotationQuaternion = calculateInverseRotationQuaternion(rotationQuaternion),
      rotatedImaginaryQuaternion = rotateImaginaryQuaternion(imaginaryQuaternion, rotationQuaternion, inverseRotationQuaternion);

  position = positionFromImaginaryQuaternion(rotatedImaginaryQuaternion);

  return position;
}

function rotatePositionAboutZAxis(position, rotationAboutZAxisMatrix) {
  position = transform3(position, rotationAboutZAxisMatrix);

  return position;
}

function calculateRotationAboutZAxisMatrix(maskingEdge) {
  var maskingEdgeExtent = maskingEdge.getExtent(),
      unitMaskingEdgeExtent = normalise3(maskingEdgeExtent),
      unitMaskingEdgeExtentComponents = unitMaskingEdgeExtent,
      ///
  firstUnitMaskingEdgeExtentComponent = first(unitMaskingEdgeExtentComponents),
      secondUnitMaskingEdgeExtentComponent = second(unitMaskingEdgeExtentComponents),
      angleOfRotationCosine = +secondUnitMaskingEdgeExtentComponent,
      ///
  angleOfRotationSine = -firstUnitMaskingEdgeExtentComponent,
      ///
  c = angleOfRotationCosine,
      s = angleOfRotationSine,
      rotationAboutZAxisMatrix = [c, -s, 0, +s, c, 0, 0, 0, 1]; ///

  return rotationAboutZAxisMatrix;
}

function calculateForwardsRotationAboutZAxisMatrix(rotationAboutZAxisMatrix) {
  var forwardsRotationAboutZAxisMatrix = rotationAboutZAxisMatrix; ///

  return forwardsRotationAboutZAxisMatrix;
}

function calculateBackwardsRotationAboutZAxisMatrix(rotationAboutZAxisMatrix) {
  var rotationAboutZAxisMatrixComponents = rotationAboutZAxisMatrix,
      ///
  firstRotationAboutZAxisMatrixComponent = first(rotationAboutZAxisMatrixComponents),
      fourthRotationAboutZAxisMatrixComponent = fourth(rotationAboutZAxisMatrixComponents),
      c = firstRotationAboutZAxisMatrixComponent,
      ///
  s = fourthRotationAboutZAxisMatrixComponent,
      ///
  backwardsRotationAboutZAxisMatrix = [c, +s, 0, -s, c, 0, 0, 0, 1];

  return backwardsRotationAboutZAxisMatrix;
}

module.exports = {
  rotatePosition: rotatePosition,
  rotatePositionAboutZAxis: rotatePositionAboutZAxis,
  calculateRotationAboutZAxisMatrix: calculateRotationAboutZAxisMatrix,
  calculateForwardsRotationAboutZAxisMatrix: calculateForwardsRotationAboutZAxisMatrix,
  calculateBackwardsRotationAboutZAxisMatrix: calculateBackwardsRotationAboutZAxisMatrix
};

function imaginaryQuaternionFromPosition(position) {
  return [0].concat(_toConsumableArray(position));
} ///

function positionFromImaginaryQuaternion(imaginaryQuaternion) {
  return imaginaryQuaternion.slice(1);
} ///
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvcm90YXRpb24uanMiXSwibmFtZXMiOlsidmVjdG9yTWF0aHMiLCJyZXF1aXJlIiwiYXJyYXlVdGlsaXRpZXMiLCJxdWF0ZXJuaW9uVXRpbGl0aWVzIiwiZmlyc3QiLCJzZWNvbmQiLCJmb3VydGgiLCJ0cmFuc2Zvcm0zIiwibm9ybWFsaXNlMyIsInJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24iLCJjYWxjdWxhdGVJbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uIiwicm90YXRlUG9zaXRpb24iLCJwb3NpdGlvbiIsInJvdGF0aW9uUXVhdGVybmlvbiIsImltYWdpbmFyeVF1YXRlcm5pb24iLCJpbWFnaW5hcnlRdWF0ZXJuaW9uRnJvbVBvc2l0aW9uIiwiaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbiIsInJvdGF0ZWRJbWFnaW5hcnlRdWF0ZXJuaW9uIiwicG9zaXRpb25Gcm9tSW1hZ2luYXJ5UXVhdGVybmlvbiIsInJvdGF0ZVBvc2l0aW9uQWJvdXRaQXhpcyIsInJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCIsImNhbGN1bGF0ZVJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCIsIm1hc2tpbmdFZGdlIiwibWFza2luZ0VkZ2VFeHRlbnQiLCJnZXRFeHRlbnQiLCJ1bml0TWFza2luZ0VkZ2VFeHRlbnQiLCJ1bml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnRzIiwiZmlyc3RVbml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnQiLCJzZWNvbmRVbml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnQiLCJhbmdsZU9mUm90YXRpb25Db3NpbmUiLCJhbmdsZU9mUm90YXRpb25TaW5lIiwiYyIsInMiLCJjYWxjdWxhdGVGb3J3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCIsImZvcndhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4IiwiY2FsY3VsYXRlQmFja3dhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4Iiwicm90YXRpb25BYm91dFpBeGlzTWF0cml4Q29tcG9uZW50cyIsImZpcnN0Um90YXRpb25BYm91dFpBeGlzTWF0cml4Q29tcG9uZW50IiwiZm91cnRoUm90YXRpb25BYm91dFpBeGlzTWF0cml4Q29tcG9uZW50IiwiYmFja3dhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4IiwibW9kdWxlIiwiZXhwb3J0cyIsInNsaWNlIl0sIm1hcHBpbmdzIjoiQUFBQTs7OztBQUVBLElBQU1BLGNBQWNDLFFBQVEsaUJBQVIsQ0FBcEI7QUFBQSxJQUNNQyxpQkFBaUJELFFBQVEsb0JBQVIsQ0FEdkI7QUFBQSxJQUVNRSxzQkFBc0JGLFFBQVEseUJBQVIsQ0FGNUI7O0lBSVFHLEssR0FBMEJGLGMsQ0FBMUJFLEs7SUFBT0MsTSxHQUFtQkgsYyxDQUFuQkcsTTtJQUFRQyxNLEdBQVdKLGMsQ0FBWEksTTtJQUNmQyxVLEdBQTJCUCxXLENBQTNCTyxVO0lBQVlDLFUsR0FBZVIsVyxDQUFmUSxVO0lBQ1pDLHlCLEdBQWtFTixtQixDQUFsRU0seUI7SUFBMkJDLGtDLEdBQXVDUCxtQixDQUF2Q08sa0M7OztBQUVuQyxTQUFTQyxjQUFULENBQXdCQyxRQUF4QixFQUFrQ0Msa0JBQWxDLEVBQXNEO0FBQ3BELE1BQU1DLHNCQUFzQkMsZ0NBQWdDSCxRQUFoQyxDQUE1QjtBQUFBLE1BQ01JLDRCQUE0Qk4sbUNBQW1DRyxrQkFBbkMsQ0FEbEM7QUFBQSxNQUVNSSw2QkFBNkJSLDBCQUEwQkssbUJBQTFCLEVBQStDRCxrQkFBL0MsRUFBbUVHLHlCQUFuRSxDQUZuQzs7QUFJQUosYUFBV00sZ0NBQWdDRCwwQkFBaEMsQ0FBWDs7QUFFQSxTQUFPTCxRQUFQO0FBQ0Q7O0FBRUQsU0FBU08sd0JBQVQsQ0FBa0NQLFFBQWxDLEVBQTRDUSx3QkFBNUMsRUFBc0U7QUFDcEVSLGFBQVdMLFdBQVdLLFFBQVgsRUFBcUJRLHdCQUFyQixDQUFYOztBQUVBLFNBQU9SLFFBQVA7QUFDRDs7QUFFRCxTQUFTUyxpQ0FBVCxDQUEyQ0MsV0FBM0MsRUFBd0Q7QUFDdEQsTUFBTUMsb0JBQW9CRCxZQUFZRSxTQUFaLEVBQTFCO0FBQUEsTUFDTUMsd0JBQXdCakIsV0FBV2UsaUJBQVgsQ0FEOUI7QUFBQSxNQUVNRyxrQ0FBa0NELHFCQUZ4QztBQUFBLE1BRWdFO0FBQzFERSx3Q0FBc0N2QixNQUFNc0IsK0JBQU4sQ0FINUM7QUFBQSxNQUlNRSx1Q0FBdUN2QixPQUFPcUIsK0JBQVAsQ0FKN0M7QUFBQSxNQUtNRyx3QkFBd0IsQ0FBQ0Qsb0NBTC9CO0FBQUEsTUFLc0U7QUFDaEVFLHdCQUFzQixDQUFDSCxtQ0FON0I7QUFBQSxNQU1rRTtBQUM1REksTUFBSUYscUJBUFY7QUFBQSxNQVFNRyxJQUFJRixtQkFSVjtBQUFBLE1BU01WLDJCQUEyQixDQUFFVyxDQUFGLEVBQUssQ0FBQ0MsQ0FBTixFQUFTLENBQVQsRUFBWSxDQUFDQSxDQUFiLEVBQWdCRCxDQUFoQixFQUFtQixDQUFuQixFQUFzQixDQUF0QixFQUF5QixDQUF6QixFQUE0QixDQUE1QixDQVRqQyxDQURzRCxDQVVhOztBQUVuRSxTQUFPWCx3QkFBUDtBQUNEOztBQUVELFNBQVNhLHlDQUFULENBQW1EYix3QkFBbkQsRUFBNkU7QUFDM0UsTUFBTWMsbUNBQW1DZCx3QkFBekMsQ0FEMkUsQ0FDUjs7QUFFbkUsU0FBT2MsZ0NBQVA7QUFDRDs7QUFFRCxTQUFTQywwQ0FBVCxDQUFvRGYsd0JBQXBELEVBQThFO0FBQzVFLE1BQU1nQixxQ0FBcUNoQix3QkFBM0M7QUFBQSxNQUFxRTtBQUMvRGlCLDJDQUF5Q2pDLE1BQU1nQyxrQ0FBTixDQUQvQztBQUFBLE1BRU1FLDBDQUEwQ2hDLE9BQU84QixrQ0FBUCxDQUZoRDtBQUFBLE1BR01MLElBQUlNLHNDQUhWO0FBQUEsTUFHa0Q7QUFDNUNMLE1BQUlNLHVDQUpWO0FBQUEsTUFJb0Q7QUFDOUNDLHNDQUFvQyxDQUFFUixDQUFGLEVBQUssQ0FBQ0MsQ0FBTixFQUFTLENBQVQsRUFBWSxDQUFDQSxDQUFiLEVBQWdCRCxDQUFoQixFQUFtQixDQUFuQixFQUFzQixDQUF0QixFQUF5QixDQUF6QixFQUE0QixDQUE1QixDQUwxQzs7QUFPQSxTQUFPUSxpQ0FBUDtBQUNEOztBQUVEQyxPQUFPQyxPQUFQLEdBQWlCO0FBQ2Y5QixrQkFBZ0JBLGNBREQ7QUFFZlEsNEJBQTBCQSx3QkFGWDtBQUdmRSxxQ0FBbUNBLGlDQUhwQjtBQUlmWSw2Q0FBMkNBLHlDQUo1QjtBQUtmRSw4Q0FBNENBO0FBTDdCLENBQWpCOztBQVFBLFNBQVNwQiwrQkFBVCxDQUF5Q0gsUUFBekMsRUFBbUQ7QUFBRSxVQUFRLENBQVIsNEJBQWNBLFFBQWQ7QUFBMEIsQyxDQUFFOztBQUVqRixTQUFTTSwrQkFBVCxDQUF5Q0osbUJBQXpDLEVBQThEO0FBQUUsU0FBT0Esb0JBQW9CNEIsS0FBcEIsQ0FBMEIsQ0FBMUIsQ0FBUDtBQUFzQyxDLENBQUUiLCJmaWxlIjoicm90YXRpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHZlY3Rvck1hdGhzID0gcmVxdWlyZSgnLi4vbWF0aHMvdmVjdG9yJyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgcXVhdGVybmlvblV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9xdWF0ZXJuaW9uJyk7XG5cbmNvbnN0IHsgZmlyc3QsIHNlY29uZCwgZm91cnRoIH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgdHJhbnNmb3JtMywgbm9ybWFsaXNlMyB9ID0gdmVjdG9yTWF0aHMsXG4gICAgICB7IHJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24sIGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb24gfSA9IHF1YXRlcm5pb25VdGlsaXRpZXM7XG5cbmZ1bmN0aW9uIHJvdGF0ZVBvc2l0aW9uKHBvc2l0aW9uLCByb3RhdGlvblF1YXRlcm5pb24pIHtcbiAgY29uc3QgaW1hZ2luYXJ5UXVhdGVybmlvbiA9IGltYWdpbmFyeVF1YXRlcm5pb25Gcm9tUG9zaXRpb24ocG9zaXRpb24pLFxuICAgICAgICBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uID0gY2FsY3VsYXRlSW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbihyb3RhdGlvblF1YXRlcm5pb24pLFxuICAgICAgICByb3RhdGVkSW1hZ2luYXJ5UXVhdGVybmlvbiA9IHJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24oaW1hZ2luYXJ5UXVhdGVybmlvbiwgcm90YXRpb25RdWF0ZXJuaW9uLCBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uKTtcblxuICBwb3NpdGlvbiA9IHBvc2l0aW9uRnJvbUltYWdpbmFyeVF1YXRlcm5pb24ocm90YXRlZEltYWdpbmFyeVF1YXRlcm5pb24pO1xuXG4gIHJldHVybiBwb3NpdGlvbjtcbn1cblxuZnVuY3Rpb24gcm90YXRlUG9zaXRpb25BYm91dFpBeGlzKHBvc2l0aW9uLCByb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgpIHtcbiAgcG9zaXRpb24gPSB0cmFuc2Zvcm0zKHBvc2l0aW9uLCByb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgpO1xuXG4gIHJldHVybiBwb3NpdGlvbjtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlUm90YXRpb25BYm91dFpBeGlzTWF0cml4KG1hc2tpbmdFZGdlKSB7XG4gIGNvbnN0IG1hc2tpbmdFZGdlRXh0ZW50ID0gbWFza2luZ0VkZ2UuZ2V0RXh0ZW50KCksXG4gICAgICAgIHVuaXRNYXNraW5nRWRnZUV4dGVudCA9IG5vcm1hbGlzZTMobWFza2luZ0VkZ2VFeHRlbnQpLFxuICAgICAgICB1bml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnRzID0gdW5pdE1hc2tpbmdFZGdlRXh0ZW50LCAgLy8vXG4gICAgICAgIGZpcnN0VW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50ID0gZmlyc3QodW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZFVuaXRNYXNraW5nRWRnZUV4dGVudENvbXBvbmVudCA9IHNlY29uZCh1bml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnRzKSxcbiAgICAgICAgYW5nbGVPZlJvdGF0aW9uQ29zaW5lID0gK3NlY29uZFVuaXRNYXNraW5nRWRnZUV4dGVudENvbXBvbmVudCwgIC8vL1xuICAgICAgICBhbmdsZU9mUm90YXRpb25TaW5lID0gLWZpcnN0VW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50LCAvLy9cbiAgICAgICAgYyA9IGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSxcbiAgICAgICAgcyA9IGFuZ2xlT2ZSb3RhdGlvblNpbmUsXG4gICAgICAgIHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCA9IFsgYywgLXMsIDAsICtzLCBjLCAwLCAwLCAwLCAxIF07ICAvLy9cblxuICByZXR1cm4gcm90YXRpb25BYm91dFpBeGlzTWF0cml4O1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVGb3J3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeChyb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgpIHtcbiAgY29uc3QgZm9yd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXggPSByb3RhdGlvbkFib3V0WkF4aXNNYXRyaXg7IC8vL1xuXG4gIHJldHVybiBmb3J3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeDtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlQmFja3dhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4KHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCkge1xuICBjb25zdCByb3RhdGlvbkFib3V0WkF4aXNNYXRyaXhDb21wb25lbnRzID0gcm90YXRpb25BYm91dFpBeGlzTWF0cml4LCAvLy9cbiAgICAgICAgZmlyc3RSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXhDb21wb25lbnQgPSBmaXJzdChyb3RhdGlvbkFib3V0WkF4aXNNYXRyaXhDb21wb25lbnRzKSxcbiAgICAgICAgZm91cnRoUm90YXRpb25BYm91dFpBeGlzTWF0cml4Q29tcG9uZW50ID0gZm91cnRoKHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeENvbXBvbmVudHMpLFxuICAgICAgICBjID0gZmlyc3RSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXhDb21wb25lbnQsIC8vL1xuICAgICAgICBzID0gZm91cnRoUm90YXRpb25BYm91dFpBeGlzTWF0cml4Q29tcG9uZW50LCAgLy8vXG4gICAgICAgIGJhY2t3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCA9IFsgYywgK3MsIDAsIC1zLCBjLCAwLCAwLCAwLCAxIF07XG5cbiAgcmV0dXJuIGJhY2t3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeDtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHJvdGF0ZVBvc2l0aW9uOiByb3RhdGVQb3NpdGlvbixcbiAgcm90YXRlUG9zaXRpb25BYm91dFpBeGlzOiByb3RhdGVQb3NpdGlvbkFib3V0WkF4aXMsXG4gIGNhbGN1bGF0ZVJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeDogY2FsY3VsYXRlUm90YXRpb25BYm91dFpBeGlzTWF0cml4LFxuICBjYWxjdWxhdGVGb3J3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeDogY2FsY3VsYXRlRm9yd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgsXG4gIGNhbGN1bGF0ZUJhY2t3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeDogY2FsY3VsYXRlQmFja3dhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4XG59O1xuXG5mdW5jdGlvbiBpbWFnaW5hcnlRdWF0ZXJuaW9uRnJvbVBvc2l0aW9uKHBvc2l0aW9uKSB7IHJldHVybiBbMCwgLi4ucG9zaXRpb25dOyB9ICAvLy9cblxuZnVuY3Rpb24gcG9zaXRpb25Gcm9tSW1hZ2luYXJ5UXVhdGVybmlvbihpbWFnaW5hcnlRdWF0ZXJuaW9uKSB7IHJldHVybiBpbWFnaW5hcnlRdWF0ZXJuaW9uLnNsaWNlKDEpOyB9ICAvLy9cbiJdfQ==