"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.calculateIntersection = calculateIntersection;
exports.calculateNonNullIntersections = calculateNonNullIntersections;
exports.calculateNullIntersectionIndex = calculateNullIntersectionIndex;
exports.calculateNonNullIntersectionIndex = calculateNonNullIntersectionIndex;
exports.calculateIntermediateVertexPosition = calculateIntermediateVertexPosition;

var _array = require("../utilities/array");

var _vector = require("../maths/vector");

var _approximate = require("../utilities/approximate");

function calculateIntersection(edge, firstPositionComponent) {
  var intersection = null;
  var edgeNonParallel = isEdgeNonParallel(edge);

  if (edgeNonParallel) {
    var edgeIntersection = calculateEdgeIntersection(edge, firstPositionComponent),
        edgeIntersectionNonTrivial = edgeIntersection > 0 && edgeIntersection < 1;

    if (edgeIntersectionNonTrivial) {
      intersection = edgeIntersection; ///
    }
  }

  return intersection;
}

function calculateNonNullIntersections(intersections) {
  var nonNullIntersections = intersections.reduce(function (nonNullIntersections, intersection) {
    if (intersection !== null) {
      var nonNullIntersection = intersection; ///

      nonNullIntersections.push(nonNullIntersection);
    }

    return nonNullIntersections;
  }, []);
  return nonNullIntersections;
}

function calculateNullIntersectionIndex(intersections) {
  var nullIntersectionIndex = intersections.reduce(function (nullIntersectionIndex, intersection, index) {
    if (nullIntersectionIndex === null) {
      if (intersection === null) {
        nullIntersectionIndex = index;
      }
    }

    return nullIntersectionIndex;
  }, null);
  return nullIntersectionIndex;
}

function calculateNonNullIntersectionIndex(intersections) {
  var nullIntersectionIndex = intersections.reduce(function (nullIntersectionIndex, intersection, index) {
    if (nullIntersectionIndex === null) {
      if (intersection !== null) {
        nullIntersectionIndex = index;
      }
    }

    return nullIntersectionIndex;
  }, null);
  return nullIntersectionIndex;
}

function calculateIntermediateVertexPosition(startVertexPosition, endVertexPosition, intersection) {
  var extent = (0, _vector.subtract3)(endVertexPosition, startVertexPosition),
      offset = (0, _vector.scale3)(extent, intersection),
      intermediateVertexPosition = (0, _vector.add3)(startVertexPosition, offset);
  return intermediateVertexPosition;
}

function isEdgeNonParallel(edge) {
  var edgeExtent = edge.getExtent(),
      edgeExtentComponents = edgeExtent,
      ///
  firstEdgeExtentComponent = (0, _array.first)(edgeExtentComponents),
      secondEdgeExtentComponent = (0, _array.second)(edgeExtentComponents),
      edgeAngleTangent = firstEdgeExtentComponent / secondEdgeExtentComponent,
      edgeAngleTangentApproximatelyEqualToZero = (0, _approximate.isApproximatelyEqualToZero)(edgeAngleTangent),
      edgeParallel = edgeAngleTangentApproximatelyEqualToZero,
      ///
  edgeNonParallel = !edgeParallel;
  return edgeNonParallel;
}

function calculateEdgeIntersection(edge, firstPositionComponent) {
  var edgeExtent = edge.getExtent(),
      edgePosition = edge.getPosition(),
      edgeExtentComponents = edgeExtent,
      ///
  edgePositionComponents = edgePosition,
      ///
  firstEdgeExtentComponent = (0, _array.first)(edgeExtentComponents),
      firstEdgePositionComponent = (0, _array.first)(edgePositionComponents),
      edgeIntersection = (firstPositionComponent - firstEdgePositionComponent) / firstEdgeExtentComponent;
  return edgeIntersection;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImludGVyc2VjdGlvbi5qcyJdLCJuYW1lcyI6WyJjYWxjdWxhdGVJbnRlcnNlY3Rpb24iLCJlZGdlIiwiZmlyc3RQb3NpdGlvbkNvbXBvbmVudCIsImludGVyc2VjdGlvbiIsImVkZ2VOb25QYXJhbGxlbCIsImlzRWRnZU5vblBhcmFsbGVsIiwiZWRnZUludGVyc2VjdGlvbiIsImNhbGN1bGF0ZUVkZ2VJbnRlcnNlY3Rpb24iLCJlZGdlSW50ZXJzZWN0aW9uTm9uVHJpdmlhbCIsImNhbGN1bGF0ZU5vbk51bGxJbnRlcnNlY3Rpb25zIiwiaW50ZXJzZWN0aW9ucyIsIm5vbk51bGxJbnRlcnNlY3Rpb25zIiwicmVkdWNlIiwibm9uTnVsbEludGVyc2VjdGlvbiIsInB1c2giLCJjYWxjdWxhdGVOdWxsSW50ZXJzZWN0aW9uSW5kZXgiLCJudWxsSW50ZXJzZWN0aW9uSW5kZXgiLCJpbmRleCIsImNhbGN1bGF0ZU5vbk51bGxJbnRlcnNlY3Rpb25JbmRleCIsImNhbGN1bGF0ZUludGVybWVkaWF0ZVZlcnRleFBvc2l0aW9uIiwic3RhcnRWZXJ0ZXhQb3NpdGlvbiIsImVuZFZlcnRleFBvc2l0aW9uIiwiZXh0ZW50Iiwib2Zmc2V0IiwiaW50ZXJtZWRpYXRlVmVydGV4UG9zaXRpb24iLCJlZGdlRXh0ZW50IiwiZ2V0RXh0ZW50IiwiZWRnZUV4dGVudENvbXBvbmVudHMiLCJmaXJzdEVkZ2VFeHRlbnRDb21wb25lbnQiLCJzZWNvbmRFZGdlRXh0ZW50Q29tcG9uZW50IiwiZWRnZUFuZ2xlVGFuZ2VudCIsImVkZ2VBbmdsZVRhbmdlbnRBcHByb3hpbWF0ZWx5RXF1YWxUb1plcm8iLCJlZGdlUGFyYWxsZWwiLCJlZGdlUG9zaXRpb24iLCJnZXRQb3NpdGlvbiIsImVkZ2VQb3NpdGlvbkNvbXBvbmVudHMiLCJmaXJzdEVkZ2VQb3NpdGlvbkNvbXBvbmVudCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBRU8sU0FBU0EscUJBQVQs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S01FLHdDQUF3QyxHQUFHLDZDQUEyQkQsZ0JBQTNCLENBTGpEO0FBQUEsTUFNTUUsWUFBWSxHQUFHRCx3Q0FOckI7QUFBQSxNQU0rRDtBQUN6RDNCLEVBQUFBLGVBQWUsR0FBRyxDQUFDNEIsWUFQekI7QUFTQSxTQUFPNUIsZUFBUDtBQUNEOztBQUVELFNBQVNHLHlCQUFULENBQW1DTixJQUFuQyxFQUF5Q0Msc0JBQXpDLEVBQWlFO0FBQy9ELE1BQU11QixVQUFVLEdBQUd4QixJQUFJLENBQUN5QixTQUFMLEVBQW5CO0FBQUEsTUFDTU8sWUFBWSxHQUFHaEMsSUFBSSxDQUFDaUMsV0FBTCxFQURyQjtBQUFBLE1BRU1QLG9CQUFvQixHQUFHRixVQUY3QjtBQUFBLE1BRXlDO0FBQ25DVSxFQUFBQSxzQkFBc0IsR0FBR0YsWUFIL0I7QUFBQSxNQUc2QztBQUN2Q0wsRUFBQUEsd0JBQXdCLEdBQUcsa0JBQU1ELG9CQUFOLENBSmpDO0FBQUEsTUFLTVMsMEJBQTBCLEdBQUcsa0JBQU1ELHNCQUFOLENBTG5DO0FBQUEsTUFNTTdCLGdCQUFnQixHQUFHLENBQUNKLHNCQUFzQixHQUFHa0MsMEJBQTFCLElBQXdEUix3QkFOakY7QUFRQSxTQUFPdEIsZ0JBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgeyBmaXJzdCwgc2Vjb25kIH0gZnJvbSBcIi4uL3V0aWxpdGllcy9hcnJheVwiO1xuaW1wb3J0IHsgYWRkMywgc3VidHJhY3QzLCBzY2FsZTMgfSBmcm9tIFwiLi4vbWF0aHMvdmVjdG9yXCI7XG5pbXBvcnQgeyBpc0FwcHJveGltYXRlbHlFcXVhbFRvWmVybyB9IGZyb20gXCIuLi91dGlsaXRpZXMvYXBwcm94aW1hdGVcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUludGVyc2VjdGlvbihlZGdlLCBmaXJzdFBvc2l0aW9uQ29tcG9uZW50KSB7XG4gIGxldCBpbnRlcnNlY3Rpb24gPSBudWxsO1xuXG4gIGNvbnN0IGVkZ2VOb25QYXJhbGxlbCA9IGlzRWRnZU5vblBhcmFsbGVsKGVkZ2UpO1xuXG4gIGlmIChlZGdlTm9uUGFyYWxsZWwpIHtcbiAgICBjb25zdCBlZGdlSW50ZXJzZWN0aW9uID0gY2FsY3VsYXRlRWRnZUludGVyc2VjdGlvbihlZGdlLCBmaXJzdFBvc2l0aW9uQ29tcG9uZW50KSxcbiAgICAgICAgICBlZGdlSW50ZXJzZWN0aW9uTm9uVHJpdmlhbCA9ICgoZWRnZUludGVyc2VjdGlvbiA+IDAgKSAmJiAoZWRnZUludGVyc2VjdGlvbiA8IDEpKTtcblxuICAgIGlmIChlZGdlSW50ZXJzZWN0aW9uTm9uVHJpdmlhbCkge1xuICAgICAgaW50ZXJzZWN0aW9uID0gZWRnZUludGVyc2VjdGlvbjsgIC8vL1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBpbnRlcnNlY3Rpb247XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zKSB7XG4gIGNvbnN0IG5vbk51bGxJbnRlcnNlY3Rpb25zID0gaW50ZXJzZWN0aW9ucy5yZWR1Y2UoKG5vbk51bGxJbnRlcnNlY3Rpb25zLCBpbnRlcnNlY3Rpb24pID0+IHtcbiAgICBpZiAoaW50ZXJzZWN0aW9uICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBub25OdWxsSW50ZXJzZWN0aW9uID0gaW50ZXJzZWN0aW9uOyAvLy9cblxuICAgICAgbm9uTnVsbEludGVyc2VjdGlvbnMucHVzaChub25OdWxsSW50ZXJzZWN0aW9uKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbm9uTnVsbEludGVyc2VjdGlvbnM7XG4gIH0sIFtdKTtcblxuICByZXR1cm4gbm9uTnVsbEludGVyc2VjdGlvbnM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVOdWxsSW50ZXJzZWN0aW9uSW5kZXgoaW50ZXJzZWN0aW9ucykge1xuICBjb25zdCBudWxsSW50ZXJzZWN0aW9uSW5kZXggPSBpbnRlcnNlY3Rpb25zLnJlZHVjZSgobnVsbEludGVyc2VjdGlvbkluZGV4LCBpbnRlcnNlY3Rpb24sIGluZGV4KSA9PiB7XG4gICAgaWYgKG51bGxJbnRlcnNlY3Rpb25JbmRleCA9PT0gbnVsbCkge1xuICAgICAgaWYgKGludGVyc2VjdGlvbiA9PT0gbnVsbCkge1xuICAgICAgICBudWxsSW50ZXJzZWN0aW9uSW5kZXggPSBpbmRleDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbEludGVyc2VjdGlvbkluZGV4O1xuICB9LCBudWxsKTtcblxuICByZXR1cm4gbnVsbEludGVyc2VjdGlvbkluZGV4O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlTm9uTnVsbEludGVyc2VjdGlvbkluZGV4KGludGVyc2VjdGlvbnMpIHtcbiAgY29uc3QgbnVsbEludGVyc2VjdGlvbkluZGV4ID0gaW50ZXJzZWN0aW9ucy5yZWR1Y2UoKG51bGxJbnRlcnNlY3Rpb25JbmRleCwgaW50ZXJzZWN0aW9uLCBpbmRleCkgPT4ge1xuICAgIGlmIChudWxsSW50ZXJzZWN0aW9uSW5kZXggPT09IG51bGwpIHtcbiAgICAgIGlmIChpbnRlcnNlY3Rpb24gIT09IG51bGwpIHtcbiAgICAgICAgbnVsbEludGVyc2VjdGlvbkluZGV4ID0gaW5kZXg7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGxJbnRlcnNlY3Rpb25JbmRleDtcbiAgfSwgbnVsbCk7XG5cbiAgcmV0dXJuIG51bGxJbnRlcnNlY3Rpb25JbmRleDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUludGVybWVkaWF0ZVZlcnRleFBvc2l0aW9uKHN0YXJ0VmVydGV4UG9zaXRpb24sIGVuZFZlcnRleFBvc2l0aW9uLCBpbnRlcnNlY3Rpb24pIHtcbiAgY29uc3QgZXh0ZW50ID0gc3VidHJhY3QzKGVuZFZlcnRleFBvc2l0aW9uLCBzdGFydFZlcnRleFBvc2l0aW9uKSxcbiAgICAgICAgb2Zmc2V0ID0gc2NhbGUzKGV4dGVudCwgaW50ZXJzZWN0aW9uKSxcbiAgICAgICAgaW50ZXJtZWRpYXRlVmVydGV4UG9zaXRpb24gPSBhZGQzKHN0YXJ0VmVydGV4UG9zaXRpb24sIG9mZnNldCk7XG5cbiAgcmV0dXJuIGludGVybWVkaWF0ZVZlcnRleFBvc2l0aW9uO1xufVxuXG5mdW5jdGlvbiBpc0VkZ2VOb25QYXJhbGxlbChlZGdlKSB7XG4gIGNvbnN0IGVkZ2VFeHRlbnQgPSBlZGdlLmdldEV4dGVudCgpLFxuICAgICAgICBlZGdlRXh0ZW50Q29tcG9uZW50cyA9IGVkZ2VFeHRlbnQsIC8vL1xuICAgICAgICBmaXJzdEVkZ2VFeHRlbnRDb21wb25lbnQgPSBmaXJzdChlZGdlRXh0ZW50Q29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZEVkZ2VFeHRlbnRDb21wb25lbnQgPSBzZWNvbmQoZWRnZUV4dGVudENvbXBvbmVudHMpLFxuICAgICAgICBlZGdlQW5nbGVUYW5nZW50ID0gZmlyc3RFZGdlRXh0ZW50Q29tcG9uZW50IC8gc2Vjb25kRWRnZUV4dGVudENvbXBvbmVudCxcbiAgICAgICAgZWRnZUFuZ2xlVGFuZ2VudEFwcHJveGltYXRlbHlFcXVhbFRvWmVybyA9IGlzQXBwcm94aW1hdGVseUVxdWFsVG9aZXJvKGVkZ2VBbmdsZVRhbmdlbnQpLFxuICAgICAgICBlZGdlUGFyYWxsZWwgPSBlZGdlQW5nbGVUYW5nZW50QXBwcm94aW1hdGVseUVxdWFsVG9aZXJvLCAvLy9cbiAgICAgICAgZWRnZU5vblBhcmFsbGVsID0gIWVkZ2VQYXJhbGxlbDtcblxuICByZXR1cm4gZWRnZU5vblBhcmFsbGVsO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVFZGdlSW50ZXJzZWN0aW9uKGVkZ2UsIGZpcnN0UG9zaXRpb25Db21wb25lbnQpIHtcbiAgY29uc3QgZWRnZUV4dGVudCA9IGVkZ2UuZ2V0RXh0ZW50KCksXG4gICAgICAgIGVkZ2VQb3NpdGlvbiA9IGVkZ2UuZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgZWRnZUV4dGVudENvbXBvbmVudHMgPSBlZGdlRXh0ZW50LCAvLy9cbiAgICAgICAgZWRnZVBvc2l0aW9uQ29tcG9uZW50cyA9IGVkZ2VQb3NpdGlvbiwgLy8vXG4gICAgICAgIGZpcnN0RWRnZUV4dGVudENvbXBvbmVudCA9IGZpcnN0KGVkZ2VFeHRlbnRDb21wb25lbnRzKSxcbiAgICAgICAgZmlyc3RFZGdlUG9zaXRpb25Db21wb25lbnQgPSBmaXJzdChlZGdlUG9zaXRpb25Db21wb25lbnRzKSxcbiAgICAgICAgZWRnZUludGVyc2VjdGlvbiA9IChmaXJzdFBvc2l0aW9uQ29tcG9uZW50IC0gZmlyc3RFZGdlUG9zaXRpb25Db21wb25lbnQpIC8gZmlyc3RFZGdlRXh0ZW50Q29tcG9uZW50O1xuXG4gIHJldHVybiBlZGdlSW50ZXJzZWN0aW9uO1xufVxuIl19