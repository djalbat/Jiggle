'use strict';

var matrixMaths = require('../maths/matrix'),
    vectorMaths = require('../maths/vector'),
    arrayUtilities = require('../utilities/array'),
    verticesUtilities = require('../utilities/vertices'),
    quaternionUtilities = require('../utilities/quaternion');

var add2 = vectorMaths.add2,
    multiply2 = vectorMaths.multiply2,
    rotateVertices = verticesUtilities.rotateVertices,
    invert2 = matrixMaths.invert2,
    invert3 = matrixMaths.invert3,
    transform2 = vectorMaths.transform2,
    transform3 = vectorMaths.transform3,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    calculateRotationQuaternion = quaternionUtilities.calculateRotationQuaternion;


function cloneTextureCoordinates(textureCoordinates) {
  textureCoordinates = textureCoordinates.map(function (textureCoordinates) {
    ///
    textureCoordinates = textureCoordinates.slice();

    return textureCoordinates;
  });

  return textureCoordinates;
}

function calculateVertexTextureCoordinates(textureCoordinates, left, bottom, width, height) {
  textureCoordinates = textureCoordinates.map(function (textureCoordinates) {
    ///
    textureCoordinates = add2(multiply2(textureCoordinates, [width, height]), [left, bottom]);

    return textureCoordinates;
  });

  return textureCoordinates;
}

function calculateAdjustedTextureCoordinates(vertices, normal, parentVertices, textureCoordinates) {
  var rotationQuaternion = calculateRotationQuaternion(normal);

  vertices = rotateVertices(vertices, rotationQuaternion);

  parentVertices = rotateVertices(parentVertices, rotationQuaternion);

  var firstVertex = first(vertices),
      secondVertex = second(vertices),
      thirdVertex = third(vertices),
      firstParentVertex = first(parentVertices),
      secondParentVertex = second(parentVertices),
      thirdParentVertex = third(parentVertices),
      firstTextureCoordinate = first(textureCoordinates),
      secondTextureCoordinate = second(textureCoordinates),
      thirdTextureCoordinate = third(textureCoordinates),
      firstVertexPosition = firstVertex.getPosition(),
      secondVertexPosition = secondVertex.getPosition(),
      thirdVertexPosition = thirdVertex.getPosition(),
      firstParentVertexPosition = firstParentVertex.getPosition(),
      secondParentVertexPosition = secondParentVertex.getPosition(),
      thirdParentVertexPosition = thirdParentVertex.getPosition(),
      R1x = firstVertexPosition[0],
      ///
  R1y = firstVertexPosition[1],
      ///
  R2x = secondVertexPosition[0],
      ///
  R2y = secondVertexPosition[1],
      ///
  R3x = thirdVertexPosition[0],
      ///
  R3y = thirdVertexPosition[1],
      ///
  P1x = firstParentVertexPosition[0],
      ///
  P2x = secondParentVertexPosition[0],
      ///
  P3x = thirdParentVertexPosition[0],
      ///
  P1y = firstParentVertexPosition[1],
      ///
  P2y = secondParentVertexPosition[1],
      ///
  P3y = thirdParentVertexPosition[1],
      ///
  P1u = firstTextureCoordinate[0],
      ///
  P1v = firstTextureCoordinate[1],
      ///
  P2u = secondTextureCoordinate[0],
      ///
  P2v = secondTextureCoordinate[1],
      ///
  P3u = thirdTextureCoordinate[0],
      ///
  P3v = thirdTextureCoordinate[1],
      ///
  textureCoordinatesMatrix = invert3([1, 1, 1, P1u, P2u, P3u, P1v, P2v, P3v]),
      firstTransformedParentVerticesComponent = transform3([P1x, P2x, P3x], textureCoordinatesMatrix),
      secondTransformedParentVerticesComponent = transform3([P1y, P2y, P3y], textureCoordinatesMatrix),
      Ox = firstTransformedParentVerticesComponent[0],
      ///
  Ux = firstTransformedParentVerticesComponent[1],
      ///
  Vx = firstTransformedParentVerticesComponent[2],
      ///
  Oy = secondTransformedParentVerticesComponent[0],
      ///
  Uy = secondTransformedParentVerticesComponent[1],
      ///
  Vy = secondTransformedParentVerticesComponent[2],
      ///
  transformedParentVerticesMatrix = invert2([Ux, Uy, Vx, Vy]),
      firstAdjustedTextureCoordinatesComponent = transform2([R1x - Ox, R1y - Oy], transformedParentVerticesMatrix),
      secondAdjustedTextureCoordinatesComponent = transform2([R2x - Ox, R2y - Oy], transformedParentVerticesMatrix),
      thirdAdjustedTextureCoordinatesComponent = transform2([R3x - Ox, R3y - Oy], transformedParentVerticesMatrix),
      adjustedTextureCoordinates = [firstAdjustedTextureCoordinatesComponent, secondAdjustedTextureCoordinatesComponent, thirdAdjustedTextureCoordinatesComponent];

  return adjustedTextureCoordinates;
}

function textureCoordinatesFromTextureCoordinatesAndIndex(textureCoordinates, index) {
  ///
  textureCoordinates = textureCoordinates.slice(index * 3, index * 3 + 3); ///

  return textureCoordinates;
}

module.exports = {
  cloneTextureCoordinates: cloneTextureCoordinates,
  calculateVertexTextureCoordinates: calculateVertexTextureCoordinates,
  calculateAdjustedTextureCoordinates: calculateAdjustedTextureCoordinates,
  textureCoordinatesFromTextureCoordinatesAndIndex: textureCoordinatesFromTextureCoordinatesAndIndex
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvdGV4dHVyZS5qcyJdLCJuYW1lcyI6WyJtYXRyaXhNYXRocyIsInJlcXVpcmUiLCJ2ZWN0b3JNYXRocyIsImFycmF5VXRpbGl0aWVzIiwidmVydGljZXNVdGlsaXRpZXMiLCJxdWF0ZXJuaW9uVXRpbGl0aWVzIiwiYWRkMiIsIm11bHRpcGx5MiIsInJvdGF0ZVZlcnRpY2VzIiwiaW52ZXJ0MiIsImludmVydDMiLCJ0cmFuc2Zvcm0yIiwidHJhbnNmb3JtMyIsImZpcnN0Iiwic2Vjb25kIiwidGhpcmQiLCJjYWxjdWxhdGVSb3RhdGlvblF1YXRlcm5pb24iLCJjbG9uZVRleHR1cmVDb29yZGluYXRlcyIsInRleHR1cmVDb29yZGluYXRlcyIsIm1hcCIsInNsaWNlIiwiY2FsY3VsYXRlVmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzIiwibGVmdCIsImJvdHRvbSIsIndpZHRoIiwiaGVpZ2h0IiwiY2FsY3VsYXRlQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXMiLCJ2ZXJ0aWNlcyIsIm5vcm1hbCIsInBhcmVudFZlcnRpY2VzIiwicm90YXRpb25RdWF0ZXJuaW9uIiwiZmlyc3RWZXJ0ZXgiLCJzZWNvbmRWZXJ0ZXgiLCJ0aGlyZFZlcnRleCIsImZpcnN0UGFyZW50VmVydGV4Iiwic2Vjb25kUGFyZW50VmVydGV4IiwidGhpcmRQYXJlbnRWZXJ0ZXgiLCJmaXJzdFRleHR1cmVDb29yZGluYXRlIiwic2Vjb25kVGV4dHVyZUNvb3JkaW5hdGUiLCJ0aGlyZFRleHR1cmVDb29yZGluYXRlIiwiZmlyc3RWZXJ0ZXhQb3NpdGlvbiIsImdldFBvc2l0aW9uIiwic2Vjb25kVmVydGV4UG9zaXRpb24iLCJ0aGlyZFZlcnRleFBvc2l0aW9uIiwiZmlyc3RQYXJlbnRWZXJ0ZXhQb3NpdGlvbiIsInNlY29uZFBhcmVudFZlcnRleFBvc2l0aW9uIiwidGhpcmRQYXJlbnRWZXJ0ZXhQb3NpdGlvbiIsIlIxeCIsIlIxeSIsIlIyeCIsIlIyeSIsIlIzeCIsIlIzeSIsIlAxeCIsIlAyeCIsIlAzeCIsIlAxeSIsIlAyeSIsIlAzeSIsIlAxdSIsIlAxdiIsIlAydSIsIlAydiIsIlAzdSIsIlAzdiIsInRleHR1cmVDb29yZGluYXRlc01hdHJpeCIsImZpcnN0VHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudCIsInNlY29uZFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnQiLCJPeCIsIlV4IiwiVngiLCJPeSIsIlV5IiwiVnkiLCJ0cmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzTWF0cml4IiwiZmlyc3RBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCIsInNlY29uZEFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzQ29tcG9uZW50IiwidGhpcmRBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCIsImFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzIiwidGV4dHVyZUNvb3JkaW5hdGVzRnJvbVRleHR1cmVDb29yZGluYXRlc0FuZEluZGV4IiwiaW5kZXgiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxjQUFjQyxRQUFRLGlCQUFSLENBQXBCO0FBQUEsSUFDTUMsY0FBY0QsUUFBUSxpQkFBUixDQURwQjtBQUFBLElBRU1FLGlCQUFpQkYsUUFBUSxvQkFBUixDQUZ2QjtBQUFBLElBR01HLG9CQUFvQkgsUUFBUSx1QkFBUixDQUgxQjtBQUFBLElBSU1JLHNCQUFzQkosUUFBUSx5QkFBUixDQUo1Qjs7SUFNUUssSSxHQUFvQkosVyxDQUFwQkksSTtJQUFNQyxTLEdBQWNMLFcsQ0FBZEssUztJQUNOQyxjLEdBQW1CSixpQixDQUFuQkksYztJQUNBQyxPLEdBQXFCVCxXLENBQXJCUyxPO0lBQVNDLE8sR0FBWVYsVyxDQUFaVSxPO0lBQ1RDLFUsR0FBMkJULFcsQ0FBM0JTLFU7SUFBWUMsVSxHQUFlVixXLENBQWZVLFU7SUFDWkMsSyxHQUF5QlYsYyxDQUF6QlUsSztJQUFPQyxN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T0FBS04seUNBQXlDLENBQXpDLENBekNYO0FBQUEsTUF5Q3lEO0FBQ25ETyxvQ0FBa0NqRSxRQUFRLENBQUU0RCxFQUFGLEVBQU1HLEVBQU4sRUFBVUYsRUFBVixFQUFjRyxFQUFkLENBQVIsQ0ExQ3hDO0FBQUEsTUEyQ01FLDJDQUEyQ2hFLFdBQVcsQ0FBRW9DLE1BQU1xQixFQUFSLEVBQVlwQixNQUFNdUIsRUFBbEIsQ0FBWCxFQUFtQ0csK0JBQW5DLENBM0NqRDtBQUFBLE1BNENNRSw0Q0FBNENqRSxXQUFXLENBQUVzQyxNQUFNbUIsRUFBUixFQUFZbEIsTUFBTXFCLEVBQWxCLENBQVgsRUFBbUNHLCtCQUFuQyxDQTVDbEQ7QUFBQSxNQTZDTUcsMkNBQTJDbEUsV0FBVyxDQUFFd0MsTUFBTWlCLEVBQVIsRUFBWWhCLE1BQU1tQixFQUFsQixDQUFYLEVBQW1DRywrQkFBbkMsQ0E3Q2pEO0FBQUEsTUE4Q01JLDZCQUE2QixDQUMzQkgsd0NBRDJCLEVBRTNCQyx5Q0FGMkIsRUFHM0JDLHdDQUgyQixDQTlDbkM7O0FBb0RBLFNBQU9DLDBCQUFQO0FBQ0Q7O0FBRUQsU0FBU0MsZ0RBQVQsQ0FBMEQ3RCxrQkFBMUQsRUFBOEU4RCxLQUE5RSxFQUFxRjtBQUFHO0FBQ3RGOUQsdUJBQXFCQSxtQkFBbUJFLEtBQW5CLENBQXlCNEQsUUFBUSxDQUFqQyxFQUFvQ0EsUUFBUSxDQUFSLEdBQVksQ0FBaEQsQ0FBckIsQ0FEbUYsQ0FDVDs7QUFFMUUsU0FBTzlELGtCQUFQO0FBQ0Q7O0FBRUQrRCxPQUFPQyxPQUFQLEdBQWlCO0FBQ2ZqRSwyQkFBeUJBLHVCQURWO0FBRWZJLHFDQUFtQ0EsaUNBRnBCO0FBR2ZLLHVDQUFxQ0EsbUNBSHRCO0FBSWZxRCxvREFBa0RBO0FBSm5DLENBQWpCIiwiZmlsZSI6InRleHR1cmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IG1hdHJpeE1hdGhzID0gcmVxdWlyZSgnLi4vbWF0aHMvbWF0cml4JyksXG4gICAgICB2ZWN0b3JNYXRocyA9IHJlcXVpcmUoJy4uL21hdGhzL3ZlY3RvcicpLFxuICAgICAgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvYXJyYXknKSxcbiAgICAgIHZlcnRpY2VzVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL3ZlcnRpY2VzJyksXG4gICAgICBxdWF0ZXJuaW9uVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL3F1YXRlcm5pb24nKTtcblxuY29uc3QgeyBhZGQyLCBtdWx0aXBseTIgfSA9IHZlY3Rvck1hdGhzLFxuICAgICAgeyByb3RhdGVWZXJ0aWNlcyB9ID0gdmVydGljZXNVdGlsaXRpZXMsXG4gICAgICB7IGludmVydDIsIGludmVydDMgfSA9IG1hdHJpeE1hdGhzLFxuICAgICAgeyB0cmFuc2Zvcm0yLCB0cmFuc2Zvcm0zIH0gPSB2ZWN0b3JNYXRocyxcbiAgICAgIHsgZmlyc3QsIHNlY29uZCwgdGhpcmQgfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBjYWxjdWxhdGVSb3RhdGlvblF1YXRlcm5pb24gfSA9IHF1YXRlcm5pb25VdGlsaXRpZXM7XG5cbmZ1bmN0aW9uIGNsb25lVGV4dHVyZUNvb3JkaW5hdGVzKHRleHR1cmVDb29yZGluYXRlcykge1xuICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQ29vcmRpbmF0ZXMubWFwKGZ1bmN0aW9uKHRleHR1cmVDb29yZGluYXRlcykgeyAgLy8vXG4gICAgdGV4dHVyZUNvb3JkaW5hdGVzID0gdGV4dHVyZUNvb3JkaW5hdGVzLnNsaWNlKCk7XG5cbiAgICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVzO1xuICB9KTtcblxuICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVzO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVWZXJ0ZXhUZXh0dXJlQ29vcmRpbmF0ZXModGV4dHVyZUNvb3JkaW5hdGVzLCBsZWZ0LCBib3R0b20sIHdpZHRoLCBoZWlnaHQpIHtcbiAgdGV4dHVyZUNvb3JkaW5hdGVzID0gdGV4dHVyZUNvb3JkaW5hdGVzLm1hcChmdW5jdGlvbih0ZXh0dXJlQ29vcmRpbmF0ZXMpIHsgIC8vL1xuICAgIHRleHR1cmVDb29yZGluYXRlcyA9IGFkZDIobXVsdGlwbHkyKHRleHR1cmVDb29yZGluYXRlcywgWyB3aWR0aCwgaGVpZ2h0IF0gKSwgWyBsZWZ0LCBib3R0b20gXSk7XG5cbiAgICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVzO1xuICB9KTtcblxuICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVzO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlcyh2ZXJ0aWNlcywgbm9ybWFsLCBwYXJlbnRWZXJ0aWNlcywgdGV4dHVyZUNvb3JkaW5hdGVzKSB7XG4gIGNvbnN0IHJvdGF0aW9uUXVhdGVybmlvbiA9IGNhbGN1bGF0ZVJvdGF0aW9uUXVhdGVybmlvbihub3JtYWwpO1xuXG4gIHZlcnRpY2VzID0gcm90YXRlVmVydGljZXModmVydGljZXMsIHJvdGF0aW9uUXVhdGVybmlvbik7XG5cbiAgcGFyZW50VmVydGljZXMgPSByb3RhdGVWZXJ0aWNlcyhwYXJlbnRWZXJ0aWNlcywgcm90YXRpb25RdWF0ZXJuaW9uKTtcblxuICBjb25zdCBmaXJzdFZlcnRleCA9IGZpcnN0KHZlcnRpY2VzKSxcbiAgICAgICAgc2Vjb25kVmVydGV4ID0gc2Vjb25kKHZlcnRpY2VzKSxcbiAgICAgICAgdGhpcmRWZXJ0ZXggPSB0aGlyZCh2ZXJ0aWNlcyksXG4gICAgICAgIGZpcnN0UGFyZW50VmVydGV4ID0gZmlyc3QocGFyZW50VmVydGljZXMpLFxuICAgICAgICBzZWNvbmRQYXJlbnRWZXJ0ZXggPSBzZWNvbmQocGFyZW50VmVydGljZXMpLFxuICAgICAgICB0aGlyZFBhcmVudFZlcnRleCA9IHRoaXJkKHBhcmVudFZlcnRpY2VzKSxcbiAgICAgICAgZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZSA9IGZpcnN0KHRleHR1cmVDb29yZGluYXRlcyksXG4gICAgICAgIHNlY29uZFRleHR1cmVDb29yZGluYXRlID0gc2Vjb25kKHRleHR1cmVDb29yZGluYXRlcyksXG4gICAgICAgIHRoaXJkVGV4dHVyZUNvb3JkaW5hdGUgPSB0aGlyZCh0ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICBmaXJzdFZlcnRleFBvc2l0aW9uID0gZmlyc3RWZXJ0ZXguZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgc2Vjb25kVmVydGV4UG9zaXRpb24gPSBzZWNvbmRWZXJ0ZXguZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgdGhpcmRWZXJ0ZXhQb3NpdGlvbiA9IHRoaXJkVmVydGV4LmdldFBvc2l0aW9uKCksXG4gICAgICAgIGZpcnN0UGFyZW50VmVydGV4UG9zaXRpb24gPSBmaXJzdFBhcmVudFZlcnRleC5nZXRQb3NpdGlvbigpLFxuICAgICAgICBzZWNvbmRQYXJlbnRWZXJ0ZXhQb3NpdGlvbiA9IHNlY29uZFBhcmVudFZlcnRleC5nZXRQb3NpdGlvbigpLFxuICAgICAgICB0aGlyZFBhcmVudFZlcnRleFBvc2l0aW9uID0gdGhpcmRQYXJlbnRWZXJ0ZXguZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgUjF4ID0gZmlyc3RWZXJ0ZXhQb3NpdGlvblswXSwgIC8vL1xuICAgICAgICBSMXkgPSBmaXJzdFZlcnRleFBvc2l0aW9uWzFdLCAgLy8vXG4gICAgICAgIFIyeCA9IHNlY29uZFZlcnRleFBvc2l0aW9uWzBdLCAvLy9cbiAgICAgICAgUjJ5ID0gc2Vjb25kVmVydGV4UG9zaXRpb25bMV0sIC8vL1xuICAgICAgICBSM3ggPSB0aGlyZFZlcnRleFBvc2l0aW9uWzBdLCAgLy8vXG4gICAgICAgIFIzeSA9IHRoaXJkVmVydGV4UG9zaXRpb25bMV0sICAvLy9cbiAgICAgICAgUDF4ID0gZmlyc3RQYXJlbnRWZXJ0ZXhQb3NpdGlvblswXSwgLy8vXG4gICAgICAgIFAyeCA9IHNlY29uZFBhcmVudFZlcnRleFBvc2l0aW9uWzBdLCAvLy9cbiAgICAgICAgUDN4ID0gdGhpcmRQYXJlbnRWZXJ0ZXhQb3NpdGlvblswXSwgLy8vXG4gICAgICAgIFAxeSA9IGZpcnN0UGFyZW50VmVydGV4UG9zaXRpb25bMV0sIC8vL1xuICAgICAgICBQMnkgPSBzZWNvbmRQYXJlbnRWZXJ0ZXhQb3NpdGlvblsxXSwgLy8vXG4gICAgICAgIFAzeSA9IHRoaXJkUGFyZW50VmVydGV4UG9zaXRpb25bMV0sIC8vL1xuICAgICAgICBQMXUgPSBmaXJzdFRleHR1cmVDb29yZGluYXRlWzBdLCAvLy9cbiAgICAgICAgUDF2ID0gZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZVsxXSwgLy8vXG4gICAgICAgIFAydSA9IHNlY29uZFRleHR1cmVDb29yZGluYXRlWzBdLCAvLy9cbiAgICAgICAgUDJ2ID0gc2Vjb25kVGV4dHVyZUNvb3JkaW5hdGVbMV0sIC8vL1xuICAgICAgICBQM3UgPSB0aGlyZFRleHR1cmVDb29yZGluYXRlWzBdLCAvLy9cbiAgICAgICAgUDN2ID0gdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZVsxXSwgLy8vXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCA9IGludmVydDMoWyAxLCAxLCAxLCBQMXUsIFAydSwgUDN1LCBQMXYsIFAydiwgUDN2IF0pLFxuICAgICAgICBmaXJzdFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnQgPSB0cmFuc2Zvcm0zKFsgUDF4LCBQMngsIFAzeCBdLCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgpLFxuICAgICAgICBzZWNvbmRUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50ID0gdHJhbnNmb3JtMyhbIFAxeSwgUDJ5LCBQM3kgXSwgdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4KSxcbiAgICAgICAgT3ggPSBmaXJzdFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnRbMF0sICAvLy9cbiAgICAgICAgVXggPSBmaXJzdFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnRbMV0sICAvLy9cbiAgICAgICAgVnggPSBmaXJzdFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnRbMl0sICAvLy9cbiAgICAgICAgT3kgPSBzZWNvbmRUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50WzBdLCAgLy8vXG4gICAgICAgIFV5ID0gc2Vjb25kVHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudFsxXSwgIC8vL1xuICAgICAgICBWeSA9IHNlY29uZFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnRbMl0sICAvLy9cbiAgICAgICAgdHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc01hdHJpeCA9IGludmVydDIoWyBVeCwgVXksIFZ4LCBWeSBdKSxcbiAgICAgICAgZmlyc3RBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCA9IHRyYW5zZm9ybTIoWyBSMXggLSBPeCwgUjF5IC0gT3kgXSwgdHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc01hdHJpeCksXG4gICAgICAgIHNlY29uZEFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzQ29tcG9uZW50ID0gdHJhbnNmb3JtMihbIFIyeCAtIE94LCBSMnkgLSBPeSBdLCB0cmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzTWF0cml4KSxcbiAgICAgICAgdGhpcmRBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCA9IHRyYW5zZm9ybTIoWyBSM3ggLSBPeCwgUjN5IC0gT3kgXSwgdHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc01hdHJpeCksXG4gICAgICAgIGFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzID0gW1xuICAgICAgICAgIGZpcnN0QWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXNDb21wb25lbnQsXG4gICAgICAgICAgc2Vjb25kQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXNDb21wb25lbnQsXG4gICAgICAgICAgdGhpcmRBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCxcbiAgICAgICAgXTtcblxuICByZXR1cm4gYWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXM7XG59XG5cbmZ1bmN0aW9uIHRleHR1cmVDb29yZGluYXRlc0Zyb21UZXh0dXJlQ29vcmRpbmF0ZXNBbmRJbmRleCh0ZXh0dXJlQ29vcmRpbmF0ZXMsIGluZGV4KSB7ICAvLy9cbiAgdGV4dHVyZUNvb3JkaW5hdGVzID0gdGV4dHVyZUNvb3JkaW5hdGVzLnNsaWNlKGluZGV4ICogMywgaW5kZXggKiAzICsgMyk7ICAvLy9cblxuICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVzO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgY2xvbmVUZXh0dXJlQ29vcmRpbmF0ZXM6IGNsb25lVGV4dHVyZUNvb3JkaW5hdGVzLFxuICBjYWxjdWxhdGVWZXJ0ZXhUZXh0dXJlQ29vcmRpbmF0ZXM6IGNhbGN1bGF0ZVZlcnRleFRleHR1cmVDb29yZGluYXRlcyxcbiAgY2FsY3VsYXRlQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXM6IGNhbGN1bGF0ZUFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzLFxuICB0ZXh0dXJlQ29vcmRpbmF0ZXNGcm9tVGV4dHVyZUNvb3JkaW5hdGVzQW5kSW5kZXg6IHRleHR1cmVDb29yZGluYXRlc0Zyb21UZXh0dXJlQ29vcmRpbmF0ZXNBbmRJbmRleFxufTtcbiJdfQ==