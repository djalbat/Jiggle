"use strict";

var _vertices = require("../utilities/vertices");

var _matrix = require("../maths/matrix");

var _array = require("../utilities/array");

var _quaternion = require("../utilities/quaternion");

var _vector = require("../maths/vector");

function cloneTextureCoordinateTuples(textureCoordinateTuples) {
  textureCoordinateTuples = textureCoordinateTuples.map(function (textureCoordinateTuple) {
    return textureCoordinateTuple.slice();
  }); ///

  return textureCoordinateTuples;
}

function calculateMappedTextureCoordinateTuples(textureCoordinateTuples, extent) {
  var left = extent.left,
      bottom = extent.bottom,
      width = extent.width,
      height = extent.height,
      mappedTextureCoordinateTuples = textureCoordinateTuples.map(function (textureCoordinateTuple) {
    return (0, _vector.add2)((0, _vector.multiply2)(textureCoordinateTuple, [width, height]), [left, bottom]);
  }); ///

  return mappedTextureCoordinateTuples;
}

function calculateAdjustedTextureCoordinateTuples(vertices, normal, parentVertices, textureCoordinateTuples) {
  var arbitraryRotationQuaternion = (0, _quaternion.calculateArbitraryRotationQuaternion)(normal),
      rotationQuaternion = arbitraryRotationQuaternion; ///

  var tempVertices = (0, _vertices.rotateVertices)(vertices, rotationQuaternion);
  parentVertices = (0, _vertices.rotateVertices)(parentVertices, rotationQuaternion);
  vertices = tempVertices; ///

  var firstVertex = (0, _array.first)(vertices),
      secondVertex = (0, _array.second)(vertices),
      thirdVertex = (0, _array.third)(vertices),
      firstParentVertex = (0, _array.first)(parentVertices),
      secondParentVertex = (0, _array.second)(parentVertices),
      thirdParentVertex = (0, _array.third)(parentVertices),
      firstTextureCoordinateTuple = (0, _array.first)(textureCoordinateTuples),
      secondTextureCoordinateTuple = (0, _array.second)(textureCoordinateTuples),
      thirdTextureCoordinateTuple = (0, _array.third)(textureCoordinateTuples),
      firstVertexPosition = firstVertex.getPosition(),
      secondVertexPosition = secondVertex.getPosition(),
      thirdVertexPosition = thirdVertex.getPosition(),
      firstParentVertexPosition = firstParentVertex.getPosition(),
      secondParentVertexPosition = secondParentVertex.getPosition(),
      thirdParentVertexPosition = thirdParentVertex.getPosition(),
      R1x = firstVertexPosition[0],
      ///
  R1y = firstVertexPosition[1],
      ///
  R2x = secondVertexPosition[0],
      ///
  R2y = secondVertexPosition[1],
      ///
  R3x = thirdVertexPosition[0],
      ///
  R3y = thirdVertexPosition[1],
      ///
  P1x = firstParentVertexPosition[0],
      ///
  P2x = secondParentVertexPosition[0],
      ///
  P3x = thirdParentVertexPosition[0],
      ///
  P1y = firstParentVertexPosition[1],
      ///
  P2y = secondParentVertexPosition[1],
      ///
  P3y = thirdParentVertexPosition[1],
      ///
  P1u = firstTextureCoordinateTuple[0],
      ///
  P1v = firstTextureCoordinateTuple[1],
      ///
  P2u = secondTextureCoordinateTuple[0],
      ///
  P2v = secondTextureCoordinateTuple[1],
      ///
  P3u = thirdTextureCoordinateTuple[0],
      ///
  P3v = thirdTextureCoordinateTuple[1],
      ///
  textureCoordinatesMatrix = (0, _matrix.invert3)([1, 1, 1, P1u, P2u, P3u, P1v, P2v, P3v]),
      firstTransformedParentVerticesComponent = (0, _vector.transform3)([P1x, P2x, P3x], textureCoordinatesMatrix),
      secondTransformedParentVerticesComponent = (0, _vector.transform3)([P1y, P2y, P3y], textureCoordinatesMatrix),
      Ox = firstTransformedParentVerticesComponent[0],
      ///
  Ux = firstTransformedParentVerticesComponent[1],
      ///
  Vx = firstTransformedParentVerticesComponent[2],
      ///
  Oy = secondTransformedParentVerticesComponent[0],
      ///
  Uy = secondTransformedParentVerticesComponent[1],
      ///
  Vy = secondTransformedParentVerticesComponent[2],
      ///
  transformedParentVerticesMatrix = (0, _matrix.invert2)([Ux, Uy, Vx, Vy]),
      firstAdjustedTextureCoordinate = (0, _vector.transform2)([R1x - Ox, R1y - Oy], transformedParentVerticesMatrix),
      secondAdjustedTextureCoordinate = (0, _vector.transform2)([R2x - Ox, R2y - Oy], transformedParentVerticesMatrix),
      thirdAdjustedTextureCoordinate = (0, _vector.transform2)([R3x - Ox, R3y - Oy], transformedParentVerticesMatrix),
      adjustedTextureCoordinateTuple = [firstAdjustedTextureCoordinate, secondAdjustedTextureCoordinate, thirdAdjustedTextureCoordinate];
  return adjustedTextureCoordinateTuple;
}

module.exports = {
  cloneTextureCoordinateTuples: cloneTextureCoordinateTuples,
  calculateMappedTextureCoordinateTuples: calculateMappedTextureCoordinateTuples,
  calculateAdjustedTextureCoordinateTuples: calculateAdjustedTextureCoordinateTuples
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRleHR1cmUuanMiXSwibmFtZXMiOlsiY2xvbmVUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcyIsInRleHR1cmVDb29yZGluYXRlVHVwbGVzIiwibWFwIiwidGV4dHVyZUNvb3JkaW5hdGVUdXBsZSIsInNsaWNlIiwiY2FsY3VsYXRlTWFwcGVkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZXMiLCJleHRlbnQiLCJsZWZ0IiwiYm90dG9tIiwid2lkdGgiLCJoZWlnaHQiLCJtYXBwZWRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcyIsImNhbGN1bGF0ZUFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZXMiLCJ2ZXJ0aWNlcyIsIm5vcm1hbCIsInBhcmVudFZlcnRpY2VzIiwiYXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uIiwicm90YXRpb25RdWF0ZXJuaW9uIiwidGVtcFZlcnRpY2VzIiwiZmlyc3RWZXJ0ZXgiLCJzZWNvbmRWZXJ0ZXgiLCJ0aGlyZFZlcnRleCIsImZpcnN0UGFyZW50VmVydGV4Iiwic2Vjb25kUGFyZW50VmVydGV4IiwidGhpcmRQYXJlbnRWZXJ0ZXgiLCJmaXJzdFRleHR1cmVDb29yZGluYXRlVHVwbGUiLCJzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlIiwidGhpcmRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlIiwiZmlyc3RWZXJ0ZXhQb3NpdGlvbiIsImdldFBvc2l0aW9uIiwic2Vjb25kVmVydGV4UG9zaXRpb24iLCJ0aGlyZFZlcnRleFBvc2l0aW9uIiwiZmlyc3RQYXJlbnRWZXJ0ZXhQb3NpdGlvbiIsInNlY29uZFBhcmVudFZlcnRleFBvc2l0aW9uIiwidGhpcmRQYXJlbnRWZXJ0ZXhQb3NpdGlvbiIsIlIxeCIsIlIxeSIsIlIyeCIsIlIyeSIsIlIzeCIsIlIzeSIsIlAxeCIsIlAyeCIsIlAzeCIsIlAxeSIsIlAyeSIsIlAzeSIsIlAxdSIsIlAxdiIsIlAydSIsIlAydiIsIlAzdSIsIlAzdiIsInRleHR1cmVDb29yZGluYXRlc01hdHJpeCIsImZpcnN0VHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudCIsInNlY29uZFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnQiLCJPeCIsIlV4IiwiVngiLCJPeSIsIlV5IiwiVnkiLCJ0cmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzTWF0cml4IiwiZmlyc3RBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlIiwic2Vjb25kQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZSIsInRoaXJkQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZSIsImFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLFNBQVNBLDRCQUFULENBQXNDQyx1QkFBdEMsRUFBK0Q7QUFDN0RBLEVBQUFBLHVCQUF1QixHQUFHQSx1QkFBdUIsQ0FBQ0MsR0FBeEIsQ0FBNEIsVUFBQ0Msc0JBQUQ7QUFBQSxXQUE0QkEsc0JBQXNCLENBQUNDLEtBQXZCLEVBQTVCO0FBQUEsR0FBNUIsQ0FBMUIsQ0FENkQsQ0FDdUQ7O0FBRXBILFNBQU9ILHVCQUFQO0FBQ0Q7O0FBRUQsU0FBU0ksc0NBQVQsQ0FBZ0RKLHVCQUFoRCxFQUF5RUssTUFBekUsRUFBaUY7QUFBQSxNQUN2RUMsSUFEdUUsR0FDdkNELE1BRHVDLENBQ3ZFQyxJQUR1RTtBQUFBLE1BQ2pFQyxNQURpRSxHQUN2Q0YsTUFEdUMsQ0FDakVFLE1BRGlFO0FBQUEsTUFDekRDLEtBRHlELEdBQ3ZDSCxNQUR1QyxDQUN6REcsS0FEeUQ7QUFBQSxNQUNsREMsTUFEa0QsR0FDdkNKLE1BRHVDLENBQ2xESSxNQURrRDtBQUFBLE1BRXpFQyw2QkFGeUUsR0FFekNWLHVCQUF1QixDQUFDQyxHQUF4QixDQUE0QixVQUFDQyxzQkFBRDtBQUFBLFdBQTRCLGtCQUFLLHVCQUFVQSxzQkFBVixFQUFrQyxDQUFFTSxLQUFGLEVBQVNDLE1BQVQsQ0FBbEMsQ0FBTCxF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QUFBQSxNQXVDeUQ7QUFDbkRLLEVBQUFBLEVBQUUsR0FBR0wsd0NBQXdDLENBQUMsQ0FBRCxDQXhDbkQ7QUFBQSxNQXdDeUQ7QUFDbkRNLEVBQUFBLEVBQUUsR0FBR04sd0NBQXdDLENBQUMsQ0FBRCxDQXpDbkQ7QUFBQSxNQXlDeUQ7QUFDbkRPLEVBQUFBLCtCQUErQixHQUFHLHFCQUFRLENBQUVMLEVBQUYsRUFBTUcsRUFBTixFQUFVRixFQUFWLEVBQWNHLEVBQWQsQ0FBUixDQTFDeEM7QUFBQSxNQTJDTUUsOEJBQThCLEdBQUcsd0JBQVcsQ0FBRTVCLEdBQUcsR0FBR3FCLEVBQVIsRUFBWXBCLEdBQUcsR0FBR3VCLEVBQWxCLENBQVgsRUFBbUNHLCtCQUFuQyxDQTNDdkM7QUFBQSxNQTRDTUUsK0JBQStCLEdBQUcsd0JBQVcsQ0FBRTNCLEdBQUcsR0FBR21CLEVBQVIsRUFBWWxCLEdBQUcsR0FBR3FCLEVBQWxCLENBQVgsRUFBbUNHLCtCQUFuQyxDQTVDeEM7QUFBQSxNQTZDTUcsOEJBQThCLEdBQUcsd0JBQVcsQ0FBRTFCLEdBQUcsR0FBR2lCLEVBQVIsRUFBWWhCLEdBQUcsR0FBR21CLEVBQWxCLENBQVgsRUFBbUNHLCtCQUFuQyxDQTdDdkM7QUFBQSxNQThDTUksOEJBQThCLEdBQUcsQ0FDL0JILDhCQUQrQixFQUUvQkMsK0JBRitCLEVBRy9CQyw4QkFIK0IsQ0E5Q3ZDO0FBb0RBLFNBQU9DLDhCQUFQO0FBQ0Q7O0FBRURDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjtBQUNmcEUsRUFBQUEsNEJBQTRCLEVBQTVCQSw0QkFEZTtBQUVmSyxFQUFBQSxzQ0FBc0MsRUFBdENBLHNDQUZlO0FBR2ZPLEVBQUFBLHdDQUF3QyxFQUF4Q0E7QUFIZSxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgeyByb3RhdGVWZXJ0aWNlcyB9IGZyb20gXCIuLi91dGlsaXRpZXMvdmVydGljZXNcIjtcbmltcG9ydCB7IGludmVydDIsIGludmVydDMgfSBmcm9tIFwiLi4vbWF0aHMvbWF0cml4XCI7XG5pbXBvcnQgeyBmaXJzdCwgc2Vjb25kLCB0aGlyZCB9IGZyb20gXCIuLi91dGlsaXRpZXMvYXJyYXlcIjtcbmltcG9ydCB7IGNhbGN1bGF0ZUFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbiB9IGZyb20gXCIuLi91dGlsaXRpZXMvcXVhdGVybmlvblwiO1xuaW1wb3J0IHsgYWRkMiwgbXVsdGlwbHkyLCB0cmFuc2Zvcm0yLCB0cmFuc2Zvcm0zIH0gZnJvbSBcIi4uL21hdGhzL3ZlY3RvclwiO1xuXG5mdW5jdGlvbiBjbG9uZVRleHR1cmVDb29yZGluYXRlVHVwbGVzKHRleHR1cmVDb29yZGluYXRlVHVwbGVzKSB7XG4gIHRleHR1cmVDb29yZGluYXRlVHVwbGVzID0gdGV4dHVyZUNvb3JkaW5hdGVUdXBsZXMubWFwKCh0ZXh0dXJlQ29vcmRpbmF0ZVR1cGxlKSA9PiB0ZXh0dXJlQ29vcmRpbmF0ZVR1cGxlLnNsaWNlKCkpOyAgLy8vXG5cbiAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlVHVwbGVzO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVNYXBwZWRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcyh0ZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcywgZXh0ZW50KSB7XG4gIGNvbnN0IHsgbGVmdCwgYm90dG9tLCB3aWR0aCwgaGVpZ2h0IH0gPSBleHRlbnQsXG4gICAgICAgIG1hcHBlZFRleHR1cmVDb29yZGluYXRlVHVwbGVzID0gdGV4dHVyZUNvb3JkaW5hdGVUdXBsZXMubWFwKCh0ZXh0dXJlQ29vcmRpbmF0ZVR1cGxlKSA9PiBhZGQyKG11bHRpcGx5Mih0ZXh0dXJlQ29vcmRpbmF0ZVR1cGxlLCBbIHdpZHRoLCBoZWlnaHQgXSApLCBbIGxlZnQsIGJvdHRvbSBdKSk7IC8vL1xuXG4gIHJldHVybiBtYXBwZWRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcztcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcyh2ZXJ0aWNlcywgbm9ybWFsLCBwYXJlbnRWZXJ0aWNlcywgdGV4dHVyZUNvb3JkaW5hdGVUdXBsZXMpIHtcbiAgY29uc3QgYXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uID0gY2FsY3VsYXRlQXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uKG5vcm1hbCksXG4gICAgICAgIHJvdGF0aW9uUXVhdGVybmlvbiA9IGFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbjsgLy8vXG5cbiAgY29uc3QgdGVtcFZlcnRpY2VzID0gcm90YXRlVmVydGljZXModmVydGljZXMsIHJvdGF0aW9uUXVhdGVybmlvbik7XG5cbiAgcGFyZW50VmVydGljZXMgPSByb3RhdGVWZXJ0aWNlcyhwYXJlbnRWZXJ0aWNlcywgcm90YXRpb25RdWF0ZXJuaW9uKTtcblxuICB2ZXJ0aWNlcyA9IHRlbXBWZXJ0aWNlczsgIC8vL1xuXG4gIGNvbnN0IGZpcnN0VmVydGV4ID0gZmlyc3QodmVydGljZXMpLFxuICAgICAgICBzZWNvbmRWZXJ0ZXggPSBzZWNvbmQodmVydGljZXMpLFxuICAgICAgICB0aGlyZFZlcnRleCA9IHRoaXJkKHZlcnRpY2VzKSxcbiAgICAgICAgZmlyc3RQYXJlbnRWZXJ0ZXggPSBmaXJzdChwYXJlbnRWZXJ0aWNlcyksXG4gICAgICAgIHNlY29uZFBhcmVudFZlcnRleCA9IHNlY29uZChwYXJlbnRWZXJ0aWNlcyksXG4gICAgICAgIHRoaXJkUGFyZW50VmVydGV4ID0gdGhpcmQocGFyZW50VmVydGljZXMpLFxuICAgICAgICBmaXJzdFRleHR1cmVDb29yZGluYXRlVHVwbGUgPSBmaXJzdCh0ZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcyksXG4gICAgICAgIHNlY29uZFRleHR1cmVDb29yZGluYXRlVHVwbGUgPSBzZWNvbmQodGV4dHVyZUNvb3JkaW5hdGVUdXBsZXMpLFxuICAgICAgICB0aGlyZFRleHR1cmVDb29yZGluYXRlVHVwbGUgPSB0aGlyZCh0ZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcyksXG4gICAgICAgIGZpcnN0VmVydGV4UG9zaXRpb24gPSBmaXJzdFZlcnRleC5nZXRQb3NpdGlvbigpLFxuICAgICAgICBzZWNvbmRWZXJ0ZXhQb3NpdGlvbiA9IHNlY29uZFZlcnRleC5nZXRQb3NpdGlvbigpLFxuICAgICAgICB0aGlyZFZlcnRleFBvc2l0aW9uID0gdGhpcmRWZXJ0ZXguZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgZmlyc3RQYXJlbnRWZXJ0ZXhQb3NpdGlvbiA9IGZpcnN0UGFyZW50VmVydGV4LmdldFBvc2l0aW9uKCksXG4gICAgICAgIHNlY29uZFBhcmVudFZlcnRleFBvc2l0aW9uID0gc2Vjb25kUGFyZW50VmVydGV4LmdldFBvc2l0aW9uKCksXG4gICAgICAgIHRoaXJkUGFyZW50VmVydGV4UG9zaXRpb24gPSB0aGlyZFBhcmVudFZlcnRleC5nZXRQb3NpdGlvbigpLFxuICAgICAgICBSMXggPSBmaXJzdFZlcnRleFBvc2l0aW9uWzBdLCAgLy8vXG4gICAgICAgIFIxeSA9IGZpcnN0VmVydGV4UG9zaXRpb25bMV0sICAvLy9cbiAgICAgICAgUjJ4ID0gc2Vjb25kVmVydGV4UG9zaXRpb25bMF0sIC8vL1xuICAgICAgICBSMnkgPSBzZWNvbmRWZXJ0ZXhQb3NpdGlvblsxXSwgLy8vXG4gICAgICAgIFIzeCA9IHRoaXJkVmVydGV4UG9zaXRpb25bMF0sICAvLy9cbiAgICAgICAgUjN5ID0gdGhpcmRWZXJ0ZXhQb3NpdGlvblsxXSwgIC8vL1xuICAgICAgICBQMXggPSBmaXJzdFBhcmVudFZlcnRleFBvc2l0aW9uWzBdLCAvLy9cbiAgICAgICAgUDJ4ID0gc2Vjb25kUGFyZW50VmVydGV4UG9zaXRpb25bMF0sIC8vL1xuICAgICAgICBQM3ggPSB0aGlyZFBhcmVudFZlcnRleFBvc2l0aW9uWzBdLCAvLy9cbiAgICAgICAgUDF5ID0gZmlyc3RQYXJlbnRWZXJ0ZXhQb3NpdGlvblsxXSwgLy8vXG4gICAgICAgIFAyeSA9IHNlY29uZFBhcmVudFZlcnRleFBvc2l0aW9uWzFdLCAvLy9cbiAgICAgICAgUDN5ID0gdGhpcmRQYXJlbnRWZXJ0ZXhQb3NpdGlvblsxXSwgLy8vXG4gICAgICAgIFAxdSA9IGZpcnN0VGV4dHVyZUNvb3JkaW5hdGVUdXBsZVswXSwgLy8vXG4gICAgICAgIFAxdiA9IGZpcnN0VGV4dHVyZUNvb3JkaW5hdGVUdXBsZVsxXSwgLy8vXG4gICAgICAgIFAydSA9IHNlY29uZFRleHR1cmVDb29yZGluYXRlVHVwbGVbMF0sIC8vL1xuICAgICAgICBQMnYgPSBzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlWzFdLCAvLy9cbiAgICAgICAgUDN1ID0gdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlWzBdLCAvLy9cbiAgICAgICAgUDN2ID0gdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlWzFdLCAvLy9cbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4ID0gaW52ZXJ0MyhbIDEsIDEsIDEsIFAxdSwgUDJ1LCBQM3UsIFAxdiwgUDJ2LCBQM3YgXSksXG4gICAgICAgIGZpcnN0VHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudCA9IHRyYW5zZm9ybTMoWyBQMXgsIFAyeCwgUDN4IF0sIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCksXG4gICAgICAgIHNlY29uZFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnQgPSB0cmFuc2Zvcm0zKFsgUDF5LCBQMnksIFAzeSBdLCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgpLFxuICAgICAgICBPeCA9IGZpcnN0VHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudFswXSwgIC8vL1xuICAgICAgICBVeCA9IGZpcnN0VHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudFsxXSwgIC8vL1xuICAgICAgICBWeCA9IGZpcnN0VHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudFsyXSwgIC8vL1xuICAgICAgICBPeSA9IHNlY29uZFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnRbMF0sICAvLy9cbiAgICAgICAgVXkgPSBzZWNvbmRUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50WzFdLCAgLy8vXG4gICAgICAgIFZ5ID0gc2Vjb25kVHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudFsyXSwgIC8vL1xuICAgICAgICB0cmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzTWF0cml4ID0gaW52ZXJ0MihbIFV4LCBVeSwgVngsIFZ5IF0pLFxuICAgICAgICBmaXJzdEFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGUgPSB0cmFuc2Zvcm0yKFsgUjF4IC0gT3gsIFIxeSAtIE95IF0sIHRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNNYXRyaXgpLFxuICAgICAgICBzZWNvbmRBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlID0gdHJhbnNmb3JtMihbIFIyeCAtIE94LCBSMnkgLSBPeSBdLCB0cmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzTWF0cml4KSxcbiAgICAgICAgdGhpcmRBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlID0gdHJhbnNmb3JtMihbIFIzeCAtIE94LCBSM3kgLSBPeSBdLCB0cmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzTWF0cml4KSxcbiAgICAgICAgYWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlID0gW1xuICAgICAgICAgIGZpcnN0QWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZSxcbiAgICAgICAgICBzZWNvbmRBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlLFxuICAgICAgICAgIHRoaXJkQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZSxcbiAgICAgICAgXTtcblxuICByZXR1cm4gYWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgY2xvbmVUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcyxcbiAgY2FsY3VsYXRlTWFwcGVkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZXMsXG4gIGNhbGN1bGF0ZUFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZXNcbn07XG4iXX0=