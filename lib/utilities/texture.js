'use strict';

var matrixMaths = require('../maths/matrix'),
    vectorMaths = require('../maths/vector'),
    arrayUtilities = require('../utilities/array'),
    verticesUtilities = require('../utilities/vertices'),
    quaternionUtilities = require('../utilities/quaternion');

var rotateVertices = verticesUtilities.rotateVertices,
    invert2 = matrixMaths.invert2,
    invert3 = matrixMaths.invert3,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    calculateArbitraryRotationQuaternion = quaternionUtilities.calculateArbitraryRotationQuaternion,
    add2 = vectorMaths.add2,
    multiply2 = vectorMaths.multiply2,
    transform2 = vectorMaths.transform2,
    transform3 = vectorMaths.transform3;

function cloneTextureCoordinateTuples(textureCoordinateTuples) {
  textureCoordinateTuples = textureCoordinateTuples.map(function (textureCoordinateTuple) {
    return textureCoordinateTuple.slice();
  }); ///

  return textureCoordinateTuples;
}

function calculateMappedTextureCoordinateTuples(textureCoordinateTuples, extent) {
  var left = extent.left,
      bottom = extent.bottom,
      width = extent.width,
      height = extent.height,
      mappedTextureCoordinateTuples = textureCoordinateTuples.map(function (textureCoordinateTuple) {
    return add2(multiply2(textureCoordinateTuple, [width, height]), [left, bottom]);
  }); ///

  return mappedTextureCoordinateTuples;
}

function calculateAdjustedTextureCoordinateTuples(vertices, normal, parentVertices, textureCoordinateTuples) {
  var arbitraryRotationQuaternion = calculateArbitraryRotationQuaternion(normal),
      rotationQuaternion = arbitraryRotationQuaternion; ///

  var tempVertices = rotateVertices(vertices, rotationQuaternion);
  parentVertices = rotateVertices(parentVertices, rotationQuaternion);
  vertices = tempVertices; ///

  var firstVertex = first(vertices),
      secondVertex = second(vertices),
      thirdVertex = third(vertices),
      firstParentVertex = first(parentVertices),
      secondParentVertex = second(parentVertices),
      thirdParentVertex = third(parentVertices),
      firstTextureCoordinateTuple = first(textureCoordinateTuples),
      secondTextureCoordinateTuple = second(textureCoordinateTuples),
      thirdTextureCoordinateTuple = third(textureCoordinateTuples),
      firstVertexPosition = firstVertex.getPosition(),
      secondVertexPosition = secondVertex.getPosition(),
      thirdVertexPosition = thirdVertex.getPosition(),
      firstParentVertexPosition = firstParentVertex.getPosition(),
      secondParentVertexPosition = secondParentVertex.getPosition(),
      thirdParentVertexPosition = thirdParentVertex.getPosition(),
      R1x = firstVertexPosition[0],
      ///
  R1y = firstVertexPosition[1],
      ///
  R2x = secondVertexPosition[0],
      ///
  R2y = secondVertexPosition[1],
      ///
  R3x = thirdVertexPosition[0],
      ///
  R3y = thirdVertexPosition[1],
      ///
  P1x = firstParentVertexPosition[0],
      ///
  P2x = secondParentVertexPosition[0],
      ///
  P3x = thirdParentVertexPosition[0],
      ///
  P1y = firstParentVertexPosition[1],
      ///
  P2y = secondParentVertexPosition[1],
      ///
  P3y = thirdParentVertexPosition[1],
      ///
  P1u = firstTextureCoordinateTuple[0],
      ///
  P1v = firstTextureCoordinateTuple[1],
      ///
  P2u = secondTextureCoordinateTuple[0],
      ///
  P2v = secondTextureCoordinateTuple[1],
      ///
  P3u = thirdTextureCoordinateTuple[0],
      ///
  P3v = thirdTextureCoordinateTuple[1],
      ///
  textureCoordinatesMatrix = invert3([1, 1, 1, P1u, P2u, P3u, P1v, P2v, P3v]),
      firstTransformedParentVerticesComponent = transform3([P1x, P2x, P3x], textureCoordinatesMatrix),
      secondTransformedParentVerticesComponent = transform3([P1y, P2y, P3y], textureCoordinatesMatrix),
      Ox = firstTransformedParentVerticesComponent[0],
      ///
  Ux = firstTransformedParentVerticesComponent[1],
      ///
  Vx = firstTransformedParentVerticesComponent[2],
      ///
  Oy = secondTransformedParentVerticesComponent[0],
      ///
  Uy = secondTransformedParentVerticesComponent[1],
      ///
  Vy = secondTransformedParentVerticesComponent[2],
      ///
  transformedParentVerticesMatrix = invert2([Ux, Uy, Vx, Vy]),
      firstAdjustedTextureCoordinate = transform2([R1x - Ox, R1y - Oy], transformedParentVerticesMatrix),
      secondAdjustedTextureCoordinate = transform2([R2x - Ox, R2y - Oy], transformedParentVerticesMatrix),
      thirdAdjustedTextureCoordinate = transform2([R3x - Ox, R3y - Oy], transformedParentVerticesMatrix),
      adjustedTextureCoordinateTuple = [firstAdjustedTextureCoordinate, secondAdjustedTextureCoordinate, thirdAdjustedTextureCoordinate];
  return adjustedTextureCoordinateTuple;
}

module.exports = {
  cloneTextureCoordinateTuples: cloneTextureCoordinateTuples,
  calculateMappedTextureCoordinateTuples: calculateMappedTextureCoordinateTuples,
  calculateAdjustedTextureCoordinateTuples: calculateAdjustedTextureCoordinateTuples
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRleHR1cmUuanMiXSwibmFtZXMiOlsibWF0cml4TWF0aHMiLCJyZXF1aXJlIiwidmVjdG9yTWF0aHMiLCJhcnJheVV0aWxpdGllcyIsInZlcnRpY2VzVXRpbGl0aWVzIiwicXVhdGVybmlvblV0aWxpdGllcyIsInJvdGF0ZVZlcnRpY2VzIiwiaW52ZXJ0MiIsImludmVydDMiLCJmaXJzdCIsInNlY29uZCIsInRoaXJkIiwiY2FsY3VsYXRlQXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uIiwiYWRkMiIsIm11bHRpcGx5MiIsInRyYW5zZm9ybTIiLCJ0cmFuc2Zvcm0zIiwiY2xvbmVUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcyIsInRleHR1cmVDb29yZGluYXRlVHVwbGVzIiwibWFwIiwidGV4dHVyZUNvb3JkaW5hdGVUdXBsZSIsInNsaWNlIiwiY2FsY3VsYXRlTWFwcGVkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZXMiLCJleHRlbnQiLCJsZWZ0IiwiYm90dG9tIiwid2lkdGgiLCJoZWlnaHQiLCJtYXBwZWRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcyIsImNhbGN1bGF0ZUFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZXMiLCJ2ZXJ0aWNlcyIsIm5vcm1hbCIsInBhcmVudFZlcnRpY2VzIiwiYXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uIiwicm90YXRpb25RdWF0ZXJuaW9uIiwidGVtcFZlcnRpY2VzIiwiZmlyc3RWZXJ0ZXgiLCJzZWNvbmRWZXJ0ZXgiLCJ0aGlyZFZlcnRleCIsImZpcnN0UGFyZW50VmVydGV4Iiwic2Vjb25kUGFyZW50VmVydGV4IiwidGhpcmRQYXJlbnRWZXJ0ZXgiLCJmaXJzdFRleHR1cmVDb29yZGluYXRlVHVwbGUiLCJzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlIiwidGhpcmRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlIiwiZmlyc3RWZXJ0ZXhQb3NpdGlvbiIsImdldFBvc2l0aW9uIiwic2Vjb25kVmVydGV4UG9zaXRpb24iLCJ0aGlyZFZlcnRleFBvc2l0aW9uIiwiZmlyc3RQYXJlbnRWZXJ0ZXhQb3NpdGlvbiIsInNlY29uZFBhcmVudFZlcnRleFBvc2l0aW9uIiwidGhpcmRQYXJlbnRWZXJ0ZXhQb3NpdGlvbiIsIlIxeCIsIlIxeSIsIlIyeCIsIlIyeSIsIlIzeCIsIlIzeSIsIlAxeCIsIlAyeCIsIlAzeCIsIlAxeSIsIlAyeSIsIlAzeSIsIlAxdSIsIlAxdiIsIlAydSIsIlAydiIsIlAzdSIsIlAzdiIsInRleHR1cmVDb29yZGluYXRlc01hdHJpeCIsImZpcnN0VHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudCIsInNlY29uZFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnQiLCJPeCIsIlV4IiwiVngiLCJPeSIsIlV5IiwiVnkiLCJ0cmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzTWF0cml4IiwiZmlyc3RBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlIiwic2Vjb25kQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZSIsInRoaXJkQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZSIsImFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQU1BLFdBQVcsR0FBR0MsT0FBTyxDQUFDLGlCQUFELENBQTNCO0FBQUEsSUFDTUMsV0FBVyxHQUFHRCxPQUFPLENBQUMsaUJBQUQsQ0FEM0I7QUFBQSxJQUVNRSxjQUFjLEdBQUdGLE9BQU8sQ0FBQyxvQkFBRCxDQUY5QjtBQUFBLElBR01HLGlCQUFpQixHQUFHSCxPQUFPLENBQUMsdUJBQUQsQ0FIakM7QUFBQSxJQUlNSSxtQkFBbUIsR0FBR0osT0FBTyxDQUFDLHlCQUFELENBSm5DOztBQU1NLElBQUVLLGNBQUYsR0FBcUJGLGlCQUFyQixDQUFFRSxjQUFGO0FBQUEsSUFDRUMsT0FERixHQUN1QlAsV0FEdkIsQ0FDRU8sT0FERjtBQUFBLElBQ1dDLE9BRFgsR0FDdUJSLFdBRHZCLENB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dGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IG1hdHJpeE1hdGhzID0gcmVxdWlyZSgnLi4vbWF0aHMvbWF0cml4JyksXG4gICAgICB2ZWN0b3JNYXRocyA9IHJlcXVpcmUoJy4uL21hdGhzL3ZlY3RvcicpLFxuICAgICAgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvYXJyYXknKSxcbiAgICAgIHZlcnRpY2VzVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL3ZlcnRpY2VzJyksXG4gICAgICBxdWF0ZXJuaW9uVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL3F1YXRlcm5pb24nKTtcblxuY29uc3QgeyByb3RhdGVWZXJ0aWNlcyB9ID0gdmVydGljZXNVdGlsaXRpZXMsXG4gICAgICB7IGludmVydDIsIGludmVydDMgfSA9IG1hdHJpeE1hdGhzLFxuICAgICAgeyBmaXJzdCwgc2Vjb25kLCB0aGlyZCB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IGNhbGN1bGF0ZUFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbiB9ID0gcXVhdGVybmlvblV0aWxpdGllcyxcbiAgICAgIHsgYWRkMiwgbXVsdGlwbHkyLCB0cmFuc2Zvcm0yLCB0cmFuc2Zvcm0zIH0gPSB2ZWN0b3JNYXRocztcblxuZnVuY3Rpb24gY2xvbmVUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcyh0ZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcykge1xuICB0ZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcyA9IHRleHR1cmVDb29yZGluYXRlVHVwbGVzLm1hcCgodGV4dHVyZUNvb3JkaW5hdGVUdXBsZSkgPT4gdGV4dHVyZUNvb3JkaW5hdGVUdXBsZS5zbGljZSgpKTsgIC8vL1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcztcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlTWFwcGVkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZXModGV4dHVyZUNvb3JkaW5hdGVUdXBsZXMsIGV4dGVudCkge1xuICBjb25zdCB7IGxlZnQsIGJvdHRvbSwgd2lkdGgsIGhlaWdodCB9ID0gZXh0ZW50LFxuICAgICAgICBtYXBwZWRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlcyA9IHRleHR1cmVDb29yZGluYXRlVHVwbGVzLm1hcCgodGV4dHVyZUNvb3JkaW5hdGVUdXBsZSkgPT4gYWRkMihtdWx0aXBseTIodGV4dHVyZUNvb3JkaW5hdGVUdXBsZSwgWyB3aWR0aCwgaGVpZ2h0IF0gKSwgWyBsZWZ0LCBib3R0b20gXSkpOyAvLy9cblxuICByZXR1cm4gbWFwcGVkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZXM7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZXModmVydGljZXMsIG5vcm1hbCwgcGFyZW50VmVydGljZXMsIHRleHR1cmVDb29yZGluYXRlVHVwbGVzKSB7XG4gIGNvbnN0IGFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbiA9IGNhbGN1bGF0ZUFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbihub3JtYWwpLFxuICAgICAgICByb3RhdGlvblF1YXRlcm5pb24gPSBhcmJpdHJhcnlSb3RhdGlvblF1YXRlcm5pb247IC8vL1xuXG4gIGNvbnN0IHRlbXBWZXJ0aWNlcyA9IHJvdGF0ZVZlcnRpY2VzKHZlcnRpY2VzLCByb3RhdGlvblF1YXRlcm5pb24pO1xuXG4gIHBhcmVudFZlcnRpY2VzID0gcm90YXRlVmVydGljZXMocGFyZW50VmVydGljZXMsIHJvdGF0aW9uUXVhdGVybmlvbik7XG5cbiAgdmVydGljZXMgPSB0ZW1wVmVydGljZXM7ICAvLy9cblxuICBjb25zdCBmaXJzdFZlcnRleCA9IGZpcnN0KHZlcnRpY2VzKSxcbiAgICAgICAgc2Vjb25kVmVydGV4ID0gc2Vjb25kKHZlcnRpY2VzKSxcbiAgICAgICAgdGhpcmRWZXJ0ZXggPSB0aGlyZCh2ZXJ0aWNlcyksXG4gICAgICAgIGZpcnN0UGFyZW50VmVydGV4ID0gZmlyc3QocGFyZW50VmVydGljZXMpLFxuICAgICAgICBzZWNvbmRQYXJlbnRWZXJ0ZXggPSBzZWNvbmQocGFyZW50VmVydGljZXMpLFxuICAgICAgICB0aGlyZFBhcmVudFZlcnRleCA9IHRoaXJkKHBhcmVudFZlcnRpY2VzKSxcbiAgICAgICAgZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlID0gZmlyc3QodGV4dHVyZUNvb3JkaW5hdGVUdXBsZXMpLFxuICAgICAgICBzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlID0gc2Vjb25kKHRleHR1cmVDb29yZGluYXRlVHVwbGVzKSxcbiAgICAgICAgdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlID0gdGhpcmQodGV4dHVyZUNvb3JkaW5hdGVUdXBsZXMpLFxuICAgICAgICBmaXJzdFZlcnRleFBvc2l0aW9uID0gZmlyc3RWZXJ0ZXguZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgc2Vjb25kVmVydGV4UG9zaXRpb24gPSBzZWNvbmRWZXJ0ZXguZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgdGhpcmRWZXJ0ZXhQb3NpdGlvbiA9IHRoaXJkVmVydGV4LmdldFBvc2l0aW9uKCksXG4gICAgICAgIGZpcnN0UGFyZW50VmVydGV4UG9zaXRpb24gPSBmaXJzdFBhcmVudFZlcnRleC5nZXRQb3NpdGlvbigpLFxuICAgICAgICBzZWNvbmRQYXJlbnRWZXJ0ZXhQb3NpdGlvbiA9IHNlY29uZFBhcmVudFZlcnRleC5nZXRQb3NpdGlvbigpLFxuICAgICAgICB0aGlyZFBhcmVudFZlcnRleFBvc2l0aW9uID0gdGhpcmRQYXJlbnRWZXJ0ZXguZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgUjF4ID0gZmlyc3RWZXJ0ZXhQb3NpdGlvblswXSwgIC8vL1xuICAgICAgICBSMXkgPSBmaXJzdFZlcnRleFBvc2l0aW9uWzFdLCAgLy8vXG4gICAgICAgIFIyeCA9IHNlY29uZFZlcnRleFBvc2l0aW9uWzBdLCAvLy9cbiAgICAgICAgUjJ5ID0gc2Vjb25kVmVydGV4UG9zaXRpb25bMV0sIC8vL1xuICAgICAgICBSM3ggPSB0aGlyZFZlcnRleFBvc2l0aW9uWzBdLCAgLy8vXG4gICAgICAgIFIzeSA9IHRoaXJkVmVydGV4UG9zaXRpb25bMV0sICAvLy9cbiAgICAgICAgUDF4ID0gZmlyc3RQYXJlbnRWZXJ0ZXhQb3NpdGlvblswXSwgLy8vXG4gICAgICAgIFAyeCA9IHNlY29uZFBhcmVudFZlcnRleFBvc2l0aW9uWzBdLCAvLy9cbiAgICAgICAgUDN4ID0gdGhpcmRQYXJlbnRWZXJ0ZXhQb3NpdGlvblswXSwgLy8vXG4gICAgICAgIFAxeSA9IGZpcnN0UGFyZW50VmVydGV4UG9zaXRpb25bMV0sIC8vL1xuICAgICAgICBQMnkgPSBzZWNvbmRQYXJlbnRWZXJ0ZXhQb3NpdGlvblsxXSwgLy8vXG4gICAgICAgIFAzeSA9IHRoaXJkUGFyZW50VmVydGV4UG9zaXRpb25bMV0sIC8vL1xuICAgICAgICBQMXUgPSBmaXJzdFRleHR1cmVDb29yZGluYXRlVHVwbGVbMF0sIC8vL1xuICAgICAgICBQMXYgPSBmaXJzdFRleHR1cmVDb29yZGluYXRlVHVwbGVbMV0sIC8vL1xuICAgICAgICBQMnUgPSBzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZVR1cGxlWzBdLCAvLy9cbiAgICAgICAgUDJ2ID0gc2Vjb25kVGV4dHVyZUNvb3JkaW5hdGVUdXBsZVsxXSwgLy8vXG4gICAgICAgIFAzdSA9IHRoaXJkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZVswXSwgLy8vXG4gICAgICAgIFAzdiA9IHRoaXJkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZVsxXSwgLy8vXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCA9IGludmVydDMoWyAxLCAxLCAxLCBQMXUsIFAydSwgUDN1LCBQMXYsIFAydiwgUDN2IF0pLFxuICAgICAgICBmaXJzdFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnQgPSB0cmFuc2Zvcm0zKFsgUDF4LCBQMngsIFAzeCBdLCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgpLFxuICAgICAgICBzZWNvbmRUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50ID0gdHJhbnNmb3JtMyhbIFAxeSwgUDJ5LCBQM3kgXSwgdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4KSxcbiAgICAgICAgT3ggPSBmaXJzdFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnRbMF0sICAvLy9cbiAgICAgICAgVXggPSBmaXJzdFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnRbMV0sICAvLy9cbiAgICAgICAgVnggPSBmaXJzdFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnRbMl0sICAvLy9cbiAgICAgICAgT3kgPSBzZWNvbmRUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50WzBdLCAgLy8vXG4gICAgICAgIFV5ID0gc2Vjb25kVHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudFsxXSwgIC8vL1xuICAgICAgICBWeSA9IHNlY29uZFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnRbMl0sICAvLy9cbiAgICAgICAgdHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc01hdHJpeCA9IGludmVydDIoWyBVeCwgVXksIFZ4LCBWeSBdKSxcbiAgICAgICAgZmlyc3RBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlID0gdHJhbnNmb3JtMihbIFIxeCAtIE94LCBSMXkgLSBPeSBdLCB0cmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzTWF0cml4KSxcbiAgICAgICAgc2Vjb25kQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZSA9IHRyYW5zZm9ybTIoWyBSMnggLSBPeCwgUjJ5IC0gT3kgXSwgdHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc01hdHJpeCksXG4gICAgICAgIHRoaXJkQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZSA9IHRyYW5zZm9ybTIoWyBSM3ggLSBPeCwgUjN5IC0gT3kgXSwgdHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc01hdHJpeCksXG4gICAgICAgIGFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZSA9IFtcbiAgICAgICAgICBmaXJzdEFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGUsXG4gICAgICAgICAgc2Vjb25kQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZSxcbiAgICAgICAgICB0aGlyZEFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGUsXG4gICAgICAgIF07XG5cbiAgcmV0dXJuIGFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVUdXBsZTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGNsb25lVGV4dHVyZUNvb3JkaW5hdGVUdXBsZXMsXG4gIGNhbGN1bGF0ZU1hcHBlZFRleHR1cmVDb29yZGluYXRlVHVwbGVzLFxuICBjYWxjdWxhdGVBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlVHVwbGVzXG59O1xuIl19