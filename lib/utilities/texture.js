'use strict';

var matrixMaths = require('../maths/matrix'),
    vectorMaths = require('../maths/vector'),
    arrayUtilities = require('../utilities/array'),
    verticesUtilities = require('../utilities/vertices'),
    quaternionUtilities = require('../utilities/quaternion');

var invert2 = matrixMaths.invert2,
    invert3 = matrixMaths.invert3,
    rotateVertices = verticesUtilities.rotateVertices,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    add2 = vectorMaths.add2,
    multiply2 = vectorMaths.multiply2,
    transform2 = vectorMaths.transform2,
    transform3 = vectorMaths.transform3,
    calculateArbitraryRotationQuaternion = quaternionUtilities.calculateArbitraryRotationQuaternion;


function cloneTextureCoordinates(textureCoordinates) {
  textureCoordinates = textureCoordinates.map(function (textureCoordinates) {
    ///
    textureCoordinates = textureCoordinates.slice();

    return textureCoordinates;
  });

  return textureCoordinates;
}

function calculateVertexTextureCoordinates(textureCoordinates, left, bottom, width, height) {
  textureCoordinates = textureCoordinates.map(function (textureCoordinates) {
    ///
    textureCoordinates = add2(multiply2(textureCoordinates, [width, height]), [left, bottom]);

    return textureCoordinates;
  });

  return textureCoordinates;
}

function calculateAdjustedTextureCoordinates(vertices, normal, parentVertices, textureCoordinates) {
  var arbitraryRotationQuaternion = calculateArbitraryRotationQuaternion(normal),
      rotationQuaternion = arbitraryRotationQuaternion;

  vertices = rotateVertices(vertices, rotationQuaternion);

  parentVertices = rotateVertices(parentVertices, rotationQuaternion);

  var firstVertex = first(vertices),
      secondVertex = second(vertices),
      thirdVertex = third(vertices),
      firstParentVertex = first(parentVertices),
      secondParentVertex = second(parentVertices),
      thirdParentVertex = third(parentVertices),
      firstTextureCoordinate = first(textureCoordinates),
      secondTextureCoordinate = second(textureCoordinates),
      thirdTextureCoordinate = third(textureCoordinates),
      firstVertexPosition = firstVertex.getPosition(),
      secondVertexPosition = secondVertex.getPosition(),
      thirdVertexPosition = thirdVertex.getPosition(),
      firstParentVertexPosition = firstParentVertex.getPosition(),
      secondParentVertexPosition = secondParentVertex.getPosition(),
      thirdParentVertexPosition = thirdParentVertex.getPosition(),
      R1x = firstVertexPosition[0],
      ///
  R1y = firstVertexPosition[1],
      ///
  R2x = secondVertexPosition[0],
      ///
  R2y = secondVertexPosition[1],
      ///
  R3x = thirdVertexPosition[0],
      ///
  R3y = thirdVertexPosition[1],
      ///
  P1x = firstParentVertexPosition[0],
      ///
  P2x = secondParentVertexPosition[0],
      ///
  P3x = thirdParentVertexPosition[0],
      ///
  P1y = firstParentVertexPosition[1],
      ///
  P2y = secondParentVertexPosition[1],
      ///
  P3y = thirdParentVertexPosition[1],
      ///
  P1u = firstTextureCoordinate[0],
      ///
  P1v = firstTextureCoordinate[1],
      ///
  P2u = secondTextureCoordinate[0],
      ///
  P2v = secondTextureCoordinate[1],
      ///
  P3u = thirdTextureCoordinate[0],
      ///
  P3v = thirdTextureCoordinate[1],
      ///
  textureCoordinatesMatrix = invert3([1, 1, 1, P1u, P2u, P3u, P1v, P2v, P3v]),
      firstTransformedParentVerticesComponent = transform3([P1x, P2x, P3x], textureCoordinatesMatrix),
      secondTransformedParentVerticesComponent = transform3([P1y, P2y, P3y], textureCoordinatesMatrix),
      Ox = firstTransformedParentVerticesComponent[0],
      ///
  Ux = firstTransformedParentVerticesComponent[1],
      ///
  Vx = firstTransformedParentVerticesComponent[2],
      ///
  Oy = secondTransformedParentVerticesComponent[0],
      ///
  Uy = secondTransformedParentVerticesComponent[1],
      ///
  Vy = secondTransformedParentVerticesComponent[2],
      ///
  transformedParentVerticesMatrix = invert2([Ux, Uy, Vx, Vy]),
      firstAdjustedTextureCoordinatesComponent = transform2([R1x - Ox, R1y - Oy], transformedParentVerticesMatrix),
      secondAdjustedTextureCoordinatesComponent = transform2([R2x - Ox, R2y - Oy], transformedParentVerticesMatrix),
      thirdAdjustedTextureCoordinatesComponent = transform2([R3x - Ox, R3y - Oy], transformedParentVerticesMatrix),
      adjustedTextureCoordinates = [firstAdjustedTextureCoordinatesComponent, secondAdjustedTextureCoordinatesComponent, thirdAdjustedTextureCoordinatesComponent];

  return adjustedTextureCoordinates;
}

function textureCoordinatesFromTextureCoordinatesAndIndex(textureCoordinates, index) {
  ///
  textureCoordinates = textureCoordinates.slice(index * 3, index * 3 + 3); ///

  return textureCoordinates;
}

module.exports = {
  cloneTextureCoordinates: cloneTextureCoordinates,
  calculateVertexTextureCoordinates: calculateVertexTextureCoordinates,
  calculateAdjustedTextureCoordinates: calculateAdjustedTextureCoordinates,
  textureCoordinatesFromTextureCoordinatesAndIndex: textureCoordinatesFromTextureCoordinatesAndIndex
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvdGV4dHVyZS5qcyJdLCJuYW1lcyI6WyJtYXRyaXhNYXRocyIsInJlcXVpcmUiLCJ2ZWN0b3JNYXRocyIsImFycmF5VXRpbGl0aWVzIiwidmVydGljZXNVdGlsaXRpZXMiLCJxdWF0ZXJuaW9uVXRpbGl0aWVzIiwiaW52ZXJ0MiIsImludmVydDMiLCJyb3RhdGVWZXJ0aWNlcyIsImZpcnN0Iiwic2Vjb25kIiwidGhpcmQiLCJhZGQyIiwibXVsdGlwbHkyIiwidHJhbnNmb3JtMiIsInRyYW5zZm9ybTMiLCJjYWxjdWxhdGVBcmJpdHJhcnlSb3RhdGlvblF1YXRlcm5pb24iLCJjbG9uZVRleHR1cmVDb29yZGluYXRlcyIsInRleHR1cmVDb29yZGluYXRlcyIsIm1hcCIsInNsaWNlIiwiY2FsY3VsYXRlVmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzIiwibGVmdCIsImJvdHRvbSIsIndpZHRoIiwiaGVpZ2h0IiwiY2FsY3VsYXRlQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXMiLCJ2ZXJ0aWNlcyIsIm5vcm1hbCIsInBhcmVudFZlcnRpY2VzIiwiYXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uIiwicm90YXRpb25RdWF0ZXJuaW9uIiwiZmlyc3RWZXJ0ZXgiLCJzZWNvbmRWZXJ0ZXgiLCJ0aGlyZFZlcnRleCIsImZpcnN0UGFyZW50VmVydGV4Iiwic2Vjb25kUGFyZW50VmVydGV4IiwidGhpcmRQYXJlbnRWZXJ0ZXgiLCJmaXJzdFRleHR1cmVDb29yZGluYXRlIiwic2Vjb25kVGV4dHVyZUNvb3JkaW5hdGUiLCJ0aGlyZFRleHR1cmVDb29yZGluYXRlIiwiZmlyc3RWZXJ0ZXhQb3NpdGlvbiIsImdldFBvc2l0aW9uIiwic2Vjb25kVmVydGV4UG9zaXRpb24iLCJ0aGlyZFZlcnRleFBvc2l0aW9uIiwiZmlyc3RQYXJlbnRWZXJ0ZXhQb3NpdGlvbiIsInNlY29uZFBhcmVudFZlcnRleFBvc2l0aW9uIiwidGhpcmRQYXJlbnRWZXJ0ZXhQb3NpdGlvbiIsIlIxeCIsIlIxeSIsIlIyeCIsIlIyeSIsIlIzeCIsIlIzeSIsIlAxeCIsIlAyeCIsIlAzeCIsIlAxeSIsIlAyeSIsIlAzeSIsIlAxdSIsIlAxdiIsIlAydSIsIlAydiIsIlAzdSIsIlAzdiIsInRleHR1cmVDb29yZGluYXRlc01hdHJpeCIsImZpcnN0VHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudCIsInNlY29uZFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnQiLCJPeCIsIlV4IiwiVngiLCJPeSIsIlV5IiwiVnkiLCJ0cmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzTWF0cml4IiwiZmlyc3RBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCIsInNlY29uZEFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzQ29tcG9uZW50IiwidGhpcmRBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCIsImFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzIiwidGV4dHVyZUNvb3JkaW5hdGVzRnJvbVRleHR1cmVDb29yZGluYXRlc0FuZEluZGV4IiwiaW5kZXgiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxjQUFjQyxRQUFRLGlCQUFSLENBQXBCO0FBQUEsSUFDTUMsY0FBY0QsUUFBUSxpQkFBUixDQURwQjtBQUFBLElBRU1FLGlCQUFpQkYsUUFBUSxvQkFBUixDQUZ2QjtBQUFBLElBR01HLG9CQUFvQkgsUUFBUSx1QkFBUixDQUgxQjtBQUFBLElBSU1JLHNCQUFzQkosUUFBUSx5QkFBUixDQUo1Qjs7SUFNUUssTyxHQUFxQk4sVyxDQUFyQk0sTztJQUFTQyxPLEdBQVlQLFcsQ0FBWk8sTztJQUNUQyxjLEdBQW1CSixpQixDQUFuQkksYztJQUNBQyxLLEdBQXlCTixjLENBQXpCTSxLO0lBQU9DLE0sR0FBa0JQLGMsQ0FBbEJPLE07SUFBUUMsSyxHQUFVUixjLENBQVZRLEs7SUFDZkMsSSxHQUE0Q1YsVyxD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QXpDLENBdkNYO0FBQUEsTUF1Q3lEO0FBQ25ESyxPQUFLTCx5Q0FBeUMsQ0FBekMsQ0F4Q1g7QUFBQSxNQXdDeUQ7QUFDbkRNLE9BQUtOLHlDQUF5QyxDQUF6QyxDQXpDWDtBQUFBLE1BeUN5RDtBQUNuRE8sb0NBQWtDckUsUUFBUSxDQUFFZ0UsRUFBRixFQUFNRyxFQUFOLEVBQVVGLEVBQVYsRUFBY0csRUFBZCxDQUFSLENBMUN4QztBQUFBLE1BMkNNRSwyQ0FBMkM5RCxXQUFXLENBQUVrQyxNQUFNcUIsRUFBUixFQUFZcEIsTUFBTXVCLEVBQWxCLENBQVgsRUFBbUNHLCtCQUFuQyxDQTNDakQ7QUFBQSxNQTRDTUUsNENBQTRDL0QsV0FBVyxDQUFFb0MsTUFBTW1CLEVBQVIsRUFBWWxCLE1BQU1xQixFQUFsQixDQUFYLEVBQW1DRywrQkFBbkMsQ0E1Q2xEO0FBQUEsTUE2Q01HLDJDQUEyQ2hFLFdBQVcsQ0FBRXNDLE1BQU1pQixFQUFSLEVBQVloQixNQUFNbUIsRUFBbEIsQ0FBWCxFQUFtQ0csK0JBQW5DLENBN0NqRDtBQUFBLE1BOENNSSw2QkFBNkIsQ0FDM0JILHdDQUQyQixFQUUzQkMseUNBRjJCLEVBRzNCQyx3Q0FIMkIsQ0E5Q25DOztBQW9EQSxTQUFPQywwQkFBUDtBQUNEOztBQUVELFNBQVNDLGdEQUFULENBQTBEOUQsa0JBQTFELEVBQThFK0QsS0FBOUUsRUFBcUY7QUFBRztBQUN0Ri9ELHVCQUFxQkEsbUJBQW1CRSxLQUFuQixDQUF5QjZELFFBQVEsQ0FBakMsRUFBb0NBLFFBQVEsQ0FBUixHQUFZLENBQWhELENBQXJCLENBRG1GLENBQ1Q7O0FBRTFFLFNBQU8vRCxrQkFBUDtBQUNEOztBQUVEZ0UsT0FBT0MsT0FBUCxHQUFpQjtBQUNmbEUsa0RBRGU7QUFFZkksc0VBRmU7QUFHZkssMEVBSGU7QUFJZnNEO0FBSmUsQ0FBakIiLCJmaWxlIjoidGV4dHVyZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgbWF0cml4TWF0aHMgPSByZXF1aXJlKCcuLi9tYXRocy9tYXRyaXgnKSxcbiAgICAgIHZlY3Rvck1hdGhzID0gcmVxdWlyZSgnLi4vbWF0aHMvdmVjdG9yJyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgdmVydGljZXNVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvdmVydGljZXMnKSxcbiAgICAgIHF1YXRlcm5pb25VdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvcXVhdGVybmlvbicpO1xuXG5jb25zdCB7IGludmVydDIsIGludmVydDMgfSA9IG1hdHJpeE1hdGhzLFxuICAgICAgeyByb3RhdGVWZXJ0aWNlcyB9ID0gdmVydGljZXNVdGlsaXRpZXMsXG4gICAgICB7IGZpcnN0LCBzZWNvbmQsIHRoaXJkIH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgYWRkMiwgbXVsdGlwbHkyLCB0cmFuc2Zvcm0yLCB0cmFuc2Zvcm0zIH0gPSB2ZWN0b3JNYXRocyxcbiAgICAgIHsgY2FsY3VsYXRlQXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uIH0gPSBxdWF0ZXJuaW9uVXRpbGl0aWVzO1xuXG5mdW5jdGlvbiBjbG9uZVRleHR1cmVDb29yZGluYXRlcyh0ZXh0dXJlQ29vcmRpbmF0ZXMpIHtcbiAgdGV4dHVyZUNvb3JkaW5hdGVzID0gdGV4dHVyZUNvb3JkaW5hdGVzLm1hcCgodGV4dHVyZUNvb3JkaW5hdGVzKSA9PiB7ICAvLy9cbiAgICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQ29vcmRpbmF0ZXMuc2xpY2UoKTtcblxuICAgIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXM7XG4gIH0pO1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXM7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVZlcnRleFRleHR1cmVDb29yZGluYXRlcyh0ZXh0dXJlQ29vcmRpbmF0ZXMsIGxlZnQsIGJvdHRvbSwgd2lkdGgsIGhlaWdodCkge1xuICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQ29vcmRpbmF0ZXMubWFwKCh0ZXh0dXJlQ29vcmRpbmF0ZXMpID0+IHsgIC8vL1xuICAgIHRleHR1cmVDb29yZGluYXRlcyA9IGFkZDIobXVsdGlwbHkyKHRleHR1cmVDb29yZGluYXRlcywgWyB3aWR0aCwgaGVpZ2h0IF0gKSwgWyBsZWZ0LCBib3R0b20gXSk7XG5cbiAgICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVzO1xuICB9KTtcblxuICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVzO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlcyh2ZXJ0aWNlcywgbm9ybWFsLCBwYXJlbnRWZXJ0aWNlcywgdGV4dHVyZUNvb3JkaW5hdGVzKSB7XG4gIGNvbnN0IGFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbiA9IGNhbGN1bGF0ZUFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbihub3JtYWwpLFxuICAgICAgICByb3RhdGlvblF1YXRlcm5pb24gPSBhcmJpdHJhcnlSb3RhdGlvblF1YXRlcm5pb247XG5cbiAgdmVydGljZXMgPSByb3RhdGVWZXJ0aWNlcyh2ZXJ0aWNlcywgcm90YXRpb25RdWF0ZXJuaW9uKTtcblxuICBwYXJlbnRWZXJ0aWNlcyA9IHJvdGF0ZVZlcnRpY2VzKHBhcmVudFZlcnRpY2VzLCByb3RhdGlvblF1YXRlcm5pb24pO1xuXG4gIGNvbnN0IGZpcnN0VmVydGV4ID0gZmlyc3QodmVydGljZXMpLFxuICAgICAgICBzZWNvbmRWZXJ0ZXggPSBzZWNvbmQodmVydGljZXMpLFxuICAgICAgICB0aGlyZFZlcnRleCA9IHRoaXJkKHZlcnRpY2VzKSxcbiAgICAgICAgZmlyc3RQYXJlbnRWZXJ0ZXggPSBmaXJzdChwYXJlbnRWZXJ0aWNlcyksXG4gICAgICAgIHNlY29uZFBhcmVudFZlcnRleCA9IHNlY29uZChwYXJlbnRWZXJ0aWNlcyksXG4gICAgICAgIHRoaXJkUGFyZW50VmVydGV4ID0gdGhpcmQocGFyZW50VmVydGljZXMpLFxuICAgICAgICBmaXJzdFRleHR1cmVDb29yZGluYXRlID0gZmlyc3QodGV4dHVyZUNvb3JkaW5hdGVzKSxcbiAgICAgICAgc2Vjb25kVGV4dHVyZUNvb3JkaW5hdGUgPSBzZWNvbmQodGV4dHVyZUNvb3JkaW5hdGVzKSxcbiAgICAgICAgdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZSA9IHRoaXJkKHRleHR1cmVDb29yZGluYXRlcyksXG4gICAgICAgIGZpcnN0VmVydGV4UG9zaXRpb24gPSBmaXJzdFZlcnRleC5nZXRQb3NpdGlvbigpLFxuICAgICAgICBzZWNvbmRWZXJ0ZXhQb3NpdGlvbiA9IHNlY29uZFZlcnRleC5nZXRQb3NpdGlvbigpLFxuICAgICAgICB0aGlyZFZlcnRleFBvc2l0aW9uID0gdGhpcmRWZXJ0ZXguZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgZmlyc3RQYXJlbnRWZXJ0ZXhQb3NpdGlvbiA9IGZpcnN0UGFyZW50VmVydGV4LmdldFBvc2l0aW9uKCksXG4gICAgICAgIHNlY29uZFBhcmVudFZlcnRleFBvc2l0aW9uID0gc2Vjb25kUGFyZW50VmVydGV4LmdldFBvc2l0aW9uKCksXG4gICAgICAgIHRoaXJkUGFyZW50VmVydGV4UG9zaXRpb24gPSB0aGlyZFBhcmVudFZlcnRleC5nZXRQb3NpdGlvbigpLFxuICAgICAgICBSMXggPSBmaXJzdFZlcnRleFBvc2l0aW9uWzBdLCAgLy8vXG4gICAgICAgIFIxeSA9IGZpcnN0VmVydGV4UG9zaXRpb25bMV0sICAvLy9cbiAgICAgICAgUjJ4ID0gc2Vjb25kVmVydGV4UG9zaXRpb25bMF0sIC8vL1xuICAgICAgICBSMnkgPSBzZWNvbmRWZXJ0ZXhQb3NpdGlvblsxXSwgLy8vXG4gICAgICAgIFIzeCA9IHRoaXJkVmVydGV4UG9zaXRpb25bMF0sICAvLy9cbiAgICAgICAgUjN5ID0gdGhpcmRWZXJ0ZXhQb3NpdGlvblsxXSwgIC8vL1xuICAgICAgICBQMXggPSBmaXJzdFBhcmVudFZlcnRleFBvc2l0aW9uWzBdLCAvLy9cbiAgICAgICAgUDJ4ID0gc2Vjb25kUGFyZW50VmVydGV4UG9zaXRpb25bMF0sIC8vL1xuICAgICAgICBQM3ggPSB0aGlyZFBhcmVudFZlcnRleFBvc2l0aW9uWzBdLCAvLy9cbiAgICAgICAgUDF5ID0gZmlyc3RQYXJlbnRWZXJ0ZXhQb3NpdGlvblsxXSwgLy8vXG4gICAgICAgIFAyeSA9IHNlY29uZFBhcmVudFZlcnRleFBvc2l0aW9uWzFdLCAvLy9cbiAgICAgICAgUDN5ID0gdGhpcmRQYXJlbnRWZXJ0ZXhQb3NpdGlvblsxXSwgLy8vXG4gICAgICAgIFAxdSA9IGZpcnN0VGV4dHVyZUNvb3JkaW5hdGVbMF0sIC8vL1xuICAgICAgICBQMXYgPSBmaXJzdFRleHR1cmVDb29yZGluYXRlWzFdLCAvLy9cbiAgICAgICAgUDJ1ID0gc2Vjb25kVGV4dHVyZUNvb3JkaW5hdGVbMF0sIC8vL1xuICAgICAgICBQMnYgPSBzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZVsxXSwgLy8vXG4gICAgICAgIFAzdSA9IHRoaXJkVGV4dHVyZUNvb3JkaW5hdGVbMF0sIC8vL1xuICAgICAgICBQM3YgPSB0aGlyZFRleHR1cmVDb29yZGluYXRlWzFdLCAvLy9cbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4ID0gaW52ZXJ0MyhbIDEsIDEsIDEsIFAxdSwgUDJ1LCBQM3UsIFAxdiwgUDJ2LCBQM3YgXSksXG4gICAgICAgIGZpcnN0VHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudCA9IHRyYW5zZm9ybTMoWyBQMXgsIFAyeCwgUDN4IF0sIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCksXG4gICAgICAgIHNlY29uZFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnQgPSB0cmFuc2Zvcm0zKFsgUDF5LCBQMnksIFAzeSBdLCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgpLFxuICAgICAgICBPeCA9IGZpcnN0VHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudFswXSwgIC8vL1xuICAgICAgICBVeCA9IGZpcnN0VHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudFsxXSwgIC8vL1xuICAgICAgICBWeCA9IGZpcnN0VHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudFsyXSwgIC8vL1xuICAgICAgICBPeSA9IHNlY29uZFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnRbMF0sICAvLy9cbiAgICAgICAgVXkgPSBzZWNvbmRUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50WzFdLCAgLy8vXG4gICAgICAgIFZ5ID0gc2Vjb25kVHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudFsyXSwgIC8vL1xuICAgICAgICB0cmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzTWF0cml4ID0gaW52ZXJ0MihbIFV4LCBVeSwgVngsIFZ5IF0pLFxuICAgICAgICBmaXJzdEFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzQ29tcG9uZW50ID0gdHJhbnNmb3JtMihbIFIxeCAtIE94LCBSMXkgLSBPeSBdLCB0cmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzTWF0cml4KSxcbiAgICAgICAgc2Vjb25kQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXNDb21wb25lbnQgPSB0cmFuc2Zvcm0yKFsgUjJ4IC0gT3gsIFIyeSAtIE95IF0sIHRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNNYXRyaXgpLFxuICAgICAgICB0aGlyZEFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzQ29tcG9uZW50ID0gdHJhbnNmb3JtMihbIFIzeCAtIE94LCBSM3kgLSBPeSBdLCB0cmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzTWF0cml4KSxcbiAgICAgICAgYWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXMgPSBbXG4gICAgICAgICAgZmlyc3RBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCxcbiAgICAgICAgICBzZWNvbmRBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCxcbiAgICAgICAgICB0aGlyZEFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzQ29tcG9uZW50LFxuICAgICAgICBdO1xuXG4gIHJldHVybiBhZGp1c3RlZFRleHR1cmVDb29yZGluYXRlcztcbn1cblxuZnVuY3Rpb24gdGV4dHVyZUNvb3JkaW5hdGVzRnJvbVRleHR1cmVDb29yZGluYXRlc0FuZEluZGV4KHRleHR1cmVDb29yZGluYXRlcywgaW5kZXgpIHsgIC8vL1xuICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQ29vcmRpbmF0ZXMuc2xpY2UoaW5kZXggKiAzLCBpbmRleCAqIDMgKyAzKTsgIC8vL1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXM7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBjbG9uZVRleHR1cmVDb29yZGluYXRlcyxcbiAgY2FsY3VsYXRlVmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzLFxuICBjYWxjdWxhdGVBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlcyxcbiAgdGV4dHVyZUNvb3JkaW5hdGVzRnJvbVRleHR1cmVDb29yZGluYXRlc0FuZEluZGV4XG59O1xuIl19