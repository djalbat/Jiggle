'use strict';

var matrixMaths = require('../maths/matrix'),
    vectorMaths = require('../maths/vector'),
    arrayUtilities = require('../utilities/array'),
    verticesUtilities = require('../utilities/vertices'),
    quaternionUtilities = require('../utilities/quaternion');

var invert2 = matrixMaths.invert2,
    invert3 = matrixMaths.invert3,
    rotateVertices = verticesUtilities.rotateVertices,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    add2 = vectorMaths.add2,
    multiply2 = vectorMaths.multiply2,
    transform2 = vectorMaths.transform2,
    transform3 = vectorMaths.transform3,
    calculateArbitraryRotationQuaternion = quaternionUtilities.calculateArbitraryRotationQuaternion;


function cloneTextureCoordinates(textureCoordinates) {
  textureCoordinates = textureCoordinates.map(function (textureCoordinates) {
    ///
    textureCoordinates = textureCoordinates.slice();

    return textureCoordinates;
  });

  return textureCoordinates;
}

function calculateVertexTextureCoordinates(textureCoordinates, left, bottom, width, height) {
  textureCoordinates = textureCoordinates.map(function (textureCoordinates) {
    ///
    textureCoordinates = add2(multiply2(textureCoordinates, [width, height]), [left, bottom]);

    return textureCoordinates;
  });

  return textureCoordinates;
}

function calculateAdjustedTextureCoordinates(vertices, normal, parentVertices, textureCoordinates) {
  var arbitraryRotationQuaternion = calculateArbitraryRotationQuaternion(normal),
      rotationQuaternion = arbitraryRotationQuaternion;

  vertices = rotateVertices(vertices, rotationQuaternion);

  parentVertices = rotateVertices(parentVertices, rotationQuaternion);

  var firstVertex = first(vertices),
      secondVertex = second(vertices),
      thirdVertex = third(vertices),
      firstParentVertex = first(parentVertices),
      secondParentVertex = second(parentVertices),
      thirdParentVertex = third(parentVertices),
      firstTextureCoordinate = first(textureCoordinates),
      secondTextureCoordinate = second(textureCoordinates),
      thirdTextureCoordinate = third(textureCoordinates),
      firstVertexPosition = firstVertex.getPosition(),
      secondVertexPosition = secondVertex.getPosition(),
      thirdVertexPosition = thirdVertex.getPosition(),
      firstParentVertexPosition = firstParentVertex.getPosition(),
      secondParentVertexPosition = secondParentVertex.getPosition(),
      thirdParentVertexPosition = thirdParentVertex.getPosition(),
      R1x = firstVertexPosition[0],
      ///
  R1y = firstVertexPosition[1],
      ///
  R2x = secondVertexPosition[0],
      ///
  R2y = secondVertexPosition[1],
      ///
  R3x = thirdVertexPosition[0],
      ///
  R3y = thirdVertexPosition[1],
      ///
  P1x = firstParentVertexPosition[0],
      ///
  P2x = secondParentVertexPosition[0],
      ///
  P3x = thirdParentVertexPosition[0],
      ///
  P1y = firstParentVertexPosition[1],
      ///
  P2y = secondParentVertexPosition[1],
      ///
  P3y = thirdParentVertexPosition[1],
      ///
  P1u = firstTextureCoordinate[0],
      ///
  P1v = firstTextureCoordinate[1],
      ///
  P2u = secondTextureCoordinate[0],
      ///
  P2v = secondTextureCoordinate[1],
      ///
  P3u = thirdTextureCoordinate[0],
      ///
  P3v = thirdTextureCoordinate[1],
      ///
  textureCoordinatesMatrix = invert3([1, 1, 1, P1u, P2u, P3u, P1v, P2v, P3v]),
      firstTransformedParentVerticesComponent = transform3([P1x, P2x, P3x], textureCoordinatesMatrix),
      secondTransformedParentVerticesComponent = transform3([P1y, P2y, P3y], textureCoordinatesMatrix),
      Ox = firstTransformedParentVerticesComponent[0],
      ///
  Ux = firstTransformedParentVerticesComponent[1],
      ///
  Vx = firstTransformedParentVerticesComponent[2],
      ///
  Oy = secondTransformedParentVerticesComponent[0],
      ///
  Uy = secondTransformedParentVerticesComponent[1],
      ///
  Vy = secondTransformedParentVerticesComponent[2],
      ///
  transformedParentVerticesMatrix = invert2([Ux, Uy, Vx, Vy]),
      firstAdjustedTextureCoordinatesComponent = transform2([R1x - Ox, R1y - Oy], transformedParentVerticesMatrix),
      secondAdjustedTextureCoordinatesComponent = transform2([R2x - Ox, R2y - Oy], transformedParentVerticesMatrix),
      thirdAdjustedTextureCoordinatesComponent = transform2([R3x - Ox, R3y - Oy], transformedParentVerticesMatrix),
      adjustedTextureCoordinates = [firstAdjustedTextureCoordinatesComponent, secondAdjustedTextureCoordinatesComponent, thirdAdjustedTextureCoordinatesComponent];

  return adjustedTextureCoordinates;
}

module.exports = {
  cloneTextureCoordinates: cloneTextureCoordinates,
  calculateVertexTextureCoordinates: calculateVertexTextureCoordinates,
  calculateAdjustedTextureCoordinates: calculateAdjustedTextureCoordinates
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvdGV4dHVyZS5qcyJdLCJuYW1lcyI6WyJtYXRyaXhNYXRocyIsInJlcXVpcmUiLCJ2ZWN0b3JNYXRocyIsImFycmF5VXRpbGl0aWVzIiwidmVydGljZXNVdGlsaXRpZXMiLCJxdWF0ZXJuaW9uVXRpbGl0aWVzIiwiaW52ZXJ0MiIsImludmVydDMiLCJyb3RhdGVWZXJ0aWNlcyIsImZpcnN0Iiwic2Vjb25kIiwidGhpcmQiLCJhZGQyIiwibXVsdGlwbHkyIiwidHJhbnNmb3JtMiIsInRyYW5zZm9ybTMiLCJjYWxjdWxhdGVBcmJpdHJhcnlSb3RhdGlvblF1YXRlcm5pb24iLCJjbG9uZVRleHR1cmVDb29yZGluYXRlcyIsInRleHR1cmVDb29yZGluYXRlcyIsIm1hcCIsInNsaWNlIiwiY2FsY3VsYXRlVmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzIiwibGVmdCIsImJvdHRvbSIsIndpZHRoIiwiaGVpZ2h0IiwiY2FsY3VsYXRlQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXMiLCJ2ZXJ0aWNlcyIsIm5vcm1hbCIsInBhcmVudFZlcnRpY2VzIiwiYXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uIiwicm90YXRpb25RdWF0ZXJuaW9uIiwiZmlyc3RWZXJ0ZXgiLCJzZWNvbmRWZXJ0ZXgiLCJ0aGlyZFZlcnRleCIsImZpcnN0UGFyZW50VmVydGV4Iiwic2Vjb25kUGFyZW50VmVydGV4IiwidGhpcmRQYXJlbnRWZXJ0ZXgiLCJmaXJzdFRleHR1cmVDb29yZGluYXRlIiwic2Vjb25kVGV4dHVyZUNvb3JkaW5hdGUiLCJ0aGlyZFRleHR1cmVDb29yZGluYXRlIiwiZmlyc3RWZXJ0ZXhQb3NpdGlvbiIsImdldFBvc2l0aW9uIiwic2Vjb25kVmVydGV4UG9zaXRpb24iLCJ0aGlyZFZlcnRleFBvc2l0aW9uIiwiZmlyc3RQYXJlbnRWZXJ0ZXhQb3NpdGlvbiIsInNlY29uZFBhcmVudFZlcnRleFBvc2l0aW9uIiwidGhpcmRQYXJlbnRWZXJ0ZXhQb3NpdGlvbiIsIlIxeCIsIlIxeSIsIlIyeCIsIlIyeSIsIlIzeCIsIlIzeSIsIlAxeCIsIlAyeCIsIlAzeCIsIlAxeSIsIlAyeSIsIlAzeSIsIlAxdSIsIlAxdiIsIlAydSIsIlAydiIsIlAzdSIsIlAzdiIsInRleHR1cmVDb29yZGluYXRlc01hdHJpeCIsImZpcnN0VHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudCIsInNlY29uZFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnQiLCJPeCIsIlV4IiwiVngiLCJPeSIsIlV5IiwiVnkiLCJ0cmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzTWF0cml4IiwiZmlyc3RBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCIsInNlY29uZEFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzQ29tcG9uZW50IiwidGhpcmRBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCIsImFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsY0FBY0MsUUFBUSxpQkFBUixDQUFwQjtBQUFBLElBQ01DLGNBQWNELFFBQVEsaUJBQVIsQ0FEcEI7QUFBQSxJQUVNRSxpQkFBaUJGLFFBQVEsb0JBQVIsQ0FGdkI7QUFBQSxJQUdNRyxvQkFBb0JILFFBQVEsdUJBQVIsQ0FIMUI7QUFBQSxJQUlNSSxzQkFBc0JKLFFBQVEseUJBQVIsQ0FKNUI7O0lBTVFLLE8sR0FBcUJOLFcsQ0FBckJNLE87SUFBU0MsTyxHQUFZUCxXLENBQVpPLE87SUFDVEMsYyxHQUFtQkosaUIsQ0FBbkJJLGM7SUFDQUMsSyxHQUF5Qk4sYyxDQUF6Qk0sSztJQUFPQyxNLEdBQWtCUCxjLENBQWxCTyxNO0lBQVFDLEssR0FBVVIsYyxDQUFWUSxLO0lBQ2ZDLEksR0FBNENWLFcsQ0FBNUNVLEk7SUFBTUMsUyxHQUFzQ1gsVyxDQUF0Q1csUztJQUFXQyxVLEdBQTJCWixXLENBQTNCWSxV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TUF3Q3lEO0FBQ25ETSxPQUFLTix5Q0FBeUMsQ0FBekMsQ0F6Q1g7QUFBQSxNQXlDeUQ7QUFDbkRPLG9DQUFrQ3JFLFFBQVEsQ0FBRWdFLEVBQUYsRUFBTUcsRUFBTixFQUFVRixFQUFWLEVBQWNHLEVBQWQsQ0FBUixDQTFDeEM7QUFBQSxNQTJDTUUsMkNBQTJDOUQsV0FBVyxDQUFFa0MsTUFBTXFCLEVBQVIsRUFBWXBCLE1BQU11QixFQUFsQixDQUFYLEVBQW1DRywrQkFBbkMsQ0EzQ2pEO0FBQUEsTUE0Q01FLDRDQUE0Qy9ELFdBQVcsQ0FBRW9DLE1BQU1tQixFQUFSLEVBQVlsQixNQUFNcUIsRUFBbEIsQ0FBWCxFQUFtQ0csK0JBQW5DLENBNUNsRDtBQUFBLE1BNkNNRywyQ0FBMkNoRSxXQUFXLENBQUVzQyxNQUFNaUIsRUFBUixFQUFZaEIsTUFBTW1CLEVBQWxCLENBQVgsRUFBbUNHLCtCQUFuQyxDQTdDakQ7QUFBQSxNQThDTUksNkJBQTZCLENBQzNCSCx3Q0FEMkIsRUFFM0JDLHlDQUYyQixFQUczQkMsd0NBSDJCLENBOUNuQzs7QUFvREEsU0FBT0MsMEJBQVA7QUFDRDs7QUFFREMsT0FBT0MsT0FBUCxHQUFpQjtBQUNmaEUsa0RBRGU7QUFFZkksc0VBRmU7QUFHZks7QUFIZSxDQUFqQiIsImZpbGUiOiJ0ZXh0dXJlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBtYXRyaXhNYXRocyA9IHJlcXVpcmUoJy4uL21hdGhzL21hdHJpeCcpLFxuICAgICAgdmVjdG9yTWF0aHMgPSByZXF1aXJlKCcuLi9tYXRocy92ZWN0b3InKSxcbiAgICAgIGFycmF5VXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2FycmF5JyksXG4gICAgICB2ZXJ0aWNlc1V0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy92ZXJ0aWNlcycpLFxuICAgICAgcXVhdGVybmlvblV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9xdWF0ZXJuaW9uJyk7XG5cbmNvbnN0IHsgaW52ZXJ0MiwgaW52ZXJ0MyB9ID0gbWF0cml4TWF0aHMsXG4gICAgICB7IHJvdGF0ZVZlcnRpY2VzIH0gPSB2ZXJ0aWNlc1V0aWxpdGllcyxcbiAgICAgIHsgZmlyc3QsIHNlY29uZCwgdGhpcmQgfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBhZGQyLCBtdWx0aXBseTIsIHRyYW5zZm9ybTIsIHRyYW5zZm9ybTMgfSA9IHZlY3Rvck1hdGhzLFxuICAgICAgeyBjYWxjdWxhdGVBcmJpdHJhcnlSb3RhdGlvblF1YXRlcm5pb24gfSA9IHF1YXRlcm5pb25VdGlsaXRpZXM7XG5cbmZ1bmN0aW9uIGNsb25lVGV4dHVyZUNvb3JkaW5hdGVzKHRleHR1cmVDb29yZGluYXRlcykge1xuICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQ29vcmRpbmF0ZXMubWFwKCh0ZXh0dXJlQ29vcmRpbmF0ZXMpID0+IHsgIC8vL1xuICAgIHRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlcy5zbGljZSgpO1xuXG4gICAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlcztcbiAgfSk7XG5cbiAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlcztcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzKHRleHR1cmVDb29yZGluYXRlcywgbGVmdCwgYm90dG9tLCB3aWR0aCwgaGVpZ2h0KSB7XG4gIHRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlcy5tYXAoKHRleHR1cmVDb29yZGluYXRlcykgPT4geyAgLy8vXG4gICAgdGV4dHVyZUNvb3JkaW5hdGVzID0gYWRkMihtdWx0aXBseTIodGV4dHVyZUNvb3JkaW5hdGVzLCBbIHdpZHRoLCBoZWlnaHQgXSApLCBbIGxlZnQsIGJvdHRvbSBdKTtcblxuICAgIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXM7XG4gIH0pO1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXM7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzKHZlcnRpY2VzLCBub3JtYWwsIHBhcmVudFZlcnRpY2VzLCB0ZXh0dXJlQ29vcmRpbmF0ZXMpIHtcbiAgY29uc3QgYXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uID0gY2FsY3VsYXRlQXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uKG5vcm1hbCksXG4gICAgICAgIHJvdGF0aW9uUXVhdGVybmlvbiA9IGFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbjtcblxuICB2ZXJ0aWNlcyA9IHJvdGF0ZVZlcnRpY2VzKHZlcnRpY2VzLCByb3RhdGlvblF1YXRlcm5pb24pO1xuXG4gIHBhcmVudFZlcnRpY2VzID0gcm90YXRlVmVydGljZXMocGFyZW50VmVydGljZXMsIHJvdGF0aW9uUXVhdGVybmlvbik7XG5cbiAgY29uc3QgZmlyc3RWZXJ0ZXggPSBmaXJzdCh2ZXJ0aWNlcyksXG4gICAgICAgIHNlY29uZFZlcnRleCA9IHNlY29uZCh2ZXJ0aWNlcyksXG4gICAgICAgIHRoaXJkVmVydGV4ID0gdGhpcmQodmVydGljZXMpLFxuICAgICAgICBmaXJzdFBhcmVudFZlcnRleCA9IGZpcnN0KHBhcmVudFZlcnRpY2VzKSxcbiAgICAgICAgc2Vjb25kUGFyZW50VmVydGV4ID0gc2Vjb25kKHBhcmVudFZlcnRpY2VzKSxcbiAgICAgICAgdGhpcmRQYXJlbnRWZXJ0ZXggPSB0aGlyZChwYXJlbnRWZXJ0aWNlcyksXG4gICAgICAgIGZpcnN0VGV4dHVyZUNvb3JkaW5hdGUgPSBmaXJzdCh0ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICBzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZSA9IHNlY29uZCh0ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICB0aGlyZFRleHR1cmVDb29yZGluYXRlID0gdGhpcmQodGV4dHVyZUNvb3JkaW5hdGVzKSxcbiAgICAgICAgZmlyc3RWZXJ0ZXhQb3NpdGlvbiA9IGZpcnN0VmVydGV4LmdldFBvc2l0aW9uKCksXG4gICAgICAgIHNlY29uZFZlcnRleFBvc2l0aW9uID0gc2Vjb25kVmVydGV4LmdldFBvc2l0aW9uKCksXG4gICAgICAgIHRoaXJkVmVydGV4UG9zaXRpb24gPSB0aGlyZFZlcnRleC5nZXRQb3NpdGlvbigpLFxuICAgICAgICBmaXJzdFBhcmVudFZlcnRleFBvc2l0aW9uID0gZmlyc3RQYXJlbnRWZXJ0ZXguZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgc2Vjb25kUGFyZW50VmVydGV4UG9zaXRpb24gPSBzZWNvbmRQYXJlbnRWZXJ0ZXguZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgdGhpcmRQYXJlbnRWZXJ0ZXhQb3NpdGlvbiA9IHRoaXJkUGFyZW50VmVydGV4LmdldFBvc2l0aW9uKCksXG4gICAgICAgIFIxeCA9IGZpcnN0VmVydGV4UG9zaXRpb25bMF0sICAvLy9cbiAgICAgICAgUjF5ID0gZmlyc3RWZXJ0ZXhQb3NpdGlvblsxXSwgIC8vL1xuICAgICAgICBSMnggPSBzZWNvbmRWZXJ0ZXhQb3NpdGlvblswXSwgLy8vXG4gICAgICAgIFIyeSA9IHNlY29uZFZlcnRleFBvc2l0aW9uWzFdLCAvLy9cbiAgICAgICAgUjN4ID0gdGhpcmRWZXJ0ZXhQb3NpdGlvblswXSwgIC8vL1xuICAgICAgICBSM3kgPSB0aGlyZFZlcnRleFBvc2l0aW9uWzFdLCAgLy8vXG4gICAgICAgIFAxeCA9IGZpcnN0UGFyZW50VmVydGV4UG9zaXRpb25bMF0sIC8vL1xuICAgICAgICBQMnggPSBzZWNvbmRQYXJlbnRWZXJ0ZXhQb3NpdGlvblswXSwgLy8vXG4gICAgICAgIFAzeCA9IHRoaXJkUGFyZW50VmVydGV4UG9zaXRpb25bMF0sIC8vL1xuICAgICAgICBQMXkgPSBmaXJzdFBhcmVudFZlcnRleFBvc2l0aW9uWzFdLCAvLy9cbiAgICAgICAgUDJ5ID0gc2Vjb25kUGFyZW50VmVydGV4UG9zaXRpb25bMV0sIC8vL1xuICAgICAgICBQM3kgPSB0aGlyZFBhcmVudFZlcnRleFBvc2l0aW9uWzFdLCAvLy9cbiAgICAgICAgUDF1ID0gZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZVswXSwgLy8vXG4gICAgICAgIFAxdiA9IGZpcnN0VGV4dHVyZUNvb3JkaW5hdGVbMV0sIC8vL1xuICAgICAgICBQMnUgPSBzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZVswXSwgLy8vXG4gICAgICAgIFAydiA9IHNlY29uZFRleHR1cmVDb29yZGluYXRlWzFdLCAvLy9cbiAgICAgICAgUDN1ID0gdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZVswXSwgLy8vXG4gICAgICAgIFAzdiA9IHRoaXJkVGV4dHVyZUNvb3JkaW5hdGVbMV0sIC8vL1xuICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXggPSBpbnZlcnQzKFsgMSwgMSwgMSwgUDF1LCBQMnUsIFAzdSwgUDF2LCBQMnYsIFAzdiBdKSxcbiAgICAgICAgZmlyc3RUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50ID0gdHJhbnNmb3JtMyhbIFAxeCwgUDJ4LCBQM3ggXSwgdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4KSxcbiAgICAgICAgc2Vjb25kVHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudCA9IHRyYW5zZm9ybTMoWyBQMXksIFAyeSwgUDN5IF0sIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCksXG4gICAgICAgIE94ID0gZmlyc3RUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50WzBdLCAgLy8vXG4gICAgICAgIFV4ID0gZmlyc3RUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50WzFdLCAgLy8vXG4gICAgICAgIFZ4ID0gZmlyc3RUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50WzJdLCAgLy8vXG4gICAgICAgIE95ID0gc2Vjb25kVHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudFswXSwgIC8vL1xuICAgICAgICBVeSA9IHNlY29uZFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnRbMV0sICAvLy9cbiAgICAgICAgVnkgPSBzZWNvbmRUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50WzJdLCAgLy8vXG4gICAgICAgIHRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNNYXRyaXggPSBpbnZlcnQyKFsgVXgsIFV5LCBWeCwgVnkgXSksXG4gICAgICAgIGZpcnN0QWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXNDb21wb25lbnQgPSB0cmFuc2Zvcm0yKFsgUjF4IC0gT3gsIFIxeSAtIE95IF0sIHRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNNYXRyaXgpLFxuICAgICAgICBzZWNvbmRBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCA9IHRyYW5zZm9ybTIoWyBSMnggLSBPeCwgUjJ5IC0gT3kgXSwgdHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc01hdHJpeCksXG4gICAgICAgIHRoaXJkQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXNDb21wb25lbnQgPSB0cmFuc2Zvcm0yKFsgUjN4IC0gT3gsIFIzeSAtIE95IF0sIHRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNNYXRyaXgpLFxuICAgICAgICBhZGp1c3RlZFRleHR1cmVDb29yZGluYXRlcyA9IFtcbiAgICAgICAgICBmaXJzdEFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzQ29tcG9uZW50LFxuICAgICAgICAgIHNlY29uZEFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzQ29tcG9uZW50LFxuICAgICAgICAgIHRoaXJkQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXNDb21wb25lbnQsXG4gICAgICAgIF07XG5cbiAgcmV0dXJuIGFkanVzdGVkVGV4dHVyZUNvb3JkaW5hdGVzO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgY2xvbmVUZXh0dXJlQ29vcmRpbmF0ZXMsXG4gIGNhbGN1bGF0ZVZlcnRleFRleHR1cmVDb29yZGluYXRlcyxcbiAgY2FsY3VsYXRlQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXNcbn07XG4iXX0=