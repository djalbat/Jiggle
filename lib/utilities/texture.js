'use strict';

var matrixMaths = require('../maths/matrix'),
    vectorMaths = require('../maths/vector'),
    arrayUtilities = require('../utilities/array'),
    verticesUtilities = require('../utilities/vertices'),
    quaternionUtilities = require('../utilities/quaternion');

var rotateVertices = verticesUtilities.rotateVertices,
    invert2 = matrixMaths.invert2,
    invert3 = matrixMaths.invert3,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    calculateArbitraryRotationQuaternion = quaternionUtilities.calculateArbitraryRotationQuaternion,
    add2 = vectorMaths.add2,
    multiply2 = vectorMaths.multiply2,
    transform2 = vectorMaths.transform2,
    transform3 = vectorMaths.transform3;


function cloneTextureCoordinatesTuple(textureCoordinatesTuple) {
  textureCoordinatesTuple = textureCoordinatesTuple.map(function (textureCoordinates) {
    return textureCoordinates.slice();
  }); ///

  return textureCoordinatesTuple;
}

function calculateVertexTextureCoordinatesTuple(textureCoordinatesTuple, left, bottom, width, height) {
  var vertexTextureCoordinatesTuple = textureCoordinatesTuple.map(function (textureCoordinates) {
    return add2(multiply2(textureCoordinates, [width, height]), [left, bottom]);
  }); ///

  return vertexTextureCoordinatesTuple;
}

function calculateAdjustedTextureCoordinatesTuple(vertices, normal, parentVertices, textureCoordinatesTuple) {
  var arbitraryRotationQuaternion = calculateArbitraryRotationQuaternion(normal),
      rotationQuaternion = arbitraryRotationQuaternion; ///

  var tempVertices = rotateVertices(vertices, rotationQuaternion);

  parentVertices = rotateVertices(parentVertices, rotationQuaternion);

  vertices = tempVertices; ///

  var firstVertex = first(vertices),
      secondVertex = second(vertices),
      thirdVertex = third(vertices),
      firstParentVertex = first(parentVertices),
      secondParentVertex = second(parentVertices),
      thirdParentVertex = third(parentVertices),
      firstTextureCoordinates = first(textureCoordinatesTuple),
      secondTextureCoordinates = second(textureCoordinatesTuple),
      thirdTextureCoordinates = third(textureCoordinatesTuple),
      firstVertexPosition = firstVertex.getPosition(),
      secondVertexPosition = secondVertex.getPosition(),
      thirdVertexPosition = thirdVertex.getPosition(),
      firstParentVertexPosition = firstParentVertex.getPosition(),
      secondParentVertexPosition = secondParentVertex.getPosition(),
      thirdParentVertexPosition = thirdParentVertex.getPosition(),
      R1x = firstVertexPosition[0],
      ///
  R1y = firstVertexPosition[1],
      ///
  R2x = secondVertexPosition[0],
      ///
  R2y = secondVertexPosition[1],
      ///
  R3x = thirdVertexPosition[0],
      ///
  R3y = thirdVertexPosition[1],
      ///
  P1x = firstParentVertexPosition[0],
      ///
  P2x = secondParentVertexPosition[0],
      ///
  P3x = thirdParentVertexPosition[0],
      ///
  P1y = firstParentVertexPosition[1],
      ///
  P2y = secondParentVertexPosition[1],
      ///
  P3y = thirdParentVertexPosition[1],
      ///
  P1u = firstTextureCoordinates[0],
      ///
  P1v = firstTextureCoordinates[1],
      ///
  P2u = secondTextureCoordinates[0],
      ///
  P2v = secondTextureCoordinates[1],
      ///
  P3u = thirdTextureCoordinates[0],
      ///
  P3v = thirdTextureCoordinates[1],
      ///
  textureCoordinatesMatrix = invert3([1, 1, 1, P1u, P2u, P3u, P1v, P2v, P3v]),
      firstTransformedParentVerticesComponent = transform3([P1x, P2x, P3x], textureCoordinatesMatrix),
      secondTransformedParentVerticesComponent = transform3([P1y, P2y, P3y], textureCoordinatesMatrix),
      Ox = firstTransformedParentVerticesComponent[0],
      ///
  Ux = firstTransformedParentVerticesComponent[1],
      ///
  Vx = firstTransformedParentVerticesComponent[2],
      ///
  Oy = secondTransformedParentVerticesComponent[0],
      ///
  Uy = secondTransformedParentVerticesComponent[1],
      ///
  Vy = secondTransformedParentVerticesComponent[2],
      ///
  transformedParentVerticesMatrix = invert2([Ux, Uy, Vx, Vy]),
      firstAdjustedTextureCoordinatesComponent = transform2([R1x - Ox, R1y - Oy], transformedParentVerticesMatrix),
      secondAdjustedTextureCoordinatesComponent = transform2([R2x - Ox, R2y - Oy], transformedParentVerticesMatrix),
      thirdAdjustedTextureCoordinatesComponent = transform2([R3x - Ox, R3y - Oy], transformedParentVerticesMatrix),
      adjustedTextureCoordinatesTuple = [firstAdjustedTextureCoordinatesComponent, secondAdjustedTextureCoordinatesComponent, thirdAdjustedTextureCoordinatesComponent];

  return adjustedTextureCoordinatesTuple;
}

module.exports = {
  cloneTextureCoordinatesTuple: cloneTextureCoordinatesTuple,
  calculateVertexTextureCoordinatesTuple: calculateVertexTextureCoordinatesTuple,
  calculateAdjustedTextureCoordinatesTuple: calculateAdjustedTextureCoordinatesTuple
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvdGV4dHVyZS5qcyJdLCJuYW1lcyI6WyJtYXRyaXhNYXRocyIsInJlcXVpcmUiLCJ2ZWN0b3JNYXRocyIsImFycmF5VXRpbGl0aWVzIiwidmVydGljZXNVdGlsaXRpZXMiLCJxdWF0ZXJuaW9uVXRpbGl0aWVzIiwicm90YXRlVmVydGljZXMiLCJpbnZlcnQyIiwiaW52ZXJ0MyIsImZpcnN0Iiwic2Vjb25kIiwidGhpcmQiLCJjYWxjdWxhdGVBcmJpdHJhcnlSb3RhdGlvblF1YXRlcm5pb24iLCJhZGQyIiwibXVsdGlwbHkyIiwidHJhbnNmb3JtMiIsInRyYW5zZm9ybTMiLCJjbG9uZVRleHR1cmVDb29yZGluYXRlc1R1cGxlIiwidGV4dHVyZUNvb3JkaW5hdGVzVHVwbGUiLCJtYXAiLCJ0ZXh0dXJlQ29vcmRpbmF0ZXMiLCJzbGljZSIsImNhbGN1bGF0ZVZlcnRleFRleHR1cmVDb29yZGluYXRlc1R1cGxlIiwibGVmdCIsImJvdHRvbSIsIndpZHRoIiwiaGVpZ2h0IiwidmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzVHVwbGUiLCJjYWxjdWxhdGVBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc1R1cGxlIiwidmVydGljZXMiLCJub3JtYWwiLCJwYXJlbnRWZXJ0aWNlcyIsImFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbiIsInJvdGF0aW9uUXVhdGVybmlvbiIsInRlbXBWZXJ0aWNlcyIsImZpcnN0VmVydGV4Iiwic2Vjb25kVmVydGV4IiwidGhpcmRWZXJ0ZXgiLCJmaXJzdFBhcmVudFZlcnRleCIsInNlY29uZFBhcmVudFZlcnRleCIsInRoaXJkUGFyZW50VmVydGV4IiwiZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZXMiLCJzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZXMiLCJ0aGlyZFRleHR1cmVDb29yZGluYXRlcyIsImZpcnN0VmVydGV4UG9zaXRpb24iLCJnZXRQb3NpdGlvbiIsInNlY29uZFZlcnRleFBvc2l0aW9uIiwidGhpcmRWZXJ0ZXhQb3NpdGlvbiIsImZpcnN0UGFyZW50VmVydGV4UG9zaXRpb24iLCJzZWNvbmRQYXJlbnRWZXJ0ZXhQb3NpdGlvbiIsInRoaXJkUGFyZW50VmVydGV4UG9zaXRpb24iLCJSMXgiLCJSMXkiLCJSMngiLCJSMnkiLCJSM3giLCJSM3kiLCJQMXgiLCJQMngiLCJQM3giLCJQMXkiLCJQMnkiLCJQM3kiLCJQMXUiLCJQMXYiLCJQMnUiLCJQMnYiLCJQM3UiLCJQM3YiLCJ0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgiLCJmaXJzdFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnQiLCJzZWNvbmRUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50IiwiT3giLCJVeCIsIlZ4IiwiT3kiLCJVeSIsIlZ5IiwidHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc01hdHJpeCIsImZpcnN0QWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXNDb21wb25lbnQiLCJzZWNvbmRBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCIsInRoaXJkQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXNDb21wb25lbnQiLCJhZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc1R1cGxlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsY0FBY0MsUUFBUSxpQkFBUixDQUFwQjtBQUFBLElBQ01DLGNBQWNELFFBQVEsaUJBQVIsQ0FEcEI7QUFBQSxJQUVNRSxpQkFBaUJGLFFBQVEsb0JBQVIsQ0FGdkI7QUFBQSxJQUdNRyxvQkFBb0JILFFBQVEsdUJBQVIsQ0FIMUI7QUFBQSxJQUlNSSxzQkFBc0JKLFFBQVEseUJBQVIsQ0FKNUI7O0FBTU0sSUFBRUssY0FBRixHQUFxQkYsaUJBQXJCLENBQUVFLGNBQUY7QUFBQSxJQUNFQyxPQURGLEdBQ3VCUCxXQUR2QixDQUNFTyxPQURGO0FBQUEsSUFDV0MsT0FEWCxHQUN1QlIsV0FEdkIsQ0FDV1EsT0FEWDtBQUFBLElBRUVDLEtB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blxuY29uc3QgbWF0cml4TWF0aHMgPSByZXF1aXJlKCcuLi9tYXRocy9tYXRyaXgnKSxcbiAgICAgIHZlY3Rvck1hdGhzID0gcmVxdWlyZSgnLi4vbWF0aHMvdmVjdG9yJyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgdmVydGljZXNVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvdmVydGljZXMnKSxcbiAgICAgIHF1YXRlcm5pb25VdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvcXVhdGVybmlvbicpO1xuXG5jb25zdCB7IHJvdGF0ZVZlcnRpY2VzIH0gPSB2ZXJ0aWNlc1V0aWxpdGllcyxcbiAgICAgIHsgaW52ZXJ0MiwgaW52ZXJ0MyB9ID0gbWF0cml4TWF0aHMsXG4gICAgICB7IGZpcnN0LCBzZWNvbmQsIHRoaXJkIH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgY2FsY3VsYXRlQXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uIH0gPSBxdWF0ZXJuaW9uVXRpbGl0aWVzLFxuICAgICAgeyBhZGQyLCBtdWx0aXBseTIsIHRyYW5zZm9ybTIsIHRyYW5zZm9ybTMgfSA9IHZlY3Rvck1hdGhzO1xuXG5mdW5jdGlvbiBjbG9uZVRleHR1cmVDb29yZGluYXRlc1R1cGxlKHRleHR1cmVDb29yZGluYXRlc1R1cGxlKSB7XG4gIHRleHR1cmVDb29yZGluYXRlc1R1cGxlID0gdGV4dHVyZUNvb3JkaW5hdGVzVHVwbGUubWFwKCh0ZXh0dXJlQ29vcmRpbmF0ZXMpID0+IHRleHR1cmVDb29yZGluYXRlcy5zbGljZSgpKTsgIC8vL1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXNUdXBsZTtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzVHVwbGUodGV4dHVyZUNvb3JkaW5hdGVzVHVwbGUsIGxlZnQsIGJvdHRvbSwgd2lkdGgsIGhlaWdodCkge1xuICBjb25zdCB2ZXJ0ZXhUZXh0dXJlQ29vcmRpbmF0ZXNUdXBsZSA9IHRleHR1cmVDb29yZGluYXRlc1R1cGxlLm1hcCgodGV4dHVyZUNvb3JkaW5hdGVzKSA9PiBhZGQyKG11bHRpcGx5Mih0ZXh0dXJlQ29vcmRpbmF0ZXMsIFsgd2lkdGgsIGhlaWdodCBdICksIFsgbGVmdCwgYm90dG9tIF0pKTsgLy8vXG5cbiAgcmV0dXJuIHZlcnRleFRleHR1cmVDb29yZGluYXRlc1R1cGxlO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc1R1cGxlKHZlcnRpY2VzLCBub3JtYWwsIHBhcmVudFZlcnRpY2VzLCB0ZXh0dXJlQ29vcmRpbmF0ZXNUdXBsZSkge1xuICBjb25zdCBhcmJpdHJhcnlSb3RhdGlvblF1YXRlcm5pb24gPSBjYWxjdWxhdGVBcmJpdHJhcnlSb3RhdGlvblF1YXRlcm5pb24obm9ybWFsKSxcbiAgICAgICAgcm90YXRpb25RdWF0ZXJuaW9uID0gYXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uOyAvLy9cblxuICBjb25zdCB0ZW1wVmVydGljZXMgPSByb3RhdGVWZXJ0aWNlcyh2ZXJ0aWNlcywgcm90YXRpb25RdWF0ZXJuaW9uKTtcblxuICBwYXJlbnRWZXJ0aWNlcyA9IHJvdGF0ZVZlcnRpY2VzKHBhcmVudFZlcnRpY2VzLCByb3RhdGlvblF1YXRlcm5pb24pO1xuXG4gIHZlcnRpY2VzID0gdGVtcFZlcnRpY2VzOyAgLy8vXG5cbiAgY29uc3QgZmlyc3RWZXJ0ZXggPSBmaXJzdCh2ZXJ0aWNlcyksXG4gICAgICAgIHNlY29uZFZlcnRleCA9IHNlY29uZCh2ZXJ0aWNlcyksXG4gICAgICAgIHRoaXJkVmVydGV4ID0gdGhpcmQodmVydGljZXMpLFxuICAgICAgICBmaXJzdFBhcmVudFZlcnRleCA9IGZpcnN0KHBhcmVudFZlcnRpY2VzKSxcbiAgICAgICAgc2Vjb25kUGFyZW50VmVydGV4ID0gc2Vjb25kKHBhcmVudFZlcnRpY2VzKSxcbiAgICAgICAgdGhpcmRQYXJlbnRWZXJ0ZXggPSB0aGlyZChwYXJlbnRWZXJ0aWNlcyksXG4gICAgICAgIGZpcnN0VGV4dHVyZUNvb3JkaW5hdGVzID0gZmlyc3QodGV4dHVyZUNvb3JkaW5hdGVzVHVwbGUpLFxuICAgICAgICBzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZXMgPSBzZWNvbmQodGV4dHVyZUNvb3JkaW5hdGVzVHVwbGUpLFxuICAgICAgICB0aGlyZFRleHR1cmVDb29yZGluYXRlcyA9IHRoaXJkKHRleHR1cmVDb29yZGluYXRlc1R1cGxlKSxcbiAgICAgICAgZmlyc3RWZXJ0ZXhQb3NpdGlvbiA9IGZpcnN0VmVydGV4LmdldFBvc2l0aW9uKCksXG4gICAgICAgIHNlY29uZFZlcnRleFBvc2l0aW9uID0gc2Vjb25kVmVydGV4LmdldFBvc2l0aW9uKCksXG4gICAgICAgIHRoaXJkVmVydGV4UG9zaXRpb24gPSB0aGlyZFZlcnRleC5nZXRQb3NpdGlvbigpLFxuICAgICAgICBmaXJzdFBhcmVudFZlcnRleFBvc2l0aW9uID0gZmlyc3RQYXJlbnRWZXJ0ZXguZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgc2Vjb25kUGFyZW50VmVydGV4UG9zaXRpb24gPSBzZWNvbmRQYXJlbnRWZXJ0ZXguZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgdGhpcmRQYXJlbnRWZXJ0ZXhQb3NpdGlvbiA9IHRoaXJkUGFyZW50VmVydGV4LmdldFBvc2l0aW9uKCksXG4gICAgICAgIFIxeCA9IGZpcnN0VmVydGV4UG9zaXRpb25bMF0sICAvLy9cbiAgICAgICAgUjF5ID0gZmlyc3RWZXJ0ZXhQb3NpdGlvblsxXSwgIC8vL1xuICAgICAgICBSMnggPSBzZWNvbmRWZXJ0ZXhQb3NpdGlvblswXSwgLy8vXG4gICAgICAgIFIyeSA9IHNlY29uZFZlcnRleFBvc2l0aW9uWzFdLCAvLy9cbiAgICAgICAgUjN4ID0gdGhpcmRWZXJ0ZXhQb3NpdGlvblswXSwgIC8vL1xuICAgICAgICBSM3kgPSB0aGlyZFZlcnRleFBvc2l0aW9uWzFdLCAgLy8vXG4gICAgICAgIFAxeCA9IGZpcnN0UGFyZW50VmVydGV4UG9zaXRpb25bMF0sIC8vL1xuICAgICAgICBQMnggPSBzZWNvbmRQYXJlbnRWZXJ0ZXhQb3NpdGlvblswXSwgLy8vXG4gICAgICAgIFAzeCA9IHRoaXJkUGFyZW50VmVydGV4UG9zaXRpb25bMF0sIC8vL1xuICAgICAgICBQMXkgPSBmaXJzdFBhcmVudFZlcnRleFBvc2l0aW9uWzFdLCAvLy9cbiAgICAgICAgUDJ5ID0gc2Vjb25kUGFyZW50VmVydGV4UG9zaXRpb25bMV0sIC8vL1xuICAgICAgICBQM3kgPSB0aGlyZFBhcmVudFZlcnRleFBvc2l0aW9uWzFdLCAvLy9cbiAgICAgICAgUDF1ID0gZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZXNbMF0sIC8vL1xuICAgICAgICBQMXYgPSBmaXJzdFRleHR1cmVDb29yZGluYXRlc1sxXSwgLy8vXG4gICAgICAgIFAydSA9IHNlY29uZFRleHR1cmVDb29yZGluYXRlc1swXSwgLy8vXG4gICAgICAgIFAydiA9IHNlY29uZFRleHR1cmVDb29yZGluYXRlc1sxXSwgLy8vXG4gICAgICAgIFAzdSA9IHRoaXJkVGV4dHVyZUNvb3JkaW5hdGVzWzBdLCAvLy9cbiAgICAgICAgUDN2ID0gdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZXNbMV0sIC8vL1xuICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXggPSBpbnZlcnQzKFsgMSwgMSwgMSwgUDF1LCBQMnUsIFAzdSwgUDF2LCBQMnYsIFAzdiBdKSxcbiAgICAgICAgZmlyc3RUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50ID0gdHJhbnNmb3JtMyhbIFAxeCwgUDJ4LCBQM3ggXSwgdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4KSxcbiAgICAgICAgc2Vjb25kVHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudCA9IHRyYW5zZm9ybTMoWyBQMXksIFAyeSwgUDN5IF0sIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCksXG4gICAgICAgIE94ID0gZmlyc3RUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50WzBdLCAgLy8vXG4gICAgICAgIFV4ID0gZmlyc3RUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50WzFdLCAgLy8vXG4gICAgICAgIFZ4ID0gZmlyc3RUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50WzJdLCAgLy8vXG4gICAgICAgIE95ID0gc2Vjb25kVHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc0NvbXBvbmVudFswXSwgIC8vL1xuICAgICAgICBVeSA9IHNlY29uZFRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNDb21wb25lbnRbMV0sICAvLy9cbiAgICAgICAgVnkgPSBzZWNvbmRUcmFuc2Zvcm1lZFBhcmVudFZlcnRpY2VzQ29tcG9uZW50WzJdLCAgLy8vXG4gICAgICAgIHRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNNYXRyaXggPSBpbnZlcnQyKFsgVXgsIFV5LCBWeCwgVnkgXSksXG4gICAgICAgIGZpcnN0QWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXNDb21wb25lbnQgPSB0cmFuc2Zvcm0yKFsgUjF4IC0gT3gsIFIxeSAtIE95IF0sIHRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNNYXRyaXgpLFxuICAgICAgICBzZWNvbmRBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCA9IHRyYW5zZm9ybTIoWyBSMnggLSBPeCwgUjJ5IC0gT3kgXSwgdHJhbnNmb3JtZWRQYXJlbnRWZXJ0aWNlc01hdHJpeCksXG4gICAgICAgIHRoaXJkQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXNDb21wb25lbnQgPSB0cmFuc2Zvcm0yKFsgUjN4IC0gT3gsIFIzeSAtIE95IF0sIHRyYW5zZm9ybWVkUGFyZW50VmVydGljZXNNYXRyaXgpLFxuICAgICAgICBhZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc1R1cGxlID0gW1xuICAgICAgICAgIGZpcnN0QWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXNDb21wb25lbnQsXG4gICAgICAgICAgc2Vjb25kQWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXNDb21wb25lbnQsXG4gICAgICAgICAgdGhpcmRBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc0NvbXBvbmVudCxcbiAgICAgICAgXTtcblxuICByZXR1cm4gYWRqdXN0ZWRUZXh0dXJlQ29vcmRpbmF0ZXNUdXBsZTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGNsb25lVGV4dHVyZUNvb3JkaW5hdGVzVHVwbGUsXG4gIGNhbGN1bGF0ZVZlcnRleFRleHR1cmVDb29yZGluYXRlc1R1cGxlLFxuICBjYWxjdWxhdGVBZGp1c3RlZFRleHR1cmVDb29yZGluYXRlc1R1cGxlXG59O1xuIl19