'use strict';

var vec3 = require('../maths/vec3'),
    vec4 = require('../maths/vec4'),
    arrayUtilities = require('../utilities/array');

var chop = arrayUtilities.chop,
    flatten = arrayUtilities.flatten,
    subtract = vec3.subtract,
    cross = vec3.cross,
    composeTransform = vec4.composeTransform;


function calculateVertexPositionData(initialVertexPositionData, width, height, depth, offset, rotation) {
  var transform = composeTransform(width, height, depth, offset, rotation);

  var vertexPositions = chop(initialVertexPositionData, 4); ///

  vertexPositions = vertexPositions.map(function (vertexPosition) {
    return transform(vertexPosition);
  });

  vertexPositions = vertexPositions.map(function (vertexPosition) {
    return vertexPosition.slice(0, 3); ///
  });

  var vertexPositionData = flatten(vertexPositions);

  return vertexPositionData;
}

function calculateVertexColourData(initialVertexPositionData, colour) {
  var initialVertexPositionDataLength = initialVertexPositionData.length,
      vertexColoursLength = initialVertexPositionDataLength / 4,
      ///
  vertexColour = colour,
      vertexColours = [];

  for (var index = 0; index < vertexColoursLength; index++) {
    vertexColours.push(vertexColour);
  }

  var vertexColourData = flatten(vertexColours); ///

  return vertexColourData;
}

function calculateVertexNormalData(initialVertexPositionData) {
  var vertexNormalVectors = [],
      faces = chop(initialVertexPositionData, 16); ///

  faces.forEach(function (face) {
    var vertexPositions = chop(face, 4);

    for (var index = 0; index < 4; index++) {
      var firstVertexIndex = index,
          secondVertexIndex = (index + 1) % 4,
          thirdVertexIndex = (index + 3) % 4,
          firstVertexPosition = vertexPositions[firstVertexIndex],
          secondVertexPosition = vertexPositions[secondVertexIndex],
          thirdVertexPosition = vertexPositions[thirdVertexIndex],
          firstVector = subtract(secondVertexPosition, firstVertexPosition),
          ///
      secondVector = subtract(thirdVertexPosition, firstVertexPosition),
          ///
      vertexNormalVector = cross(firstVector, secondVector);

      vertexNormalVectors.push(vertexNormalVector);
    }
  });

  var vertexNormalData = flatten(vertexNormalVectors); ///

  return vertexNormalData;
}

function calculateVertexIndexData(initialVertexPositionData) {
  var vertexIndexData = [],
      initialVertexPositionDataLength = initialVertexPositionData.length,
      facesLength = initialVertexPositionDataLength / 16; ///

  for (var index = 0; index < facesLength; index++) {
    var offset = index * 4;

    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 1);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 3);
  }

  return vertexIndexData;
}

module.exports = {
  calculateVertexPositionData: calculateVertexPositionData,
  calculateVertexColourData: calculateVertexColourData,
  calculateVertexNormalData: calculateVertexNormalData,
  calculateVertexIndexData: calculateVertexIndexData
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvdmVydGV4LmpzIl0sIm5hbWVzIjpbInZlYzMiLCJyZXF1aXJlIiwidmVjNCIsImFycmF5VXRpbGl0aWVzIiwiY2hvcCIsImZsYXR0ZW4iLCJzdWJ0cmFjdCIsImNyb3NzIiwiY29tcG9zZVRyYW5zZm9ybSIsImNhbGN1bGF0ZVZlcnRleFBvc2l0aW9uRGF0YSIsImluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEiLCJ3aWR0aCIsImhlaWdodCIsImRlcHRoIiwib2Zmc2V0Iiwicm90YXRpb24iLCJ0cmFuc2Zvcm0iLCJ2ZXJ0ZXhQb3NpdGlvbnMiLCJtYXAiLCJ2ZXJ0ZXhQb3NpdGlvbiIsInNsaWNlIiwidmVydGV4UG9zaXRpb25EYXRhIiwiY2FsY3VsYXRlVmVydGV4Q29sb3VyRGF0YSIsImNvbG91ciIsImluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGgiLCJsZW5ndGgiLCJ2ZXJ0ZXhDb2xvdXJzTGVuZ3RoIiwidmVydGV4Q29sb3VyIiwidmVydGV4Q29sb3VycyIsImluZGV4IiwicHVzaCIsInZlcnRleENvbG91ckRhdGEiLCJjYWxjdWxhdGVWZXJ0ZXhOb3JtYWxEYXRhIiwidmVydGV4Tm9ybWFsVmVjdG9ycyIsImZhY2VzIiwiZm9yRWFjaCIsImZhY2UiLCJmaXJzdFZlcnRleEluZGV4Iiwic2Vjb25kVmVydGV4SW5kZXgiLCJ0aGlyZFZlcnRleEluZGV4IiwiZmlyc3RWZXJ0ZXhQb3NpdGlvbiIsInNlY29uZFZlcnRleFBvc2l0aW9uIiwidGhpcmRWZXJ0ZXhQb3NpdGlvbiIsImZpcnN0VmVjdG9yIiwic2Vjb25kVmVjdG9yIiwidmVydGV4Tm9ybWFsVmVjdG9yIiwidmVydGV4Tm9ybWFsRGF0YSIsImNhbGN1bGF0ZVZlcnRleEluZGV4RGF0YSIsInZlcnRleEluZGV4RGF0YSIsImZhY2VzTGVuZ3RoIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsT0FBT0MsUUFB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VUFYLDBCQUFvQkgsSUFBcEIsQ0FBeUJlLGtCQUF6QjtBQUNEO0FBQ0YsR0FoQkQ7O0FBa0JBLE1BQU1DLG1CQUFtQnpDLFFBQVE0QixtQkFBUixDQUF6QixDQXRCNEQsQ0FzQkw7O0FBRXZELFNBQU9hLGdCQUFQO0FBQ0Q7O0FBRUQsU0FBU0Msd0JBQVQsQ0FBa0NyQyx5QkFBbEMsRUFBNkQ7QUFDM0QsTUFBTXNDLGtCQUFrQixFQUF4QjtBQUFBLE1BQ014QixrQ0FBa0NkLDBCQUEwQmUsTUFEbEU7QUFBQSxNQUVNd0IsY0FBY3pCLGtDQUFrQyxFQUZ0RCxDQUQyRCxDQUdEOztBQUUxRCxPQUFLLElBQUlLLFFBQVEsQ0FBakIsRUFBb0JBLFFBQVFvQixXQUE1QixFQUF5Q3BCLE9BQXpDLEVBQWtEO0FBQ2hELFFBQU1mLFNBQVNlLFFBQVEsQ0FBdkI7O0FBRUFtQixvQkFBZ0JsQixJQUFoQixDQUFxQmhCLFNBQVMsQ0FBOUI7QUFDQWtDLG9CQUFnQmxCLElBQWhCLENBQXFCaEIsU0FBUyxDQUE5QjtBQUNBa0Msb0JBQWdCbEIsSUFBaEIsQ0FBcUJoQixTQUFTLENBQTlCO0FBQ0FrQyxvQkFBZ0JsQixJQUFoQixDQUFxQmhCLFNBQVMsQ0FBOUI7QUFDQWtDLG9CQUFnQmxCLElBQWhCLENBQXFCaEIsU0FBUyxDQUE5QjtBQUNBa0Msb0JBQWdCbEIsSUFBaEIsQ0FBcUJoQixTQUFTLENBQTlCO0FBQ0Q7O0FBRUQsU0FBT2tDLGVBQVA7QUFDRDs7QUFFREUsT0FBT0MsT0FBUCxHQUFpQjtBQUNmMUMsK0JBQTZCQSwyQkFEZDtBQUVmYSw2QkFBMkJBLHlCQUZaO0FBR2ZVLDZCQUEyQkEseUJBSFo7QUFJZmUsNEJBQTBCQTtBQUpYLENBQWpCIiwiZmlsZSI6InZlcnRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgdmVjMyA9IHJlcXVpcmUoJy4uL21hdGhzL3ZlYzMnKSxcbiAgICAgIHZlYzQgPSByZXF1aXJlKCcuLi9tYXRocy92ZWM0JyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpO1xuXG5jb25zdCB7IGNob3AsIGZsYXR0ZW4gfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBzdWJ0cmFjdCwgY3Jvc3MgfSA9IHZlYzMsXG4gICAgICB7IGNvbXBvc2VUcmFuc2Zvcm0gfSA9IHZlYzQ7XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVZlcnRleFBvc2l0aW9uRGF0YShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgb2Zmc2V0LCByb3RhdGlvbikge1xuICBjb25zdCB0cmFuc2Zvcm0gPSBjb21wb3NlVHJhbnNmb3JtKHdpZHRoLCBoZWlnaHQsIGRlcHRoLCBvZmZzZXQsIHJvdGF0aW9uKTtcblxuICBsZXQgdmVydGV4UG9zaXRpb25zID0gY2hvcChpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLCA0KTsgIC8vL1xuXG4gIHZlcnRleFBvc2l0aW9ucyA9IHZlcnRleFBvc2l0aW9ucy5tYXAoZnVuY3Rpb24odmVydGV4UG9zaXRpb24pIHtcbiAgICByZXR1cm4gdHJhbnNmb3JtKHZlcnRleFBvc2l0aW9uKTtcbiAgfSk7XG5cbiAgdmVydGV4UG9zaXRpb25zID0gdmVydGV4UG9zaXRpb25zLm1hcChmdW5jdGlvbih2ZXJ0ZXhQb3NpdGlvbikge1xuICAgIHJldHVybiB2ZXJ0ZXhQb3NpdGlvbi5zbGljZSgwLCAzKTsgIC8vL1xuICB9KTtcbiAgXG4gIGNvbnN0IHZlcnRleFBvc2l0aW9uRGF0YSA9IGZsYXR0ZW4odmVydGV4UG9zaXRpb25zKTsgXG5cbiAgcmV0dXJuIHZlcnRleFBvc2l0aW9uRGF0YTtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVmVydGV4Q29sb3VyRGF0YShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLCBjb2xvdXIpIHtcbiAgY29uc3QgaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCA9IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEubGVuZ3RoLFxuICAgICAgICB2ZXJ0ZXhDb2xvdXJzTGVuZ3RoID0gaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCAvIDQsICAvLy9cbiAgICAgICAgdmVydGV4Q29sb3VyID0gY29sb3VyLFxuICAgICAgICB2ZXJ0ZXhDb2xvdXJzID0gW107XG5cbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHZlcnRleENvbG91cnNMZW5ndGg7IGluZGV4KyspIHtcbiAgICB2ZXJ0ZXhDb2xvdXJzLnB1c2godmVydGV4Q29sb3VyKTtcbiAgfVxuXG4gIGNvbnN0IHZlcnRleENvbG91ckRhdGEgPSBmbGF0dGVuKHZlcnRleENvbG91cnMpOyAgLy8vXG5cbiAgcmV0dXJuIHZlcnRleENvbG91ckRhdGE7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVZlcnRleE5vcm1hbERhdGEoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSkge1xuICBjb25zdCB2ZXJ0ZXhOb3JtYWxWZWN0b3JzID0gW10sXG4gICAgICAgIGZhY2VzID0gY2hvcChpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLCAxNik7ICAvLy9cblxuICBmYWNlcy5mb3JFYWNoKGZ1bmN0aW9uKGZhY2UpIHtcbiAgICBjb25zdCB2ZXJ0ZXhQb3NpdGlvbnMgPSBjaG9wKGZhY2UsIDQpO1xuXG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IDQ7IGluZGV4KyspIHtcbiAgICAgIGNvbnN0IGZpcnN0VmVydGV4SW5kZXggPSBpbmRleCxcbiAgICAgICAgICAgIHNlY29uZFZlcnRleEluZGV4ID0gKGluZGV4ICsgMSkgJSA0LFxuICAgICAgICAgICAgdGhpcmRWZXJ0ZXhJbmRleCA9IChpbmRleCArIDMpICUgNCxcbiAgICAgICAgICAgIGZpcnN0VmVydGV4UG9zaXRpb24gPSB2ZXJ0ZXhQb3NpdGlvbnNbZmlyc3RWZXJ0ZXhJbmRleF0sXG4gICAgICAgICAgICBzZWNvbmRWZXJ0ZXhQb3NpdGlvbiA9IHZlcnRleFBvc2l0aW9uc1tzZWNvbmRWZXJ0ZXhJbmRleF0sXG4gICAgICAgICAgICB0aGlyZFZlcnRleFBvc2l0aW9uID0gdmVydGV4UG9zaXRpb25zW3RoaXJkVmVydGV4SW5kZXhdLFxuICAgICAgICAgICAgZmlyc3RWZWN0b3IgPSBzdWJ0cmFjdChzZWNvbmRWZXJ0ZXhQb3NpdGlvbiwgZmlyc3RWZXJ0ZXhQb3NpdGlvbiksICAvLy9cbiAgICAgICAgICAgIHNlY29uZFZlY3RvciA9IHN1YnRyYWN0KHRoaXJkVmVydGV4UG9zaXRpb24sIGZpcnN0VmVydGV4UG9zaXRpb24pLCAgLy8vXG4gICAgICAgICAgICB2ZXJ0ZXhOb3JtYWxWZWN0b3IgPSBjcm9zcyhmaXJzdFZlY3Rvciwgc2Vjb25kVmVjdG9yKTtcblxuICAgICAgdmVydGV4Tm9ybWFsVmVjdG9ycy5wdXNoKHZlcnRleE5vcm1hbFZlY3Rvcik7XG4gICAgfVxuICB9KTtcbiAgXG4gIGNvbnN0IHZlcnRleE5vcm1hbERhdGEgPSBmbGF0dGVuKHZlcnRleE5vcm1hbFZlY3RvcnMpOyAvLy9cblxuICByZXR1cm4gdmVydGV4Tm9ybWFsRGF0YTtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVmVydGV4SW5kZXhEYXRhKGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEpIHtcbiAgY29uc3QgdmVydGV4SW5kZXhEYXRhID0gW10sXG4gICAgICAgIGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGggPSBpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLmxlbmd0aCxcbiAgICAgICAgZmFjZXNMZW5ndGggPSBpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoIC8gMTY7IC8vL1xuXG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBmYWNlc0xlbmd0aDsgaW5kZXgrKykge1xuICAgIGNvbnN0IG9mZnNldCA9IGluZGV4ICogNDtcblxuICAgIHZlcnRleEluZGV4RGF0YS5wdXNoKG9mZnNldCArIDApO1xuICAgIHZlcnRleEluZGV4RGF0YS5wdXNoKG9mZnNldCArIDEpO1xuICAgIHZlcnRleEluZGV4RGF0YS5wdXNoKG9mZnNldCArIDIpO1xuICAgIHZlcnRleEluZGV4RGF0YS5wdXNoKG9mZnNldCArIDApO1xuICAgIHZlcnRleEluZGV4RGF0YS5wdXNoKG9mZnNldCArIDIpO1xuICAgIHZlcnRleEluZGV4RGF0YS5wdXNoKG9mZnNldCArIDMpO1xuICB9XG5cbiAgcmV0dXJuIHZlcnRleEluZGV4RGF0YTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGNhbGN1bGF0ZVZlcnRleFBvc2l0aW9uRGF0YTogY2FsY3VsYXRlVmVydGV4UG9zaXRpb25EYXRhLFxuICBjYWxjdWxhdGVWZXJ0ZXhDb2xvdXJEYXRhOiBjYWxjdWxhdGVWZXJ0ZXhDb2xvdXJEYXRhLFxuICBjYWxjdWxhdGVWZXJ0ZXhOb3JtYWxEYXRhOiBjYWxjdWxhdGVWZXJ0ZXhOb3JtYWxEYXRhLFxuICBjYWxjdWxhdGVWZXJ0ZXhJbmRleERhdGE6IGNhbGN1bGF0ZVZlcnRleEluZGV4RGF0YVxufTtcbiJdfQ==