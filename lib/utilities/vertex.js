'use strict';

var vec3 = require('gl-vec3'),
    ///
vec4 = require('gl-vec4'),
    ///
mat4 = require('gl-mat4'); ///

var arrayUtilities = require('../utilities/array');

var dice = arrayUtilities.dice,
    flatten = arrayUtilities.flatten,
    create = mat4.create,
    translate = mat4.translate,
    scale = mat4.scale,
    rotate = mat4.rotate,
    transformMat4 = vec4.transformMat4;


var defaultWidth = 1,
    defaultDepth = 1,
    defaultHeight = 1,
    defaultOffset = [0, 0, 0],
    defaultRotation = [0, 0, 0];

function calculateVertexPositionData(initialVertexPositionData) {
  var width = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultWidth;
  var depth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : defaultDepth;
  var height = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : defaultHeight;
  var offset = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : defaultOffset;
  var rotation = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : defaultRotation;

  var mat4 = create(),
      xAngle = rotation[0] * Math.PI / 180,
      yAngle = rotation[1] * Math.PI / 180,
      zAngle = rotation[2] * Math.PI / 180;

  translate(mat4, mat4, offset);

  rotate(mat4, mat4, xAngle, [1, 0, 0]);
  rotate(mat4, mat4, yAngle, [0, 1, 0]);
  rotate(mat4, mat4, zAngle, [0, 0, 1]);

  scale(mat4, mat4, [width, depth, height]);

  var vertexPositions = dice(initialVertexPositionData, 4); ///

  vertexPositions = vertexPositions.map(function (vertexPosition) {
    return transformMat4(vertexPosition, vertexPosition, mat4);
  });

  vertexPositions = vertexPositions.map(function (vertexPosition) {
    return vertexPosition.slice(0, 3);
  });

  var vertexPositionData = flatten(vertexPositions);

  return vertexPositionData;
}

function calculateVertexNormalData(initialVertexPositionData) {
  var vertexNormalVectors = [],
      faces = dice(initialVertexPositionData, 16); ///

  faces.forEach(function (face) {
    var vertexPositions = dice(face, 4);

    for (var index = 0; index < 4; index++) {
      var firstVertexIndex = index,
          secondVertexIndex = (index + 1) % 4,
          thirdVertexIndex = (index + 3) % 4,
          firstVertexPosition = vertexPositions[firstVertexIndex],
          secondVertexPosition = vertexPositions[secondVertexIndex],
          thirdVertexPosition = vertexPositions[thirdVertexIndex],
          firstVector = subtract(secondVertexPosition, firstVertexPosition),
          ///
      secondVector = subtract(thirdVertexPosition, firstVertexPosition),
          ///
      vertexNormalVector = cross(firstVector, secondVector);

      vertexNormalVectors.push(vertexNormalVector);
    }
  });

  var vertexNormalData = flatten(vertexNormalVectors); ///

  return vertexNormalData;
}

function calculateVertexIndexData(initialVertexPositionData) {
  var vertexIndexData = [],
      initialVertexPositionDataLength = initialVertexPositionData.length,
      facesLength = initialVertexPositionDataLength / 16; ///

  for (var index = 0; index < facesLength; index++) {
    var offset = index * 4;

    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 1);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 3);
  }

  return vertexIndexData;
}

module.exports = {
  calculateVertexPositionData: calculateVertexPositionData,
  calculateVertexNormalData: calculateVertexNormalData,
  calculateVertexIndexData: calculateVertexIndexData
};

function subtract(vec1, vec2) {
  var vec = [];

  vec3.subtract(vec, vec1, vec2);

  return vec;
}

function cross(vec1, vec2) {
  var vec = [];

  vec3.cross(vec, vec1, vec2);

  return vec;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvdmVydGV4LmpzIl0sIm5hbWVzIjpbInZlYzMiLCJyZXF1aXJlIiwidmVjNCIsIm1hdDQiLCJhcnJheVV0aWxpdGllcyIsImRpY2UiLCJmbGF0dGVuIiwiY3JlYXRlIiwidHJhbnNsYXRlIiwic2NhbGUiLCJyb3RhdGUiLCJ0cmFuc2Zvcm1NYXQ0IiwiZGVmYXVsdFdpZHRoIiwiZGVmYXVsdERlcHRoIiwiZGVmYXVsdEhlaWdodCIsImRlZmF1bHRPZmZzZXQiLCJkZWZhdWx0Um90YXRpb24iLCJjYWxjdWxhdGVWZXJ0ZXhQb3NpdGlvbkRhdGEiLCJpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhIiwid2lkdGgiLCJkZXB0aCIsImhlaWdodCIsIm9mZnNldCIsInJvdGF0aW9uIiwieEFuZ2xlIiwiTWF0aCIsIlBJIiwieUFuZ2xlIiwiekFuZ2xlIiwidmVydGV4UG9zaXRpb25zIiwibWFwIiwidmVydGV4UG9zaXRpb24iLCJzbGljZSIsInZlcnRleFBvc2l0aW9uRGF0YSIsImNhbGN1bGF0ZVZlcnRleE5vcm1hbERhdGEiLCJ2ZXJ0ZXhOb3JtYWxWZWN0b3JzIiwiZmFjZXMiLCJmb3JFYWNoIiwiZmFjZSIsImluZGV4IiwiZmlyc3RWZXJ0ZXhJbmRleCIsInNlY29uZFZlcnRleEluZGV4IiwidGhpcmRWZXJ0ZXhJbmRleCIsImZpcnN0VmVydGV4UG9zaXRpb24iLCJzZWNvbmRWZXJ0ZXhQb3NpdGlvbiIsInRoaXJkVmVydGV4UG9zaXRpb24iLCJmaXJzdFZlY3RvciIsInN1YnRyYWN0Iiwic2Vjb25kVmVjdG9yIiwidmVydGV4Tm9ybWFsVmVjdG9yIiwiY3Jvc3MiLCJwdXNoIiwidmVydGV4Tm9ybWFsRGF0YSIsImNhbGN1bGF0ZVZlcnRleEluZGV4RGF0YSIsInZlcnRleEluZGV4RGF0YSIsImluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGgiLCJsZW5ndGgiLCJmYWNlc0xlbmd0aCIsIm1vZHVsZSIsImV4cG9ydHMi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eUNsQixPQUF6QyxFQUFrRDtBQUNoRCxRQUFNakIsU0FBU2lCLFFBQVEsQ0FBdkI7O0FBRUFlLG9CQUFnQkgsSUFBaEIsQ0FBcUI3QixTQUFTLENBQTlCO0FBQ0FnQyxvQkFBZ0JILElBQWhCLENBQXFCN0IsU0FBUyxDQUE5QjtBQUNBZ0Msb0JBQWdCSCxJQUFoQixDQUFxQjdCLFNBQVMsQ0FBOUI7QUFDQWdDLG9CQUFnQkgsSUFBaEIsQ0FBcUI3QixTQUFTLENBQTlCO0FBQ0FnQyxvQkFBZ0JILElBQWhCLENBQXFCN0IsU0FBUyxDQUE5QjtBQUNBZ0Msb0JBQWdCSCxJQUFoQixDQUFxQjdCLFNBQVMsQ0FBOUI7QUFDRDs7QUFFRCxTQUFPZ0MsZUFBUDtBQUNEOztBQUVESSxPQUFPQyxPQUFQLEdBQWlCO0FBQ2YxQywrQkFBNkJBLDJCQURkO0FBRWZpQiw2QkFBMkJBLHlCQUZaO0FBR2ZtQiw0QkFBMEJBO0FBSFgsQ0FBakI7O0FBTUEsU0FBU04sUUFBVCxDQUFrQmEsSUFBbEIsRUFBd0JDLElBQXhCLEVBQThCO0FBQzVCLE1BQU1DLE1BQU0sRUFBWjs7QUFFQTlELE9BQUsrQyxRQUFMLENBQWNlLEdBQWQsRUFBbUJGLElBQW5CLEVBQXlCQyxJQUF6Qjs7QUFFQSxTQUFPQyxHQUFQO0FBQ0Q7O0FBRUQsU0FBU1osS0FBVCxDQUFlVSxJQUFmLEVBQXFCQyxJQUFyQixFQUEyQjtBQUN6QixNQUFNQyxNQUFNLEVBQVo7O0FBRUE5RCxPQUFLa0QsS0FBTCxDQUFXWSxHQUFYLEVBQWdCRixJQUFoQixFQUFzQkMsSUFBdEI7O0FBRUEsU0FBT0MsR0FBUDtBQUNEIiwiZmlsZSI6InZlcnRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgdmVjMyA9IHJlcXVpcmUoJ2dsLXZlYzMnKSwgIC8vL1xuICAgICAgdmVjNCA9IHJlcXVpcmUoJ2dsLXZlYzQnKSwgIC8vL1xuICAgICAgbWF0NCA9IHJlcXVpcmUoJ2dsLW1hdDQnKTsgIC8vL1xuXG5jb25zdCBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpO1xuXG5jb25zdCB7IGRpY2UsIGZsYXR0ZW4gfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBjcmVhdGUsIHRyYW5zbGF0ZSwgc2NhbGUsIHJvdGF0ZSB9ID0gbWF0NCxcbiAgICAgIHsgdHJhbnNmb3JtTWF0NCB9ID0gdmVjNDtcblxuY29uc3QgZGVmYXVsdFdpZHRoID0gMSxcbiAgICAgIGRlZmF1bHREZXB0aCA9IDEsXG4gICAgICBkZWZhdWx0SGVpZ2h0ID0gMSxcbiAgICAgIGRlZmF1bHRPZmZzZXQgPSBbIDAsIDAsIDAgXSxcbiAgICAgIGRlZmF1bHRSb3RhdGlvbiA9IFsgMCwgMCwgMF07XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVZlcnRleFBvc2l0aW9uRGF0YShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLCB3aWR0aCA9IGRlZmF1bHRXaWR0aCwgZGVwdGggPSBkZWZhdWx0RGVwdGgsIGhlaWdodCA9IGRlZmF1bHRIZWlnaHQsIG9mZnNldCA9IGRlZmF1bHRPZmZzZXQsIHJvdGF0aW9uID0gZGVmYXVsdFJvdGF0aW9uKSB7XG4gIGNvbnN0IG1hdDQgPSBjcmVhdGUoKSxcbiAgICAgICAgeEFuZ2xlID0gcm90YXRpb25bMF0gKiBNYXRoLlBJIC8gMTgwLFxuICAgICAgICB5QW5nbGUgPSByb3RhdGlvblsxXSAqIE1hdGguUEkgLyAxODAsXG4gICAgICAgIHpBbmdsZSA9IHJvdGF0aW9uWzJdICogTWF0aC5QSSAvIDE4MDtcblxuICB0cmFuc2xhdGUobWF0NCwgbWF0NCwgb2Zmc2V0KTtcblxuICByb3RhdGUobWF0NCwgbWF0NCwgeEFuZ2xlLCBbMSwgMCwgMF0pO1xuICByb3RhdGUobWF0NCwgbWF0NCwgeUFuZ2xlLCBbMCwgMSwgMF0pO1xuICByb3RhdGUobWF0NCwgbWF0NCwgekFuZ2xlLCBbMCwgMCwgMV0pO1xuXG4gIHNjYWxlKG1hdDQsIG1hdDQsIFt3aWR0aCwgZGVwdGgsIGhlaWdodF0pO1xuXG4gIGxldCB2ZXJ0ZXhQb3NpdGlvbnMgPSBkaWNlKGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEsIDQpOyAgLy8vXG5cbiAgdmVydGV4UG9zaXRpb25zID0gdmVydGV4UG9zaXRpb25zLm1hcChmdW5jdGlvbih2ZXJ0ZXhQb3NpdGlvbikge1xuICAgIHJldHVybiB0cmFuc2Zvcm1NYXQ0KHZlcnRleFBvc2l0aW9uLCB2ZXJ0ZXhQb3NpdGlvbiwgbWF0NCk7XG4gIH0pO1xuXG4gIHZlcnRleFBvc2l0aW9ucyA9IHZlcnRleFBvc2l0aW9ucy5tYXAoZnVuY3Rpb24odmVydGV4UG9zaXRpb24pIHtcbiAgICByZXR1cm4gdmVydGV4UG9zaXRpb24uc2xpY2UoMCwgMyk7XG4gIH0pO1xuICBcbiAgY29uc3QgdmVydGV4UG9zaXRpb25EYXRhID0gZmxhdHRlbih2ZXJ0ZXhQb3NpdGlvbnMpOyBcblxuICByZXR1cm4gdmVydGV4UG9zaXRpb25EYXRhO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVWZXJ0ZXhOb3JtYWxEYXRhKGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEpIHtcbiAgY29uc3QgdmVydGV4Tm9ybWFsVmVjdG9ycyA9IFtdLFxuICAgICAgICBmYWNlcyA9IGRpY2UoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSwgMTYpOyAgLy8vXG5cbiAgZmFjZXMuZm9yRWFjaChmdW5jdGlvbihmYWNlKSB7XG4gICAgY29uc3QgdmVydGV4UG9zaXRpb25zID0gZGljZShmYWNlLCA0KTtcblxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCA0OyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBmaXJzdFZlcnRleEluZGV4ID0gaW5kZXgsXG4gICAgICAgICAgICBzZWNvbmRWZXJ0ZXhJbmRleCA9IChpbmRleCArIDEpICUgNCxcbiAgICAgICAgICAgIHRoaXJkVmVydGV4SW5kZXggPSAoaW5kZXggKyAzKSAlIDQsXG4gICAgICAgICAgICBmaXJzdFZlcnRleFBvc2l0aW9uID0gdmVydGV4UG9zaXRpb25zW2ZpcnN0VmVydGV4SW5kZXhdLFxuICAgICAgICAgICAgc2Vjb25kVmVydGV4UG9zaXRpb24gPSB2ZXJ0ZXhQb3NpdGlvbnNbc2Vjb25kVmVydGV4SW5kZXhdLFxuICAgICAgICAgICAgdGhpcmRWZXJ0ZXhQb3NpdGlvbiA9IHZlcnRleFBvc2l0aW9uc1t0aGlyZFZlcnRleEluZGV4XSxcbiAgICAgICAgICAgIGZpcnN0VmVjdG9yID0gc3VidHJhY3Qoc2Vjb25kVmVydGV4UG9zaXRpb24sIGZpcnN0VmVydGV4UG9zaXRpb24pLCAgLy8vXG4gICAgICAgICAgICBzZWNvbmRWZWN0b3IgPSBzdWJ0cmFjdCh0aGlyZFZlcnRleFBvc2l0aW9uLCBmaXJzdFZlcnRleFBvc2l0aW9uKSwgIC8vL1xuICAgICAgICAgICAgdmVydGV4Tm9ybWFsVmVjdG9yID0gY3Jvc3MoZmlyc3RWZWN0b3IsIHNlY29uZFZlY3Rvcik7XG5cbiAgICAgIHZlcnRleE5vcm1hbFZlY3RvcnMucHVzaCh2ZXJ0ZXhOb3JtYWxWZWN0b3IpO1xuICAgIH1cbiAgfSk7XG4gIFxuICBjb25zdCB2ZXJ0ZXhOb3JtYWxEYXRhID0gZmxhdHRlbih2ZXJ0ZXhOb3JtYWxWZWN0b3JzKTsgLy8vXG5cbiAgcmV0dXJuIHZlcnRleE5vcm1hbERhdGE7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVZlcnRleEluZGV4RGF0YShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhKSB7XG4gIGNvbnN0IHZlcnRleEluZGV4RGF0YSA9IFtdLFxuICAgICAgICBpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoID0gaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YS5sZW5ndGgsXG4gICAgICAgIGZhY2VzTGVuZ3RoID0gaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCAvIDE2OyAvLy9cblxuICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgZmFjZXNMZW5ndGg7IGluZGV4KyspIHtcbiAgICBjb25zdCBvZmZzZXQgPSBpbmRleCAqIDQ7XG5cbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAwKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAxKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAyKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAwKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAyKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAzKTtcbiAgfVxuXG4gIHJldHVybiB2ZXJ0ZXhJbmRleERhdGE7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBjYWxjdWxhdGVWZXJ0ZXhQb3NpdGlvbkRhdGE6IGNhbGN1bGF0ZVZlcnRleFBvc2l0aW9uRGF0YSxcbiAgY2FsY3VsYXRlVmVydGV4Tm9ybWFsRGF0YTogY2FsY3VsYXRlVmVydGV4Tm9ybWFsRGF0YSxcbiAgY2FsY3VsYXRlVmVydGV4SW5kZXhEYXRhOiBjYWxjdWxhdGVWZXJ0ZXhJbmRleERhdGFcbn07XG5cbmZ1bmN0aW9uIHN1YnRyYWN0KHZlYzEsIHZlYzIpIHtcbiAgY29uc3QgdmVjID0gW107XG5cbiAgdmVjMy5zdWJ0cmFjdCh2ZWMsIHZlYzEsIHZlYzIpO1xuXG4gIHJldHVybiB2ZWM7XG59XG5cbmZ1bmN0aW9uIGNyb3NzKHZlYzEsIHZlYzIpIHtcbiAgY29uc3QgdmVjID0gW107XG5cbiAgdmVjMy5jcm9zcyh2ZWMsIHZlYzEsIHZlYzIpO1xuXG4gIHJldHVybiB2ZWM7XG59XG4iXX0=