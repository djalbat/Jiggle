'use strict';

var vec3 = require('gl-vec3'),
    ///
vec4 = require('gl-vec4'),
    ///
mat4 = require('gl-mat4'); ///

var arrayUtilities = require('../utilities/array');

var dice = arrayUtilities.dice,
    flatten = arrayUtilities.flatten;


function calculateVertexPositionData(initialVertexPositionData, width, depth, height, offset) {
  var matrix = mat4.create();

  mat4.translate(matrix, matrix, offset);
  mat4.scale(matrix, matrix, [width, depth, height]);

  var vertexPositions = dice(initialVertexPositionData, 4); ///

  vertexPositions = vertexPositions.map(function (vertexPosition) {
    return vec4.transformMat4(vertexPosition, vertexPosition, matrix);
  });

  vertexPositions = vertexPositions.map(function (vertexPosition) {
    return vertexPosition.slice(0, 3);
  });

  var vertexPositionData = flatten(vertexPositions);

  return vertexPositionData;
}

function calculateVertexNormalData(initialVertexPositionData) {
  var vertexNormalVectors = [],
      faces = dice(initialVertexPositionData, 16);

  faces.forEach(function (face) {
    var vertexPositions = dice(face, 4);

    for (var index = 0; index < 4; index++) {
      var firstVertexIndex = index,
          secondVertexIndex = (index + 1) % 4,
          thirdVertexIndex = (index + 3) % 4,
          firstVertexPosition = vertexPositions[firstVertexIndex],
          secondVertexPosition = vertexPositions[secondVertexIndex],
          thirdVertexPosition = vertexPositions[thirdVertexIndex],
          firstVector = subtract(secondVertexPosition, firstVertexPosition),
          ///
      secondVector = subtract(thirdVertexPosition, firstVertexPosition),
          ///
      vertexNormalVector = cross(firstVector, secondVector);

      vertexNormalVectors.push(vertexNormalVector);
    }
  });

  var vertexNormalData = flatten(vertexNormalVectors);

  return vertexNormalData;
}

function calculateVertexIndexData(initialVertexPositionData) {
  var vertexIndexData = [],
      initialVertexPositionDataLength = initialVertexPositionData.length,
      facesLength = initialVertexPositionDataLength / 16;

  for (var index = 0; index < facesLength; index++) {
    var offset = index * 4;

    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 1);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 3);
  }

  return vertexIndexData;
}

module.exports = {
  calculateVertexPositionData: calculateVertexPositionData,
  calculateVertexNormalData: calculateVertexNormalData,
  calculateVertexIndexData: calculateVertexIndexData
};

function subtract(vec1, vec2) {
  var vec = [];

  vec3.subtract(vec, vec1, vec2);

  return vec;
}

function cross(vec1, vec2) {
  var vec = [];

  vec3.cross(vec, vec1, vec2);

  return vec;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvdmVydGV4LmpzIl0sIm5hbWVzIjpbInZlYzMiLCJyZXF1aXJlIiwidmVjNCIsIm1hdDQiLCJhcnJheVV0aWxpdGllcyIsImRpY2UiLCJmbGF0dGVuIiwiY2FsY3VsYXRlVmVydGV4UG9zaXRpb25EYXRhIiwiaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSIsIndpZHRoIiwiZGVwdGgiLCJoZWlnaHQiLCJvZmZzZXQiLCJtYXRyaXgiLCJjcmVhdGUiLCJ0cmFuc2xhdGUiLCJzY2FsZSIsInZlcnRleFBvc2l0aW9ucyIsIm1hcCIsInZlcnRleFBvc2l0aW9uIiwidHJhbnNmb3JtTWF0NCIsInNsaWNlIiwidmVydGV4UG9zaXRpb25EYXRhIiwiY2FsY3VsYXRlVmVydGV4Tm9ybWFsRGF0YSIsInZlcnRleE5vcm1hbFZlY3RvcnMiLCJmYWNlcyIsImZvckVhY2giLCJmYWNlIiwiaW5kZXgiLCJmaXJzdFZlcnRleEluZGV4Iiwic2Vjb25kVmVydGV4SW5kZXgiLCJ0aGlyZFZlcnRleEluZGV4IiwiZmlyc3RWZXJ0ZXhQb3NpdGlvbiIsInNlY29uZFZlcnRleFBvc2l0aW9uIiwidGhpcmRWZXJ0ZXhQb3NpdGlvbiIsImZpcnN0VmVjdG9yIiwic3VidHJhY3QiLCJzZWNvbmRWZWN0b3IiLCJ2ZXJ0ZXhOb3JtYWxWZWN0b3IiLCJjcm9zcyIsInB1c2giLCJ2ZXJ0ZXhOb3JtYWxEYXRhIiwiY2FsY3VsYXRlVmVydGV4SW5kZXhEYXRhIiwidmVydGV4SW5kZXhEYXRhIiwiaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCIsImxlbmd0aCIsImZhY2VzTGVuZ3RoIiwibW9kdWxlIiwiZXhwb3J0cyIsInZlYzEiLCJ2ZWMyIiwidmVjIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxPQUFPQyxRQUFRLFNBQVIsQ0FBYjtBQUFBLElBQWtDO0FBQzVCQyxPQUFPRCxRQUFRLFNBQVIsQ0FEYjtBQUFBLElBQ2tDO0FBQzVCRSxP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QXFCNUIsU0FBUyxDQUE5QjtBQUNBK0Isb0JBQWdCSCxJQUFoQixDQUFxQjVCLFNBQVMsQ0FBOUI7QUFDQStCLG9CQUFnQkgsSUFBaEIsQ0FBcUI1QixTQUFTLENBQTlCO0FBQ0ErQixvQkFBZ0JILElBQWhCLENBQXFCNUIsU0FBUyxDQUE5QjtBQUNBK0Isb0JBQWdCSCxJQUFoQixDQUFxQjVCLFNBQVMsQ0FBOUI7QUFDQStCLG9CQUFnQkgsSUFBaEIsQ0FBcUI1QixTQUFTLENBQTlCO0FBQ0Q7O0FBRUQsU0FBTytCLGVBQVA7QUFDRDs7QUFFREksT0FBT0MsT0FBUCxHQUFpQjtBQUNmekMsK0JBQTZCQSwyQkFEZDtBQUVmZ0IsNkJBQTJCQSx5QkFGWjtBQUdmbUIsNEJBQTBCQTtBQUhYLENBQWpCOztBQU1BLFNBQVNOLFFBQVQsQ0FBa0JhLElBQWxCLEVBQXdCQyxJQUF4QixFQUE4QjtBQUM1QixNQUFNQyxNQUFNLEVBQVo7O0FBRUFuRCxPQUFLb0MsUUFBTCxDQUFjZSxHQUFkLEVBQW1CRixJQUFuQixFQUF5QkMsSUFBekI7O0FBRUEsU0FBT0MsR0FBUDtBQUNEOztBQUVELFNBQVNaLEtBQVQsQ0FBZVUsSUFBZixFQUFxQkMsSUFBckIsRUFBMkI7QUFDekIsTUFBTUMsTUFBTSxFQUFaOztBQUVBbkQsT0FBS3VDLEtBQUwsQ0FBV1ksR0FBWCxFQUFnQkYsSUFBaEIsRUFBc0JDLElBQXRCOztBQUVBLFNBQU9DLEdBQVA7QUFDRCIsImZpbGUiOiJ2ZXJ0ZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHZlYzMgPSByZXF1aXJlKCdnbC12ZWMzJyksICAvLy9cbiAgICAgIHZlYzQgPSByZXF1aXJlKCdnbC12ZWM0JyksICAvLy9cbiAgICAgIG1hdDQgPSByZXF1aXJlKCdnbC1tYXQ0Jyk7ICAvLy9cblxuY29uc3QgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvYXJyYXknKTtcblxuY29uc3QgeyBkaWNlLCBmbGF0dGVuIH0gPSBhcnJheVV0aWxpdGllcztcblxuZnVuY3Rpb24gY2FsY3VsYXRlVmVydGV4UG9zaXRpb25EYXRhKGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEsIHdpZHRoLCBkZXB0aCwgaGVpZ2h0LCBvZmZzZXQpIHtcbiAgY29uc3QgbWF0cml4ID0gbWF0NC5jcmVhdGUoKTtcblxuICBtYXQ0LnRyYW5zbGF0ZShtYXRyaXgsIG1hdHJpeCwgb2Zmc2V0KTtcbiAgbWF0NC5zY2FsZShtYXRyaXgsIG1hdHJpeCwgW3dpZHRoLCBkZXB0aCwgaGVpZ2h0XSk7XG5cbiAgbGV0IHZlcnRleFBvc2l0aW9ucyA9IGRpY2UoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSwgNCk7ICAvLy9cblxuICB2ZXJ0ZXhQb3NpdGlvbnMgPSB2ZXJ0ZXhQb3NpdGlvbnMubWFwKGZ1bmN0aW9uKHZlcnRleFBvc2l0aW9uKSB7XG4gICAgcmV0dXJuIHZlYzQudHJhbnNmb3JtTWF0NCh2ZXJ0ZXhQb3NpdGlvbiwgdmVydGV4UG9zaXRpb24sIG1hdHJpeCk7XG4gIH0pO1xuXG4gIHZlcnRleFBvc2l0aW9ucyA9IHZlcnRleFBvc2l0aW9ucy5tYXAoZnVuY3Rpb24odmVydGV4UG9zaXRpb24pIHtcbiAgICByZXR1cm4gdmVydGV4UG9zaXRpb24uc2xpY2UoMCwgMyk7XG4gIH0pO1xuICBcbiAgY29uc3QgdmVydGV4UG9zaXRpb25EYXRhID0gZmxhdHRlbih2ZXJ0ZXhQb3NpdGlvbnMpOyBcblxuICByZXR1cm4gdmVydGV4UG9zaXRpb25EYXRhO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVWZXJ0ZXhOb3JtYWxEYXRhKGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEpIHtcbiAgY29uc3QgdmVydGV4Tm9ybWFsVmVjdG9ycyA9IFtdLFxuICAgICAgICBmYWNlcyA9IGRpY2UoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSwgMTYpO1xuXG4gIGZhY2VzLmZvckVhY2goZnVuY3Rpb24oZmFjZSkge1xuICAgIGNvbnN0IHZlcnRleFBvc2l0aW9ucyA9IGRpY2UoZmFjZSwgNCk7XG5cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgNDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZmlyc3RWZXJ0ZXhJbmRleCA9IGluZGV4LFxuICAgICAgICAgICAgc2Vjb25kVmVydGV4SW5kZXggPSAoaW5kZXggKyAxKSAlIDQsXG4gICAgICAgICAgICB0aGlyZFZlcnRleEluZGV4ID0gKGluZGV4ICsgMykgJSA0LFxuICAgICAgICAgICAgZmlyc3RWZXJ0ZXhQb3NpdGlvbiA9IHZlcnRleFBvc2l0aW9uc1tmaXJzdFZlcnRleEluZGV4XSxcbiAgICAgICAgICAgIHNlY29uZFZlcnRleFBvc2l0aW9uID0gdmVydGV4UG9zaXRpb25zW3NlY29uZFZlcnRleEluZGV4XSxcbiAgICAgICAgICAgIHRoaXJkVmVydGV4UG9zaXRpb24gPSB2ZXJ0ZXhQb3NpdGlvbnNbdGhpcmRWZXJ0ZXhJbmRleF0sXG4gICAgICAgICAgICBmaXJzdFZlY3RvciA9IHN1YnRyYWN0KHNlY29uZFZlcnRleFBvc2l0aW9uLCBmaXJzdFZlcnRleFBvc2l0aW9uKSwgIC8vL1xuICAgICAgICAgICAgc2Vjb25kVmVjdG9yID0gc3VidHJhY3QodGhpcmRWZXJ0ZXhQb3NpdGlvbiwgZmlyc3RWZXJ0ZXhQb3NpdGlvbiksICAvLy9cbiAgICAgICAgICAgIHZlcnRleE5vcm1hbFZlY3RvciA9IGNyb3NzKGZpcnN0VmVjdG9yLCBzZWNvbmRWZWN0b3IpO1xuXG4gICAgICB2ZXJ0ZXhOb3JtYWxWZWN0b3JzLnB1c2godmVydGV4Tm9ybWFsVmVjdG9yKTtcbiAgICB9XG4gIH0pO1xuICBcbiAgY29uc3QgdmVydGV4Tm9ybWFsRGF0YSA9IGZsYXR0ZW4odmVydGV4Tm9ybWFsVmVjdG9ycyk7IFxuXG4gIHJldHVybiB2ZXJ0ZXhOb3JtYWxEYXRhO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVWZXJ0ZXhJbmRleERhdGEoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSkge1xuICBjb25zdCB2ZXJ0ZXhJbmRleERhdGEgPSBbXSxcbiAgICAgICAgaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCA9IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEubGVuZ3RoLFxuICAgICAgICBmYWNlc0xlbmd0aCA9IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGggLyAxNjtcblxuICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgZmFjZXNMZW5ndGg7IGluZGV4KyspIHtcbiAgICBjb25zdCBvZmZzZXQgPSBpbmRleCAqIDQ7XG5cbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAwKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAxKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAyKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAwKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAyKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAzKTtcbiAgfVxuXG4gIHJldHVybiB2ZXJ0ZXhJbmRleERhdGE7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBjYWxjdWxhdGVWZXJ0ZXhQb3NpdGlvbkRhdGE6IGNhbGN1bGF0ZVZlcnRleFBvc2l0aW9uRGF0YSxcbiAgY2FsY3VsYXRlVmVydGV4Tm9ybWFsRGF0YTogY2FsY3VsYXRlVmVydGV4Tm9ybWFsRGF0YSxcbiAgY2FsY3VsYXRlVmVydGV4SW5kZXhEYXRhOiBjYWxjdWxhdGVWZXJ0ZXhJbmRleERhdGFcbn07XG5cbmZ1bmN0aW9uIHN1YnRyYWN0KHZlYzEsIHZlYzIpIHtcbiAgY29uc3QgdmVjID0gW107XG5cbiAgdmVjMy5zdWJ0cmFjdCh2ZWMsIHZlYzEsIHZlYzIpO1xuXG4gIHJldHVybiB2ZWM7XG59XG5cbmZ1bmN0aW9uIGNyb3NzKHZlYzEsIHZlYzIpIHtcbiAgY29uc3QgdmVjID0gW107XG5cbiAgdmVjMy5jcm9zcyh2ZWMsIHZlYzEsIHZlYzIpO1xuXG4gIHJldHVybiB2ZWM7XG59XG4iXX0=