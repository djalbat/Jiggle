'use strict';

var vec3 = require('../maths/vec3'),
    vec4 = require('../maths/vec4'),
    arrayUtilities = require('../utilities/array'),
    imageMapUtilities = require('../utilities/imageMap');

var chop = arrayUtilities.chop,
    flatten = arrayUtilities.flatten,
    textureCoordinateDataFromImageNames = imageMapUtilities.textureCoordinateDataFromImageNames,
    subtract = vec3.subtract,
    cross = vec3.cross,
    composeTransform = vec4.composeTransform;


function calculateVertexPositionData(initialVertexPositionData, width, height, depth, offset, rotation) {
  var transform = composeTransform(width, height, depth, offset, rotation);

  var vertexPositions = chop(initialVertexPositionData, 4); ///

  vertexPositions = vertexPositions.map(function (vertexPosition) {
    return transform(vertexPosition);
  });

  vertexPositions = vertexPositions.map(function (vertexPosition) {
    return vertexPosition.slice(0, 3); ///
  });

  var vertexPositionData = flatten(vertexPositions);

  return vertexPositionData;
}

function calculateVertexColourData(initialVertexPositionData, colour) {
  var initialVertexPositionDataLength = initialVertexPositionData.length,
      vertexColoursLength = initialVertexPositionDataLength / 4,
      ///
  vertexColour = colour,
      vertexColours = [];

  for (var index = 0; index < vertexColoursLength; index++) {
    vertexColours.push(vertexColour);
  }

  var vertexColourData = flatten(vertexColours); ///

  return vertexColourData;
}

function calculateTextureCoordinateData(initialVertexPositionData, imageName) {
  var initialVertexPositionDataLength = initialVertexPositionData.length,
      imageNamesLength = initialVertexPositionDataLength / 16,
      ///
  imageNames = [];

  for (var index = 0; index < imageNamesLength; index++) {
    imageNames.push(imageName);
  }

  var textureCoordinateData = textureCoordinateDataFromImageNames(imageNames);

  return textureCoordinateData;
}

function calculateVertexNormalData(initialVertexPositionData) {
  var vertexNormalVectors = [],
      faces = chop(initialVertexPositionData, 16); ///

  faces.forEach(function (face) {
    var vertexPositions = chop(face, 4);

    for (var index = 0; index < 4; index++) {
      var firstVertexIndex = index,
          secondVertexIndex = (index + 1) % 4,
          thirdVertexIndex = (index + 3) % 4,
          firstVertexPosition = vertexPositions[firstVertexIndex],
          secondVertexPosition = vertexPositions[secondVertexIndex],
          thirdVertexPosition = vertexPositions[thirdVertexIndex],
          firstVector = subtract(secondVertexPosition, firstVertexPosition),
          ///
      secondVector = subtract(thirdVertexPosition, firstVertexPosition),
          ///
      vertexNormalVector = cross(firstVector, secondVector);

      vertexNormalVectors.push(vertexNormalVector);
    }
  });

  var vertexNormalData = flatten(vertexNormalVectors); ///

  return vertexNormalData;
}

function calculateVertexIndexData(initialVertexPositionData) {
  var vertexIndexData = [],
      initialVertexPositionDataLength = initialVertexPositionData.length,
      facesLength = initialVertexPositionDataLength / 16; ///

  for (var index = 0; index < facesLength; index++) {
    var offset = index * 4;

    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 1);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 3);
  }

  return vertexIndexData;
}

module.exports = {
  calculateVertexPositionData: calculateVertexPositionData,
  calculateTextureCoordinateData: calculateTextureCoordinateData,
  calculateVertexColourData: calculateVertexColourData,
  calculateVertexNormalData: calculateVertexNormalData,
  calculateVertexIndexData: calculateVertexIndexData
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvdmVydGV4LmpzIl0sIm5hbWVzIjpbInZlYzMiLCJyZXF1aXJlIiwidmVjNCIsImFycmF5VXRpbGl0aWVzIiwiaW1hZ2VNYXBVdGlsaXRpZXMiLCJjaG9wIiwiZmxhdHRlbiIsInRleHR1cmVDb29yZGluYXRlRGF0YUZyb21JbWFnZU5hbWVzIiwic3VidHJhY3QiLCJjcm9zcyIsImNvbXBvc2VUcmFuc2Zvcm0iLCJjYWxjdWxhdGVWZXJ0ZXhQb3NpdGlvbkRhdGEiLCJpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhIiwid2lkdGgiLCJoZWlnaHQiLCJkZXB0aCIsIm9mZnNldCIsInJvdGF0aW9uIiwidHJhbnNmb3JtIiwidmVydGV4UG9zaXRpb25zIiwibWFwIiwidmVydGV4UG9zaXRpb24iLCJzbGljZSIsInZlcnRleFBvc2l0aW9uRGF0YSIsImNhbGN1bGF0ZVZlcnRleENvbG91ckRhdGEiLCJjb2xvdXIiLCJpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoIiwibGVuZ3RoIiwidmVydGV4Q29sb3Vyc0xlbmd0aCIsInZlcnRleENvbG91ciIsInZlcnRleENvbG91cnMiLCJpbmRleCIsInB1c2giLCJ2ZXJ0ZXhDb2xvdXJEYXRhIiwiY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVEYXRhIiwiaW1hZ2VOYW1lIiwiaW1hZ2VOYW1lc0xlbmd0aCIsImltYWdlTmFtZXMiLCJ0ZXh0dXJlQ29vcmRpbmF0ZURhdGEiLCJjYWxjdWxhdGVWZXJ0ZXhOb3JtYWxEYXRhIiwidmVydGV4Tm9ybWFsVmVjdG9ycyIsImZhY2VzIiwiZm9yRWFjaCIsImZhY2UiLCJmaXJzdFZlcnRleEluZGV4Iiwic2Vjb25kVmVydGV4SW5kZXgiLCJ0aGlyZFZlcnRleEluZGV4IiwiZmlyc3RWZXJ0ZXhQb3NpdGlvbiIsInNlY29uZFZlcnRleFBvc2l0aW9uIiwidGhpcmRWZXJ0ZXhQb3NpdGlvbiIsImZpcnN0VmVjdG9yIiwic2Vjb25kVmVjdG9yIiwidmVydGV4Tm9ybWFsVmVjdG9yIiwidmVydGV4Tm9ybWFsRGF0YSIsImNhbGN1bGF0ZVZlcnRleEluZGV4RGF0YSIsInZlcnRleEluZGV4RGF0YSIsImZhY2VzTGVuZ3RoIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsT0FBT0MsUUFBUSxlQUFSLENBQWI7QUFBQSxJQUNNQyxPQUFPRCxRQUFRLGVBQVIsQ0FEYjtBQUFBLElBRU1FLGlCQUFpQkYsUUFBUSxvQkFBUixDQUZ2QjtBQUFBLElBR01HLG9CQUFvQkgsUUFBUSx1QkFBUixDQUgxQjs7SUFLUUksSSxHQUFrQkYsYyxDQUFsQkUsSTtJQUFNQyxPLEdBQVlILGMsQ0FBWkcsTztJQUNOQyxtQyxHQUF3Q0gsaUIsQ0FBeENHLG1DO0lBQ0FDLFEsR0FBb0JSLEksQ0FBcEJRLFE7SUFBVUMsSyxHQUFVVCxJLENBQVZTLEs7SUFDVkMsZ0IsR0FBcUJSLEksQ0FBckJRLGdCOzs7QUFFUixTQUFTQywyQkFBVCxDQUFxQ0MseUJBQXJDLEVBQWdFQyxLQUFoRSxFQUF1RUMsTUFBdkUsRUFBK0VDLEtBQS9FLEVBQXNGQyxNQUF0RixFQUE4RkMsUUFBOUYsRUFBd0c7QUFDdEcsTUFBTUMsWUFBWVIsaUJBQWlCRyxLQUFqQixFQUF3QkMsTUFBeEIsRUFBZ0NDLEtBQWhDLEVBQXVDQyxNQUF2QyxFQUErQ0MsUUFBL0MsQ0FBbEI7O0FBRUEsTUFBSUUsa0JBQWtCZCxLQUFLTyx5QkFBTCxFQUFnQyxDQUFoQyxDQUF0QixDQUhzRyxDQUczQzs7QUFFM0RPLG9CQUFrQkEsZ0JBQWdCQyxHQUFoQixDQUFvQixVQUFTQyxjQUFULEVBQXlCO0FBQzdELFdBQU9ILFVBQVVHLGNBQVYsQ0FBUDtBQUNELEdBRmlCLENBQWxCOztBQUlBRixvQkFBa0JBLGdCQUFnQkMsR0FBaEIsQ0FBb0IsVUFBU0MsY0FBVCxFQUF5QjtBQUM3RCxXQUFPQSxlQUFlQyxLQUFmLENBQXFCLENBQXJCLEVBQXdCLENBQXhCLENBQVAsQ0FENkQsQ0FD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USxDQUF2Qjs7QUFFQXdCLG9CQUFnQnZCLElBQWhCLENBQXFCaEIsU0FBUyxDQUE5QjtBQUNBdUMsb0JBQWdCdkIsSUFBaEIsQ0FBcUJoQixTQUFTLENBQTlCO0FBQ0F1QyxvQkFBZ0J2QixJQUFoQixDQUFxQmhCLFNBQVMsQ0FBOUI7QUFDQXVDLG9CQUFnQnZCLElBQWhCLENBQXFCaEIsU0FBUyxDQUE5QjtBQUNBdUMsb0JBQWdCdkIsSUFBaEIsQ0FBcUJoQixTQUFTLENBQTlCO0FBQ0F1QyxvQkFBZ0J2QixJQUFoQixDQUFxQmhCLFNBQVMsQ0FBOUI7QUFDRDs7QUFFRCxTQUFPdUMsZUFBUDtBQUNEOztBQUVERSxPQUFPQyxPQUFQLEdBQWlCO0FBQ2YvQywrQkFBNkJBLDJCQURkO0FBRWZ1QixrQ0FBZ0NBLDhCQUZqQjtBQUdmViw2QkFBMkJBLHlCQUhaO0FBSWZlLDZCQUEyQkEseUJBSlo7QUFLZmUsNEJBQTBCQTtBQUxYLENBQWpCIiwiZmlsZSI6InZlcnRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgdmVjMyA9IHJlcXVpcmUoJy4uL21hdGhzL3ZlYzMnKSxcbiAgICAgIHZlYzQgPSByZXF1aXJlKCcuLi9tYXRocy92ZWM0JyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgaW1hZ2VNYXBVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvaW1hZ2VNYXAnKTtcblxuY29uc3QgeyBjaG9wLCBmbGF0dGVuIH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgdGV4dHVyZUNvb3JkaW5hdGVEYXRhRnJvbUltYWdlTmFtZXMgfSA9IGltYWdlTWFwVXRpbGl0aWVzLFxuICAgICAgeyBzdWJ0cmFjdCwgY3Jvc3MgfSA9IHZlYzMsXG4gICAgICB7IGNvbXBvc2VUcmFuc2Zvcm0gfSA9IHZlYzQ7XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVZlcnRleFBvc2l0aW9uRGF0YShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgb2Zmc2V0LCByb3RhdGlvbikge1xuICBjb25zdCB0cmFuc2Zvcm0gPSBjb21wb3NlVHJhbnNmb3JtKHdpZHRoLCBoZWlnaHQsIGRlcHRoLCBvZmZzZXQsIHJvdGF0aW9uKTtcblxuICBsZXQgdmVydGV4UG9zaXRpb25zID0gY2hvcChpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLCA0KTsgIC8vL1xuXG4gIHZlcnRleFBvc2l0aW9ucyA9IHZlcnRleFBvc2l0aW9ucy5tYXAoZnVuY3Rpb24odmVydGV4UG9zaXRpb24pIHtcbiAgICByZXR1cm4gdHJhbnNmb3JtKHZlcnRleFBvc2l0aW9uKTtcbiAgfSk7XG5cbiAgdmVydGV4UG9zaXRpb25zID0gdmVydGV4UG9zaXRpb25zLm1hcChmdW5jdGlvbih2ZXJ0ZXhQb3NpdGlvbikge1xuICAgIHJldHVybiB2ZXJ0ZXhQb3NpdGlvbi5zbGljZSgwLCAzKTsgIC8vL1xuICB9KTtcbiAgXG4gIGNvbnN0IHZlcnRleFBvc2l0aW9uRGF0YSA9IGZsYXR0ZW4odmVydGV4UG9zaXRpb25zKTsgXG5cbiAgcmV0dXJuIHZlcnRleFBvc2l0aW9uRGF0YTtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVmVydGV4Q29sb3VyRGF0YShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLCBjb2xvdXIpIHtcbiAgY29uc3QgaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCA9IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEubGVuZ3RoLFxuICAgICAgICB2ZXJ0ZXhDb2xvdXJzTGVuZ3RoID0gaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCAvIDQsICAvLy9cbiAgICAgICAgdmVydGV4Q29sb3VyID0gY29sb3VyLFxuICAgICAgICB2ZXJ0ZXhDb2xvdXJzID0gW107XG5cbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHZlcnRleENvbG91cnNMZW5ndGg7IGluZGV4KyspIHtcbiAgICB2ZXJ0ZXhDb2xvdXJzLnB1c2godmVydGV4Q29sb3VyKTtcbiAgfVxuXG4gIGNvbnN0IHZlcnRleENvbG91ckRhdGEgPSBmbGF0dGVuKHZlcnRleENvbG91cnMpOyAgLy8vXG5cbiAgcmV0dXJuIHZlcnRleENvbG91ckRhdGE7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlRGF0YShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLCBpbWFnZU5hbWUpIHtcbiAgY29uc3QgaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCA9IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEubGVuZ3RoLFxuICAgICAgICBpbWFnZU5hbWVzTGVuZ3RoID0gaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCAvIDE2LCAgLy8vXG4gICAgICAgIGltYWdlTmFtZXMgPSBbXTtcbiAgXG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBpbWFnZU5hbWVzTGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgaW1hZ2VOYW1lcy5wdXNoKGltYWdlTmFtZSk7XG4gIH1cblxuICBjb25zdCB0ZXh0dXJlQ29vcmRpbmF0ZURhdGEgPSB0ZXh0dXJlQ29vcmRpbmF0ZURhdGFGcm9tSW1hZ2VOYW1lcyhpbWFnZU5hbWVzKTtcblxuICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVEYXRhO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVWZXJ0ZXhOb3JtYWxEYXRhKGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEpIHtcbiAgY29uc3QgdmVydGV4Tm9ybWFsVmVjdG9ycyA9IFtdLFxuICAgICAgICBmYWNlcyA9IGNob3AoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSwgMTYpOyAgLy8vXG5cbiAgZmFjZXMuZm9yRWFjaChmdW5jdGlvbihmYWNlKSB7XG4gICAgY29uc3QgdmVydGV4UG9zaXRpb25zID0gY2hvcChmYWNlLCA0KTtcblxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCA0OyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBmaXJzdFZlcnRleEluZGV4ID0gaW5kZXgsXG4gICAgICAgICAgICBzZWNvbmRWZXJ0ZXhJbmRleCA9IChpbmRleCArIDEpICUgNCxcbiAgICAgICAgICAgIHRoaXJkVmVydGV4SW5kZXggPSAoaW5kZXggKyAzKSAlIDQsXG4gICAgICAgICAgICBmaXJzdFZlcnRleFBvc2l0aW9uID0gdmVydGV4UG9zaXRpb25zW2ZpcnN0VmVydGV4SW5kZXhdLFxuICAgICAgICAgICAgc2Vjb25kVmVydGV4UG9zaXRpb24gPSB2ZXJ0ZXhQb3NpdGlvbnNbc2Vjb25kVmVydGV4SW5kZXhdLFxuICAgICAgICAgICAgdGhpcmRWZXJ0ZXhQb3NpdGlvbiA9IHZlcnRleFBvc2l0aW9uc1t0aGlyZFZlcnRleEluZGV4XSxcbiAgICAgICAgICAgIGZpcnN0VmVjdG9yID0gc3VidHJhY3Qoc2Vjb25kVmVydGV4UG9zaXRpb24sIGZpcnN0VmVydGV4UG9zaXRpb24pLCAgLy8vXG4gICAgICAgICAgICBzZWNvbmRWZWN0b3IgPSBzdWJ0cmFjdCh0aGlyZFZlcnRleFBvc2l0aW9uLCBmaXJzdFZlcnRleFBvc2l0aW9uKSwgIC8vL1xuICAgICAgICAgICAgdmVydGV4Tm9ybWFsVmVjdG9yID0gY3Jvc3MoZmlyc3RWZWN0b3IsIHNlY29uZFZlY3Rvcik7XG5cbiAgICAgIHZlcnRleE5vcm1hbFZlY3RvcnMucHVzaCh2ZXJ0ZXhOb3JtYWxWZWN0b3IpO1xuICAgIH1cbiAgfSk7XG4gIFxuICBjb25zdCB2ZXJ0ZXhOb3JtYWxEYXRhID0gZmxhdHRlbih2ZXJ0ZXhOb3JtYWxWZWN0b3JzKTsgLy8vXG5cbiAgcmV0dXJuIHZlcnRleE5vcm1hbERhdGE7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVZlcnRleEluZGV4RGF0YShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhKSB7XG4gIGNvbnN0IHZlcnRleEluZGV4RGF0YSA9IFtdLFxuICAgICAgICBpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoID0gaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YS5sZW5ndGgsXG4gICAgICAgIGZhY2VzTGVuZ3RoID0gaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCAvIDE2OyAvLy9cblxuICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgZmFjZXNMZW5ndGg7IGluZGV4KyspIHtcbiAgICBjb25zdCBvZmZzZXQgPSBpbmRleCAqIDQ7XG5cbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAwKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAxKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAyKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAwKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAyKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAzKTtcbiAgfVxuXG4gIHJldHVybiB2ZXJ0ZXhJbmRleERhdGE7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBjYWxjdWxhdGVWZXJ0ZXhQb3NpdGlvbkRhdGE6IGNhbGN1bGF0ZVZlcnRleFBvc2l0aW9uRGF0YSxcbiAgY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVEYXRhOiBjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZURhdGEsXG4gIGNhbGN1bGF0ZVZlcnRleENvbG91ckRhdGE6IGNhbGN1bGF0ZVZlcnRleENvbG91ckRhdGEsXG4gIGNhbGN1bGF0ZVZlcnRleE5vcm1hbERhdGE6IGNhbGN1bGF0ZVZlcnRleE5vcm1hbERhdGEsXG4gIGNhbGN1bGF0ZVZlcnRleEluZGV4RGF0YTogY2FsY3VsYXRlVmVydGV4SW5kZXhEYXRhXG59O1xuIl19