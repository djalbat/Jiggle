'use strict';

var vec3 = require('../gl/vec3'),
    vec4 = require('../gl/vec4'),
    mat4 = require('../gl/mat4'),
    arrayUtilities = require('../utilities/array');

var dice = arrayUtilities.dice,
    flatten = arrayUtilities.flatten,
    create = mat4.create,
    translate = mat4.translate,
    scale = mat4.scale,
    rotate = mat4.rotate,
    transformMat4 = vec4.transformMat4,
    subtract = vec3.subtract,
    cross = vec3.cross;


var defaultWidth = 1,
    defaultDepth = 1,
    defaultHeight = 1,
    defaultOffset = [0, 0, 0],
    defaultRotation = [0, 0, 0];

function calculateVertexPositionData(initialVertexPositionData) {
  var width = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultWidth;
  var depth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : defaultDepth;
  var height = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : defaultHeight;
  var offset = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : defaultOffset;
  var rotation = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : defaultRotation;

  var mat4 = create(),
      xAngle = rotation[0] * Math.PI / 180,
      yAngle = rotation[1] * Math.PI / 180,
      zAngle = rotation[2] * Math.PI / 180;

  translate(mat4, mat4, offset);

  rotate(mat4, mat4, xAngle, [1, 0, 0]);
  rotate(mat4, mat4, yAngle, [0, 1, 0]);
  rotate(mat4, mat4, zAngle, [0, 0, 1]);

  scale(mat4, mat4, [width, depth, height]);

  var vertexPositions = dice(initialVertexPositionData, 4); ///

  vertexPositions = vertexPositions.map(function (vertexPosition) {
    return transformMat4(vertexPosition, vertexPosition, mat4);
  });

  vertexPositions = vertexPositions.map(function (vertexPosition) {
    return vertexPosition.slice(0, 3);
  });

  var vertexPositionData = flatten(vertexPositions);

  return vertexPositionData;
}

function calculateVertexNormalData(initialVertexPositionData) {
  var vertexNormalVectors = [],
      faces = dice(initialVertexPositionData, 16); ///

  faces.forEach(function (face) {
    var vertexPositions = dice(face, 4);

    for (var index = 0; index < 4; index++) {
      var firstVertexIndex = index,
          secondVertexIndex = (index + 1) % 4,
          thirdVertexIndex = (index + 3) % 4,
          firstVertexPosition = vertexPositions[firstVertexIndex],
          secondVertexPosition = vertexPositions[secondVertexIndex],
          thirdVertexPosition = vertexPositions[thirdVertexIndex],
          firstVector = subtract(secondVertexPosition, firstVertexPosition),
          ///
      secondVector = subtract(thirdVertexPosition, firstVertexPosition),
          ///
      vertexNormalVector = cross(firstVector, secondVector);

      vertexNormalVectors.push(vertexNormalVector);
    }
  });

  var vertexNormalData = flatten(vertexNormalVectors); ///

  return vertexNormalData;
}

function calculateVertexIndexData(initialVertexPositionData) {
  var vertexIndexData = [],
      initialVertexPositionDataLength = initialVertexPositionData.length,
      facesLength = initialVertexPositionDataLength / 16; ///

  for (var index = 0; index < facesLength; index++) {
    var offset = index * 4;

    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 1);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 3);
  }

  return vertexIndexData;
}

module.exports = {
  calculateVertexPositionData: calculateVertexPositionData,
  calculateVertexNormalData: calculateVertexNormalData,
  calculateVertexIndexData: calculateVertexIndexData
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvdmVydGV4LmpzIl0sIm5hbWVzIjpbInZlYzMiLCJyZXF1aXJlIiwidmVjNCIsIm1hdDQiLCJhcnJheVV0aWxpdGllcyIsImRpY2UiLCJmbGF0dGVuIiwiY3JlYXRlIiwidHJhbnNsYXRlIiwic2NhbGUiLCJyb3RhdGUiLCJ0cmFuc2Zvcm1NYXQ0Iiwic3VidHJhY3QiLCJjcm9zcyIsImRlZmF1bHRXaWR0aCIsImRlZmF1bHREZXB0aCIsImRlZmF1bHRIZWlnaHQiLCJkZWZhdWx0T2Zmc2V0IiwiZGVmYXVsdFJvdGF0aW9uIiwiY2FsY3VsYXRlVmVydGV4UG9zaXRpb25EYXRhIiwiaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSIsIndpZHRoIiwiZGVwdGgiLCJoZWlnaHQiLCJvZmZzZXQiLCJyb3RhdGlvbiIsInhBbmdsZSIsIk1hdGgiLCJQSSIsInlBbmdsZSIsInpBbmdsZSIsInZlcnRleFBvc2l0aW9ucyIsIm1hcCIsInZlcnRleFBvc2l0aW9uIiwic2xpY2UiLCJ2ZXJ0ZXhQb3NpdGlvbkRhdGEiLCJjYWxjdWxhdGVWZXJ0ZXhOb3JtYWxEYXRhIiwidmVydGV4Tm9ybWFsVmVjdG9ycyIsImZhY2VzIiwiZm9yRWFjaCIsImZhY2UiLCJpbmRleCIsImZpcnN0VmVydGV4SW5kZXgiLCJzZWNvbmRWZXJ0ZXhJbmRleCIsInRoaXJkVmVydGV4SW5kZXgiLCJmaXJzdFZlcnRleFBvc2l0aW9uIiwic2Vjb25kVmVydGV4UG9zaXRpb24iLCJ0aGlyZFZlcnRleFBvc2l0aW9uIiwiZmlyc3RWZWN0b3IiLCJzZWNvbmRWZWN0b3IiLCJ2ZXJ0ZXhOb3JtYWxWZWN0b3IiLCJwdXNoIiwidmVydGV4Tm9ybWFsRGF0YSIsImNhbGN1bGF0ZVZlcnRleEluZGV4RGF0YSIsInZlcnRleEluZGV4RGF0YSIsImluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGgiLCJsZW5ndGgiLCJmYWNlc0xlbmd0aCIsIm1vZHVsZSIsImV4cG9ydHMi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QixXQUE1QixFQUF5Q2hCLE9BQXpDLEVBQWtEO0FBQ2hELFFBQU1qQixTQUFTaUIsUUFBUSxDQUF2Qjs7QUFFQWEsb0JBQWdCSCxJQUFoQixDQUFxQjNCLFNBQVMsQ0FBOUI7QUFDQThCLG9CQUFnQkgsSUFBaEIsQ0FBcUIzQixTQUFTLENBQTlCO0FBQ0E4QixvQkFBZ0JILElBQWhCLENBQXFCM0IsU0FBUyxDQUE5QjtBQUNBOEIsb0JBQWdCSCxJQUFoQixDQUFxQjNCLFNBQVMsQ0FBOUI7QUFDQThCLG9CQUFnQkgsSUFBaEIsQ0FBcUIzQixTQUFTLENBQTlCO0FBQ0E4QixvQkFBZ0JILElBQWhCLENBQXFCM0IsU0FBUyxDQUE5QjtBQUNEOztBQUVELFNBQU84QixlQUFQO0FBQ0Q7O0FBRURJLE9BQU9DLE9BQVAsR0FBaUI7QUFDZnhDLCtCQUE2QkEsMkJBRGQ7QUFFZmlCLDZCQUEyQkEseUJBRlo7QUFHZmlCLDRCQUEwQkE7QUFIWCxDQUFqQiIsImZpbGUiOiJ2ZXJ0ZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHZlYzMgPSByZXF1aXJlKCcuLi9nbC92ZWMzJyksXG4gICAgICB2ZWM0ID0gcmVxdWlyZSgnLi4vZ2wvdmVjNCcpLFxuICAgICAgbWF0NCA9IHJlcXVpcmUoJy4uL2dsL21hdDQnKSxcbiAgICAgIGFycmF5VXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2FycmF5Jyk7XG5cbmNvbnN0IHsgZGljZSwgZmxhdHRlbiB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IGNyZWF0ZSwgdHJhbnNsYXRlLCBzY2FsZSwgcm90YXRlIH0gPSBtYXQ0LFxuICAgICAgeyB0cmFuc2Zvcm1NYXQ0IH0gPSB2ZWM0LFxuICAgICAgeyBzdWJ0cmFjdCwgY3Jvc3MgfSA9IHZlYzM7XG5cbmNvbnN0IGRlZmF1bHRXaWR0aCA9IDEsXG4gICAgICBkZWZhdWx0RGVwdGggPSAxLFxuICAgICAgZGVmYXVsdEhlaWdodCA9IDEsXG4gICAgICBkZWZhdWx0T2Zmc2V0ID0gWyAwLCAwLCAwIF0sXG4gICAgICBkZWZhdWx0Um90YXRpb24gPSBbIDAsIDAsIDBdO1xuXG5mdW5jdGlvbiBjYWxjdWxhdGVWZXJ0ZXhQb3NpdGlvbkRhdGEoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSwgd2lkdGggPSBkZWZhdWx0V2lkdGgsIGRlcHRoID0gZGVmYXVsdERlcHRoLCBoZWlnaHQgPSBkZWZhdWx0SGVpZ2h0LCBvZmZzZXQgPSBkZWZhdWx0T2Zmc2V0LCByb3RhdGlvbiA9IGRlZmF1bHRSb3RhdGlvbikge1xuICBjb25zdCBtYXQ0ID0gY3JlYXRlKCksXG4gICAgICAgIHhBbmdsZSA9IHJvdGF0aW9uWzBdICogTWF0aC5QSSAvIDE4MCxcbiAgICAgICAgeUFuZ2xlID0gcm90YXRpb25bMV0gKiBNYXRoLlBJIC8gMTgwLFxuICAgICAgICB6QW5nbGUgPSByb3RhdGlvblsyXSAqIE1hdGguUEkgLyAxODA7XG5cbiAgdHJhbnNsYXRlKG1hdDQsIG1hdDQsIG9mZnNldCk7XG5cbiAgcm90YXRlKG1hdDQsIG1hdDQsIHhBbmdsZSwgWzEsIDAsIDBdKTtcbiAgcm90YXRlKG1hdDQsIG1hdDQsIHlBbmdsZSwgWzAsIDEsIDBdKTtcbiAgcm90YXRlKG1hdDQsIG1hdDQsIHpBbmdsZSwgWzAsIDAsIDFdKTtcblxuICBzY2FsZShtYXQ0LCBtYXQ0LCBbd2lkdGgsIGRlcHRoLCBoZWlnaHRdKTtcblxuICBsZXQgdmVydGV4UG9zaXRpb25zID0gZGljZShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLCA0KTsgIC8vL1xuXG4gIHZlcnRleFBvc2l0aW9ucyA9IHZlcnRleFBvc2l0aW9ucy5tYXAoZnVuY3Rpb24odmVydGV4UG9zaXRpb24pIHtcbiAgICByZXR1cm4gdHJhbnNmb3JtTWF0NCh2ZXJ0ZXhQb3NpdGlvbiwgdmVydGV4UG9zaXRpb24sIG1hdDQpO1xuICB9KTtcblxuICB2ZXJ0ZXhQb3NpdGlvbnMgPSB2ZXJ0ZXhQb3NpdGlvbnMubWFwKGZ1bmN0aW9uKHZlcnRleFBvc2l0aW9uKSB7XG4gICAgcmV0dXJuIHZlcnRleFBvc2l0aW9uLnNsaWNlKDAsIDMpO1xuICB9KTtcbiAgXG4gIGNvbnN0IHZlcnRleFBvc2l0aW9uRGF0YSA9IGZsYXR0ZW4odmVydGV4UG9zaXRpb25zKTsgXG5cbiAgcmV0dXJuIHZlcnRleFBvc2l0aW9uRGF0YTtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVmVydGV4Tm9ybWFsRGF0YShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhKSB7XG4gIGNvbnN0IHZlcnRleE5vcm1hbFZlY3RvcnMgPSBbXSxcbiAgICAgICAgZmFjZXMgPSBkaWNlKGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEsIDE2KTsgIC8vL1xuXG4gIGZhY2VzLmZvckVhY2goZnVuY3Rpb24oZmFjZSkge1xuICAgIGNvbnN0IHZlcnRleFBvc2l0aW9ucyA9IGRpY2UoZmFjZSwgNCk7XG5cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgNDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZmlyc3RWZXJ0ZXhJbmRleCA9IGluZGV4LFxuICAgICAgICAgICAgc2Vjb25kVmVydGV4SW5kZXggPSAoaW5kZXggKyAxKSAlIDQsXG4gICAgICAgICAgICB0aGlyZFZlcnRleEluZGV4ID0gKGluZGV4ICsgMykgJSA0LFxuICAgICAgICAgICAgZmlyc3RWZXJ0ZXhQb3NpdGlvbiA9IHZlcnRleFBvc2l0aW9uc1tmaXJzdFZlcnRleEluZGV4XSxcbiAgICAgICAgICAgIHNlY29uZFZlcnRleFBvc2l0aW9uID0gdmVydGV4UG9zaXRpb25zW3NlY29uZFZlcnRleEluZGV4XSxcbiAgICAgICAgICAgIHRoaXJkVmVydGV4UG9zaXRpb24gPSB2ZXJ0ZXhQb3NpdGlvbnNbdGhpcmRWZXJ0ZXhJbmRleF0sXG4gICAgICAgICAgICBmaXJzdFZlY3RvciA9IHN1YnRyYWN0KHNlY29uZFZlcnRleFBvc2l0aW9uLCBmaXJzdFZlcnRleFBvc2l0aW9uKSwgIC8vL1xuICAgICAgICAgICAgc2Vjb25kVmVjdG9yID0gc3VidHJhY3QodGhpcmRWZXJ0ZXhQb3NpdGlvbiwgZmlyc3RWZXJ0ZXhQb3NpdGlvbiksICAvLy9cbiAgICAgICAgICAgIHZlcnRleE5vcm1hbFZlY3RvciA9IGNyb3NzKGZpcnN0VmVjdG9yLCBzZWNvbmRWZWN0b3IpO1xuXG4gICAgICB2ZXJ0ZXhOb3JtYWxWZWN0b3JzLnB1c2godmVydGV4Tm9ybWFsVmVjdG9yKTtcbiAgICB9XG4gIH0pO1xuICBcbiAgY29uc3QgdmVydGV4Tm9ybWFsRGF0YSA9IGZsYXR0ZW4odmVydGV4Tm9ybWFsVmVjdG9ycyk7IC8vL1xuXG4gIHJldHVybiB2ZXJ0ZXhOb3JtYWxEYXRhO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVWZXJ0ZXhJbmRleERhdGEoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSkge1xuICBjb25zdCB2ZXJ0ZXhJbmRleERhdGEgPSBbXSxcbiAgICAgICAgaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCA9IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEubGVuZ3RoLFxuICAgICAgICBmYWNlc0xlbmd0aCA9IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGggLyAxNjsgLy8vXG5cbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGZhY2VzTGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgY29uc3Qgb2Zmc2V0ID0gaW5kZXggKiA0O1xuXG4gICAgdmVydGV4SW5kZXhEYXRhLnB1c2gob2Zmc2V0ICsgMCk7XG4gICAgdmVydGV4SW5kZXhEYXRhLnB1c2gob2Zmc2V0ICsgMSk7XG4gICAgdmVydGV4SW5kZXhEYXRhLnB1c2gob2Zmc2V0ICsgMik7XG4gICAgdmVydGV4SW5kZXhEYXRhLnB1c2gob2Zmc2V0ICsgMCk7XG4gICAgdmVydGV4SW5kZXhEYXRhLnB1c2gob2Zmc2V0ICsgMik7XG4gICAgdmVydGV4SW5kZXhEYXRhLnB1c2gob2Zmc2V0ICsgMyk7XG4gIH1cblxuICByZXR1cm4gdmVydGV4SW5kZXhEYXRhO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgY2FsY3VsYXRlVmVydGV4UG9zaXRpb25EYXRhOiBjYWxjdWxhdGVWZXJ0ZXhQb3NpdGlvbkRhdGEsXG4gIGNhbGN1bGF0ZVZlcnRleE5vcm1hbERhdGE6IGNhbGN1bGF0ZVZlcnRleE5vcm1hbERhdGEsXG4gIGNhbGN1bGF0ZVZlcnRleEluZGV4RGF0YTogY2FsY3VsYXRlVmVydGV4SW5kZXhEYXRhXG59O1xuIl19