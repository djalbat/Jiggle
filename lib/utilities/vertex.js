'use strict';

var vec3 = require('../maths/vec3'),
    arrayUtilities = require('../utilities/array'),
    imageMapUtilities = require('../utilities/imageMap'),
    transformUtilities = require('../utilities/transform');

var textureCoordinatesFromImageNames = imageMapUtilities.textureCoordinatesFromImageNames,
    composeScaleRotateTranslate = transformUtilities.composeScaleRotateTranslate,
    chop = arrayUtilities.chop,
    flatten = arrayUtilities.flatten,
    subtract = vec3.subtract,
    cross = vec3.cross,
    normalise = vec3.normalise;


function calculateVertexPositionData(initialVertexPositionData, width, height, depth, offset, rotations) {
  var initialVertexPositions = chop(initialVertexPositionData, 3),
      ///
  scaleRotateTranslate = composeScaleRotateTranslate(width, height, depth, offset, rotations),
      vertexPositions = initialVertexPositions.map(function (initialVertexPosition) {
    var vertexPosition = scaleRotateTranslate(initialVertexPosition);

    return vertexPosition;
  }),
      vertexPositionData = flatten(vertexPositions);

  return vertexPositionData;
}

function calculateVertexNormalData(vertexPositionData) {
  var faces = chop(vertexPositionData, 12),
      ///
  vertexNormals = faces.reduce(function (vertexNormals, face) {
    var vertexPositions = chop(face, 3);

    for (var index = 0; index < 4; index++) {
      var firstVertexIndex = index,
          secondVertexIndex = (index + 1) % 4,
          thirdVertexIndex = (index + 3) % 4,
          firstVertexPosition = vertexPositions[firstVertexIndex],
          secondVertexPosition = vertexPositions[secondVertexIndex],
          thirdVertexPosition = vertexPositions[thirdVertexIndex],
          firstVector = subtract(secondVertexPosition, firstVertexPosition),
          secondVector = subtract(thirdVertexPosition, firstVertexPosition),
          vertexNormal = normalise(cross(firstVector, secondVector));

      vertexNormals.push(vertexNormal);
    }

    return vertexNormals;
  }, []),
      vertexNormalData = flatten(vertexNormals); ///

  return vertexNormalData;
}

function calculateVertexIndexData(initialVertexPositionData) {
  var vertexIndexData = [],
      initialVertexPositionDataLength = initialVertexPositionData.length,
      facesLength = initialVertexPositionDataLength / 12; ///

  for (var index = 0; index < facesLength; index++) {
    var offset = index * 4;

    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 1);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 3);
  }

  return vertexIndexData;
}

function calculateVertexColourData(initialVertexPositionData, colour) {
  var initialVertexPositionDataLength = initialVertexPositionData.length,
      vertexColoursLength = initialVertexPositionDataLength / 3,
      ///
  vertexColour = colour,
      vertexColours = [];

  for (var index = 0; index < vertexColoursLength; index++) {
    vertexColours.push(vertexColour);
  }

  var vertexColourData = flatten(vertexColours); ///

  return vertexColourData;
}

function calculateTextureCoordinateData(initialVertexPositionData, imageName) {
  var initialVertexPositionDataLength = initialVertexPositionData.length,
      imageNamesLength = initialVertexPositionDataLength / 12,
      ///
  imageNames = [];

  for (var index = 0; index < imageNamesLength; index++) {
    imageNames.push(imageName);
  }

  var textureCoordinates = textureCoordinatesFromImageNames(imageNames),
      textureCoordinateData = flatten(textureCoordinates);

  return textureCoordinateData;
}

module.exports = {
  calculateVertexPositionData: calculateVertexPositionData,
  calculateVertexNormalData: calculateVertexNormalData,
  calculateVertexIndexData: calculateVertexIndexData,
  calculateVertexColourData: calculateVertexColourData,
  calculateTextureCoordinateData: calculateTextureCoordinateData
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvdmVydGV4LmpzIl0sIm5hbWVzIjpbInZlYzMiLCJyZXF1aXJlIiwiYXJyYXlVdGlsaXRpZXMiLCJpbWFnZU1hcFV0aWxpdGllcyIsInRyYW5zZm9ybVV0aWxpdGllcyIsInRleHR1cmVDb29yZGluYXRlc0Zyb21JbWFnZU5hbWVzIiwiY29tcG9zZVNjYWxlUm90YXRlVHJhbnNsYXRlIiwiY2hvcCIsImZsYXR0ZW4iLCJzdWJ0cmFjdCIsImNyb3NzIiwibm9ybWFsaXNlIiwiY2FsY3VsYXRlVmVydGV4UG9zaXRpb25EYXRhIiwiaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSIsIndpZHRoIiwiaGVpZ2h0IiwiZGVwdGgiLCJvZmZzZXQiLCJyb3RhdGlvbnMiLCJpbml0aWFsVmVydGV4UG9zaXRpb25zIiwic2NhbGVSb3RhdGVUcmFuc2xhdGUiLCJ2ZXJ0ZXhQb3NpdGlvbnMiLCJtYXAiLCJpbml0aWFsVmVydGV4UG9zaXRpb24iLCJ2ZXJ0ZXhQb3NpdGlvbiIsInZlcnRleFBvc2l0aW9uRGF0YSIsImNhbGN1bGF0ZVZlcnRleE5vcm1hbERhdGEiLCJmYWNlcyIsInZlcnRleE5vcm1hbHMiLCJyZWR1Y2UiLCJmYWNlIiwiaW5kZXgiLCJmaXJzdFZlcnRleEluZGV4Iiwic2Vjb25kVmVydGV4SW5kZXgiLCJ0aGlyZFZlcnRleEluZGV4IiwiZmlyc3RWZXJ0ZXhQb3NpdGlvbiIsInNlY29uZFZlcnRleFBvc2l0aW9uIiwidGhpcmRWZXJ0ZXhQb3NpdGlvbiIsImZpcnN0VmVjdG9yIiwic2Vjb25kVmVjdG9yIiwidmVydGV4Tm9ybWFsIiwicHVzaCIsInZlcnRleE5vcm1hbERhdGEiLCJjYWxjdWxhdGVWZXJ0ZXhJbmRleERhdGEiLCJ2ZXJ0ZXhJbmRleERhdGEiLCJpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoIiwibGVuZ3RoIiwiZmFjZXNMZW5ndGgiLCJjYWxjdWxhdGVWZXJ0ZXhDb2xvdXJEYXRhIiwiY29sb3VyIiwidmVydGV4Q29sb3Vyc0xlbmd0aCIsInZlcnRleENvbG91ciIsInZlcnRleENvbG91cnMiLCJ2ZXJ0ZXhDb2xvdXJEYXRhIiwiY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVEYXRhIiwiaW1hZ2VOYW1lIiwiaW1hZ2VOYW1lc0xlbmd0aCIsImltYWdlTmFtZXMiLCJ0ZXh0dXJlQ29vcmRpbmF0ZXMiLCJ0ZXh0dXJlQ29vcmRpbmF0ZURhdGEiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxPQUFPQyxRQUFRLGVBQVIsQ0FBYjtBQUFBLElBQ01DLGlCQUFpQkQsUUFBUSxvQkFBUixDQUR2QjtBQUFBLElBRU1FLG9CQUFvQkYsUUFBUSx1QkFBUixDQUYxQjtBQUFBLElBR01HLHFCQUFxQkgsUUFBUSx3QkFBUixDQUgzQjs7QUFLTSxJQUFFSSxnQ0FBRixHQUF1Q0YsaUJBQXZDLENBQUVFLGdDQUFGO0FBQUEsSUFDRUMsMkJBREYsR0FDa0NGLGtCQURsQyxDQUNFRSwyQkFERjtBQUFBLElBRUVDLElBRkYsR0FFb0JMLGNBRnBCLENBRUVLLElBRkY7QUFBQSxJQUVRQyxPQUZSLEdBRW9CTixjQUZwQixDQUVRTSxPQUZSO0FBQUEsSUFHRUMsUUFIRixHQUdpQ1QsSUFIakMsQ0FHRVMsUUFIRjtBQUFBLElBR1lDLEtBSFosR0FHaUNWLElBSGpDLENBR1lVLEtBSFo7QUFBQSxJQUdtQkMsU0FIbkIsR0FHaUNYLElBSGpDLENBR21CVyxTQUhuQjs7O0FBS04sU0FBU0MsMkJBQVQsQ0FBcUNDLHlCQUFyQyxFQUFnRUMsS0FBaEUsRUFBdUVDLE1BQXZFLEVBQStFQyxLQUEvRSxFQUFzRkMsTUFBdEYsRUFBOEZDLFNBQTlGLEVBQXlHO0FBQ3ZHLE1BQU1DLHlCQUF5QlosS0FBS00seUJBQUwsRUFBZ0MsQ0FBaEMsQ0FBL0I7QUFBQSxNQUFvRTtBQUM5RE8seUJBQXVCZCw0QkFBNEJRLEtBQTVCLEVBQW1DQyxNQUFuQyxFQUEyQ0MsS0FBM0MsRUFBa0RDLE1BQWxELEVB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a0JBQWNYLElBQWQsQ0FBbUJVLFlBQW5CO0FBQ0Q7O0FBRUQsTUFBTUUsbUJBQW1CN0MsUUFBUTRDLGFBQVIsQ0FBekIsQ0FWb0UsQ0FVbEI7O0FBRWxELFNBQU9DLGdCQUFQO0FBQ0Q7O0FBRUQsU0FBU0MsOEJBQVQsQ0FBd0N6Qyx5QkFBeEMsRUFBbUUwQyxTQUFuRSxFQUE4RTtBQUM1RSxNQUFNVixrQ0FBa0NoQywwQkFBMEJpQyxNQUFsRTtBQUFBLE1BQ01VLG1CQUFtQlgsa0NBQWtDLEVBRDNEO0FBQUEsTUFDZ0U7QUFDMURZLGVBQWEsRUFGbkI7O0FBSUEsT0FBSyxJQUFJMUIsUUFBUSxDQUFqQixFQUFvQkEsUUFBUXlCLGdCQUE1QixFQUE4Q3pCLE9BQTlDLEVBQXVEO0FBQ3JEMEIsZUFBV2hCLElBQVgsQ0FBZ0JjLFNBQWhCO0FBQ0Q7O0FBRUQsTUFBTUcscUJBQXFCckQsaUNBQWlDb0QsVUFBakMsQ0FBM0I7QUFBQSxNQUNNRSx3QkFBd0JuRCxRQUFRa0Qsa0JBQVIsQ0FEOUI7O0FBR0EsU0FBT0MscUJBQVA7QUFDRDs7QUFFREMsT0FBT0MsT0FBUCxHQUFpQjtBQUNmakQsK0JBQTZCQSwyQkFEZDtBQUVmYyw2QkFBMkJBLHlCQUZaO0FBR2ZpQiw0QkFBMEJBLHdCQUhYO0FBSWZLLDZCQUEyQkEseUJBSlo7QUFLZk0sa0NBQWdDQTtBQUxqQixDQUFqQiIsImZpbGUiOiJ2ZXJ0ZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHZlYzMgPSByZXF1aXJlKCcuLi9tYXRocy92ZWMzJyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgaW1hZ2VNYXBVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvaW1hZ2VNYXAnKSxcbiAgICAgIHRyYW5zZm9ybVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy90cmFuc2Zvcm0nKTtcblxuY29uc3QgeyB0ZXh0dXJlQ29vcmRpbmF0ZXNGcm9tSW1hZ2VOYW1lcyB9ID0gaW1hZ2VNYXBVdGlsaXRpZXMsXG4gICAgICB7IGNvbXBvc2VTY2FsZVJvdGF0ZVRyYW5zbGF0ZSB9ID0gdHJhbnNmb3JtVXRpbGl0aWVzLFxuICAgICAgeyBjaG9wLCBmbGF0dGVuIH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgc3VidHJhY3QsIGNyb3NzLCBub3JtYWxpc2UgfSA9IHZlYzM7XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVZlcnRleFBvc2l0aW9uRGF0YShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgb2Zmc2V0LCByb3RhdGlvbnMpIHtcbiAgY29uc3QgaW5pdGlhbFZlcnRleFBvc2l0aW9ucyA9IGNob3AoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSwgMyksICAvLy9cbiAgICAgICAgc2NhbGVSb3RhdGVUcmFuc2xhdGUgPSBjb21wb3NlU2NhbGVSb3RhdGVUcmFuc2xhdGUod2lkdGgsIGhlaWdodCwgZGVwdGgsIG9mZnNldCwgcm90YXRpb25zKSxcbiAgICAgICAgdmVydGV4UG9zaXRpb25zID0gaW5pdGlhbFZlcnRleFBvc2l0aW9ucy5tYXAoZnVuY3Rpb24oaW5pdGlhbFZlcnRleFBvc2l0aW9uKSB7XG4gICAgICAgICAgY29uc3QgdmVydGV4UG9zaXRpb24gPSBzY2FsZVJvdGF0ZVRyYW5zbGF0ZShpbml0aWFsVmVydGV4UG9zaXRpb24pO1xuICBcbiAgICAgICAgICByZXR1cm4gdmVydGV4UG9zaXRpb247XG4gICAgICAgIH0pLFxuICAgICAgICB2ZXJ0ZXhQb3NpdGlvbkRhdGEgPSBmbGF0dGVuKHZlcnRleFBvc2l0aW9ucyk7XG5cbiAgcmV0dXJuIHZlcnRleFBvc2l0aW9uRGF0YTtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVmVydGV4Tm9ybWFsRGF0YSh2ZXJ0ZXhQb3NpdGlvbkRhdGEpIHtcbiAgY29uc3QgZmFjZXMgPSBjaG9wKHZlcnRleFBvc2l0aW9uRGF0YSwgMTIpLCAgLy8vXG4gICAgICAgIHZlcnRleE5vcm1hbHMgPSBmYWNlcy5yZWR1Y2UoZnVuY3Rpb24odmVydGV4Tm9ybWFscywgZmFjZSkge1xuICAgICAgICAgIGNvbnN0IHZlcnRleFBvc2l0aW9ucyA9IGNob3AoZmFjZSwgMyk7XG5cbiAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgNDsgaW5kZXgrKykge1xuICAgICAgICAgICAgY29uc3QgZmlyc3RWZXJ0ZXhJbmRleCA9IGluZGV4LFxuICAgICAgICAgICAgICAgICAgc2Vjb25kVmVydGV4SW5kZXggPSAoaW5kZXggKyAxKSAlIDQsXG4gICAgICAgICAgICAgICAgICB0aGlyZFZlcnRleEluZGV4ID0gKGluZGV4ICsgMykgJSA0LFxuICAgICAgICAgICAgICAgICAgZmlyc3RWZXJ0ZXhQb3NpdGlvbiA9IHZlcnRleFBvc2l0aW9uc1tmaXJzdFZlcnRleEluZGV4XSxcbiAgICAgICAgICAgICAgICAgIHNlY29uZFZlcnRleFBvc2l0aW9uID0gdmVydGV4UG9zaXRpb25zW3NlY29uZFZlcnRleEluZGV4XSxcbiAgICAgICAgICAgICAgICAgIHRoaXJkVmVydGV4UG9zaXRpb24gPSB2ZXJ0ZXhQb3NpdGlvbnNbdGhpcmRWZXJ0ZXhJbmRleF0sXG4gICAgICAgICAgICAgICAgICBmaXJzdFZlY3RvciA9IHN1YnRyYWN0KHNlY29uZFZlcnRleFBvc2l0aW9uLCBmaXJzdFZlcnRleFBvc2l0aW9uKSxcbiAgICAgICAgICAgICAgICAgIHNlY29uZFZlY3RvciA9IHN1YnRyYWN0KHRoaXJkVmVydGV4UG9zaXRpb24sIGZpcnN0VmVydGV4UG9zaXRpb24pLFxuICAgICAgICAgICAgICAgICAgdmVydGV4Tm9ybWFsID0gbm9ybWFsaXNlKGNyb3NzKGZpcnN0VmVjdG9yLCBzZWNvbmRWZWN0b3IpKTtcblxuICAgICAgICAgICAgdmVydGV4Tm9ybWFscy5wdXNoKHZlcnRleE5vcm1hbCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHZlcnRleE5vcm1hbHM7XG4gICAgICAgIH0sIFtdKSxcbiAgICAgICAgdmVydGV4Tm9ybWFsRGF0YSA9IGZsYXR0ZW4odmVydGV4Tm9ybWFscyk7IC8vL1xuXG4gIHJldHVybiB2ZXJ0ZXhOb3JtYWxEYXRhO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVWZXJ0ZXhJbmRleERhdGEoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSkge1xuICBjb25zdCB2ZXJ0ZXhJbmRleERhdGEgPSBbXSxcbiAgICAgICAgaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCA9IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEubGVuZ3RoLFxuICAgICAgICBmYWNlc0xlbmd0aCA9IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGggLyAxMjsgLy8vXG5cbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGZhY2VzTGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgY29uc3Qgb2Zmc2V0ID0gaW5kZXggKiA0O1xuXG4gICAgdmVydGV4SW5kZXhEYXRhLnB1c2gob2Zmc2V0ICsgMCk7XG4gICAgdmVydGV4SW5kZXhEYXRhLnB1c2gob2Zmc2V0ICsgMSk7XG4gICAgdmVydGV4SW5kZXhEYXRhLnB1c2gob2Zmc2V0ICsgMik7XG4gICAgdmVydGV4SW5kZXhEYXRhLnB1c2gob2Zmc2V0ICsgMCk7XG4gICAgdmVydGV4SW5kZXhEYXRhLnB1c2gob2Zmc2V0ICsgMik7XG4gICAgdmVydGV4SW5kZXhEYXRhLnB1c2gob2Zmc2V0ICsgMyk7XG4gIH1cblxuICByZXR1cm4gdmVydGV4SW5kZXhEYXRhO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVWZXJ0ZXhDb2xvdXJEYXRhKGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEsIGNvbG91cikge1xuICBjb25zdCBpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoID0gaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YS5sZW5ndGgsXG4gICAgICAgIHZlcnRleENvbG91cnNMZW5ndGggPSBpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoIC8gMywgIC8vL1xuICAgICAgICB2ZXJ0ZXhDb2xvdXIgPSBjb2xvdXIsXG4gICAgICAgIHZlcnRleENvbG91cnMgPSBbXTtcblxuICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdmVydGV4Q29sb3Vyc0xlbmd0aDsgaW5kZXgrKykge1xuICAgIHZlcnRleENvbG91cnMucHVzaCh2ZXJ0ZXhDb2xvdXIpO1xuICB9XG5cbiAgY29uc3QgdmVydGV4Q29sb3VyRGF0YSA9IGZsYXR0ZW4odmVydGV4Q29sb3Vycyk7ICAvLy9cblxuICByZXR1cm4gdmVydGV4Q29sb3VyRGF0YTtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVEYXRhKGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGEsIGltYWdlTmFtZSkge1xuICBjb25zdCBpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoID0gaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YS5sZW5ndGgsXG4gICAgICAgIGltYWdlTmFtZXNMZW5ndGggPSBpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoIC8gMTIsICAvLy9cbiAgICAgICAgaW1hZ2VOYW1lcyA9IFtdO1xuXG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBpbWFnZU5hbWVzTGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgaW1hZ2VOYW1lcy5wdXNoKGltYWdlTmFtZSk7XG4gIH1cblxuICBjb25zdCB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQ29vcmRpbmF0ZXNGcm9tSW1hZ2VOYW1lcyhpbWFnZU5hbWVzKSxcbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVEYXRhID0gZmxhdHRlbih0ZXh0dXJlQ29vcmRpbmF0ZXMpO1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZURhdGE7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBjYWxjdWxhdGVWZXJ0ZXhQb3NpdGlvbkRhdGE6IGNhbGN1bGF0ZVZlcnRleFBvc2l0aW9uRGF0YSxcbiAgY2FsY3VsYXRlVmVydGV4Tm9ybWFsRGF0YTogY2FsY3VsYXRlVmVydGV4Tm9ybWFsRGF0YSxcbiAgY2FsY3VsYXRlVmVydGV4SW5kZXhEYXRhOiBjYWxjdWxhdGVWZXJ0ZXhJbmRleERhdGEsXG4gIGNhbGN1bGF0ZVZlcnRleENvbG91ckRhdGE6IGNhbGN1bGF0ZVZlcnRleENvbG91ckRhdGEsXG4gIGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlRGF0YTogY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVEYXRhXG59O1xuIl19