'use strict';

var vec3 = require('../maths/vec3'),
    arrayUtilities = require('../utilities/array'),
    imageMapUtilities = require('../utilities/imageMap'),
    transformUtilities = require('../utilities/transform');

var textureCoordinatesFromImageNames = imageMapUtilities.textureCoordinatesFromImageNames,
    composeTransforms = transformUtilities.composeTransforms,
    chop = arrayUtilities.chop,
    flatten = arrayUtilities.flatten,
    subtract = vec3.subtract,
    cross = vec3.cross,
    normalise = vec3.normalise;


function calculateVertexPositionData(initialVertexPositionData, width, height, depth, dimensions, position, rotations, transformations) {
  var initialVertexPositions = chop(initialVertexPositionData, 3),
      ///
  transforms = composeTransforms(width, height, depth, dimensions, position, rotations, transformations),
      vertexPositions = initialVertexPositions.map(function (initialVertexPosition) {
    var vertexPosition = initialVertexPosition;

    transforms.forEach(function (transform) {
      vertexPosition = transform(vertexPosition);
    });

    return vertexPosition;
  }),
      vertexPositionData = flatten(vertexPositions);

  return vertexPositionData;
}

function calculateVertexNormalData(vertexPositionData) {
  var faces = chop(vertexPositionData, 12),
      ///
  vertexNormals = faces.reduce(function (vertexNormals, face) {
    var vertexPositions = chop(face, 3);

    for (var index = 0; index < 4; index++) {
      var firstVertexIndex = index,
          secondVertexIndex = (index + 1) % 4,
          thirdVertexIndex = (index + 3) % 4,
          firstVertexPosition = vertexPositions[firstVertexIndex],
          secondVertexPosition = vertexPositions[secondVertexIndex],
          thirdVertexPosition = vertexPositions[thirdVertexIndex],
          firstVector = subtract(secondVertexPosition, firstVertexPosition),
          secondVector = subtract(thirdVertexPosition, firstVertexPosition),
          vertexNormal = normalise(cross(firstVector, secondVector));

      vertexNormals.push(vertexNormal);
    }

    return vertexNormals;
  }, []),
      vertexNormalData = flatten(vertexNormals); ///

  return vertexNormalData;
}

function calculateVertexIndexData(initialVertexPositionData) {
  var vertexIndexData = [],
      initialVertexPositionDataLength = initialVertexPositionData.length,
      facesLength = initialVertexPositionDataLength / 12; ///

  for (var index = 0; index < facesLength; index++) {
    var offset = index * 4;

    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 1);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 3);
  }

  return vertexIndexData;
}

function calculateVertexColourData(initialVertexPositionData, colour) {
  var initialVertexPositionDataLength = initialVertexPositionData.length,
      vertexColoursLength = initialVertexPositionDataLength / 3,
      ///
  vertexColour = colour,
      vertexColours = [];

  for (var index = 0; index < vertexColoursLength; index++) {
    vertexColours.push(vertexColour);
  }

  var vertexColourData = flatten(vertexColours); ///

  return vertexColourData;
}

function calculateTextureCoordinateData(initialVertexPositionData, imageName) {
  var initialVertexPositionDataLength = initialVertexPositionData.length,
      imageNamesLength = initialVertexPositionDataLength / 12,
      ///
  imageNames = [];

  for (var index = 0; index < imageNamesLength; index++) {
    imageNames.push(imageName);
  }

  var textureCoordinates = textureCoordinatesFromImageNames(imageNames),
      textureCoordinateData = flatten(textureCoordinates);

  return textureCoordinateData;
}

module.exports = {
  calculateVertexPositionData: calculateVertexPositionData,
  calculateVertexNormalData: calculateVertexNormalData,
  calculateVertexIndexData: calculateVertexIndexData,
  calculateVertexColourData: calculateVertexColourData,
  calculateTextureCoordinateData: calculateTextureCoordinateData
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvdmVydGV4LmpzIl0sIm5hbWVzIjpbInZlYzMiLCJyZXF1aXJlIiwiYXJyYXlVdGlsaXRpZXMiLCJpbWFnZU1hcFV0aWxpdGllcyIsInRyYW5zZm9ybVV0aWxpdGllcyIsInRleHR1cmVDb29yZGluYXRlc0Zyb21JbWFnZU5hbWVzIiwiY29tcG9zZVRyYW5zZm9ybXMiLCJjaG9wIiwiZmxhdHRlbiIsInN1YnRyYWN0IiwiY3Jvc3MiLCJub3JtYWxpc2UiLCJjYWxjdWxhdGVWZXJ0ZXhQb3NpdGlvbkRhdGEiLCJpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhIiwid2lkdGgiLCJoZWlnaHQiLCJkZXB0aCIsImRpbWVuc2lvbnMiLCJwb3NpdGlvbiIsInJvdGF0aW9ucyIsInRyYW5zZm9ybWF0aW9ucyIsImluaXRpYWxWZXJ0ZXhQb3NpdGlvbnMiLCJ0cmFuc2Zvcm1zIiwidmVydGV4UG9zaXRpb25zIiwibWFwIiwiaW5pdGlhbFZlcnRleFBvc2l0aW9uIiwidmVydGV4UG9zaXRpb24iLCJmb3JFYWNoIiwidHJhbnNmb3JtIiwidmVydGV4UG9zaXRpb25EYXRhIiwiY2FsY3VsYXRlVmVydGV4Tm9ybWFsRGF0YSIsImZhY2VzIiwidmVydGV4Tm9ybWFscyIsInJlZHVjZSIsImZhY2UiLCJpbmRleCIsImZpcnN0VmVydGV4SW5kZXgiLCJzZWNvbmRWZXJ0ZXhJbmRleCIsInRoaXJkVmVydGV4SW5kZXgiLCJmaXJzdFZlcnRleFBvc2l0aW9uIiwic2Vjb25kVmVydGV4UG9zaXRpb24iLCJ0aGlyZFZlcnRleFBvc2l0aW9uIiwiZmlyc3RWZWN0b3IiLCJzZWNvbmRWZWN0b3IiLCJ2ZXJ0ZXhOb3JtYWwiLCJwdXNoIiwidmVydGV4Tm9ybWFsRGF0YSIsImNhbGN1bGF0ZVZlcnRleEluZGV4RGF0YSIsInZlcnRleEluZGV4RGF0YSIsImluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGgiLCJsZW5ndGgiLCJmYWNlc0xlbmd0aCIsIm9mZnNldCIsImNhbGN1bGF0ZVZlcnRleENvbG91ckRhdGEiLCJjb2xvdXIiLCJ2ZXJ0ZXhDb2xvdXJzTGVuZ3RoIiwidmVydGV4Q29sb3VyIiwidmVydGV4Q29sb3VycyIsInZlcnRleENvbG91ckRhdGEiLCJjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZURhdGEiLCJpbWFnZU5hbWUiLCJpbWFnZU5hbWVzTGVuZ3RoIiwiaW1hZ2VOYW1lcyIsInRleHR1cmVDb29yZGluYXRlcyIsInRleHR1cmVDb29yZGluYXRlRGF0YSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQU1BLE9BQU9DLFFBQVEsZUFBUixDQUFiO0FBQUEsSUFDTUMsaUJBQWlCRCxRQUFRLG9CQUFSLENBRHZCO0FBQUEsSUFFTUUsb0JBQW9CRixRQUFRLHVCQUFSLENBRjFCO0FBQUEsSUFHTUcscUJBQXFCSCxRQUFRLHdCQUFSLENBSDNCOztBQUtNLElBQUVJLGdDQUFGLEdBQXVDRixpQkFBdkMsQ0FBRUUsZ0NBQUY7QUFBQSxJQUNFQyxpQkFERixHQUN3QkYsa0JBRHhCLENBQ0VFLGlCQURGO0FBQUEsSUFFRUMsSUFGRixHQUVvQkwsY0FGcEIsQ0FFRUssSUFGRjtBQUFBLElBRVFDLE9BRlIsR0FFb0JOLGNBRnBCLENBRVFNLE9BRlI7QUFBQSxJQUdFQyxRQUhGLEdBR2lDVCxJQUhqQyxDQUdFUyxRQUhGO0FBQUEsSUFHWUMsS0FIWixHQUdpQ1YsSUFIakMsQ0FHWVUsS0FIWjtBQUFBLElBR21CQyxTQUhuQixHQUdpQ1gsSUFIakMsQ0FHbUJXLFNBSG5COzs7QUFLTixTQUFTQywyQkFBVCxDQUFxQ0MseUJBQXJDLEVBQWdFQyxLQUFoRSxFQUF1RUMsTUFBdkUsRUFBK0VDLEtBQS9FLEVBQXNGQyxVQUF0RixFQUFrR0MsUUFBbEcsRUFBNEdDLFNBQTVHLEVBQXVIQyxlQUF2SCxFQUF3STtBQUN0SSxNQUFNQyx5QkFBeUJkLEtBQUtNLHlCQUFMLEVBQWdDLENBQWhDLENBQS9CO0FBQUEsTUFBb0U7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TUssc0JBQXNCTixrQ0FBa0MsQ0FEOUQ7QUFBQSxNQUNrRTtBQUM1RE8saUJBQWVGLE1BRnJCO0FBQUEsTUFHTUcsZ0JBQWdCLEVBSHRCOztBQUtBLE9BQUssSUFBSXRCLFFBQVEsQ0FBakIsRUFBb0JBLFFBQVFvQixtQkFBNUIsRUFBaURwQixPQUFqRCxFQUEwRDtBQUN4RHNCLGtCQUFjWixJQUFkLENBQW1CVyxZQUFuQjtBQUNEOztBQUVELE1BQU1FLG1CQUFtQmxELFFBQVFpRCxhQUFSLENBQXpCLENBVm9FLENBVWxCOztBQUVsRCxTQUFPQyxnQkFBUDtBQUNEOztBQUVELFNBQVNDLDhCQUFULENBQXdDOUMseUJBQXhDLEVBQW1FK0MsU0FBbkUsRUFBOEU7QUFDNUUsTUFBTVgsa0NBQWtDcEMsMEJBQTBCcUMsTUFBbEU7QUFBQSxNQUNNVyxtQkFBbUJaLGtDQUFrQyxFQUQzRDtBQUFBLE1BQ2dFO0FBQzFEYSxlQUFhLEVBRm5COztBQUlBLE9BQUssSUFBSTNCLFFBQVEsQ0FBakIsRUFBb0JBLFFBQVEwQixnQkFBNUIsRUFBOEMxQixPQUE5QyxFQUF1RDtBQUNyRDJCLGVBQVdqQixJQUFYLENBQWdCZSxTQUFoQjtBQUNEOztBQUVELE1BQU1HLHFCQUFxQjFELGlDQUFpQ3lELFVBQWpDLENBQTNCO0FBQUEsTUFDTUUsd0JBQXdCeEQsUUFBUXVELGtCQUFSLENBRDlCOztBQUdBLFNBQU9DLHFCQUFQO0FBQ0Q7O0FBRURDLE9BQU9DLE9BQVAsR0FBaUI7QUFDZnRELCtCQUE2QkEsMkJBRGQ7QUFFZmtCLDZCQUEyQkEseUJBRlo7QUFHZmlCLDRCQUEwQkEsd0JBSFg7QUFJZk0sNkJBQTJCQSx5QkFKWjtBQUtmTSxrQ0FBZ0NBO0FBTGpCLENBQWpCIiwiZmlsZSI6InZlcnRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgdmVjMyA9IHJlcXVpcmUoJy4uL21hdGhzL3ZlYzMnKSxcbiAgICAgIGFycmF5VXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2FycmF5JyksXG4gICAgICBpbWFnZU1hcFV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9pbWFnZU1hcCcpLFxuICAgICAgdHJhbnNmb3JtVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL3RyYW5zZm9ybScpO1xuXG5jb25zdCB7IHRleHR1cmVDb29yZGluYXRlc0Zyb21JbWFnZU5hbWVzIH0gPSBpbWFnZU1hcFV0aWxpdGllcyxcbiAgICAgIHsgY29tcG9zZVRyYW5zZm9ybXMgfSA9IHRyYW5zZm9ybVV0aWxpdGllcyxcbiAgICAgIHsgY2hvcCwgZmxhdHRlbiB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IHN1YnRyYWN0LCBjcm9zcywgbm9ybWFsaXNlIH0gPSB2ZWMzO1xuXG5mdW5jdGlvbiBjYWxjdWxhdGVWZXJ0ZXhQb3NpdGlvbkRhdGEoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSwgd2lkdGgsIGhlaWdodCwgZGVwdGgsIGRpbWVuc2lvbnMsIHBvc2l0aW9uLCByb3RhdGlvbnMsIHRyYW5zZm9ybWF0aW9ucykge1xuICBjb25zdCBpbml0aWFsVmVydGV4UG9zaXRpb25zID0gY2hvcChpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLCAzKSwgIC8vL1xuICAgICAgICB0cmFuc2Zvcm1zID0gY29tcG9zZVRyYW5zZm9ybXMod2lkdGgsIGhlaWdodCwgZGVwdGgsIGRpbWVuc2lvbnMsIHBvc2l0aW9uLCByb3RhdGlvbnMsIHRyYW5zZm9ybWF0aW9ucyksXG4gICAgICAgIHZlcnRleFBvc2l0aW9ucyA9IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbnMubWFwKGZ1bmN0aW9uKGluaXRpYWxWZXJ0ZXhQb3NpdGlvbikge1xuICAgICAgICAgIGxldCB2ZXJ0ZXhQb3NpdGlvbiA9IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbjtcblxuICAgICAgICAgIHRyYW5zZm9ybXMuZm9yRWFjaChmdW5jdGlvbih0cmFuc2Zvcm0pIHtcbiAgICAgICAgICAgIHZlcnRleFBvc2l0aW9uID0gdHJhbnNmb3JtKHZlcnRleFBvc2l0aW9uKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHJldHVybiB2ZXJ0ZXhQb3NpdGlvbjtcbiAgICAgICAgfSksXG4gICAgICAgIHZlcnRleFBvc2l0aW9uRGF0YSA9IGZsYXR0ZW4odmVydGV4UG9zaXRpb25zKTtcblxuICByZXR1cm4gdmVydGV4UG9zaXRpb25EYXRhO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVWZXJ0ZXhOb3JtYWxEYXRhKHZlcnRleFBvc2l0aW9uRGF0YSkge1xuICBjb25zdCBmYWNlcyA9IGNob3AodmVydGV4UG9zaXRpb25EYXRhLCAxMiksICAvLy9cbiAgICAgICAgdmVydGV4Tm9ybWFscyA9IGZhY2VzLnJlZHVjZShmdW5jdGlvbih2ZXJ0ZXhOb3JtYWxzLCBmYWNlKSB7XG4gICAgICAgICAgY29uc3QgdmVydGV4UG9zaXRpb25zID0gY2hvcChmYWNlLCAzKTtcblxuICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCA0OyBpbmRleCsrKSB7XG4gICAgICAgICAgICBjb25zdCBmaXJzdFZlcnRleEluZGV4ID0gaW5kZXgsXG4gICAgICAgICAgICAgICAgICBzZWNvbmRWZXJ0ZXhJbmRleCA9IChpbmRleCArIDEpICUgNCxcbiAgICAgICAgICAgICAgICAgIHRoaXJkVmVydGV4SW5kZXggPSAoaW5kZXggKyAzKSAlIDQsXG4gICAgICAgICAgICAgICAgICBmaXJzdFZlcnRleFBvc2l0aW9uID0gdmVydGV4UG9zaXRpb25zW2ZpcnN0VmVydGV4SW5kZXhdLFxuICAgICAgICAgICAgICAgICAgc2Vjb25kVmVydGV4UG9zaXRpb24gPSB2ZXJ0ZXhQb3NpdGlvbnNbc2Vjb25kVmVydGV4SW5kZXhdLFxuICAgICAgICAgICAgICAgICAgdGhpcmRWZXJ0ZXhQb3NpdGlvbiA9IHZlcnRleFBvc2l0aW9uc1t0aGlyZFZlcnRleEluZGV4XSxcbiAgICAgICAgICAgICAgICAgIGZpcnN0VmVjdG9yID0gc3VidHJhY3Qoc2Vjb25kVmVydGV4UG9zaXRpb24sIGZpcnN0VmVydGV4UG9zaXRpb24pLFxuICAgICAgICAgICAgICAgICAgc2Vjb25kVmVjdG9yID0gc3VidHJhY3QodGhpcmRWZXJ0ZXhQb3NpdGlvbiwgZmlyc3RWZXJ0ZXhQb3NpdGlvbiksXG4gICAgICAgICAgICAgICAgICB2ZXJ0ZXhOb3JtYWwgPSBub3JtYWxpc2UoY3Jvc3MoZmlyc3RWZWN0b3IsIHNlY29uZFZlY3RvcikpO1xuXG4gICAgICAgICAgICB2ZXJ0ZXhOb3JtYWxzLnB1c2godmVydGV4Tm9ybWFsKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gdmVydGV4Tm9ybWFscztcbiAgICAgICAgfSwgW10pLFxuICAgICAgICB2ZXJ0ZXhOb3JtYWxEYXRhID0gZmxhdHRlbih2ZXJ0ZXhOb3JtYWxzKTsgLy8vXG5cbiAgcmV0dXJuIHZlcnRleE5vcm1hbERhdGE7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVZlcnRleEluZGV4RGF0YShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhKSB7XG4gIGNvbnN0IHZlcnRleEluZGV4RGF0YSA9IFtdLFxuICAgICAgICBpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoID0gaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YS5sZW5ndGgsXG4gICAgICAgIGZhY2VzTGVuZ3RoID0gaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCAvIDEyOyAvLy9cblxuICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgZmFjZXNMZW5ndGg7IGluZGV4KyspIHtcbiAgICBjb25zdCBvZmZzZXQgPSBpbmRleCAqIDQ7XG5cbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAwKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAxKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAyKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAwKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAyKTtcbiAgICB2ZXJ0ZXhJbmRleERhdGEucHVzaChvZmZzZXQgKyAzKTtcbiAgfVxuXG4gIHJldHVybiB2ZXJ0ZXhJbmRleERhdGE7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVZlcnRleENvbG91ckRhdGEoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSwgY29sb3VyKSB7XG4gIGNvbnN0IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGggPSBpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLmxlbmd0aCxcbiAgICAgICAgdmVydGV4Q29sb3Vyc0xlbmd0aCA9IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGggLyAzLCAgLy8vXG4gICAgICAgIHZlcnRleENvbG91ciA9IGNvbG91cixcbiAgICAgICAgdmVydGV4Q29sb3VycyA9IFtdO1xuXG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB2ZXJ0ZXhDb2xvdXJzTGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgdmVydGV4Q29sb3Vycy5wdXNoKHZlcnRleENvbG91cik7XG4gIH1cblxuICBjb25zdCB2ZXJ0ZXhDb2xvdXJEYXRhID0gZmxhdHRlbih2ZXJ0ZXhDb2xvdXJzKTsgIC8vL1xuXG4gIHJldHVybiB2ZXJ0ZXhDb2xvdXJEYXRhO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZURhdGEoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSwgaW1hZ2VOYW1lKSB7XG4gIGNvbnN0IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGggPSBpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLmxlbmd0aCxcbiAgICAgICAgaW1hZ2VOYW1lc0xlbmd0aCA9IGluaXRpYWxWZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGggLyAxMiwgIC8vL1xuICAgICAgICBpbWFnZU5hbWVzID0gW107XG5cbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGltYWdlTmFtZXNMZW5ndGg7IGluZGV4KyspIHtcbiAgICBpbWFnZU5hbWVzLnB1c2goaW1hZ2VOYW1lKTtcbiAgfVxuXG4gIGNvbnN0IHRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlc0Zyb21JbWFnZU5hbWVzKGltYWdlTmFtZXMpLFxuICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZURhdGEgPSBmbGF0dGVuKHRleHR1cmVDb29yZGluYXRlcyk7XG5cbiAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlRGF0YTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGNhbGN1bGF0ZVZlcnRleFBvc2l0aW9uRGF0YTogY2FsY3VsYXRlVmVydGV4UG9zaXRpb25EYXRhLFxuICBjYWxjdWxhdGVWZXJ0ZXhOb3JtYWxEYXRhOiBjYWxjdWxhdGVWZXJ0ZXhOb3JtYWxEYXRhLFxuICBjYWxjdWxhdGVWZXJ0ZXhJbmRleERhdGE6IGNhbGN1bGF0ZVZlcnRleEluZGV4RGF0YSxcbiAgY2FsY3VsYXRlVmVydGV4Q29sb3VyRGF0YTogY2FsY3VsYXRlVmVydGV4Q29sb3VyRGF0YSxcbiAgY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVEYXRhOiBjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZURhdGFcbn07XG4iXX0=