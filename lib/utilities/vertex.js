'use strict';

var vec3 = require('gl-vec3'),
    ///
vec4 = require('gl-vec4'),
    ///
mat4 = require('gl-mat4'); ///

var arrayUtilities = require('../utilities/array');

var dice = arrayUtilities.dice,
    flatten = arrayUtilities.flatten;


function calculateVertexPositionData(initialVertexPositionData, width, depth, height, offset) {
  var matrix = mat4.create();

  mat4.translate(matrix, matrix, offset);
  mat4.scale(matrix, matrix, [width, depth, height]);

  var vertexPositions = dice(initialVertexPositionData, 4); ///

  vertexPositions = vertexPositions.map(function (vertexPosition) {
    return vec4.transformMat4(vertexPosition, vertexPosition, matrix);
  });

  vertexPositions = vertexPositions.map(function (vertexPosition) {
    return vertexPosition.slice(0, 3);
  });

  var vertexPositionData = flatten(vertexPositions);

  return vertexPositionData;
}

function calculateVertexNormalData(initialVertexPositionData) {
  var vertexNormalVectors = [],
      faces = dice(initialVertexPositionData, 16);

  faces.forEach(function (face) {
    var vertexPositions = dice(face, 4);

    for (var index = 0; index < 4; index++) {
      var firstVertexIndex = index,
          secondVertexIndex = (index + 1) % 4,
          thirdVertexIndex = (index + 3) % 4,
          firstVertexPosition = vertexPositions[firstVertexIndex],
          secondVertexPosition = vertexPositions[secondVertexIndex],
          thirdVertexPosition = vertexPositions[thirdVertexIndex],
          firstVector = subtract(secondVertexPosition, firstVertexPosition),
          ///
      secondVector = subtract(thirdVertexPosition, firstVertexPosition),
          ///
      vertexNormalVector = cross(firstVector, secondVector);

      vertexNormalVectors.push(vertexNormalVector);
    }
  });

  var vertexNormalData = flatten(vertexNormalVectors); ///

  return vertexNormalData;
}

function calculateVertexIndexData(initialVertexPositionData) {
  var vertexIndexData = [],
      initialVertexPositionDataLength = initialVertexPositionData.length,
      facesLength = initialVertexPositionDataLength / 16;

  for (var index = 0; index < facesLength; index++) {
    var offset = index * 4;

    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 1);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 0);
    vertexIndexData.push(offset + 2);
    vertexIndexData.push(offset + 3);
  }

  return vertexIndexData;
}

module.exports = {
  calculateVertexPositionData: calculateVertexPositionData,
  calculateVertexNormalData: calculateVertexNormalData,
  calculateVertexIndexData: calculateVertexIndexData
};

function subtract(vec1, vec2) {
  var vec = [];

  vec3.subtract(vec, vec1, vec2);

  return vec;
}

function cross(vec1, vec2) {
  var vec = [];

  vec3.cross(vec, vec1, vec2);

  return vec;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvdmVydGV4LmpzIl0sIm5hbWVzIjpbInZlYzMiLCJyZXF1aXJlIiwidmVjNCIsIm1hdDQiLCJhcnJheVV0aWxpdGllcyIsImRpY2UiLCJmbGF0dGVuIiwiY2FsY3VsYXRlVmVydGV4UG9zaXRpb25EYXRhIiwiaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSIsIndpZHRoIiwiZGVwdGgiLCJoZWlnaHQiLCJvZmZzZXQiLCJtYXRyaXgiLCJjcmVhdGUiLCJ0cmFuc2xhdGUiLCJzY2FsZSIsInZlcnRleFBvc2l0aW9ucyIsIm1hcCIsInZlcnRleFBvc2l0aW9uIiwidHJhbnNmb3JtTWF0NCIsInNsaWNlIiwidmVydGV4UG9zaXRpb25EYXRhIiwiY2FsY3VsYXRlVmVydGV4Tm9ybWFsRGF0YSIsInZlcnRleE5vcm1hbFZlY3RvcnMiLCJmYWNlcyIsImZvckVhY2giLCJmYWNlIiwiaW5kZXgiLCJmaXJzdFZlcnRleEluZGV4Iiwic2Vjb25kVmVydGV4SW5kZXgiLCJ0aGlyZFZlcnRleEluZGV4IiwiZmlyc3RWZXJ0ZXhQb3NpdGlvbiIsInNlY29uZFZlcnRleFBvc2l0aW9uIiwidGhpcmRWZXJ0ZXhQb3NpdGlvbiIsImZpcnN0VmVjdG9yIiwic3VidHJhY3QiLCJzZWNvbmRWZWN0b3IiLCJ2ZXJ0ZXhOb3JtYWxWZWN0b3IiLCJjcm9zcyIsInB1c2giLCJ2ZXJ0ZXhOb3JtYWxEYXRhIiwiY2FsY3VsYXRlVmVydGV4SW5kZXhEYXRhIiwidmVydGV4SW5kZXhEYXRhIiwiaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCIsImxlbmd0aCIsImZhY2VzTGVuZ3RoIiwibW9kdWxlIiwiZXhwb3J0cyIsInZlYzEiLCJ2ZWMyIiwidmVjIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxPQUFPQyxRQUFRLFNBQVIsQ0FBYjtBQUFBLElBQWtDO0FBQzVCQyxPQUFPRCxRQUFRLFNBQVIsQ0FEYjtBQUFBLElBQ2tDO0FBQzVCRSxP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QUFnQkgsSUFBaEIsQ0FBcUI1QixTQUFTLENBQTlCO0FBQ0ErQixvQkFBZ0JILElBQWhCLENBQXFCNUIsU0FBUyxDQUE5QjtBQUNBK0Isb0JBQWdCSCxJQUFoQixDQUFxQjVCLFNBQVMsQ0FBOUI7QUFDQStCLG9CQUFnQkgsSUFBaEIsQ0FBcUI1QixTQUFTLENBQTlCO0FBQ0ErQixvQkFBZ0JILElBQWhCLENBQXFCNUIsU0FBUyxDQUE5QjtBQUNBK0Isb0JBQWdCSCxJQUFoQixDQUFxQjVCLFNBQVMsQ0FBOUI7QUFDRDs7QUFFRCxTQUFPK0IsZUFBUDtBQUNEOztBQUVESSxPQUFPQyxPQUFQLEdBQWlCO0FBQ2Z6QywrQkFBNkJBLDJCQURkO0FBRWZnQiw2QkFBMkJBLHlCQUZaO0FBR2ZtQiw0QkFBMEJBO0FBSFgsQ0FBakI7O0FBTUEsU0FBU04sUUFBVCxDQUFrQmEsSUFBbEIsRUFBd0JDLElBQXhCLEVBQThCO0FBQzVCLE1BQU1DLE1BQU0sRUFBWjs7QUFFQW5ELE9BQUtvQyxRQUFMLENBQWNlLEdBQWQsRUFBbUJGLElBQW5CLEVBQXlCQyxJQUF6Qjs7QUFFQSxTQUFPQyxHQUFQO0FBQ0Q7O0FBRUQsU0FBU1osS0FBVCxDQUFlVSxJQUFmLEVBQXFCQyxJQUFyQixFQUEyQjtBQUN6QixNQUFNQyxNQUFNLEVBQVo7O0FBRUFuRCxPQUFLdUMsS0FBTCxDQUFXWSxHQUFYLEVBQWdCRixJQUFoQixFQUFzQkMsSUFBdEI7O0FBRUEsU0FBT0MsR0FBUDtBQUNEIiwiZmlsZSI6InZlcnRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgdmVjMyA9IHJlcXVpcmUoJ2dsLXZlYzMnKSwgIC8vL1xuICAgICAgdmVjNCA9IHJlcXVpcmUoJ2dsLXZlYzQnKSwgIC8vL1xuICAgICAgbWF0NCA9IHJlcXVpcmUoJ2dsLW1hdDQnKTsgIC8vL1xuXG5jb25zdCBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpO1xuXG5jb25zdCB7IGRpY2UsIGZsYXR0ZW4gfSA9IGFycmF5VXRpbGl0aWVzO1xuXG5mdW5jdGlvbiBjYWxjdWxhdGVWZXJ0ZXhQb3NpdGlvbkRhdGEoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSwgd2lkdGgsIGRlcHRoLCBoZWlnaHQsIG9mZnNldCkge1xuICBjb25zdCBtYXRyaXggPSBtYXQ0LmNyZWF0ZSgpO1xuXG4gIG1hdDQudHJhbnNsYXRlKG1hdHJpeCwgbWF0cml4LCBvZmZzZXQpO1xuICBtYXQ0LnNjYWxlKG1hdHJpeCwgbWF0cml4LCBbd2lkdGgsIGRlcHRoLCBoZWlnaHRdKTtcblxuICBsZXQgdmVydGV4UG9zaXRpb25zID0gZGljZShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLCA0KTsgIC8vL1xuXG4gIHZlcnRleFBvc2l0aW9ucyA9IHZlcnRleFBvc2l0aW9ucy5tYXAoZnVuY3Rpb24odmVydGV4UG9zaXRpb24pIHtcbiAgICByZXR1cm4gdmVjNC50cmFuc2Zvcm1NYXQ0KHZlcnRleFBvc2l0aW9uLCB2ZXJ0ZXhQb3NpdGlvbiwgbWF0cml4KTtcbiAgfSk7XG5cbiAgdmVydGV4UG9zaXRpb25zID0gdmVydGV4UG9zaXRpb25zLm1hcChmdW5jdGlvbih2ZXJ0ZXhQb3NpdGlvbikge1xuICAgIHJldHVybiB2ZXJ0ZXhQb3NpdGlvbi5zbGljZSgwLCAzKTtcbiAgfSk7XG4gIFxuICBjb25zdCB2ZXJ0ZXhQb3NpdGlvbkRhdGEgPSBmbGF0dGVuKHZlcnRleFBvc2l0aW9ucyk7IFxuXG4gIHJldHVybiB2ZXJ0ZXhQb3NpdGlvbkRhdGE7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVZlcnRleE5vcm1hbERhdGEoaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YSkge1xuICBjb25zdCB2ZXJ0ZXhOb3JtYWxWZWN0b3JzID0gW10sXG4gICAgICAgIGZhY2VzID0gZGljZShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhLCAxNik7XG5cbiAgZmFjZXMuZm9yRWFjaChmdW5jdGlvbihmYWNlKSB7XG4gICAgY29uc3QgdmVydGV4UG9zaXRpb25zID0gZGljZShmYWNlLCA0KTtcblxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCA0OyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBmaXJzdFZlcnRleEluZGV4ID0gaW5kZXgsXG4gICAgICAgICAgICBzZWNvbmRWZXJ0ZXhJbmRleCA9IChpbmRleCArIDEpICUgNCxcbiAgICAgICAgICAgIHRoaXJkVmVydGV4SW5kZXggPSAoaW5kZXggKyAzKSAlIDQsXG4gICAgICAgICAgICBmaXJzdFZlcnRleFBvc2l0aW9uID0gdmVydGV4UG9zaXRpb25zW2ZpcnN0VmVydGV4SW5kZXhdLFxuICAgICAgICAgICAgc2Vjb25kVmVydGV4UG9zaXRpb24gPSB2ZXJ0ZXhQb3NpdGlvbnNbc2Vjb25kVmVydGV4SW5kZXhdLFxuICAgICAgICAgICAgdGhpcmRWZXJ0ZXhQb3NpdGlvbiA9IHZlcnRleFBvc2l0aW9uc1t0aGlyZFZlcnRleEluZGV4XSxcbiAgICAgICAgICAgIGZpcnN0VmVjdG9yID0gc3VidHJhY3Qoc2Vjb25kVmVydGV4UG9zaXRpb24sIGZpcnN0VmVydGV4UG9zaXRpb24pLCAgLy8vXG4gICAgICAgICAgICBzZWNvbmRWZWN0b3IgPSBzdWJ0cmFjdCh0aGlyZFZlcnRleFBvc2l0aW9uLCBmaXJzdFZlcnRleFBvc2l0aW9uKSwgIC8vL1xuICAgICAgICAgICAgdmVydGV4Tm9ybWFsVmVjdG9yID0gY3Jvc3MoZmlyc3RWZWN0b3IsIHNlY29uZFZlY3Rvcik7XG5cbiAgICAgIHZlcnRleE5vcm1hbFZlY3RvcnMucHVzaCh2ZXJ0ZXhOb3JtYWxWZWN0b3IpO1xuICAgIH1cbiAgfSk7XG4gIFxuICBjb25zdCB2ZXJ0ZXhOb3JtYWxEYXRhID0gZmxhdHRlbih2ZXJ0ZXhOb3JtYWxWZWN0b3JzKTsgLy8vXG5cbiAgcmV0dXJuIHZlcnRleE5vcm1hbERhdGE7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVZlcnRleEluZGV4RGF0YShpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhKSB7XG4gIGNvbnN0IHZlcnRleEluZGV4RGF0YSA9IFtdLFxuICAgICAgICBpbml0aWFsVmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoID0gaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YS5sZW5ndGgsXG4gICAgICAgIGZhY2VzTGVuZ3RoID0gaW5pdGlhbFZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCAvIDE2O1xuXG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBmYWNlc0xlbmd0aDsgaW5kZXgrKykge1xuICAgIGNvbnN0IG9mZnNldCA9IGluZGV4ICogNDtcblxuICAgIHZlcnRleEluZGV4RGF0YS5wdXNoKG9mZnNldCArIDApO1xuICAgIHZlcnRleEluZGV4RGF0YS5wdXNoKG9mZnNldCArIDEpO1xuICAgIHZlcnRleEluZGV4RGF0YS5wdXNoKG9mZnNldCArIDIpO1xuICAgIHZlcnRleEluZGV4RGF0YS5wdXNoKG9mZnNldCArIDApO1xuICAgIHZlcnRleEluZGV4RGF0YS5wdXNoKG9mZnNldCArIDIpO1xuICAgIHZlcnRleEluZGV4RGF0YS5wdXNoKG9mZnNldCArIDMpO1xuICB9XG5cbiAgcmV0dXJuIHZlcnRleEluZGV4RGF0YTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGNhbGN1bGF0ZVZlcnRleFBvc2l0aW9uRGF0YTogY2FsY3VsYXRlVmVydGV4UG9zaXRpb25EYXRhLFxuICBjYWxjdWxhdGVWZXJ0ZXhOb3JtYWxEYXRhOiBjYWxjdWxhdGVWZXJ0ZXhOb3JtYWxEYXRhLFxuICBjYWxjdWxhdGVWZXJ0ZXhJbmRleERhdGE6IGNhbGN1bGF0ZVZlcnRleEluZGV4RGF0YVxufTtcblxuZnVuY3Rpb24gc3VidHJhY3QodmVjMSwgdmVjMikge1xuICBjb25zdCB2ZWMgPSBbXTtcblxuICB2ZWMzLnN1YnRyYWN0KHZlYywgdmVjMSwgdmVjMik7XG5cbiAgcmV0dXJuIHZlYztcbn1cblxuZnVuY3Rpb24gY3Jvc3ModmVjMSwgdmVjMikge1xuICBjb25zdCB2ZWMgPSBbXTtcblxuICB2ZWMzLmNyb3NzKHZlYywgdmVjMSwgdmVjMik7XG5cbiAgcmV0dXJuIHZlYztcbn1cbiJdfQ==