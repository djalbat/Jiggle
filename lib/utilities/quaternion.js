'use strict';

var vectorMaths = require('../maths/vector'),
    arrayUtilities = require('../utilities/array'),
    angleUtilities = require('../utilities/angle'),
    approximateUtilities = require('../utilities/approximate');

var dot3 = vectorMaths.dot3,
    cross3 = vectorMaths.cross3,
    normalise3 = vectorMaths.normalise3,
    isApproximatelyEqualToOne = approximateUtilities.isApproximatelyEqualToOne,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    fourth = arrayUtilities.fourth,
    calculateHalfAngleCosine = angleUtilities.calculateHalfAngleCosine,
    calculateHalfAngleSine = angleUtilities.calculateHalfAngleSine;


function rotateImaginaryQuaternion(imaginaryQuaternion, rotationQuaternion, inverseRotationQuaternion) {
  return hamiltonProduct(hamiltonProduct(rotationQuaternion, imaginaryQuaternion), inverseRotationQuaternion);
}

function calculateInverseRotationQuaternion(rotationQuaternion) {
  var rotationQuaternionComponents = rotationQuaternion,
      ///
  firstRotationQuaternionComponent = first(rotationQuaternionComponents),
      secondRotationQuaternionComponent = second(rotationQuaternionComponents),
      thirdRotationQuaternionComponent = third(rotationQuaternionComponents),
      fourthRotationQuaternionComponent = fourth(rotationQuaternionComponents),
      inverseRotationQuaternion = [firstRotationQuaternionComponent, -secondRotationQuaternionComponent, -thirdRotationQuaternionComponent, -fourthRotationQuaternionComponent];

  return inverseRotationQuaternion;
}

function calculateForwardsRotationQuaternion(rotationQuaternion) {
  var forwardsRotationQuaternion = rotationQuaternion; ///

  return forwardsRotationQuaternion;
}

function calculateBackwardsRotationQuaternion(rotationQuaternion) {
  var inverseRotationQuaternion = calculateInverseRotationQuaternion(rotationQuaternion),
      backwardsRotationQuaternion = inverseRotationQuaternion; ///

  return backwardsRotationQuaternion;
}

function calculateArbitraryRotationQuaternion(normal) {
  var extent = normal.getExtent(),
      unitNormal = extent,
      ///
  zAxis = [0, 0, 1],
      dotProductOfUnitNormalAndZAxis = dot3(unitNormal, zAxis),
      crossProductOfUnitNormalAndZAxis = cross3(unitNormal, zAxis),
      angleOfRotationCosine = dotProductOfUnitNormalAndZAxis,
      ///
  angleOfRotationCosineAbsoluteValue = Math.abs(angleOfRotationCosine),
      angleOfRotationCosineAbsoluteValueApproximatelyEqualToOne = isApproximatelyEqualToOne(angleOfRotationCosineAbsoluteValue),
      axisOfRotation = angleOfRotationCosineAbsoluteValueApproximatelyEqualToOne ? [1, 0, 0] : ///
  crossProductOfUnitNormalAndZAxis,
      unitAxisOfRotation = normalise3(axisOfRotation),
      halfAngleOfRotationCosine = calculateHalfAngleCosine(angleOfRotationCosine),
      halfAngleOfRotationSine = calculateHalfAngleSine(angleOfRotationCosine),
      unitAxisOfRotationComponents = unitAxisOfRotation,
      ///
  firstAxisOfRotationComponent = first(unitAxisOfRotationComponents),
      secondAxisOfRotationComponent = second(unitAxisOfRotationComponents),
      thirdAxisOfRotationComponent = third(unitAxisOfRotationComponents),
      arbitraryRotationQuaternion = [halfAngleOfRotationCosine, firstAxisOfRotationComponent * halfAngleOfRotationSine, secondAxisOfRotationComponent * halfAngleOfRotationSine, thirdAxisOfRotationComponent * halfAngleOfRotationSine];

  return arbitraryRotationQuaternion;
}

function calculateRotationAboutZAxisQuaternion(maskingEdge) {
  var maskingEdgeExtent = maskingEdge.getExtent(),
      unitMaskingEdgeExtent = normalise3(maskingEdgeExtent),
      unitMaskingEdgeExtentComponents = unitMaskingEdgeExtent,
      ///
  firstUnitMaskingEdgeExtentComponent = first(unitMaskingEdgeExtentComponents),
      secondUnitMaskingEdgeExtentComponent = second(unitMaskingEdgeExtentComponents),
      angleOfRotationSine = firstUnitMaskingEdgeExtentComponent,
      ///
  angleOfRotationCosine = secondUnitMaskingEdgeExtentComponent,
      ///
  halfAngleOfRotationCosine = calculateHalfAngleCosine(angleOfRotationCosine),
      halfAngleOfRotationSine = angleOfRotationSine > 0 ? +calculateHalfAngleSine(angleOfRotationCosine) : -calculateHalfAngleSine(angleOfRotationCosine),
      rotationAboutZAxisQuaternion = [halfAngleOfRotationCosine, 0, 0, halfAngleOfRotationSine];

  return rotationAboutZAxisQuaternion;
}

module.exports = {
  rotateImaginaryQuaternion: rotateImaginaryQuaternion,
  calculateInverseRotationQuaternion: calculateInverseRotationQuaternion,
  calculateForwardsRotationQuaternion: calculateForwardsRotationQuaternion,
  calculateBackwardsRotationQuaternion: calculateBackwardsRotationQuaternion,
  calculateArbitraryRotationQuaternion: calculateArbitraryRotationQuaternion,
  calculateRotationAboutZAxisQuaternion: calculateRotationAboutZAxisQuaternion
};

function hamiltonProduct(quaternionA, quaternionB) {
  var a1 = quaternionA[0],
      b1 = quaternionA[1],
      c1 = quaternionA[2],
      d1 = quaternionA[3],
      a2 = quaternionB[0],
      b2 = quaternionB[1],
      c2 = quaternionB[2],
      d2 = quaternionB[3],
      a = a1 * a2 - b1 * b2 - c1 * c2 - d1 * d2,
      b = a1 * b2 + b1 * a2 + c1 * d2 - d1 * c2,
      c = a1 * c2 - b1 * d2 + c1 * a2 + d1 * b2,
      d = a1 * d2 + b1 * c2 - c1 * b2 + d1 * a2,
      quaternion = [a, b, c, d];

  return quaternion;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvcXVhdGVybmlvbi5qcyJdLCJuYW1lcyI6WyJ2ZWN0b3JNYXRocyIsInJlcXVpcmUiLCJhcnJheVV0aWxpdGllcyIsImFuZ2xlVXRpbGl0aWVzIiwiYXBwcm94aW1hdGVVdGlsaXRpZXMiLCJkb3QzIiwiY3Jvc3MzIiwibm9ybWFsaXNlMyIsImlzQXBwcm94aW1hdGVseUVxdWFsVG9PbmUiLCJmaXJzdCIsInNlY29uZCIsInRoaXJkIiwiZm91cnRoIiwiY2FsY3VsYXRlSGFsZkFuZ2xlQ29zaW5lIiwiY2FsY3VsYXRlSGFsZkFuZ2xlU2luZSIsInJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24iLCJpbWFnaW5hcnlRdWF0ZXJuaW9uIiwicm90YXRpb25RdWF0ZXJuaW9uIiwiaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbiIsImhhbWlsdG9uUHJvZHVjdCIsImNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb24iLCJyb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzIiwiZmlyc3RSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQiLCJzZWNvbmRSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQiLCJ0aGlyZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCIsImZvdXJ0aFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCIsImNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25RdWF0ZXJuaW9uIiwiZm9yd2FyZHNSb3RhdGlvblF1YXRlcm5pb24iLCJjYWxjdWxhdGVCYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb24iLCJiYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb24iLCJjYWxjdWxhdGVBcmJpdHJhcnlSb3RhdGlvblF1YXRlcm5pb24iLCJub3JtYWwiLCJleHRlbnQiLCJnZXRFeHRlbnQiLCJ1bml0Tm9ybWFsIiwiekF4aXMiLCJkb3RQcm9kdWN0T2ZVbml0Tm9ybWFsQW5kWkF4aXMiLCJjcm9zc1Byb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcyIsImFuZ2xlT2ZSb3RhdGlvbkNvc2luZSIsImFuZ2xlT2ZSb3RhdGlvbkNvc2luZUFic29sdXRlVmFsdWUiLCJNYXRoIiwiYWJzIiwiYW5nbGVPZlJvdGF0aW9uQ29zaW5lQWJzb2x1dGVWYWx1ZUFwcHJveGltYXRlbHlFcXVhbFRvT25lIiwiYXhpc09mUm90YXRpb24iLCJ1bml0QXhpc09mUm90YXRpb24iLCJoYWxmQW5nbGVPZlJvdGF0aW9uQ29zaW5lIiwiaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmUiLCJ1bml0QXhpc09mUm90YXRpb25Db21wb25lbnRzIiwiZmlyc3RBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCIsInNlY29uZEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50IiwidGhpcmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCIsImFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbiIsImNhbGN1bGF0ZVJvdGF0aW9uQWJvdXRaQXhpc1F1YXRlcm5pb24iLCJtYXNraW5nRWRnZSIsIm1hc2tpbmdFZGdlRXh0ZW50IiwidW5pdE1hc2tpbmdFZGdlRXh0ZW50IiwidW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50cyIsImZpcnN0VW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50Iiwic2Vjb25kVW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50IiwiYW5nbGVPZlJvdGF0aW9uU2luZSIsInJvdGF0aW9uQWJvdXRaQXhpc1F1YXRlcm5pb24iLCJtb2R1bGUiLCJleHBvcnRzIiwicXVhdGVybmlvbkEiLCJxdWF0ZXJuaW9uQiIsImExIiwiYjEiLCJjMSIsImQxIiwiYTIiLCJiMiIsImMyIiwiZDIiLCJhIiwiYiIsImMiLCJkIiwicXVhdGVybmlvbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsY0FBY0MsUUFBUSxpQkFBUixDQUFwQjtBQUFBLElBQ01DLGlCQUFpQkQsUUFBUSxvQkFBUixDQUR2QjtBQUFBLElBRU1FLGlCQUFpQkYsUUFBUSxvQkFBUixDQUZ2QjtB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QUhYO0FBQUEsTUFJTU0sS0FBS0wsWUFBWSxDQUFaLENBSlg7QUFBQSxNQUtNTSxLQUFLTixZQUFZLENBQVosQ0FMWDtBQUFBLE1BTU1PLEtBQUtQLFlBQVksQ0FBWixDQU5YO0FBQUEsTUFPTVEsS0FBS1IsWUFBWSxDQUFaLENBUFg7QUFBQSxNQVFNUyxJQUFJUixLQUFLSSxFQUFMLEdBQVVILEtBQUtJLEVBQWYsR0FBb0JILEtBQUtJLEVBQXpCLEdBQThCSCxLQUFLSSxFQVI3QztBQUFBLE1BU01FLElBQUlULEtBQUtLLEVBQUwsR0FBVUosS0FBS0csRUFBZixHQUFvQkYsS0FBS0ssRUFBekIsR0FBOEJKLEtBQUtHLEVBVDdDO0FBQUEsTUFVTUksSUFBSVYsS0FBS00sRUFBTCxHQUFVTCxLQUFLTSxFQUFmLEdBQW9CTCxLQUFLRSxFQUF6QixHQUE4QkQsS0FBS0UsRUFWN0M7QUFBQSxNQVdNTSxJQUFJWCxLQUFLTyxFQUFMLEdBQVVOLEtBQUtLLEVBQWYsR0FBb0JKLEtBQUtHLEVBQXpCLEdBQThCRixLQUFLQyxFQVg3QztBQUFBLE1BWU1RLGFBQWEsQ0FBRUosQ0FBRixFQUFLQyxDQUFMLEVBQVFDLENBQVIsRUFBV0MsQ0FBWCxDQVpuQjs7QUFjQSxTQUFPQyxVQUFQO0FBQ0QiLCJmaWxlIjoicXVhdGVybmlvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgdmVjdG9yTWF0aHMgPSByZXF1aXJlKCcuLi9tYXRocy92ZWN0b3InKSxcbiAgICAgIGFycmF5VXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2FycmF5JyksXG4gICAgICBhbmdsZVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hbmdsZScpLFxuICAgICAgYXBwcm94aW1hdGVVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvYXBwcm94aW1hdGUnKTtcblxuY29uc3QgeyBkb3QzLCBjcm9zczMsIG5vcm1hbGlzZTMgfSA9IHZlY3Rvck1hdGhzLFxuICAgICAgeyBpc0FwcHJveGltYXRlbHlFcXVhbFRvT25lIH0gPSBhcHByb3hpbWF0ZVV0aWxpdGllcyxcbiAgICAgIHsgZmlyc3QsIHNlY29uZCwgdGhpcmQsIGZvdXJ0aCB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IGNhbGN1bGF0ZUhhbGZBbmdsZUNvc2luZSwgY2FsY3VsYXRlSGFsZkFuZ2xlU2luZSB9ID0gYW5nbGVVdGlsaXRpZXM7XG5cbmZ1bmN0aW9uIHJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24oaW1hZ2luYXJ5UXVhdGVybmlvbiwgcm90YXRpb25RdWF0ZXJuaW9uLCBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uKSB7IHJldHVybiBoYW1pbHRvblByb2R1Y3QoaGFtaWx0b25Qcm9kdWN0KHJvdGF0aW9uUXVhdGVybmlvbiwgaW1hZ2luYXJ5UXVhdGVybmlvbiksIGludmVyc2VSb3RhdGlvblF1YXRlcm5pb24pOyB9XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb24ocm90YXRpb25RdWF0ZXJuaW9uKSB7XG4gIGNvbnN0IHJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMgPSByb3RhdGlvblF1YXRlcm5pb24sICAvLy9cbiAgICAgICAgZmlyc3RSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQgPSBmaXJzdChyb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzKSxcbiAgICAgICAgc2Vjb25kUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50ID0gc2Vjb25kKHJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMpLFxuICAgICAgICB0aGlyZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCA9IHRoaXJkKHJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMpLFxuICAgICAgICBmb3VydGhSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQgPSBmb3VydGgocm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50cyksXG4gICAgICAgIGludmVyc2VSb3RhdGlvblF1YXRlcm5pb24gPSBbXG4gICAgICAgICAgZmlyc3RSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQsXG4gICAgICAgICAgLXNlY29uZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCxcbiAgICAgICAgICAtdGhpcmRSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQsXG4gICAgICAgICAgLWZvdXJ0aFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudFxuICAgICAgICBdO1xuXG4gIHJldHVybiBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVGb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbihyb3RhdGlvblF1YXRlcm5pb24pIHtcbiAgY29uc3QgZm9yd2FyZHNSb3RhdGlvblF1YXRlcm5pb24gPSByb3RhdGlvblF1YXRlcm5pb247ICAvLy9cblxuICByZXR1cm4gZm9yd2FyZHNSb3RhdGlvblF1YXRlcm5pb247XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUJhY2t3YXJkc1JvdGF0aW9uUXVhdGVybmlvbihyb3RhdGlvblF1YXRlcm5pb24pIHtcbiAgY29uc3QgaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbiA9IGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb24ocm90YXRpb25RdWF0ZXJuaW9uKSxcbiAgICAgICAgYmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uID0gaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbjsgIC8vL1xuXG4gIHJldHVybiBiYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb247XG5cbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlQXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uKG5vcm1hbCkge1xuICBjb25zdCBleHRlbnQgPSBub3JtYWwuZ2V0RXh0ZW50KCksXG4gICAgICAgIHVuaXROb3JtYWwgPSBleHRlbnQsICAvLy9cbiAgICAgICAgekF4aXMgPSBbIDAsIDAsIDEgXSxcbiAgICAgICAgZG90UHJvZHVjdE9mVW5pdE5vcm1hbEFuZFpBeGlzID0gZG90Myh1bml0Tm9ybWFsLCB6QXhpcyksXG4gICAgICAgIGNyb3NzUHJvZHVjdE9mVW5pdE5vcm1hbEFuZFpBeGlzID0gY3Jvc3MzKHVuaXROb3JtYWwsIHpBeGlzKSxcbiAgICAgICAgYW5nbGVPZlJvdGF0aW9uQ29zaW5lID0gZG90UHJvZHVjdE9mVW5pdE5vcm1hbEFuZFpBeGlzLCAvLy9cbiAgICAgICAgYW5nbGVPZlJvdGF0aW9uQ29zaW5lQWJzb2x1dGVWYWx1ZSA9IE1hdGguYWJzKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSksXG4gICAgICAgIGFuZ2xlT2ZSb3RhdGlvbkNvc2luZUFic29sdXRlVmFsdWVBcHByb3hpbWF0ZWx5RXF1YWxUb09uZSA9IGlzQXBwcm94aW1hdGVseUVxdWFsVG9PbmUoYW5nbGVPZlJvdGF0aW9uQ29zaW5lQWJzb2x1dGVWYWx1ZSksXG4gICAgICAgIGF4aXNPZlJvdGF0aW9uID0gYW5nbGVPZlJvdGF0aW9uQ29zaW5lQWJzb2x1dGVWYWx1ZUFwcHJveGltYXRlbHlFcXVhbFRvT25lID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgWyAxLCAwLCAwIF0gOiAvLy9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcm9zc1Byb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcyxcbiAgICAgICAgdW5pdEF4aXNPZlJvdGF0aW9uID0gbm9ybWFsaXNlMyhheGlzT2ZSb3RhdGlvbiksXG4gICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25Db3NpbmUgPSBjYWxjdWxhdGVIYWxmQW5nbGVDb3NpbmUoYW5nbGVPZlJvdGF0aW9uQ29zaW5lKSxcbiAgICAgICAgaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmUgPSBjYWxjdWxhdGVIYWxmQW5nbGVTaW5lKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSksXG4gICAgICAgIHVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMgPSB1bml0QXhpc09mUm90YXRpb24sICAvLy9cbiAgICAgICAgZmlyc3RBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCA9IGZpcnN0KHVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMpLFxuICAgICAgICBzZWNvbmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCA9IHNlY29uZCh1bml0QXhpc09mUm90YXRpb25Db21wb25lbnRzKSxcbiAgICAgICAgdGhpcmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCA9IHRoaXJkKHVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMpLFxuICAgICAgICBhcmJpdHJhcnlSb3RhdGlvblF1YXRlcm5pb24gPSBbXG4gICAgICAgICAgaGFsZkFuZ2xlT2ZSb3RhdGlvbkNvc2luZSxcbiAgICAgICAgICBmaXJzdEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50ICogaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmUsXG4gICAgICAgICAgc2Vjb25kQXhpc09mUm90YXRpb25Db21wb25lbnQgKiBoYWxmQW5nbGVPZlJvdGF0aW9uU2luZSxcbiAgICAgICAgICB0aGlyZEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50ICogaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmVcbiAgICAgICAgXTtcblxuICByZXR1cm4gYXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVSb3RhdGlvbkFib3V0WkF4aXNRdWF0ZXJuaW9uKG1hc2tpbmdFZGdlKSB7XG4gIGNvbnN0IG1hc2tpbmdFZGdlRXh0ZW50ID0gbWFza2luZ0VkZ2UuZ2V0RXh0ZW50KCksXG4gICAgICAgIHVuaXRNYXNraW5nRWRnZUV4dGVudCA9IG5vcm1hbGlzZTMobWFza2luZ0VkZ2VFeHRlbnQpLFxuICAgICAgICB1bml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnRzID0gdW5pdE1hc2tpbmdFZGdlRXh0ZW50LCAgLy8vXG4gICAgICAgIGZpcnN0VW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50ID0gZmlyc3QodW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZFVuaXRNYXNraW5nRWRnZUV4dGVudENvbXBvbmVudCA9IHNlY29uZCh1bml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnRzKSxcbiAgICAgICAgYW5nbGVPZlJvdGF0aW9uU2luZSA9IGZpcnN0VW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50LCAgLy8vXG4gICAgICAgIGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSA9IHNlY29uZFVuaXRNYXNraW5nRWRnZUV4dGVudENvbXBvbmVudCwgIC8vL1xuICAgICAgICBoYWxmQW5nbGVPZlJvdGF0aW9uQ29zaW5lID0gY2FsY3VsYXRlSGFsZkFuZ2xlQ29zaW5lKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSksXG4gICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25TaW5lID0gKGFuZ2xlT2ZSb3RhdGlvblNpbmUgPiAwICkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArY2FsY3VsYXRlSGFsZkFuZ2xlU2luZShhbmdsZU9mUm90YXRpb25Db3NpbmUpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtY2FsY3VsYXRlSGFsZkFuZ2xlU2luZShhbmdsZU9mUm90YXRpb25Db3NpbmUpLFxuICAgICAgICByb3RhdGlvbkFib3V0WkF4aXNRdWF0ZXJuaW9uID0gW1xuICAgICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25Db3NpbmUsXG4gICAgICAgICAgMCxcbiAgICAgICAgICAwLFxuICAgICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25TaW5lXG4gICAgICAgIF07XG5cbiAgcmV0dXJuIHJvdGF0aW9uQWJvdXRaQXhpc1F1YXRlcm5pb247XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICByb3RhdGVJbWFnaW5hcnlRdWF0ZXJuaW9uLFxuICBjYWxjdWxhdGVJbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uLFxuICBjYWxjdWxhdGVGb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbixcbiAgY2FsY3VsYXRlQmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uLFxuICBjYWxjdWxhdGVBcmJpdHJhcnlSb3RhdGlvblF1YXRlcm5pb24sXG4gIGNhbGN1bGF0ZVJvdGF0aW9uQWJvdXRaQXhpc1F1YXRlcm5pb25cbn07XG5cbmZ1bmN0aW9uIGhhbWlsdG9uUHJvZHVjdChxdWF0ZXJuaW9uQSwgcXVhdGVybmlvbkIpIHtcbiAgY29uc3QgYTEgPSBxdWF0ZXJuaW9uQVswXSxcbiAgICAgICAgYjEgPSBxdWF0ZXJuaW9uQVsxXSxcbiAgICAgICAgYzEgPSBxdWF0ZXJuaW9uQVsyXSxcbiAgICAgICAgZDEgPSBxdWF0ZXJuaW9uQVszXSxcbiAgICAgICAgYTIgPSBxdWF0ZXJuaW9uQlswXSxcbiAgICAgICAgYjIgPSBxdWF0ZXJuaW9uQlsxXSxcbiAgICAgICAgYzIgPSBxdWF0ZXJuaW9uQlsyXSxcbiAgICAgICAgZDIgPSBxdWF0ZXJuaW9uQlszXSxcbiAgICAgICAgYSA9IGExICogYTIgLSBiMSAqIGIyIC0gYzEgKiBjMiAtIGQxICogZDIsXG4gICAgICAgIGIgPSBhMSAqIGIyICsgYjEgKiBhMiArIGMxICogZDIgLSBkMSAqIGMyLFxuICAgICAgICBjID0gYTEgKiBjMiAtIGIxICogZDIgKyBjMSAqIGEyICsgZDEgKiBiMixcbiAgICAgICAgZCA9IGExICogZDIgKyBiMSAqIGMyIC0gYzEgKiBiMiArIGQxICogYTIsXG4gICAgICAgIHF1YXRlcm5pb24gPSBbIGEsIGIsIGMsIGQgXTtcblxuICByZXR1cm4gcXVhdGVybmlvbjtcbn1cbiJdfQ==