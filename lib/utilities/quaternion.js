'use strict';

var vec3 = require('../maths/vec3'),
    arrayUtilities = require('../utilities/array'),
    angleUtilities = require('../utilities/angle');

var normalise = vec3.normalise,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    fourth = arrayUtilities.fourth,
    calculateHalfAngleCosine = angleUtilities.calculateHalfAngleCosine,
    calculateHalfAngleSine = angleUtilities.calculateHalfAngleSine;


function rotateImaginaryQuaternion(imaginaryQuaternion, rotationQuaternion, inverseRotationQuaternion) {
  var rotatedImaginaryQuaternion = hamiltonProduct(hamiltonProduct(rotationQuaternion, imaginaryQuaternion), inverseRotationQuaternion);

  return rotatedImaginaryQuaternion;
}

function calculateRotationQuaternion(normal) {
  var angleCosineBetweenNormalAndZAxis = calculateAngleCosineBetweenNormalAndZAxis(normal),
      crossProductOfNormalWithZAxis = calculateCrossProductOfNormalWithZAxis(normal),
      angleOfRotationCosine = angleCosineBetweenNormalAndZAxis,
      axisOfRotation = angleOfRotationCosine === 1 ? [0, 0, 1] : ///
  crossProductOfNormalWithZAxis,
      unitAxisOfRotation = normalise(axisOfRotation),
      halfAngleOfRotationCosine = calculateHalfAngleCosine(angleOfRotationCosine),
      halfAngleOfRotationSine = calculateHalfAngleSine(angleOfRotationCosine),
      unitAxisOfRotationComponents = unitAxisOfRotation,
      ///
  firstAxisOfRotationComponent = first(unitAxisOfRotationComponents),
      secondAxisOfRotationComponent = second(unitAxisOfRotationComponents),
      thirdAxisOfRotationComponent = third(unitAxisOfRotationComponents),
      rotationQuaternion = [halfAngleOfRotationCosine, firstAxisOfRotationComponent * halfAngleOfRotationSine, secondAxisOfRotationComponent * halfAngleOfRotationSine, thirdAxisOfRotationComponent * halfAngleOfRotationSine];

  return rotationQuaternion;
}

function calculateInverseRotationQuaternion(rotationQuaternion) {
  var rotationQuaternionComponents = rotationQuaternion,
      ///
  firstRotationQuaternionComponent = first(rotationQuaternionComponents),
      secondRotationQuaternionComponent = second(rotationQuaternionComponents),
      thirdRotationQuaternionComponent = third(rotationQuaternionComponents),
      fourthRotationQuaternionComponent = fourth(rotationQuaternionComponents),
      inverseRotationQuaternion = [firstRotationQuaternionComponent, -secondRotationQuaternionComponent, -thirdRotationQuaternionComponent, -fourthRotationQuaternionComponent];

  return inverseRotationQuaternion;
}

module.exports = {
  rotateImaginaryQuaternion: rotateImaginaryQuaternion,
  calculateRotationQuaternion: calculateRotationQuaternion,
  calculateInverseRotationQuaternion: calculateInverseRotationQuaternion
};

function calculateAngleCosineBetweenNormalAndZAxis(normal) {
  var unitNormal = normalise(normal),
      unitNormalComponents = unitNormal,
      ///
  thirdUnitNormalComponent = third(unitNormalComponents),
      angleCosineBetweenNormalAndZAxis = thirdUnitNormalComponent; ///

  return angleCosineBetweenNormalAndZAxis;
}

function calculateCrossProductOfNormalWithZAxis(normal) {
  var normalComponents = normal,
      ///
  firstNormalComponent = first(normalComponents),
      secondNormalComponent = second(normalComponents),
      crossProductOfNormalWithZAxis = [+secondNormalComponent, -firstNormalComponent, 0];

  return crossProductOfNormalWithZAxis;
}

function hamiltonProduct(quaternionA, quaternionB) {
  var quaternionAComponents = quaternionA,
      ///
  quaternionBComponents = quaternionB,
      ///
  firstQuaternionAComponent = first(quaternionAComponents),
      secondQuaternionAComponent = second(quaternionAComponents),
      thirdQuaternionAComponent = third(quaternionAComponents),
      fourthQuaternionAComponent = fourth(quaternionAComponents),
      firstQuaternionBComponent = first(quaternionBComponents),
      secondQuaternionBComponent = second(quaternionBComponents),
      thirdQuaternionBComponent = third(quaternionBComponents),
      fourthQuaternionBComponent = fourth(quaternionBComponents),
      a1 = firstQuaternionAComponent,
      b1 = secondQuaternionAComponent,
      c1 = thirdQuaternionAComponent,
      d1 = fourthQuaternionAComponent,
      a2 = firstQuaternionBComponent,
      b2 = secondQuaternionBComponent,
      c2 = thirdQuaternionBComponent,
      d2 = fourthQuaternionBComponent,
      a = a1 * a2 - b1 * b2 - c1 * c2 - d1 * d2,
      b = a1 * b2 + b1 * a2 + c1 * d2 - d1 * c2,
      c = a1 * c2 - b1 * d2 + c1 * a2 + d1 * b2,
      d = a1 * d2 + b1 * c2 - c1 * b2 + d1 * a2,
      quaternion = [a, b, c, d];

  return quaternion;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvcXVhdGVybmlvbi5qcyJdLCJuYW1lcyI6WyJ2ZWMzIiwicmVxdWlyZSIsImFycmF5VXRpbGl0aWVzIiwiYW5nbGVVdGlsaXRpZXMiLCJub3JtYWxpc2UiLCJmaXJzdCIsInNlY29uZCIsInRoaXJkIiwiZm91cnRoIiwiY2FsY3VsYXRlSGFsZkFuZ2xlQ29zaW5lIiwiY2FsY3VsYXRlSGFsZkFuZ2xlU2luZSIsInJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24iLCJpbWFnaW5hcnlRdWF0ZXJuaW9uIiwicm90YXRpb25RdWF0ZXJuaW9uIiwiaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbiIsInJvdGF0ZWRJbWFnaW5hcnlRdWF0ZXJuaW9uIiwiaGFtaWx0b25Qcm9kdWN0IiwiY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uIiwibm9ybWFsIiwiYW5nbGVDb3NpbmVCZXR3ZWVuTm9ybWFsQW5kWkF4aXMiLCJjYWxjdWxhdGVBbmdsZUNvc2luZUJldHdlZW5Ob3JtYWxBbmRaQXhpcyIsImNyb3NzUHJvZHVjdE9mTm9ybWFsV2l0aFpBeGlzIiwiY2FsY3VsYXRlQ3Jvc3NQcm9kdWN0T2ZOb3JtYWxXaXRoWkF4aXMiLCJhbmdsZU9mUm90YXRpb25Db3NpbmUiLCJheGlzT2ZSb3RhdGlvbiIsInVuaXRBeGlzT2ZSb3RhdGlvbiIsImhhbGZBbmdsZU9mUm90YXRpb25Db3NpbmUiLCJoYWxmQW5nbGVPZlJvdGF0aW9uU2luZSIsInVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMiLCJmaXJzdEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50Iiwic2Vjb25kQXhpc09mUm90YXRpb25Db21wb25lbnQiLCJ0aGlyZEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50IiwiY2FsY3VsYXRlSW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbiIsInJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMiLCJmaXJzdFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCIsInNlY29uZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCIsInRoaXJkUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50IiwiZm91cnRoUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50IiwibW9kdWxlIiwiZXhwb3J0cyIsInVuaXROb3JtYWwiLCJ1bml0Tm9ybWFsQ29tcG9uZW50cyIsInRoaXJkVW5pdE5vcm1hbENvbXBvbmVudCIsIm5vcm1hbENvbXBvbmVudHMiLCJmaXJzdE5vcm1hbENvbXBvbmVudCIsInNlY29uZE5vcm1hbENvbXBvbmVudCIsInF1YXRlcm5pb25BIiwicXVhdGVybmlvbkIiLCJxdWF0ZXJuaW9uQUNvbXBvbmVudHMiLCJxdWF0ZXJuaW9uQkNvbXBvbmVudHMiLCJmaXJzdFF1YXRlcm5pb25BQ29tcG9uZW50Iiwic2Vjb25kUXVhdGVybmlvbkFDb21wb25lbnQiLCJ0aGlyZFF1YXRlcm5pb25BQ29tcG9uZW50IiwiZm91cnRoUXVhdGVybmlvbkFDb21wb25lbnQiLCJmaXJzdFF1YXRlcm5pb25CQ29tcG9uZW50Iiwic2Vjb25kUXVhdGVybmlvbkJDb21wb25lbnQiLCJ0aGlyZFF1YXRlcm5pb25CQ29tcG9uZW50IiwiZm91cnRoUXVhdGVybmlvbkJDb21wb25lbnQiLCJhMSIsImIxIiwiYzEiLCJkMSIsImEyIiwiYjIiLCJjMiIsImQyIiwiYSIsImIiLCJjIiwiZCIsInF1YXRlcm5pb24iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQU1BLE9BQU9DLFFBQVEsZUFBUixDQUFiO0FBQUEsSUFDTUMsaUJBQWlCRCxRQUFRLG9CQUFSLENBRHZCO0FBQUEsSUFFTUUsaUJBQWlCRixRQUFRLG9CQUFSLENBRnZCOztBQUlNLElBQUVHLFNBQUYsR0FBZ0JKLElBQWhCLENBQUVJLFNBQUY7QUFBQSxJQUNFQyxLQURGLEdBQ21DSCxjQURuQyxDQUNFRyxLQURGO0FBQUEsSUFDU0MsTUFEVCxHQUNtQ0osY0FEbkMsQ0FDU0ksTUFEVDtBQUFBLElBQ2lCQyxLQURqQixHQUNtQ0wsY0FE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QUF6QixHQUE4QkQsS0FBS0UsRUFwQjdDO0FBQUEsTUFxQk1NLElBQUlYLEtBQUtPLEVBQUwsR0FBVU4sS0FBS0ssRUFBZixHQUFvQkosS0FBS0csRUFBekIsR0FBOEJGLEtBQUtDLEVBckI3QztBQUFBLE1Bc0JNUSxhQUFhLENBQUVKLENBQUYsRUFBS0MsQ0FBTCxFQUFRQyxDQUFSLEVBQVdDLENBQVgsQ0F0Qm5COztBQXdCQSxTQUFPQyxVQUFQO0FBQ0QiLCJmaWxlIjoicXVhdGVybmlvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgdmVjMyA9IHJlcXVpcmUoJy4uL21hdGhzL3ZlYzMnKSxcbiAgICAgIGFycmF5VXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2FycmF5JyksXG4gICAgICBhbmdsZVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hbmdsZScpO1xuXG5jb25zdCB7IG5vcm1hbGlzZSB9ID0gdmVjMyxcbiAgICAgIHsgZmlyc3QsIHNlY29uZCwgdGhpcmQsIGZvdXJ0aCB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IGNhbGN1bGF0ZUhhbGZBbmdsZUNvc2luZSwgY2FsY3VsYXRlSGFsZkFuZ2xlU2luZSB9ID0gYW5nbGVVdGlsaXRpZXM7XG5cbmZ1bmN0aW9uIHJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24oaW1hZ2luYXJ5UXVhdGVybmlvbiwgcm90YXRpb25RdWF0ZXJuaW9uLCBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uKSB7XG4gIGNvbnN0IHJvdGF0ZWRJbWFnaW5hcnlRdWF0ZXJuaW9uID0gaGFtaWx0b25Qcm9kdWN0KGhhbWlsdG9uUHJvZHVjdChyb3RhdGlvblF1YXRlcm5pb24sIGltYWdpbmFyeVF1YXRlcm5pb24pLCBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uKTtcblxuICByZXR1cm4gcm90YXRlZEltYWdpbmFyeVF1YXRlcm5pb247XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVJvdGF0aW9uUXVhdGVybmlvbihub3JtYWwpIHtcbiAgY29uc3QgYW5nbGVDb3NpbmVCZXR3ZWVuTm9ybWFsQW5kWkF4aXMgPSBjYWxjdWxhdGVBbmdsZUNvc2luZUJldHdlZW5Ob3JtYWxBbmRaQXhpcyhub3JtYWwpLFxuICAgICAgICBjcm9zc1Byb2R1Y3RPZk5vcm1hbFdpdGhaQXhpcyA9IGNhbGN1bGF0ZUNyb3NzUHJvZHVjdE9mTm9ybWFsV2l0aFpBeGlzKG5vcm1hbCksXG4gICAgICAgIGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSA9IGFuZ2xlQ29zaW5lQmV0d2Vlbk5vcm1hbEFuZFpBeGlzLFxuICAgICAgICBheGlzT2ZSb3RhdGlvbiA9IChhbmdsZU9mUm90YXRpb25Db3NpbmUgPT09IDEpID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIFswLCAwLCAxXSA6IC8vL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcm9zc1Byb2R1Y3RPZk5vcm1hbFdpdGhaQXhpcyxcbiAgICAgICAgdW5pdEF4aXNPZlJvdGF0aW9uID0gbm9ybWFsaXNlKGF4aXNPZlJvdGF0aW9uKSxcbiAgICAgICAgaGFsZkFuZ2xlT2ZSb3RhdGlvbkNvc2luZSA9IGNhbGN1bGF0ZUhhbGZBbmdsZUNvc2luZShhbmdsZU9mUm90YXRpb25Db3NpbmUpLFxuICAgICAgICBoYWxmQW5nbGVPZlJvdGF0aW9uU2luZSA9IGNhbGN1bGF0ZUhhbGZBbmdsZVNpbmUoYW5nbGVPZlJvdGF0aW9uQ29zaW5lKSxcbiAgICAgICAgdW5pdEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50cyA9IHVuaXRBeGlzT2ZSb3RhdGlvbiwgIC8vL1xuICAgICAgICBmaXJzdEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50ID0gZmlyc3QodW5pdEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50ID0gc2Vjb25kKHVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMpLFxuICAgICAgICB0aGlyZEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50ID0gdGhpcmQodW5pdEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50cyksXG4gICAgICAgIHJvdGF0aW9uUXVhdGVybmlvbiA9IFtcbiAgICAgICAgICBoYWxmQW5nbGVPZlJvdGF0aW9uQ29zaW5lLFxuICAgICAgICAgIGZpcnN0QXhpc09mUm90YXRpb25Db21wb25lbnQgKiBoYWxmQW5nbGVPZlJvdGF0aW9uU2luZSxcbiAgICAgICAgICBzZWNvbmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCAqIGhhbGZBbmdsZU9mUm90YXRpb25TaW5lLFxuICAgICAgICAgIHRoaXJkQXhpc09mUm90YXRpb25Db21wb25lbnQgKiBoYWxmQW5nbGVPZlJvdGF0aW9uU2luZVxuICAgICAgICBdO1xuXG4gIHJldHVybiByb3RhdGlvblF1YXRlcm5pb247XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb24ocm90YXRpb25RdWF0ZXJuaW9uKSB7XG4gIGNvbnN0IHJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMgPSByb3RhdGlvblF1YXRlcm5pb24sICAvLy9cbiAgICAgICAgZmlyc3RSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQgPSBmaXJzdChyb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzKSxcbiAgICAgICAgc2Vjb25kUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50ID0gc2Vjb25kKHJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMpLFxuICAgICAgICB0aGlyZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCA9IHRoaXJkKHJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMpLFxuICAgICAgICBmb3VydGhSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQgPSBmb3VydGgocm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50cyksXG4gICAgICAgIGludmVyc2VSb3RhdGlvblF1YXRlcm5pb24gPSBbXG4gICAgICAgICAgZmlyc3RSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQsXG4gICAgICAgICAgLXNlY29uZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCxcbiAgICAgICAgICAtdGhpcmRSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQsXG4gICAgICAgICAgLWZvdXJ0aFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudFxuICAgICAgICBdO1xuXG4gIHJldHVybiBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgcm90YXRlSW1hZ2luYXJ5UXVhdGVybmlvbjogcm90YXRlSW1hZ2luYXJ5UXVhdGVybmlvbixcbiAgY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uOiBjYWxjdWxhdGVSb3RhdGlvblF1YXRlcm5pb24sXG4gIGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb246IGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb25cbn07XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUFuZ2xlQ29zaW5lQmV0d2Vlbk5vcm1hbEFuZFpBeGlzKG5vcm1hbCkge1xuICBjb25zdCB1bml0Tm9ybWFsID0gbm9ybWFsaXNlKG5vcm1hbCksXG4gICAgICAgIHVuaXROb3JtYWxDb21wb25lbnRzID0gdW5pdE5vcm1hbCwgIC8vL1xuICAgICAgICB0aGlyZFVuaXROb3JtYWxDb21wb25lbnQgPSB0aGlyZCh1bml0Tm9ybWFsQ29tcG9uZW50cyksXG4gICAgICAgIGFuZ2xlQ29zaW5lQmV0d2Vlbk5vcm1hbEFuZFpBeGlzID0gdGhpcmRVbml0Tm9ybWFsQ29tcG9uZW50OyAgLy8vXG5cbiAgcmV0dXJuIGFuZ2xlQ29zaW5lQmV0d2Vlbk5vcm1hbEFuZFpBeGlzO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVDcm9zc1Byb2R1Y3RPZk5vcm1hbFdpdGhaQXhpcyhub3JtYWwpIHtcbiAgY29uc3Qgbm9ybWFsQ29tcG9uZW50cyA9IG5vcm1hbCwgIC8vL1xuICAgICAgICBmaXJzdE5vcm1hbENvbXBvbmVudCA9IGZpcnN0KG5vcm1hbENvbXBvbmVudHMpLFxuICAgICAgICBzZWNvbmROb3JtYWxDb21wb25lbnQgPSBzZWNvbmQobm9ybWFsQ29tcG9uZW50cyksXG4gICAgICAgIGNyb3NzUHJvZHVjdE9mTm9ybWFsV2l0aFpBeGlzID0gW1xuICAgICAgICAgICtzZWNvbmROb3JtYWxDb21wb25lbnQsXG4gICAgICAgICAgLWZpcnN0Tm9ybWFsQ29tcG9uZW50LFxuICAgICAgICAgIDBcbiAgICAgICAgXTtcblxuICByZXR1cm4gY3Jvc3NQcm9kdWN0T2ZOb3JtYWxXaXRoWkF4aXM7XG59XG5cbmZ1bmN0aW9uIGhhbWlsdG9uUHJvZHVjdChxdWF0ZXJuaW9uQSwgcXVhdGVybmlvbkIpIHtcbiAgY29uc3QgcXVhdGVybmlvbkFDb21wb25lbnRzID0gcXVhdGVybmlvbkEsICAvLy9cbiAgICAgICAgcXVhdGVybmlvbkJDb21wb25lbnRzID0gcXVhdGVybmlvbkIsICAvLy9cbiAgICAgICAgZmlyc3RRdWF0ZXJuaW9uQUNvbXBvbmVudCA9IGZpcnN0KHF1YXRlcm5pb25BQ29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZFF1YXRlcm5pb25BQ29tcG9uZW50ID0gc2Vjb25kKHF1YXRlcm5pb25BQ29tcG9uZW50cyksXG4gICAgICAgIHRoaXJkUXVhdGVybmlvbkFDb21wb25lbnQgPSB0aGlyZChxdWF0ZXJuaW9uQUNvbXBvbmVudHMpLFxuICAgICAgICBmb3VydGhRdWF0ZXJuaW9uQUNvbXBvbmVudCA9IGZvdXJ0aChxdWF0ZXJuaW9uQUNvbXBvbmVudHMpLFxuICAgICAgICBmaXJzdFF1YXRlcm5pb25CQ29tcG9uZW50ID0gZmlyc3QocXVhdGVybmlvbkJDb21wb25lbnRzKSxcbiAgICAgICAgc2Vjb25kUXVhdGVybmlvbkJDb21wb25lbnQgPSBzZWNvbmQocXVhdGVybmlvbkJDb21wb25lbnRzKSxcbiAgICAgICAgdGhpcmRRdWF0ZXJuaW9uQkNvbXBvbmVudCA9IHRoaXJkKHF1YXRlcm5pb25CQ29tcG9uZW50cyksXG4gICAgICAgIGZvdXJ0aFF1YXRlcm5pb25CQ29tcG9uZW50ID0gZm91cnRoKHF1YXRlcm5pb25CQ29tcG9uZW50cyksXG4gICAgICAgIGExID0gZmlyc3RRdWF0ZXJuaW9uQUNvbXBvbmVudCxcbiAgICAgICAgYjEgPSBzZWNvbmRRdWF0ZXJuaW9uQUNvbXBvbmVudCxcbiAgICAgICAgYzEgPSB0aGlyZFF1YXRlcm5pb25BQ29tcG9uZW50LFxuICAgICAgICBkMSA9IGZvdXJ0aFF1YXRlcm5pb25BQ29tcG9uZW50LFxuICAgICAgICBhMiA9IGZpcnN0UXVhdGVybmlvbkJDb21wb25lbnQsXG4gICAgICAgIGIyID0gc2Vjb25kUXVhdGVybmlvbkJDb21wb25lbnQsXG4gICAgICAgIGMyID0gdGhpcmRRdWF0ZXJuaW9uQkNvbXBvbmVudCxcbiAgICAgICAgZDIgPSBmb3VydGhRdWF0ZXJuaW9uQkNvbXBvbmVudCxcbiAgICAgICAgYSA9IGExICogYTIgLSBiMSAqIGIyIC0gYzEgKiBjMiAtIGQxICogZDIsXG4gICAgICAgIGIgPSBhMSAqIGIyICsgYjEgKiBhMiArIGMxICogZDIgLSBkMSAqIGMyLFxuICAgICAgICBjID0gYTEgKiBjMiAtIGIxICogZDIgKyBjMSAqIGEyICsgZDEgKiBiMixcbiAgICAgICAgZCA9IGExICogZDIgKyBiMSAqIGMyIC0gYzEgKiBiMiArIGQxICogYTIsXG4gICAgICAgIHF1YXRlcm5pb24gPSBbIGEsIGIsIGMsIGQgXTtcblxuICByZXR1cm4gcXVhdGVybmlvbjtcbn1cbiJdfQ==