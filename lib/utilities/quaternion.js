'use strict';

var vectorMaths = require('../maths/vector'),
    arrayUtilities = require('../utilities/array'),
    angleUtilities = require('../utilities/angle'),
    approximateUtilities = require('../utilities/approximate');

var dot3 = vectorMaths.dot3,
    cross3 = vectorMaths.cross3,
    normalise3 = vectorMaths.normalise3,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    fourth = arrayUtilities.fourth,
    isApproximatelyEqualToOne = approximateUtilities.isApproximatelyEqualToOne,
    calculateHalfAngleCosine = angleUtilities.calculateHalfAngleCosine,
    calculateHalfAngleSine = angleUtilities.calculateHalfAngleSine;


function rotateImaginaryQuaternion(imaginaryQuaternion, rotationQuaternion, inverseRotationQuaternion) {
  return hamiltonProduct(hamiltonProduct(rotationQuaternion, imaginaryQuaternion), inverseRotationQuaternion);
}

function calculateRotationQuaternion(normal) {
  var extent = normal.getExtent(),
      unitNormal = extent,
      ///
  zAxis = [0, 0, 1],
      dotProductOfUnitNormalAndZAxis = dot3(unitNormal, zAxis),
      crossProductOfUnitNormalAndZAxis = cross3(unitNormal, zAxis),
      angleOfRotationCosine = dotProductOfUnitNormalAndZAxis,
      ///
  angleOfRotationCosineAbsoluteValue = Math.abs(angleOfRotationCosine),
      angleOfRotationCosineAbsoluteValueApproximatelyEqualToOne = isApproximatelyEqualToOne(angleOfRotationCosineAbsoluteValue),
      axisOfRotation = angleOfRotationCosineAbsoluteValueApproximatelyEqualToOne ? [1, 0, 0] : ///
  crossProductOfUnitNormalAndZAxis,
      unitAxisOfRotation = normalise3(axisOfRotation),
      halfAngleOfRotationCosine = calculateHalfAngleCosine(angleOfRotationCosine),
      halfAngleOfRotationSine = calculateHalfAngleSine(angleOfRotationCosine),
      unitAxisOfRotationComponents = unitAxisOfRotation,
      ///
  firstAxisOfRotationComponent = first(unitAxisOfRotationComponents),
      secondAxisOfRotationComponent = second(unitAxisOfRotationComponents),
      thirdAxisOfRotationComponent = third(unitAxisOfRotationComponents),
      rotationQuaternion = [halfAngleOfRotationCosine, firstAxisOfRotationComponent * halfAngleOfRotationSine, secondAxisOfRotationComponent * halfAngleOfRotationSine, thirdAxisOfRotationComponent * halfAngleOfRotationSine];

  return rotationQuaternion;
}

function calculateInverseRotationQuaternion(rotationQuaternion) {
  var rotationQuaternionComponents = rotationQuaternion,
      ///
  firstRotationQuaternionComponent = first(rotationQuaternionComponents),
      secondRotationQuaternionComponent = second(rotationQuaternionComponents),
      thirdRotationQuaternionComponent = third(rotationQuaternionComponents),
      fourthRotationQuaternionComponent = fourth(rotationQuaternionComponents),
      inverseRotationQuaternion = [firstRotationQuaternionComponent, -secondRotationQuaternionComponent, -thirdRotationQuaternionComponent, -fourthRotationQuaternionComponent];

  return inverseRotationQuaternion;
}

function calculateForwardsRotationQuaternion(rotationQuaternion) {
  var forwardsRotationQuaternion = rotationQuaternion; ///

  return forwardsRotationQuaternion;
}

function calculateBackwardsRotationQuaternion(rotationQuaternion) {
  var inverseRotationQuaternion = calculateInverseRotationQuaternion(rotationQuaternion),
      backwardsRotationQuaternion = inverseRotationQuaternion; ///

  return backwardsRotationQuaternion;
}

module.exports = {
  rotateImaginaryQuaternion: rotateImaginaryQuaternion,
  calculateRotationQuaternion: calculateRotationQuaternion,
  calculateInverseRotationQuaternion: calculateInverseRotationQuaternion,
  calculateForwardsRotationQuaternion: calculateForwardsRotationQuaternion,
  calculateBackwardsRotationQuaternion: calculateBackwardsRotationQuaternion
};

function hamiltonProduct(quaternionA, quaternionB) {
  var quaternionAComponents = quaternionA,
      ///
  quaternionBComponents = quaternionB,
      ///
  firstQuaternionAComponent = first(quaternionAComponents),
      secondQuaternionAComponent = second(quaternionAComponents),
      thirdQuaternionAComponent = third(quaternionAComponents),
      fourthQuaternionAComponent = fourth(quaternionAComponents),
      firstQuaternionBComponent = first(quaternionBComponents),
      secondQuaternionBComponent = second(quaternionBComponents),
      thirdQuaternionBComponent = third(quaternionBComponents),
      fourthQuaternionBComponent = fourth(quaternionBComponents),
      a1 = firstQuaternionAComponent,
      ///
  b1 = secondQuaternionAComponent,
      ///
  c1 = thirdQuaternionAComponent,
      ///
  d1 = fourthQuaternionAComponent,
      ///
  a2 = firstQuaternionBComponent,
      ///
  b2 = secondQuaternionBComponent,
      ///
  c2 = thirdQuaternionBComponent,
      ///
  d2 = fourthQuaternionBComponent,
      ///
  a = a1 * a2 - b1 * b2 - c1 * c2 - d1 * d2,
      b = a1 * b2 + b1 * a2 + c1 * d2 - d1 * c2,
      c = a1 * c2 - b1 * d2 + c1 * a2 + d1 * b2,
      d = a1 * d2 + b1 * c2 - c1 * b2 + d1 * a2,
      quaternion = [a, b, c, d];

  return quaternion;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvcXVhdGVybmlvbi5qcyJdLCJuYW1lcyI6WyJ2ZWN0b3JNYXRocyIsInJlcXVpcmUiLCJhcnJheVV0aWxpdGllcyIsImFuZ2xlVXRpbGl0aWVzIiwiYXBwcm94aW1hdGVVdGlsaXRpZXMiLCJkb3QzIiwiY3Jvc3MzIiwibm9ybWFsaXNlMyIsImZpcnN0Iiwic2Vjb25kIiwidGhpcmQiLCJmb3VydGgiLCJpc0FwcHJveGltYXRlbHlFcXVhbFRvT25lIiwiY2FsY3VsYXRlSGFsZkFuZ2xlQ29zaW5lIiwiY2FsY3VsYXRlSGFsZkFuZ2xlU2luZSIsInJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24iLCJpbWFnaW5hcnlRdWF0ZXJuaW9uIiwicm90YXRpb25RdWF0ZXJuaW9uIiwiaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbiIsImhhbWlsdG9uUHJvZHVjdCIsImNhbGN1bGF0ZVJvdGF0aW9uUXVhdGVybmlvbiIsIm5vcm1hbCIsImV4dGVudCIsImdldEV4dGVudCIsInVuaXROb3JtYWwiLCJ6QXhpcyIsImRvdFByb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcyIsImNyb3NzUHJvZHVjdE9mVW5pdE5vcm1hbEFuZFpBeGlzIiwiYW5nbGVPZlJvdGF0aW9uQ29zaW5lIiwiYW5nbGVPZlJvdGF0aW9uQ29zaW5lQWJzb2x1dGVWYWx1ZSIsIk1hdGgiLCJhYnMiLCJhbmdsZU9mUm90YXRpb25Db3NpbmVBYnNvbHV0ZVZhbHVlQXBwcm94aW1hdGVseUVxdWFsVG9PbmUiLCJheGlzT2ZSb3RhdGlvbiIsInVuaXRBeGlzT2ZSb3RhdGlvbiIsImhhbGZBbmdsZU9mUm90YXRpb25Db3NpbmUiLCJoYWxmQW5nbGVPZlJvdGF0aW9uU2luZSIsInVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMiLCJmaXJzdEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50Iiwic2Vjb25kQXhpc09mUm90YXRpb25Db21wb25lbnQiLCJ0aGlyZEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50IiwiY2FsY3VsYXRlSW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbiIsInJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMiLCJmaXJzdFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCIsInNlY29uZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCIsInRoaXJkUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50IiwiZm91cnRoUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50IiwiY2FsY3VsYXRlRm9yd2FyZHNSb3RhdGlvblF1YXRlcm5pb24iLCJmb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbiIsImNhbGN1bGF0ZUJhY2t3YXJkc1JvdGF0aW9uUXVhdGVybmlvbiIsImJhY2t3YXJkc1JvdGF0aW9uUXVhdGVybmlvbiIsIm1vZHVsZSIsImV4cG9ydHMiLCJxdWF0ZXJuaW9uQSIsInF1YXRlcm5pb25CIiwicXVhdGVybmlvbkFDb21wb25lbnRzIiwicXVhdGVybmlvbkJDb21wb25lbnRzIiwiZmlyc3RRdWF0ZXJuaW9uQUNvbXBvbmVudCIsInNlY29uZFF1YXRlcm5pb25BQ29tcG9uZW50IiwidGhpcmRRdWF0ZXJuaW9uQUNvbXBvbmVudCIsImZvdXJ0aFF1YXRlcm5pb25BQ29tcG9uZW50IiwiZmlyc3RRdWF0ZXJuaW9uQkNvbXBvbmVudCIsInNlY29uZFF1YXRlcm5pb25CQ29tcG9uZW50IiwidGhpcmRRdWF0ZXJuaW9uQkNvbXBvbmVudCIsImZvdXJ0aFF1YXRlcm5pb25CQ29tcG9uZW50IiwiYTEiLCJiMSIsImMxIiwiZDEiLCJhMiIsImIyIiwiYzIiLCJkMiIsImEiLCJiIiwiYyIsImQiLCJxdWF0ZXJuaW9uIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxjQUFjQyxRQUFRLGlCQUFSLENBQXBCO0FBQUEsSUFDTUMsaUJBQWlCRCxRQUFRLG9CQUFSLENBRHZCO0FBQUEsSUFFTUUsaUJBQWlCRixRQUFRLG9CQUFSLENBRnZCO0FBQUEsSUFHTUcsdUJBQXVCSCxRQUFRLDBC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QUNsQ1MsTUFBSVIsS0FBS0ksRUFBTCxHQUFVSCxLQUFLSSxFQUFmLEdBQW9CSCxLQUFLSSxFQUF6QixHQUE4QkgsS0FBS0ksRUFsQjdDO0FBQUEsTUFtQk1FLElBQUlULEtBQUtLLEVBQUwsR0FBVUosS0FBS0csRUFBZixHQUFvQkYsS0FBS0ssRUFBekIsR0FBOEJKLEtBQUtHLEVBbkI3QztBQUFBLE1Bb0JNSSxJQUFJVixLQUFLTSxFQUFMLEdBQVVMLEtBQUtNLEVBQWYsR0FBb0JMLEtBQUtFLEVBQXpCLEdBQThCRCxLQUFLRSxFQXBCN0M7QUFBQSxNQXFCTU0sSUFBSVgsS0FBS08sRUFBTCxHQUFVTixLQUFLSyxFQUFmLEdBQW9CSixLQUFLRyxFQUF6QixHQUE4QkYsS0FBS0MsRUFyQjdDO0FBQUEsTUFzQk1RLGFBQWEsQ0FBRUosQ0FBRixFQUFLQyxDQUFMLEVBQVFDLENBQVIsRUFBV0MsQ0FBWCxDQXRCbkI7O0FBd0JBLFNBQU9DLFVBQVA7QUFDRCIsImZpbGUiOiJxdWF0ZXJuaW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCB2ZWN0b3JNYXRocyA9IHJlcXVpcmUoJy4uL21hdGhzL3ZlY3RvcicpLFxuICAgICAgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvYXJyYXknKSxcbiAgICAgIGFuZ2xlVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2FuZ2xlJyksXG4gICAgICBhcHByb3hpbWF0ZVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcHByb3hpbWF0ZScpO1xuXG5jb25zdCB7IGRvdDMsIGNyb3NzMywgbm9ybWFsaXNlMyB9ID0gdmVjdG9yTWF0aHMsXG4gICAgICB7IGZpcnN0LCBzZWNvbmQsIHRoaXJkLCBmb3VydGggfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBpc0FwcHJveGltYXRlbHlFcXVhbFRvT25lIH0gPSBhcHByb3hpbWF0ZVV0aWxpdGllcyxcbiAgICAgIHsgY2FsY3VsYXRlSGFsZkFuZ2xlQ29zaW5lLCBjYWxjdWxhdGVIYWxmQW5nbGVTaW5lIH0gPSBhbmdsZVV0aWxpdGllcztcblxuZnVuY3Rpb24gcm90YXRlSW1hZ2luYXJ5UXVhdGVybmlvbihpbWFnaW5hcnlRdWF0ZXJuaW9uLCByb3RhdGlvblF1YXRlcm5pb24sIGludmVyc2VSb3RhdGlvblF1YXRlcm5pb24pIHsgcmV0dXJuIGhhbWlsdG9uUHJvZHVjdChoYW1pbHRvblByb2R1Y3Qocm90YXRpb25RdWF0ZXJuaW9uLCBpbWFnaW5hcnlRdWF0ZXJuaW9uKSwgaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbik7IH1cblxuZnVuY3Rpb24gY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uKG5vcm1hbCkge1xuICBjb25zdCBleHRlbnQgPSBub3JtYWwuZ2V0RXh0ZW50KCksXG4gICAgICAgIHVuaXROb3JtYWwgPSBleHRlbnQsICAvLy9cbiAgICAgICAgekF4aXMgPSBbIDAsIDAsIDFdLFxuICAgICAgICBkb3RQcm9kdWN0T2ZVbml0Tm9ybWFsQW5kWkF4aXMgPSBkb3QzKHVuaXROb3JtYWwsIHpBeGlzKSxcbiAgICAgICAgY3Jvc3NQcm9kdWN0T2ZVbml0Tm9ybWFsQW5kWkF4aXMgPSBjcm9zczModW5pdE5vcm1hbCwgekF4aXMpLFxuICAgICAgICBhbmdsZU9mUm90YXRpb25Db3NpbmUgPSBkb3RQcm9kdWN0T2ZVbml0Tm9ybWFsQW5kWkF4aXMsIC8vL1xuICAgICAgICBhbmdsZU9mUm90YXRpb25Db3NpbmVBYnNvbHV0ZVZhbHVlID0gTWF0aC5hYnMoYW5nbGVPZlJvdGF0aW9uQ29zaW5lKSxcbiAgICAgICAgYW5nbGVPZlJvdGF0aW9uQ29zaW5lQWJzb2x1dGVWYWx1ZUFwcHJveGltYXRlbHlFcXVhbFRvT25lID0gaXNBcHByb3hpbWF0ZWx5RXF1YWxUb09uZShhbmdsZU9mUm90YXRpb25Db3NpbmVBYnNvbHV0ZVZhbHVlKSxcbiAgICAgICAgYXhpc09mUm90YXRpb24gPSBhbmdsZU9mUm90YXRpb25Db3NpbmVBYnNvbHV0ZVZhbHVlQXBwcm94aW1hdGVseUVxdWFsVG9PbmUgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgWyAxLCAwLCAwIF0gOiAvLy9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Jvc3NQcm9kdWN0T2ZVbml0Tm9ybWFsQW5kWkF4aXMsXG4gICAgICAgIHVuaXRBeGlzT2ZSb3RhdGlvbiA9IG5vcm1hbGlzZTMoYXhpc09mUm90YXRpb24pLFxuICAgICAgICBoYWxmQW5nbGVPZlJvdGF0aW9uQ29zaW5lID0gY2FsY3VsYXRlSGFsZkFuZ2xlQ29zaW5lKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSksXG4gICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25TaW5lID0gY2FsY3VsYXRlSGFsZkFuZ2xlU2luZShhbmdsZU9mUm90YXRpb25Db3NpbmUpLFxuICAgICAgICB1bml0QXhpc09mUm90YXRpb25Db21wb25lbnRzID0gdW5pdEF4aXNPZlJvdGF0aW9uLCAgLy8vXG4gICAgICAgIGZpcnN0QXhpc09mUm90YXRpb25Db21wb25lbnQgPSBmaXJzdCh1bml0QXhpc09mUm90YXRpb25Db21wb25lbnRzKSxcbiAgICAgICAgc2Vjb25kQXhpc09mUm90YXRpb25Db21wb25lbnQgPSBzZWNvbmQodW5pdEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50cyksXG4gICAgICAgIHRoaXJkQXhpc09mUm90YXRpb25Db21wb25lbnQgPSB0aGlyZCh1bml0QXhpc09mUm90YXRpb25Db21wb25lbnRzKSxcbiAgICAgICAgcm90YXRpb25RdWF0ZXJuaW9uID0gW1xuICAgICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25Db3NpbmUsXG4gICAgICAgICAgZmlyc3RBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCAqIGhhbGZBbmdsZU9mUm90YXRpb25TaW5lLFxuICAgICAgICAgIHNlY29uZEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50ICogaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmUsXG4gICAgICAgICAgdGhpcmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCAqIGhhbGZBbmdsZU9mUm90YXRpb25TaW5lXG4gICAgICAgIF07XG5cbiAgcmV0dXJuIHJvdGF0aW9uUXVhdGVybmlvbjtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlSW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbihyb3RhdGlvblF1YXRlcm5pb24pIHtcbiAgY29uc3Qgcm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50cyA9IHJvdGF0aW9uUXVhdGVybmlvbiwgIC8vL1xuICAgICAgICBmaXJzdFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCA9IGZpcnN0KHJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMpLFxuICAgICAgICBzZWNvbmRSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQgPSBzZWNvbmQocm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50cyksXG4gICAgICAgIHRoaXJkUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50ID0gdGhpcmQocm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50cyksXG4gICAgICAgIGZvdXJ0aFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCA9IGZvdXJ0aChyb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzKSxcbiAgICAgICAgaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbiA9IFtcbiAgICAgICAgICBmaXJzdFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCxcbiAgICAgICAgICAtc2Vjb25kUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50LFxuICAgICAgICAgIC10aGlyZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCxcbiAgICAgICAgICAtZm91cnRoUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50XG4gICAgICAgIF07XG5cbiAgcmV0dXJuIGludmVyc2VSb3RhdGlvblF1YXRlcm5pb247XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25RdWF0ZXJuaW9uKHJvdGF0aW9uUXVhdGVybmlvbikge1xuICBjb25zdCBmb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbiA9IHJvdGF0aW9uUXVhdGVybmlvbjsgIC8vL1xuXG4gIHJldHVybiBmb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbjtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlQmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uKHJvdGF0aW9uUXVhdGVybmlvbikge1xuICBjb25zdCBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uID0gY2FsY3VsYXRlSW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbihyb3RhdGlvblF1YXRlcm5pb24pLFxuICAgICAgICBiYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb24gPSBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uOyAgLy8vXG5cbiAgcmV0dXJuIGJhY2t3YXJkc1JvdGF0aW9uUXVhdGVybmlvbjtcblxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgcm90YXRlSW1hZ2luYXJ5UXVhdGVybmlvbjogcm90YXRlSW1hZ2luYXJ5UXVhdGVybmlvbixcbiAgY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uOiBjYWxjdWxhdGVSb3RhdGlvblF1YXRlcm5pb24sXG4gIGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb246IGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb24sXG4gIGNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25RdWF0ZXJuaW9uOiBjYWxjdWxhdGVGb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbixcbiAgY2FsY3VsYXRlQmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uOiBjYWxjdWxhdGVCYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb25cbn07XG5cbmZ1bmN0aW9uIGhhbWlsdG9uUHJvZHVjdChxdWF0ZXJuaW9uQSwgcXVhdGVybmlvbkIpIHtcbiAgY29uc3QgcXVhdGVybmlvbkFDb21wb25lbnRzID0gcXVhdGVybmlvbkEsICAvLy9cbiAgICAgICAgcXVhdGVybmlvbkJDb21wb25lbnRzID0gcXVhdGVybmlvbkIsICAvLy9cbiAgICAgICAgZmlyc3RRdWF0ZXJuaW9uQUNvbXBvbmVudCA9IGZpcnN0KHF1YXRlcm5pb25BQ29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZFF1YXRlcm5pb25BQ29tcG9uZW50ID0gc2Vjb25kKHF1YXRlcm5pb25BQ29tcG9uZW50cyksXG4gICAgICAgIHRoaXJkUXVhdGVybmlvbkFDb21wb25lbnQgPSB0aGlyZChxdWF0ZXJuaW9uQUNvbXBvbmVudHMpLFxuICAgICAgICBmb3VydGhRdWF0ZXJuaW9uQUNvbXBvbmVudCA9IGZvdXJ0aChxdWF0ZXJuaW9uQUNvbXBvbmVudHMpLFxuICAgICAgICBmaXJzdFF1YXRlcm5pb25CQ29tcG9uZW50ID0gZmlyc3QocXVhdGVybmlvbkJDb21wb25lbnRzKSxcbiAgICAgICAgc2Vjb25kUXVhdGVybmlvbkJDb21wb25lbnQgPSBzZWNvbmQocXVhdGVybmlvbkJDb21wb25lbnRzKSxcbiAgICAgICAgdGhpcmRRdWF0ZXJuaW9uQkNvbXBvbmVudCA9IHRoaXJkKHF1YXRlcm5pb25CQ29tcG9uZW50cyksXG4gICAgICAgIGZvdXJ0aFF1YXRlcm5pb25CQ29tcG9uZW50ID0gZm91cnRoKHF1YXRlcm5pb25CQ29tcG9uZW50cyksXG4gICAgICAgIGExID0gZmlyc3RRdWF0ZXJuaW9uQUNvbXBvbmVudCwgLy8vXG4gICAgICAgIGIxID0gc2Vjb25kUXVhdGVybmlvbkFDb21wb25lbnQsICAvLy9cbiAgICAgICAgYzEgPSB0aGlyZFF1YXRlcm5pb25BQ29tcG9uZW50LCAvLy9cbiAgICAgICAgZDEgPSBmb3VydGhRdWF0ZXJuaW9uQUNvbXBvbmVudCwgIC8vL1xuICAgICAgICBhMiA9IGZpcnN0UXVhdGVybmlvbkJDb21wb25lbnQsIC8vL1xuICAgICAgICBiMiA9IHNlY29uZFF1YXRlcm5pb25CQ29tcG9uZW50LCAgLy8vXG4gICAgICAgIGMyID0gdGhpcmRRdWF0ZXJuaW9uQkNvbXBvbmVudCwgLy8vXG4gICAgICAgIGQyID0gZm91cnRoUXVhdGVybmlvbkJDb21wb25lbnQsICAvLy9cbiAgICAgICAgYSA9IGExICogYTIgLSBiMSAqIGIyIC0gYzEgKiBjMiAtIGQxICogZDIsXG4gICAgICAgIGIgPSBhMSAqIGIyICsgYjEgKiBhMiArIGMxICogZDIgLSBkMSAqIGMyLFxuICAgICAgICBjID0gYTEgKiBjMiAtIGIxICogZDIgKyBjMSAqIGEyICsgZDEgKiBiMixcbiAgICAgICAgZCA9IGExICogZDIgKyBiMSAqIGMyIC0gYzEgKiBiMiArIGQxICogYTIsXG4gICAgICAgIHF1YXRlcm5pb24gPSBbIGEsIGIsIGMsIGQgXTtcblxuICByZXR1cm4gcXVhdGVybmlvbjtcbn1cbiJdfQ==