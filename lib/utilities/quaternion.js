'use strict';

var vectorMaths = require('../maths/vector'),
    arrayUtilities = require('../utilities/array'),
    angleUtilities = require('../utilities/angle'),
    approximateUtilities = require('../utilities/approximate');

var dot3 = vectorMaths.dot3,
    cross3 = vectorMaths.cross3,
    normalise3 = vectorMaths.normalise3,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    fourth = arrayUtilities.fourth,
    isApproximatelyEqualToOne = approximateUtilities.isApproximatelyEqualToOne,
    calculateHalfAngleCosine = angleUtilities.calculateHalfAngleCosine,
    calculateHalfAngleSine = angleUtilities.calculateHalfAngleSine;


function rotateImaginaryQuaternion(imaginaryQuaternion, rotationQuaternion, inverseRotationQuaternion) {
  return hamiltonProduct(hamiltonProduct(rotationQuaternion, imaginaryQuaternion), inverseRotationQuaternion);
}

function calculateArbitraryRotationQuaternion(normal) {
  var extent = normal.getExtent(),
      unitNormal = extent,
      ///
  zAxis = [0, 0, 1],
      dotProductOfUnitNormalAndZAxis = dot3(unitNormal, zAxis),
      crossProductOfUnitNormalAndZAxis = cross3(unitNormal, zAxis),
      angleOfRotationCosine = dotProductOfUnitNormalAndZAxis,
      ///
  angleOfRotationCosineAbsoluteValue = Math.abs(angleOfRotationCosine),
      angleOfRotationCosineAbsoluteValueApproximatelyEqualToOne = isApproximatelyEqualToOne(angleOfRotationCosineAbsoluteValue),
      axisOfRotation = angleOfRotationCosineAbsoluteValueApproximatelyEqualToOne ? [1, 0, 0] : ///
  crossProductOfUnitNormalAndZAxis,
      unitAxisOfRotation = normalise3(axisOfRotation),
      halfAngleOfRotationCosine = calculateHalfAngleCosine(angleOfRotationCosine),
      halfAngleOfRotationSine = calculateHalfAngleSine(angleOfRotationCosine),
      unitAxisOfRotationComponents = unitAxisOfRotation,
      ///
  firstAxisOfRotationComponent = first(unitAxisOfRotationComponents),
      secondAxisOfRotationComponent = second(unitAxisOfRotationComponents),
      thirdAxisOfRotationComponent = third(unitAxisOfRotationComponents),
      arbitraryRotationQuaternion = [halfAngleOfRotationCosine, firstAxisOfRotationComponent * halfAngleOfRotationSine, secondAxisOfRotationComponent * halfAngleOfRotationSine, thirdAxisOfRotationComponent * halfAngleOfRotationSine];

  return arbitraryRotationQuaternion;
}

function calculateRotationAboutZAxisQuaternion(maskingEdge) {
  var maskingEdgeExtent = maskingEdge.getExtent(),
      unitMaskingEdgeExtent = normalise3(maskingEdgeExtent),
      unitMaskingEdgeExtentComponents = unitMaskingEdgeExtent,
      ///
  firstUnitMaskingEdgeExtentComponent = first(unitMaskingEdgeExtentComponents),
      secondUnitMaskingEdgeExtentComponent = second(unitMaskingEdgeExtentComponents),
      angleOfRotationSine = firstUnitMaskingEdgeExtentComponent,
      ///
  angleOfRotationCosine = secondUnitMaskingEdgeExtentComponent,
      ///
  halfAngleOfRotationCosine = calculateHalfAngleCosine(angleOfRotationCosine),
      halfAngleOfRotationSine = angleOfRotationSine > 0 ? +calculateHalfAngleSine(angleOfRotationCosine) : -calculateHalfAngleSine(angleOfRotationCosine),
      rotationAboutZAxisQuaternion = [halfAngleOfRotationCosine, 0, 0, halfAngleOfRotationSine];

  return rotationAboutZAxisQuaternion;
}

function calculateInverseRotationQuaternion(rotationQuaternion) {
  var rotationQuaternionComponents = rotationQuaternion,
      ///
  firstRotationQuaternionComponent = first(rotationQuaternionComponents),
      secondRotationQuaternionComponent = second(rotationQuaternionComponents),
      thirdRotationQuaternionComponent = third(rotationQuaternionComponents),
      fourthRotationQuaternionComponent = fourth(rotationQuaternionComponents),
      inverseRotationQuaternion = [firstRotationQuaternionComponent, -secondRotationQuaternionComponent, -thirdRotationQuaternionComponent, -fourthRotationQuaternionComponent];

  return inverseRotationQuaternion;
}

function calculateForwardsRotationQuaternion(rotationQuaternion) {
  var forwardsRotationQuaternion = rotationQuaternion; ///

  return forwardsRotationQuaternion;
}

function calculateBackwardsRotationQuaternion(rotationQuaternion) {
  var inverseRotationQuaternion = calculateInverseRotationQuaternion(rotationQuaternion),
      backwardsRotationQuaternion = inverseRotationQuaternion; ///

  return backwardsRotationQuaternion;
}

module.exports = {
  rotateImaginaryQuaternion: rotateImaginaryQuaternion,
  calculateArbitraryRotationQuaternion: calculateArbitraryRotationQuaternion,
  calculateRotationAboutZAxisQuaternion: calculateRotationAboutZAxisQuaternion,
  calculateInverseRotationQuaternion: calculateInverseRotationQuaternion,
  calculateForwardsRotationQuaternion: calculateForwardsRotationQuaternion,
  calculateBackwardsRotationQuaternion: calculateBackwardsRotationQuaternion
};

function hamiltonProduct(quaternionA, quaternionB) {
  var quaternionAComponents = quaternionA,
      ///
  quaternionBComponents = quaternionB,
      ///
  firstQuaternionAComponent = first(quaternionAComponents),
      secondQuaternionAComponent = second(quaternionAComponents),
      thirdQuaternionAComponent = third(quaternionAComponents),
      fourthQuaternionAComponent = fourth(quaternionAComponents),
      firstQuaternionBComponent = first(quaternionBComponents),
      secondQuaternionBComponent = second(quaternionBComponents),
      thirdQuaternionBComponent = third(quaternionBComponents),
      fourthQuaternionBComponent = fourth(quaternionBComponents),
      a1 = firstQuaternionAComponent,
      ///
  b1 = secondQuaternionAComponent,
      ///
  c1 = thirdQuaternionAComponent,
      ///
  d1 = fourthQuaternionAComponent,
      ///
  a2 = firstQuaternionBComponent,
      ///
  b2 = secondQuaternionBComponent,
      ///
  c2 = thirdQuaternionBComponent,
      ///
  d2 = fourthQuaternionBComponent,
      ///
  a = a1 * a2 - b1 * b2 - c1 * c2 - d1 * d2,
      b = a1 * b2 + b1 * a2 + c1 * d2 - d1 * c2,
      c = a1 * c2 - b1 * d2 + c1 * a2 + d1 * b2,
      d = a1 * d2 + b1 * c2 - c1 * b2 + d1 * a2,
      quaternion = [a, b, c, d];

  return quaternion;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvcXVhdGVybmlvbi5qcyJdLCJuYW1lcyI6WyJ2ZWN0b3JNYXRocyIsInJlcXVpcmUiLCJhcnJheVV0aWxpdGllcyIsImFuZ2xlVXRpbGl0aWVzIiwiYXBwcm94aW1hdGVVdGlsaXRpZXMiLCJkb3QzIiwiY3Jvc3MzIiwibm9ybWFsaXNlMyIsImZpcnN0Iiwic2Vjb25kIiwidGhpcmQiLCJmb3VydGgiLCJpc0FwcHJveGltYXRlbHlFcXVhbFRvT25lIiwiY2FsY3VsYXRlSGFsZkFuZ2xlQ29zaW5lIiwiY2FsY3VsYXRlSGFsZkFuZ2xlU2luZSIsInJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24iLCJpbWFnaW5hcnlRdWF0ZXJuaW9uIiwicm90YXRpb25RdWF0ZXJuaW9uIiwiaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbiIsImhhbWlsdG9uUHJvZHVjdCIsImNhbGN1bGF0ZUFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbiIsIm5vcm1hbCIsImV4dGVudCIsImdldEV4dGVudCIsInVuaXROb3JtYWwiLCJ6QXhpcyIsImRvdFByb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcyIsImNyb3NzUHJvZHVjdE9mVW5pdE5vcm1hbEFuZFpBeGlzIiwiYW5nbGVPZlJvdGF0aW9uQ29zaW5lIiwiYW5nbGVPZlJvdGF0aW9uQ29zaW5lQWJzb2x1dGVWYWx1ZSIsIk1hdGgiLCJhYnMiLCJhbmdsZU9mUm90YXRpb25Db3NpbmVBYnNvbHV0ZVZhbHVlQXBwcm94aW1hdGVseUVxdWFsVG9PbmUiLCJheGlzT2ZSb3RhdGlvbiIsInVuaXRBeGlzT2ZSb3RhdGlvbiIsImhhbGZBbmdsZU9mUm90YXRpb25Db3NpbmUiLCJoYWxmQW5nbGVPZlJvdGF0aW9uU2luZSIsInVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMiLCJmaXJzdEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50Iiwic2Vjb25kQXhpc09mUm90YXRpb25Db21wb25lbnQiLCJ0aGlyZEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50IiwiYXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uIiwiY2FsY3VsYXRlUm90YXRpb25BYm91dFpBeGlzUXVhdGVybmlvbiIsIm1hc2tpbmdFZGdlIiwibWFza2luZ0VkZ2VFeHRlbnQiLCJ1bml0TWFza2luZ0VkZ2VFeHRlbnQiLCJ1bml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnRzIiwiZmlyc3RVbml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnQiLCJzZWNvbmRVbml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnQiLCJhbmdsZU9mUm90YXRpb25TaW5lIiwicm90YXRpb25BYm91dFpBeGlzUXVhdGVybmlvbiIsImNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb24iLCJyb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzIiwiZmlyc3RSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQiLCJzZWNvbmRSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQiLCJ0aGlyZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCIsImZvdXJ0aFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCIsImNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25RdWF0ZXJuaW9uIiwiZm9yd2FyZHNSb3RhdGlvblF1YXRlcm5pb24iLCJjYWxjdWxhdGVCYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb24iLCJiYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb24iLCJtb2R1bGUiLCJleHBvcnRzIiwicXVhdGVybmlvbkEiLCJxdWF0ZXJuaW9uQiIsInF1YXRlcm5pb25BQ29tcG9uZW50cyIsInF1YXRlcm5pb25CQ29tcG9uZW50cyIsImZpcnN0UXVhdGVybmlvbkFDb21wb25lbnQiLCJzZWNvbmRRdWF0ZXJuaW9uQUNvbXBvbmVudCIsInRoaXJkUXVhdGVybmlvbkFDb21wb25lbnQiLCJmb3VydGhRdWF0ZXJuaW9uQUNvbXBvbmVudCIsImZpcnN0UXVhdGVybmlvbkJDb21wb25lbnQiLCJzZWNvbmRRdWF0ZXJuaW9uQkNvbXBvbmVudCIsInRoaXJkUXVhdGVybmlvbkJDb21wb25lbnQiLCJmb3VydGhRdWF0ZXJuaW9uQkNvbXBvbmVudCIsImExIiwiYjEiLCJjMSIsImQxIiwiYTIiLCJiMiIsImMyIiwiZDIiLCJhIiwiYiIsImMiLCJkIiwicXVhdGVybmlvbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsY0FBY0MsUUFBUSxpQkFBUixDQUFwQjtBQUFBLElBQ01DLGlCQUFpQkQsUUFBUSxvQkFBUixDQUR2QjtBQUFBLElBRU1FLGlCQUFpQkYsUUFBUSxvQkFBUixDQUZ2QjtBQUFBLElBR01HLHVCQUF1QkgsUUFBUSwwQkFBUixDQUg3Qjs7SUFLUUksSSxHQUE2QkwsVyxDQUE3QkssSTtJQUFNQyxNLEdBQXVCTixXLENBQXZCTSxNO0lBQVFDLFUsR0FBZVAsVyxDQUFmTyxVO0lBQ2RDLEssR0FBaUNOLGMsQ0FBakNNLEs7SUFBT0MsTSxHQUEwQlAsYyxDQUExQk8sTTtJQUFRQyxLLEdBQWtCUixjLENBQWxCUSxLO0lBQU9DLE0sR0FBV1QsYyxDQUFYUyxNO0lBQ3RCQyx5QixHQUE4QlIsb0IsQ0FBOUJRLHlCO0lBQ0FDLHdCLEdBQXFEVixjLENBQXJEVSx3QjtJQUEwQkMsc0IsR0FBMkJYLGMsQ0FBM0JXLHNCOzs7QUFFbEMsU0FBU0MseUJBQVQsQ0FBbUNDLG1CQUFuQyxFQUF3REMsa0JBQXhELEVBQTRFQyx5QkFBNUUsRUFBdUc7QUFBRSxTQUFPQyxnQkFBZ0JBLGdCQUFnQkYsa0JBQWhCLEVBQW9DRCxtQkFBcEMsQ0FBaEIsRUFBMEVFLHlCQUExRSxDQUFQO0FBQThHOztBQUV2TixTQUFTRSxvQ0FBVCxDQUE4Q0MsTUFBOUMsRUFBc0Q7QUFDcEQsTUFBTUMsU0FBU0QsT0FBT0UsU0FBUCxFQUFmO0FBQUEsTUFDTUMsYUFBYUYsTUFEbkI7QUFBQSxNQUM0QjtBQUN0QkcsVUFBUSxDQUFFLENBQUYsRUFBSyxDQUFMLEVBQVEsQ0FBUixDQUZkO0FBQUEsTUFHTUMsaUNBQWlDckIsS0FB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S0ssRUFBTCxHQUFVSixLQUFLRyxFQUFmLEdBQW9CRixLQUFLSyxFQUF6QixHQUE4QkosS0FBS0csRUFuQjdDO0FBQUEsTUFvQk1JLElBQUlWLEtBQUtNLEVBQUwsR0FBVUwsS0FBS00sRUFBZixHQUFvQkwsS0FBS0UsRUFBekIsR0FBOEJELEtBQUtFLEVBcEI3QztBQUFBLE1BcUJNTSxJQUFJWCxLQUFLTyxFQUFMLEdBQVVOLEtBQUtLLEVBQWYsR0FBb0JKLEtBQUtHLEVBQXpCLEdBQThCRixLQUFLQyxFQXJCN0M7QUFBQSxNQXNCTVEsYUFBYSxDQUFFSixDQUFGLEVBQUtDLENBQUwsRUFBUUMsQ0FBUixFQUFXQyxDQUFYLENBdEJuQjs7QUF3QkEsU0FBT0MsVUFBUDtBQUNEIiwiZmlsZSI6InF1YXRlcm5pb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHZlY3Rvck1hdGhzID0gcmVxdWlyZSgnLi4vbWF0aHMvdmVjdG9yJyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgYW5nbGVVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvYW5nbGUnKSxcbiAgICAgIGFwcHJveGltYXRlVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2FwcHJveGltYXRlJyk7XG5cbmNvbnN0IHsgZG90MywgY3Jvc3MzLCBub3JtYWxpc2UzIH0gPSB2ZWN0b3JNYXRocyxcbiAgICAgIHsgZmlyc3QsIHNlY29uZCwgdGhpcmQsIGZvdXJ0aCB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IGlzQXBwcm94aW1hdGVseUVxdWFsVG9PbmUgfSA9IGFwcHJveGltYXRlVXRpbGl0aWVzLFxuICAgICAgeyBjYWxjdWxhdGVIYWxmQW5nbGVDb3NpbmUsIGNhbGN1bGF0ZUhhbGZBbmdsZVNpbmUgfSA9IGFuZ2xlVXRpbGl0aWVzO1xuXG5mdW5jdGlvbiByb3RhdGVJbWFnaW5hcnlRdWF0ZXJuaW9uKGltYWdpbmFyeVF1YXRlcm5pb24sIHJvdGF0aW9uUXVhdGVybmlvbiwgaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbikgeyByZXR1cm4gaGFtaWx0b25Qcm9kdWN0KGhhbWlsdG9uUHJvZHVjdChyb3RhdGlvblF1YXRlcm5pb24sIGltYWdpbmFyeVF1YXRlcm5pb24pLCBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uKTsgfVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVBcmJpdHJhcnlSb3RhdGlvblF1YXRlcm5pb24obm9ybWFsKSB7XG4gIGNvbnN0IGV4dGVudCA9IG5vcm1hbC5nZXRFeHRlbnQoKSxcbiAgICAgICAgdW5pdE5vcm1hbCA9IGV4dGVudCwgIC8vL1xuICAgICAgICB6QXhpcyA9IFsgMCwgMCwgMV0sXG4gICAgICAgIGRvdFByb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcyA9IGRvdDModW5pdE5vcm1hbCwgekF4aXMpLFxuICAgICAgICBjcm9zc1Byb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcyA9IGNyb3NzMyh1bml0Tm9ybWFsLCB6QXhpcyksXG4gICAgICAgIGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSA9IGRvdFByb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcywgLy8vXG4gICAgICAgIGFuZ2xlT2ZSb3RhdGlvbkNvc2luZUFic29sdXRlVmFsdWUgPSBNYXRoLmFicyhhbmdsZU9mUm90YXRpb25Db3NpbmUpLFxuICAgICAgICBhbmdsZU9mUm90YXRpb25Db3NpbmVBYnNvbHV0ZVZhbHVlQXBwcm94aW1hdGVseUVxdWFsVG9PbmUgPSBpc0FwcHJveGltYXRlbHlFcXVhbFRvT25lKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZUFic29sdXRlVmFsdWUpLFxuICAgICAgICBheGlzT2ZSb3RhdGlvbiA9IGFuZ2xlT2ZSb3RhdGlvbkNvc2luZUFic29sdXRlVmFsdWVBcHByb3hpbWF0ZWx5RXF1YWxUb09uZSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBbIDEsIDAsIDAgXSA6IC8vL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcm9zc1Byb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcyxcbiAgICAgICAgdW5pdEF4aXNPZlJvdGF0aW9uID0gbm9ybWFsaXNlMyhheGlzT2ZSb3RhdGlvbiksXG4gICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25Db3NpbmUgPSBjYWxjdWxhdGVIYWxmQW5nbGVDb3NpbmUoYW5nbGVPZlJvdGF0aW9uQ29zaW5lKSxcbiAgICAgICAgaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmUgPSBjYWxjdWxhdGVIYWxmQW5nbGVTaW5lKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSksXG4gICAgICAgIHVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMgPSB1bml0QXhpc09mUm90YXRpb24sICAvLy9cbiAgICAgICAgZmlyc3RBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCA9IGZpcnN0KHVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMpLFxuICAgICAgICBzZWNvbmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCA9IHNlY29uZCh1bml0QXhpc09mUm90YXRpb25Db21wb25lbnRzKSxcbiAgICAgICAgdGhpcmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCA9IHRoaXJkKHVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMpLFxuICAgICAgICBhcmJpdHJhcnlSb3RhdGlvblF1YXRlcm5pb24gPSBbXG4gICAgICAgICAgaGFsZkFuZ2xlT2ZSb3RhdGlvbkNvc2luZSxcbiAgICAgICAgICBmaXJzdEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50ICogaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmUsXG4gICAgICAgICAgc2Vjb25kQXhpc09mUm90YXRpb25Db21wb25lbnQgKiBoYWxmQW5nbGVPZlJvdGF0aW9uU2luZSxcbiAgICAgICAgICB0aGlyZEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50ICogaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmVcbiAgICAgICAgXTtcblxuICByZXR1cm4gYXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVSb3RhdGlvbkFib3V0WkF4aXNRdWF0ZXJuaW9uKG1hc2tpbmdFZGdlKSB7XG4gIGNvbnN0IG1hc2tpbmdFZGdlRXh0ZW50ID0gbWFza2luZ0VkZ2UuZ2V0RXh0ZW50KCksXG4gICAgICAgIHVuaXRNYXNraW5nRWRnZUV4dGVudCA9IG5vcm1hbGlzZTMobWFza2luZ0VkZ2VFeHRlbnQpLFxuICAgICAgICB1bml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnRzID0gdW5pdE1hc2tpbmdFZGdlRXh0ZW50LCAgLy8vXG4gICAgICAgIGZpcnN0VW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50ID0gZmlyc3QodW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZFVuaXRNYXNraW5nRWRnZUV4dGVudENvbXBvbmVudCA9IHNlY29uZCh1bml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnRzKSxcbiAgICAgICAgYW5nbGVPZlJvdGF0aW9uU2luZSA9IGZpcnN0VW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50LCAgLy8vXG4gICAgICAgIGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSA9IHNlY29uZFVuaXRNYXNraW5nRWRnZUV4dGVudENvbXBvbmVudCwgIC8vL1xuICAgICAgICBoYWxmQW5nbGVPZlJvdGF0aW9uQ29zaW5lID0gY2FsY3VsYXRlSGFsZkFuZ2xlQ29zaW5lKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSksXG4gICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25TaW5lID0gKGFuZ2xlT2ZSb3RhdGlvblNpbmUgPiAwICkgP1xuICAgICAgICAgICAgK2NhbGN1bGF0ZUhhbGZBbmdsZVNpbmUoYW5nbGVPZlJvdGF0aW9uQ29zaW5lKSA6XG4gICAgICAgICAgICAtY2FsY3VsYXRlSGFsZkFuZ2xlU2luZShhbmdsZU9mUm90YXRpb25Db3NpbmUpLFxuICAgICAgICByb3RhdGlvbkFib3V0WkF4aXNRdWF0ZXJuaW9uID0gW1xuICAgICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25Db3NpbmUsXG4gICAgICAgICAgMCxcbiAgICAgICAgICAwLFxuICAgICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25TaW5lXG4gICAgICAgIF07XG5cbiAgcmV0dXJuIHJvdGF0aW9uQWJvdXRaQXhpc1F1YXRlcm5pb247XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb24ocm90YXRpb25RdWF0ZXJuaW9uKSB7XG4gIGNvbnN0IHJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMgPSByb3RhdGlvblF1YXRlcm5pb24sICAvLy9cbiAgICAgICAgZmlyc3RSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQgPSBmaXJzdChyb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzKSxcbiAgICAgICAgc2Vjb25kUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50ID0gc2Vjb25kKHJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMpLFxuICAgICAgICB0aGlyZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCA9IHRoaXJkKHJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMpLFxuICAgICAgICBmb3VydGhSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQgPSBmb3VydGgocm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50cyksXG4gICAgICAgIGludmVyc2VSb3RhdGlvblF1YXRlcm5pb24gPSBbXG4gICAgICAgICAgZmlyc3RSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQsXG4gICAgICAgICAgLXNlY29uZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCxcbiAgICAgICAgICAtdGhpcmRSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQsXG4gICAgICAgICAgLWZvdXJ0aFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudFxuICAgICAgICBdO1xuXG4gIHJldHVybiBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVGb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbihyb3RhdGlvblF1YXRlcm5pb24pIHtcbiAgY29uc3QgZm9yd2FyZHNSb3RhdGlvblF1YXRlcm5pb24gPSByb3RhdGlvblF1YXRlcm5pb247ICAvLy9cblxuICByZXR1cm4gZm9yd2FyZHNSb3RhdGlvblF1YXRlcm5pb247XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUJhY2t3YXJkc1JvdGF0aW9uUXVhdGVybmlvbihyb3RhdGlvblF1YXRlcm5pb24pIHtcbiAgY29uc3QgaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbiA9IGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb24ocm90YXRpb25RdWF0ZXJuaW9uKSxcbiAgICAgICAgYmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uID0gaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbjsgIC8vL1xuXG4gIHJldHVybiBiYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb247XG5cbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24sXG4gIGNhbGN1bGF0ZUFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbixcbiAgY2FsY3VsYXRlUm90YXRpb25BYm91dFpBeGlzUXVhdGVybmlvbixcbiAgY2FsY3VsYXRlSW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbixcbiAgY2FsY3VsYXRlRm9yd2FyZHNSb3RhdGlvblF1YXRlcm5pb24sXG4gIGNhbGN1bGF0ZUJhY2t3YXJkc1JvdGF0aW9uUXVhdGVybmlvblxufTtcblxuZnVuY3Rpb24gaGFtaWx0b25Qcm9kdWN0KHF1YXRlcm5pb25BLCBxdWF0ZXJuaW9uQikge1xuICBjb25zdCBxdWF0ZXJuaW9uQUNvbXBvbmVudHMgPSBxdWF0ZXJuaW9uQSwgIC8vL1xuICAgICAgICBxdWF0ZXJuaW9uQkNvbXBvbmVudHMgPSBxdWF0ZXJuaW9uQiwgIC8vL1xuICAgICAgICBmaXJzdFF1YXRlcm5pb25BQ29tcG9uZW50ID0gZmlyc3QocXVhdGVybmlvbkFDb21wb25lbnRzKSxcbiAgICAgICAgc2Vjb25kUXVhdGVybmlvbkFDb21wb25lbnQgPSBzZWNvbmQocXVhdGVybmlvbkFDb21wb25lbnRzKSxcbiAgICAgICAgdGhpcmRRdWF0ZXJuaW9uQUNvbXBvbmVudCA9IHRoaXJkKHF1YXRlcm5pb25BQ29tcG9uZW50cyksXG4gICAgICAgIGZvdXJ0aFF1YXRlcm5pb25BQ29tcG9uZW50ID0gZm91cnRoKHF1YXRlcm5pb25BQ29tcG9uZW50cyksXG4gICAgICAgIGZpcnN0UXVhdGVybmlvbkJDb21wb25lbnQgPSBmaXJzdChxdWF0ZXJuaW9uQkNvbXBvbmVudHMpLFxuICAgICAgICBzZWNvbmRRdWF0ZXJuaW9uQkNvbXBvbmVudCA9IHNlY29uZChxdWF0ZXJuaW9uQkNvbXBvbmVudHMpLFxuICAgICAgICB0aGlyZFF1YXRlcm5pb25CQ29tcG9uZW50ID0gdGhpcmQocXVhdGVybmlvbkJDb21wb25lbnRzKSxcbiAgICAgICAgZm91cnRoUXVhdGVybmlvbkJDb21wb25lbnQgPSBmb3VydGgocXVhdGVybmlvbkJDb21wb25lbnRzKSxcbiAgICAgICAgYTEgPSBmaXJzdFF1YXRlcm5pb25BQ29tcG9uZW50LCAvLy9cbiAgICAgICAgYjEgPSBzZWNvbmRRdWF0ZXJuaW9uQUNvbXBvbmVudCwgIC8vL1xuICAgICAgICBjMSA9IHRoaXJkUXVhdGVybmlvbkFDb21wb25lbnQsIC8vL1xuICAgICAgICBkMSA9IGZvdXJ0aFF1YXRlcm5pb25BQ29tcG9uZW50LCAgLy8vXG4gICAgICAgIGEyID0gZmlyc3RRdWF0ZXJuaW9uQkNvbXBvbmVudCwgLy8vXG4gICAgICAgIGIyID0gc2Vjb25kUXVhdGVybmlvbkJDb21wb25lbnQsICAvLy9cbiAgICAgICAgYzIgPSB0aGlyZFF1YXRlcm5pb25CQ29tcG9uZW50LCAvLy9cbiAgICAgICAgZDIgPSBmb3VydGhRdWF0ZXJuaW9uQkNvbXBvbmVudCwgIC8vL1xuICAgICAgICBhID0gYTEgKiBhMiAtIGIxICogYjIgLSBjMSAqIGMyIC0gZDEgKiBkMixcbiAgICAgICAgYiA9IGExICogYjIgKyBiMSAqIGEyICsgYzEgKiBkMiAtIGQxICogYzIsXG4gICAgICAgIGMgPSBhMSAqIGMyIC0gYjEgKiBkMiArIGMxICogYTIgKyBkMSAqIGIyLFxuICAgICAgICBkID0gYTEgKiBkMiArIGIxICogYzIgLSBjMSAqIGIyICsgZDEgKiBhMixcbiAgICAgICAgcXVhdGVybmlvbiA9IFsgYSwgYiwgYywgZCBdO1xuXG4gIHJldHVybiBxdWF0ZXJuaW9uO1xufVxuIl19