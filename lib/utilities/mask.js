'use strict';

var vec3 = require('../maths/vec3'),
    arrayUtilities = require('../utilities/array');

var first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    fourth = arrayUtilities.fourth,
    subtract = vec3.subtract,
    dot = vec3.dot,
    cross = vec3.cross,
    normalise = vec3.normalise;


function calculateNormal(vertexPositions) {
  var firstVertexPosition = first(vertexPositions),
      secondVertexPosition = second(vertexPositions),
      fourthVertexPosition = fourth(vertexPositions),
      firstVector = subtract(secondVertexPosition, firstVertexPosition),
      secondVector = subtract(fourthVertexPosition, firstVertexPosition),
      normal = normalise(cross(firstVector, secondVector));

  return normal;
}

function calculateIntersectionOfPlanes(vertexPositionsA, vertexPositionsB) {
  var normalA = calculateNormal(vertexPositionsA),
      rotationQuaternion = calculateRotationQuaternion(normalA),
      rotatedVertexPositionsA = rotatePositions(vertexPositionsA, rotationQuaternion),
      rotatedVertexPositionsB = rotatePositions(vertexPositionsB, rotationQuaternion),
      firstRotatedVertexPosition = first(rotatedVertexPositionsA),
      rotatedVertexPosition = firstRotatedVertexPosition,
      ///
  rotatedVertexPositionComponents = rotatedVertexPosition,
      ///
  thirdRotatedVertexPositionComponent = third(rotatedVertexPositionComponents),
      z = thirdRotatedVertexPositionComponent,
      ///
  normalB = calculateNormal(rotatedVertexPositionsB),
      normalBComponents = normalB,
      ///
  firstNormalBComponent = first(normalBComponents),
      secondNormalBComponent = second(normalBComponents),
      thirdNormalBComponent = third(normalBComponents),
      a = firstNormalBComponent,
      ///
  b = secondNormalBComponent,
      ///
  c = dot(rotatedVertexPosition, normalB) - thirdNormalBComponent * z;

  debugger;
}

function calculateRotationQuaternion(normal) {
  var normalComponents = normal,
      ///
  firstNormalComponent = first(normalComponents),
      secondNormalComponent = second(normalComponents),
      thirdNormalComponent = third(normalComponents),
      angleOfRotationCosine = thirdNormalComponent,
      ///
  axisOfRotation = angleOfRotationCosine === 1 ? [0, 0, 1] : [+secondNormalComponent, -firstNormalComponent, 0],
      unitAxisOfRotation = normalise(axisOfRotation),
      rotationQuaternion = calculateRotationQuarternion(angleOfRotationCosine, unitAxisOfRotation);

  return rotationQuaternion;
}

function rotatePosition(position, rotationQuaternion) {
  var imaginaryQuaternion = calculateImaginaryQuaternion(position),
      rotatedImaginaryQuaternion = rotateImaginaryQuaternion(imaginaryQuaternion, rotationQuaternion),
      rotatedPosition = calculatePosition(rotatedImaginaryQuaternion);

  return rotatedPosition;
}

function rotatePositions(positions, rotationQuaternion) {
  var rotatedPositions = positions.map(function (position) {
    var rotatedPosition = rotatePosition(position, rotationQuaternion);

    return rotatedPosition;
  });

  return rotatedPositions;
}

function rotateImaginaryQuaternion(imaginaryQuaternion, rotationQuaternion) {
  var inverseRotationQuaternion = calculateInverseRotationQuarternion(rotationQuaternion),
      rotatedImaginaryQuaternion = hamiltonProduct(hamiltonProduct(rotationQuaternion, imaginaryQuaternion), inverseRotationQuaternion);

  return rotatedImaginaryQuaternion;
}

function hamiltonProduct(quaternionA, quarternionB) {
  var quaternionAComponents = quaternionA,
      ///
  quaternionBComponents = quarternionB,
      ///
  firstQuarternionAComponent = first(quaternionAComponents),
      secondQuarternionAComponent = second(quaternionAComponents),
      thirdQuarternionAComponent = third(quaternionAComponents),
      fourthQuarternionAComponent = fourth(quaternionAComponents),
      firstQuarternionBComponent = first(quaternionBComponents),
      secondQuarternionBComponent = second(quaternionBComponents),
      thirdQuarternionBComponent = third(quaternionBComponents),
      fourthQuarternionBComponent = fourth(quaternionBComponents),
      a1 = firstQuarternionAComponent,
      b1 = secondQuarternionAComponent,
      c1 = thirdQuarternionAComponent,
      d1 = fourthQuarternionAComponent,
      a2 = firstQuarternionBComponent,
      b2 = secondQuarternionBComponent,
      c2 = thirdQuarternionBComponent,
      d2 = fourthQuarternionBComponent,
      a = a1 * a2 - b1 * b2 - c1 * c2 - d1 * d2,
      b = a1 * b2 + b1 * a2 + c1 * d2 - d1 * c2,
      c = a1 * c2 - b1 * d2 + c1 * a2 + d1 * b2,
      d = a1 * d2 + b1 * c2 - c1 * b2 + d1 * a2,
      quaternion = [a, b, c, d];

  return quaternion;
}

function calculateImaginaryQuaternion(position) {
  var positionComponents = position,
      ///
  firstPositionComponent = first(positionComponents),
      secondPositionComponent = second(positionComponents),
      thirdPositionComponent = third(positionComponents),
      imaginaryQuaternion = [0, firstPositionComponent, secondPositionComponent, thirdPositionComponent];

  return imaginaryQuaternion;
}

function calculatePosition(imaginaryQuaternion) {
  var imaginaryQuaternionComponents = imaginaryQuaternion,
      ///
  secondImaginaryQuaternionComponent = second(imaginaryQuaternionComponents),
      thirdImaginaryQuaternionComponent = third(imaginaryQuaternionComponents),
      fourthImaginaryQuaternionComponent = fourth(imaginaryQuaternionComponents),
      position = [secondImaginaryQuaternionComponent, thirdImaginaryQuaternionComponent, fourthImaginaryQuaternionComponent];

  return position;
}

function calculateRotationQuarternion(angleOfRotationCosine, unitAxisOfRotation) {
  var halfAngleOfRotationCosine = calculateHalfAngleCosine(angleOfRotationCosine),
      halfAngleOfRotationSine = calculateHalfAngleSine(angleOfRotationCosine),
      unitAxisOfRotationComponents = unitAxisOfRotation,
      ///
  firstAxisOfRotationComponent = first(unitAxisOfRotationComponents),
      secondAxisOfRotationComponent = second(unitAxisOfRotationComponents),
      thirdAxisOfRotationComponent = third(unitAxisOfRotationComponents),
      rotationQuarternion = [halfAngleOfRotationCosine, firstAxisOfRotationComponent * halfAngleOfRotationSine, secondAxisOfRotationComponent * halfAngleOfRotationSine, thirdAxisOfRotationComponent * halfAngleOfRotationSine];

  return rotationQuarternion;
}

function calculateInverseRotationQuarternion(rotationQuaternion) {
  var rotationQuaternionComponents = rotationQuaternion,
      ///
  firstRotationQuaternionComponent = first(rotationQuaternionComponents),
      secondRotationQuaternionComponent = second(rotationQuaternionComponents),
      thirdRotationQuaternionComponent = third(rotationQuaternionComponents),
      fourthRotationQuaternionComponent = fourth(rotationQuaternionComponents),
      inverseRotationQuaternion = [firstRotationQuaternionComponent, -secondRotationQuaternionComponent, -thirdRotationQuaternionComponent, -fourthRotationQuaternionComponent];

  return inverseRotationQuaternion;
}

function calculateHalfAngleCosine(angleCosine) {
  var halfAngleCosine = Math.sqrt((1 + angleCosine) / 2);

  return halfAngleCosine;
}

function calculateHalfAngleSine(angleCosine) {
  var halfAngleSine = Math.sqrt((1 - angleCosine) / 2);

  return halfAngleSine;
}

module.exports = {
  calculateIntersectionOfPlanes: calculateIntersectionOfPlanes
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvbWFzay5qcyJdLCJuYW1lcyI6WyJ2ZWMzIiwicmVxdWlyZSIsImFycmF5VXRpbGl0aWVzIiwiZmlyc3QiLCJzZWNvbmQiLCJ0aGlyZCIsImZvdXJ0aCIsInN1YnRyYWN0IiwiZG90IiwiY3Jvc3MiLCJub3JtYWxpc2UiLCJjYWxjdWxhdGVOb3JtYWwiLCJ2ZXJ0ZXhQb3NpdGlvbnMiLCJmaXJzdFZlcnRleFBvc2l0aW9uIiwic2Vjb25kVmVydGV4UG9zaXRpb24iLCJmb3VydGhWZXJ0ZXhQb3NpdGlvbiIsImZpcnN0VmVjdG9yIiwic2Vjb25kVmVjdG9yIiwibm9ybWFsIiwiY2FsY3VsYXRlSW50ZXJzZWN0aW9uT2ZQbGFuZXMiLCJ2ZXJ0ZXhQb3NpdGlvbnNBIiwidmVydGV4UG9zaXRpb25zQiIsIm5vcm1hbEEiLCJyb3RhdGlvblF1YXRlcm5pb24iLCJjYWxjdWxhdGVSb3RhdGlvblF1YXRlcm5pb24iLCJyb3RhdGVkVmVydGV4UG9zaXRpb25zQSIsInJvdGF0ZVBvc2l0aW9ucyIsInJvdGF0ZWRWZXJ0ZXhQb3NpdGlvbnNCIiwiZmlyc3RSb3RhdGVkVmVydGV4UG9zaXRpb24iLCJyb3RhdGVkVmVydGV4UG9zaXRpb24iLCJyb3RhdGVkVmVydGV4UG9zaXRpb25Db21wb25lbnRzIiwidGhpcmRSb3RhdGVkVmVydGV4UG9zaXRpb25Db21wb25lbnQiLCJ6Iiwibm9ybWFsQiIsIm5vcm1hbEJDb21wb25lbnRzIiwiZmlyc3ROb3JtYWxCQ29tcG9uZW50Iiwic2Vjb25kTm9ybWFsQkNvbXBvbmVudCIsInRoaXJkTm9ybWFsQkNvbXBvbmVudCIsImEiLCJiIiwiYyIsIm5vcm1hbENvbXBvbmVudHMiLCJmaXJzdE5vcm1hbENvbXBvbmVudCIsInNlY29uZE5vcm1hbENvbXBvbmVudCIsInRoaXJkTm9ybWFsQ29tcG9uZW50IiwiYW5nbGVPZlJvdGF0aW9uQ29zaW5lIiwiYXhpc09mUm90YXRpb24iLCJ1bml0QXhpc09mUm90YXRpb24iLCJjYWxjdWxhdGVSb3RhdGlvblF1YXJ0ZXJuaW9uIiwicm90YXRlUG9zaXRpb24iLCJwb3NpdGlvbiIsImltYWdpbmFyeVF1YXRlcm5pb24iLCJjYWxjdWxhdGVJbWFnaW5hcnlRdWF0ZXJuaW9uIiwicm90YXRlZEltYWdpbmFyeVF1YXRlcm5pb24iLCJyb3RhdGVJbWFnaW5hcnlRdWF0ZXJuaW9uIiwicm90YXRlZFBvc2l0aW9uIiwiY2FsY3VsYXRlUG9zaXRpb24iLCJwb3NpdGlvbnMiLCJyb3RhdGVkUG9zaXRpb25zIiwibWFwIiwiaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbiIsImNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXJ0ZXJuaW9uIiwiaGFtaWx0b25Qcm9kdWN0IiwicXVhdGVybmlvbkEiLCJxdWFydGVybmlvbkIiLCJxdWF0ZXJuaW9uQUNvbXBvbmVudHMiLCJxdWF0ZXJuaW9uQkNvbXBvbmVudHMiLCJmaXJzdFF1YXJ0ZXJuaW9uQUNvbXBvbmVudCIsInNlY29uZFF1YXJ0ZXJuaW9uQUNvbXBvbmVudCIsInRoaXJkUXVhcnRlcm5pb25BQ29tcG9uZW50IiwiZm91cnRoUXVhcnRlcm5pb25BQ29tcG9uZW50IiwiZmlyc3RRdWFydGVybmlvbkJDb21wb25lbnQiLCJzZWNvbmRRdWFydGVybmlvbkJDb21wb25lbnQiLCJ0aGlyZFF1YXJ0ZXJuaW9uQkNvbXBvbmVudCIsImZvdXJ0aFF1YXJ0ZXJuaW9uQkNvbXBvbmVudCIsImExIiwiYjEiLCJjMSIsImQxIiwiYTIiLCJiMiIsImMyIiwiZDIiLCJkIiwicXVhdGVybmlvbiIsInBvc2l0aW9uQ29tcG9uZW50cyIsImZpcnN0UG9zaXRpb25Db21wb25lbnQiLCJzZWNvbmRQb3NpdGlvbkNvbXBvbmVudCIsInRoaXJkUG9zaXRpb25Db21wb25lbnQiLCJpbWFnaW5hcnlRdWF0ZXJuaW9uQ29tcG9uZW50cyIsInNlY29uZEltYWdpbmFyeVF1YXRlcm5pb25Db21wb25lbnQiLCJ0aGlyZEltYWdpbmFyeVF1YXRlcm5pb25Db21wb25lbnQiLCJmb3VydGhJbWFnaW5hcnlRdWF0ZXJuaW9uQ29tcG9uZW50IiwiaGFsZkFuZ2xlT2ZSb3RhdGlvbkNvc2luZSIsImNhbGN1bGF0ZUhhbGZBbmdsZUNvc2luZSIsImhhbGZBbmdsZU9mUm90YXRpb25TaW5lIiwiY2FsY3VsYXRlSGFsZkFuZ2xlU2luZSIsInVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMiLCJmaXJzdEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50Iiwic2Vjb25kQXhpc09mUm90YXRpb25Db21wb25lbnQiLCJ0aGlyZEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50Iiwicm90YXRpb25RdWFydGVybmlvbiIsInJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMiLCJmaXJzdFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCIsInNlY29uZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCIsInRoaXJkUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50IiwiZm91cnRoUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50IiwiYW5nbGVDb3NpbmUiLCJoYWxmQW5nbGVDb3NpbmUiLCJNYXRoIiwic3FydCIsImhhbGZBbmdsZVNpbmUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxPQUFPQyxRQUFRLGVBQVIsQ0FBYjtBQUFBLElBQ01DLGlCQUFpQkQsUUFBUSxvQkFBUixDQUR2Qjs7SUFHUUUsSyxHQUFpQ0QsYyxDQUFqQ0MsSztJQUFPQyxNLEdBQTBCRixjLENBQTFCRSxNO0lBQVFDLEssR0FBa0JILGMsQ0FBbEJHLEs7SUFBT0MsTSxHQUFXSixjLENBQVhJLE07SUFDdEJDLFEsR0FBb0NQLEksQ0FBcENPLFE7SUFBVUMsRyxHQUEwQlIsSSxDQUExQlEsRztJQUFLQyxLLEdBQXFCVCxJLENBQXJCUyxLO0lBQU9DLFMsR0FBY1YsSSxDQUFkVSxTOzs7QUFFOUIsU0FBU0MsZUFBVCxDQUF5QkMsZUFBekIsRUFBMEM7QUFDeEMsTUFBTUMsc0JBQXNCVixNQUFNUyxlQUFOLENBQTVCO0FBQUEsTUFDTUUsdUJBQXVCVixPQUFPUSxlQUFQLENBRDdCO0FBQUEsTUFFTUcsdUJBQXVCVCxPQUFPTSxlQUFQLENBRjdCO0FBQUEsTUFHTUksY0FBY1QsU0FBU08sb0JBQVQsRUFBK0JELG1CQUEvQixDQUhwQjtBQUFBLE1BSU1JLGVBQWVWLFNBQVNRLG9CQUFULEVBQStCRixtQkFBL0IsQ0FKckI7QUFBQSxNQUtNSyxTQUFTUixVQUFVRCxNQUFNTyxXQUFOLEVBQW1CQyxZQUFuQixDQUFWLENBTGY7O0FBT0EsU0FBT0MsTUFBUDtBQUNEOztBQUVELFNBQVNDLDZCQUFULENBQXVDQyxnQkFBdkMsRUFBeURDLGdCQUF6RCxFQUEyRTtBQUN6RSxNQUFNQyxVQUFVWCxnQkFBZ0JTLGdCQUFoQixDQUFoQjtBQUFBLE1BQ01HLHFCQUFxQkMsNEJBQTRCRixPQUE1QixDQUQzQjtBQUFBLE1BRU1HLDBCQUEwQkMsZ0JBQWdCTixnQkFBaEIsRUFBa0NHLGtCQUFsQyxDQUZoQztBQUFBLE1BR01JLDBCQUEwQkQsZ0JBQWdCTCxnQkFBaEIsRUFBa0NFLGtCQUFsQyxDQUhoQztBQUFBLE1BSU1LLDZCQUE2QnpCLE1BQU1zQix1QkFBTixDQUpuQztBQUFBLE1BS01JLHdCQUF3QkQsMEJBTDlCO0FBQUEsTUFLMEQ7QUFDcERFLG9DQUFrQ0QscUJBTnhDO0FBQUEsTUFNZ0U7QUFDMURFLHdDQUFzQzFCLE1BQU15QiwrQkFBTixDQVA1QztBQUFBLE1BUU1FLElBQUlELG1DQVJWO0FBQUEsTUFRZ0Q7QUFDMUNFLFlBQVV0QixnQkFBZ0JnQix1QkFBaEIsQ0FUaEI7QUFBQSxNQVVNTyxvQkFBb0JELE9BVjFCO0FBQUEsTUFVb0M7QUFDOUJFLDBCQUF3QmhDLE1BQU0rQixpQkFBTixDQVg5QjtBQUFBLE1BWU1FLHlCQUF5QmhDLE9BQU84QixpQkFBUCxDQVovQjtBQUFBLE1BYU1HLHdCQUF3QmhDLE1BQU02QixpQkFBTixDQWI5QjtBQUFBLE1BY01JLElBQUlILHFCQWRWO0FBQUEsTUFja0M7QUFDNUJJLE1BQUlILHNCQWZWO0FBQUEsTUFla0M7QUFDNUJJLE1BQUloQyxJQUFJcUIscUJBQUosRUFBMkJJLE9BQTNCLElBQXNDSSx3QkFBd0JMLENBaEJ4RTs7QUFtQkE7QUFDRDs7QUFFRCxTQUFTUiwyQkFBVCxDQUFxQ04sTUFBckMsRUFBNkM7QUFDM0MsTUFBTXVCLG1CQUFtQnZCLE1BQXpCO0FBQUEsTUFBa0M7QUFDNUJ3Qix5QkFBdUJ2QyxNQUFNc0MsZ0JBQU4sQ0FEN0I7QUFBQSxNQUVNRSx3QkFBd0J2QyxPQUFPcUMsZ0JBQVAsQ0FGOUI7QUFBQSxNQUdNRyx1QkFBdUJ2QyxNQUFNb0MsZ0JBQU4sQ0FIN0I7QUFBQSxNQUlNSSx3QkFBd0JELG9CQUo5QjtBQUFBLE1BSXFEO0FBQy9DRSxtQkFBa0JELDBCQUEwQixDQUEzQixHQUNFLENBQUUsQ0FBRixFQUFLLENBQUwsRUFBUSxDQUFSLENBREYsR0FFSSxDQUNFLENBQUNGLHFCQURILEVBRUUsQ0FBQ0Qsb0JBRkgsRUFHRSxDQUhGLENBUDNCO0FBQUEsTUFZTUsscUJBQXFCckMsVUFBVW9DLGNBQVYsQ0FaM0I7QUFBQSxNQWFNdkIscUJBQXFCeUIsNkJBQTZCSCxxQkFBN0IsRUFBb0RFLGtCQUFwRCxDQWIzQjs7QUFlQSxTQUFPeEIsa0JBQVA7QUFDRDs7QUFFRCxTQUFTMEIsY0FBVCxDQUF3QkMsUUFBeEIsRUFBa0MzQixrQkFBbEMsRUFBc0Q7QUFDcEQsTUFBTTRCLHNCQUFzQkMsNkJBQTZCRixRQUE3QixDQUE1QjtBQUFBLE1BQ01HLDZCQUE2QkMsMEJBQTBCSCxtQkFBMUIsRUFBK0M1QixrQkFBL0MsQ0FEbkM7QUFBQSxNQUVNZ0Msa0JBQWtCQyxrQkFBa0JILDBCQUFsQixDQUZ4Qjs7QUFJQSxTQUFPRSxlQUFQO0FBQ0Q7O0FBRUQsU0FBUzdCLGVBQVQsQ0FBeUIrQixTQUF6QixFQUFvQ2xDLGtCQUFwQyxFQUF3RDtBQUN0RCxNQUFNbUMsbUJBQW1CRCxVQUFVRSxHQUFWLENBQWMsVUFBU1QsUUFBVCxFQUFtQjtBQUN4RCxRQUFNSyxrQkFBa0JOLGVBQWVDLFFBQWYsRUFBeUIzQixrQkFBekIsQ0FBeEI7O0FBRUEsV0FBT2dDLGVBQVA7QUFDRCxHQUp3QixDQUF6Qjs7QUFNQSxTQUFPRyxnQkFBUDtBQUNEOztBQUVELFNBQVNKLHlCQUFULENBQW1DSCxtQkFBbkMsRUFBd0Q1QixrQkFBeEQsRUFBNEU7QUFDMUUsTUFBTXFDLDRCQUE0QkMsb0NBQW9DdEMsa0JBQXBDLENBQWxDO0FBQUEsTUFDTThCLDZCQUE2QlMsZ0JBQWdCQSxnQkFBZ0J2QyxrQkFBaEIsRUFBb0M0QixtQkFBcEMsQ0FBaEIsRUFBMEVTLHlCQUExRSxDQURuQzs7QUFHQSxTQUFPUCwwQkFBUDtBQUNEOztBQUVELFNBQVNTLGVBQVQsQ0FBeUJDLFdBQXpCLEVBQXNDQyxZQUF0QyxFQUFvRDtBQUNsRCxNQUFNQyx3QkFBd0JGLFdBQTlCO0FBQUEsTUFBNEM7QUFDdENHLDBCQUF3QkYsWUFEOUI7QUFBQSxNQUM2QztBQUN2Q0csK0JBQTZCaEUsTUFBTThELHFCQUFOLENBRm5DO0FBQUEsTUFHTUcsOEJBQThCaEUsT0FBTzZELHFCQUFQLENBSHBDO0FBQUEsTUFJTUksNkJBQTZCaEUsTUFBTTRELHFCQUFOLENBSm5DO0FBQUEsTUFLTUssOEJBQThCaEUsT0FBTzJELHFCQUFQLENBTHBDO0FBQUEsTUFNTU0sNkJBQTZCcEUsTUFBTStELHFCQUFOLENBTm5DO0FBQUEsTUFPTU0sOEJBQThCcEUsT0FBTzhELHFCQUFQLENBUHBDO0FBQUEsTUFRTU8sNkJBQTZCcEUsTUFBTTZELHFCQUFOLENBUm5DO0FBQUEsTUFTTVEsOEJBQThCcEUsT0FBTzRELHFCQUFQLENBVHBDO0FBQUEsTUFVTVMsS0FBS1IsMEJBVlg7QUFBQSxNQVdNUyxLQUFLUiwyQkFYWDtBQUFBLE1BWU1TLEtBQUtSLDBCQVpYO0FBQUEsTUFhTVMsS0FBS1IsMkJBYlg7QUFBQSxNQWNNUyxLQUFLUiwwQkFkWDtBQUFBLE1BZU1TLEtBQUtSLDJCQWZYO0FBQUEsTUFnQk1TLEtBQUtSLDBCQWhCWDtBQUFBLE1BaUJNUyxLQUFLUiwyQkFqQlg7QUFBQSxNQWtCTXBDLElBQUlxQyxLQUFLSSxFQUFMLEdBQVVILEtBQUtJLEVBQWYsR0FBb0JILEtBQUtJLEVBQXpCLEdBQThCSCxLQUFLSSxFQWxCN0M7QUFBQSxNQW1CTTNDLElBQUlvQyxLQUFLSyxFQUFMLEdBQVVKLEtBQUtHLEVBQWYsR0FBb0JGLEtBQUtLLEVBQXpCLEdBQThCSixLQUFLRyxFQW5CN0M7QUFBQSxNQW9CTXpDLElBQUltQyxLQUFLTSxFQUFMLEdBQVVMLEtBQUtNLEVBQWYsR0FBb0JMLEtBQUtFLEVBQXpCLEdBQThCRCxLQUFLRSxFQXBCN0M7QUFBQSxNQXFCTUcsSUFBSVIsS0FBS08sRUFBTCxHQUFVTixLQUFLSyxFQUFmLEdBQW9CSixLQUFLRyxFQUF6QixHQUE4QkYsS0FBS0MsRUFyQjdDO0FBQUEsTUFzQk1LLGFBQWEsQ0FBRTlDLENBQUYsRUFBS0MsQ0FBTCxFQUFRQyxDQUFSLEVBQVcyQyxDQUFYLENBdEJuQjs7QUF3QkEsU0FBT0MsVUFBUDtBQUNEOztBQUVELFNBQVNoQyw0QkFBVCxDQUFzQ0YsUUFBdEMsRUFBZ0Q7QUFDOUMsTUFBTW1DLHFCQUFxQm5DLFFBQTNCO0FBQUEsTUFBc0M7QUFDaENvQywyQkFBeUJuRixNQUFNa0Ysa0JBQU4sQ0FEL0I7QUFBQSxNQUVNRSwwQkFBMEJuRixPQUFPaUYsa0JBQVAsQ0FGaEM7QUFBQSxNQUdNRyx5QkFBeUJuRixNQUFNZ0Ysa0JBQU4sQ0FIL0I7QUFBQSxNQUlNbEMsc0JBQXNCLENBQ3BCLENBRG9CLEVBRXBCbUMsc0JBRm9CLEVBR3BCQyx1QkFIb0IsRUFJcEJDLHNCQUpvQixDQUo1Qjs7QUFXQSxTQUFPckMsbUJBQVA7QUFDRDs7QUFFRCxTQUFTSyxpQkFBVCxDQUEyQkwsbUJBQTNCLEVBQWdEO0FBQzlDLE1BQU1zQyxnQ0FBZ0N0QyxtQkFBdEM7QUFBQSxNQUE0RDtBQUN0RHVDLHVDQUFxQ3RGLE9BQU9xRiw2QkFBUCxDQUQzQztBQUFBLE1BRU1FLG9DQUFvQ3RGLE1BQU1vRiw2QkFBTixDQUYxQztBQUFBLE1BR01HLHFDQUFxQ3RGLE9BQU9tRiw2QkFBUCxDQUgzQztBQUFBLE1BSU12QyxXQUFXLENBQ1R3QyxrQ0FEUyxFQUVUQyxpQ0FGUyxFQUdUQyxrQ0FIUyxDQUpqQjs7QUFVQSxTQUFPMUMsUUFBUDtBQUNEOztBQUVELFNBQVNGLDRCQUFULENBQXNDSCxxQkFBdEMsRUFBNkRFLGtCQUE3RCxFQUFpRjtBQUMvRSxNQUFNOEMsNEJBQTRCQyx5QkFBeUJqRCxxQkFBekIsQ0FBbEM7QUFBQSxNQUNNa0QsMEJBQTBCQyx1QkFBdUJuRCxxQkFBdkIsQ0FEaEM7QUFBQSxNQUVNb0QsK0JBQStCbEQsa0JBRnJDO0FBQUEsTUFFMEQ7QUFDcERtRCxpQ0FBK0IvRixNQUFNOEYsNEJBQU4sQ0FIckM7QUFBQSxNQUlNRSxnQ0FBZ0MvRixPQUFPNkYsNEJBQVAsQ0FKdEM7QUFBQSxNQUtNRywrQkFBK0IvRixNQUFNNEYsNEJBQU4sQ0FMckM7QUFBQSxNQU1NSSxzQkFBc0IsQ0FDcEJSLHlCQURvQixFQUVwQkssK0JBQStCSCx1QkFGWCxFQUdwQkksZ0NBQWdDSix1QkFIWixFQUlwQkssK0JBQStCTCx1QkFKWCxDQU41Qjs7QUFhQSxTQUFPTSxtQkFBUDtBQUNEOztBQUVELFNBQVN4QyxtQ0FBVCxDQUE2Q3RDLGtCQUE3QyxFQUFpRTtBQUMvRCxNQUFNK0UsK0JBQStCL0Usa0JBQXJDO0FBQUEsTUFBMEQ7QUFDcERnRixxQ0FBbUNwRyxNQUFNbUcsNEJBQU4sQ0FEekM7QUFBQSxNQUVNRSxvQ0FBb0NwRyxPQUFPa0csNEJBQVAsQ0FGMUM7QUFBQSxNQUdNRyxtQ0FBbUNwRyxNQUFNaUcsNEJBQU4sQ0FIekM7QUFBQSxNQUlNSSxvQ0FBb0NwRyxPQUFPZ0csNEJBQVAsQ0FKMUM7QUFBQSxNQUtNMUMsNEJBQTRCLENBQzFCMkMsZ0NBRDBCLEVBRTFCLENBQUNDLGlDQUZ5QixFQUcxQixDQUFDQyxnQ0FIeUIsRUFJMUIsQ0FBQ0MsaUNBSnlCLENBTGxDOztBQVlBLFNBQU85Qyx5QkFBUDtBQUNEOztBQUVELFNBQVNrQyx3QkFBVCxDQUFrQ2EsV0FBbEMsRUFBK0M7QUFDN0MsTUFBTUMsa0JBQWtCQyxLQUFLQyxJQUFMLENBQVUsQ0FBQyxJQUFJSCxXQUFMLElBQW9CLENBQTlCLENBQXhCOztBQUVBLFNBQU9DLGVBQVA7QUFDRDs7QUFFRCxTQUFTWixzQkFBVCxDQUFnQ1csV0FBaEMsRUFBNkM7QUFDM0MsTUFBTUksZ0JBQWdCRixLQUFLQyxJQUFMLENBQVUsQ0FBQyxJQUFJSCxXQUFMLElBQW9CLENBQTlCLENBQXRCOztBQUVBLFNBQU9JLGFBQVA7QUFDRDs7QUFFREMsT0FBT0MsT0FBUCxHQUFpQjtBQUNmOUYsaUNBQStCQTtBQURoQixDQUFqQiIsImZpbGUiOiJtYXNrLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCB2ZWMzID0gcmVxdWlyZSgnLi4vbWF0aHMvdmVjMycpLFxuICAgICAgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvYXJyYXknKTtcblxuY29uc3QgeyBmaXJzdCwgc2Vjb25kLCB0aGlyZCwgZm91cnRoIH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgc3VidHJhY3QsIGRvdCwgY3Jvc3MsIG5vcm1hbGlzZSB9ID0gdmVjMztcblxuZnVuY3Rpb24gY2FsY3VsYXRlTm9ybWFsKHZlcnRleFBvc2l0aW9ucykge1xuICBjb25zdCBmaXJzdFZlcnRleFBvc2l0aW9uID0gZmlyc3QodmVydGV4UG9zaXRpb25zKSxcbiAgICAgICAgc2Vjb25kVmVydGV4UG9zaXRpb24gPSBzZWNvbmQodmVydGV4UG9zaXRpb25zKSxcbiAgICAgICAgZm91cnRoVmVydGV4UG9zaXRpb24gPSBmb3VydGgodmVydGV4UG9zaXRpb25zKSxcbiAgICAgICAgZmlyc3RWZWN0b3IgPSBzdWJ0cmFjdChzZWNvbmRWZXJ0ZXhQb3NpdGlvbiwgZmlyc3RWZXJ0ZXhQb3NpdGlvbiksXG4gICAgICAgIHNlY29uZFZlY3RvciA9IHN1YnRyYWN0KGZvdXJ0aFZlcnRleFBvc2l0aW9uLCBmaXJzdFZlcnRleFBvc2l0aW9uKSxcbiAgICAgICAgbm9ybWFsID0gbm9ybWFsaXNlKGNyb3NzKGZpcnN0VmVjdG9yLCBzZWNvbmRWZWN0b3IpKTtcblxuICByZXR1cm4gbm9ybWFsO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVJbnRlcnNlY3Rpb25PZlBsYW5lcyh2ZXJ0ZXhQb3NpdGlvbnNBLCB2ZXJ0ZXhQb3NpdGlvbnNCKSB7XG4gIGNvbnN0IG5vcm1hbEEgPSBjYWxjdWxhdGVOb3JtYWwodmVydGV4UG9zaXRpb25zQSksXG4gICAgICAgIHJvdGF0aW9uUXVhdGVybmlvbiA9IGNhbGN1bGF0ZVJvdGF0aW9uUXVhdGVybmlvbihub3JtYWxBKSxcbiAgICAgICAgcm90YXRlZFZlcnRleFBvc2l0aW9uc0EgPSByb3RhdGVQb3NpdGlvbnModmVydGV4UG9zaXRpb25zQSwgcm90YXRpb25RdWF0ZXJuaW9uKSxcbiAgICAgICAgcm90YXRlZFZlcnRleFBvc2l0aW9uc0IgPSByb3RhdGVQb3NpdGlvbnModmVydGV4UG9zaXRpb25zQiwgcm90YXRpb25RdWF0ZXJuaW9uKSxcbiAgICAgICAgZmlyc3RSb3RhdGVkVmVydGV4UG9zaXRpb24gPSBmaXJzdChyb3RhdGVkVmVydGV4UG9zaXRpb25zQSksXG4gICAgICAgIHJvdGF0ZWRWZXJ0ZXhQb3NpdGlvbiA9IGZpcnN0Um90YXRlZFZlcnRleFBvc2l0aW9uLCAvLy9cbiAgICAgICAgcm90YXRlZFZlcnRleFBvc2l0aW9uQ29tcG9uZW50cyA9IHJvdGF0ZWRWZXJ0ZXhQb3NpdGlvbiwgIC8vL1xuICAgICAgICB0aGlyZFJvdGF0ZWRWZXJ0ZXhQb3NpdGlvbkNvbXBvbmVudCA9IHRoaXJkKHJvdGF0ZWRWZXJ0ZXhQb3NpdGlvbkNvbXBvbmVudHMpLFxuICAgICAgICB6ID0gdGhpcmRSb3RhdGVkVmVydGV4UG9zaXRpb25Db21wb25lbnQsICAvLy9cbiAgICAgICAgbm9ybWFsQiA9IGNhbGN1bGF0ZU5vcm1hbChyb3RhdGVkVmVydGV4UG9zaXRpb25zQiksXG4gICAgICAgIG5vcm1hbEJDb21wb25lbnRzID0gbm9ybWFsQiwgIC8vL1xuICAgICAgICBmaXJzdE5vcm1hbEJDb21wb25lbnQgPSBmaXJzdChub3JtYWxCQ29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZE5vcm1hbEJDb21wb25lbnQgPSBzZWNvbmQobm9ybWFsQkNvbXBvbmVudHMpLFxuICAgICAgICB0aGlyZE5vcm1hbEJDb21wb25lbnQgPSB0aGlyZChub3JtYWxCQ29tcG9uZW50cyksXG4gICAgICAgIGEgPSBmaXJzdE5vcm1hbEJDb21wb25lbnQsICAvLy9cbiAgICAgICAgYiA9IHNlY29uZE5vcm1hbEJDb21wb25lbnQsIC8vL1xuICAgICAgICBjID0gZG90KHJvdGF0ZWRWZXJ0ZXhQb3NpdGlvbiwgbm9ybWFsQikgLSB0aGlyZE5vcm1hbEJDb21wb25lbnQgKiB6O1xuXG5cbiAgZGVidWdnZXJcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uKG5vcm1hbCkge1xuICBjb25zdCBub3JtYWxDb21wb25lbnRzID0gbm9ybWFsLCAgLy8vXG4gICAgICAgIGZpcnN0Tm9ybWFsQ29tcG9uZW50ID0gZmlyc3Qobm9ybWFsQ29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZE5vcm1hbENvbXBvbmVudCA9IHNlY29uZChub3JtYWxDb21wb25lbnRzKSxcbiAgICAgICAgdGhpcmROb3JtYWxDb21wb25lbnQgPSB0aGlyZChub3JtYWxDb21wb25lbnRzKSxcbiAgICAgICAgYW5nbGVPZlJvdGF0aW9uQ29zaW5lID0gdGhpcmROb3JtYWxDb21wb25lbnQsICAvLy9cbiAgICAgICAgYXhpc09mUm90YXRpb24gPSAoYW5nbGVPZlJvdGF0aW9uQ29zaW5lID09PSAxKSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBbIDAsIDAsIDEgXSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArc2Vjb25kTm9ybWFsQ29tcG9uZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1maXJzdE5vcm1hbENvbXBvbmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgIHVuaXRBeGlzT2ZSb3RhdGlvbiA9IG5vcm1hbGlzZShheGlzT2ZSb3RhdGlvbiksXG4gICAgICAgIHJvdGF0aW9uUXVhdGVybmlvbiA9IGNhbGN1bGF0ZVJvdGF0aW9uUXVhcnRlcm5pb24oYW5nbGVPZlJvdGF0aW9uQ29zaW5lLCB1bml0QXhpc09mUm90YXRpb24pO1xuXG4gIHJldHVybiByb3RhdGlvblF1YXRlcm5pb247XG59XG5cbmZ1bmN0aW9uIHJvdGF0ZVBvc2l0aW9uKHBvc2l0aW9uLCByb3RhdGlvblF1YXRlcm5pb24pIHtcbiAgY29uc3QgaW1hZ2luYXJ5UXVhdGVybmlvbiA9IGNhbGN1bGF0ZUltYWdpbmFyeVF1YXRlcm5pb24ocG9zaXRpb24pLFxuICAgICAgICByb3RhdGVkSW1hZ2luYXJ5UXVhdGVybmlvbiA9IHJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24oaW1hZ2luYXJ5UXVhdGVybmlvbiwgcm90YXRpb25RdWF0ZXJuaW9uKSxcbiAgICAgICAgcm90YXRlZFBvc2l0aW9uID0gY2FsY3VsYXRlUG9zaXRpb24ocm90YXRlZEltYWdpbmFyeVF1YXRlcm5pb24pO1xuXG4gIHJldHVybiByb3RhdGVkUG9zaXRpb247XG59XG5cbmZ1bmN0aW9uIHJvdGF0ZVBvc2l0aW9ucyhwb3NpdGlvbnMsIHJvdGF0aW9uUXVhdGVybmlvbikge1xuICBjb25zdCByb3RhdGVkUG9zaXRpb25zID0gcG9zaXRpb25zLm1hcChmdW5jdGlvbihwb3NpdGlvbikge1xuICAgIGNvbnN0IHJvdGF0ZWRQb3NpdGlvbiA9IHJvdGF0ZVBvc2l0aW9uKHBvc2l0aW9uLCByb3RhdGlvblF1YXRlcm5pb24pO1xuXG4gICAgcmV0dXJuIHJvdGF0ZWRQb3NpdGlvbjtcbiAgfSk7XG5cbiAgcmV0dXJuIHJvdGF0ZWRQb3NpdGlvbnM7XG59XG5cbmZ1bmN0aW9uIHJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24oaW1hZ2luYXJ5UXVhdGVybmlvbiwgcm90YXRpb25RdWF0ZXJuaW9uKSB7XG4gIGNvbnN0IGludmVyc2VSb3RhdGlvblF1YXRlcm5pb24gPSBjYWxjdWxhdGVJbnZlcnNlUm90YXRpb25RdWFydGVybmlvbihyb3RhdGlvblF1YXRlcm5pb24pLFxuICAgICAgICByb3RhdGVkSW1hZ2luYXJ5UXVhdGVybmlvbiA9IGhhbWlsdG9uUHJvZHVjdChoYW1pbHRvblByb2R1Y3Qocm90YXRpb25RdWF0ZXJuaW9uLCBpbWFnaW5hcnlRdWF0ZXJuaW9uKSwgaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbik7XG5cbiAgcmV0dXJuIHJvdGF0ZWRJbWFnaW5hcnlRdWF0ZXJuaW9uO1xufVxuXG5mdW5jdGlvbiBoYW1pbHRvblByb2R1Y3QocXVhdGVybmlvbkEsIHF1YXJ0ZXJuaW9uQikge1xuICBjb25zdCBxdWF0ZXJuaW9uQUNvbXBvbmVudHMgPSBxdWF0ZXJuaW9uQSwgIC8vL1xuICAgICAgICBxdWF0ZXJuaW9uQkNvbXBvbmVudHMgPSBxdWFydGVybmlvbkIsICAvLy9cbiAgICAgICAgZmlyc3RRdWFydGVybmlvbkFDb21wb25lbnQgPSBmaXJzdChxdWF0ZXJuaW9uQUNvbXBvbmVudHMpLFxuICAgICAgICBzZWNvbmRRdWFydGVybmlvbkFDb21wb25lbnQgPSBzZWNvbmQocXVhdGVybmlvbkFDb21wb25lbnRzKSxcbiAgICAgICAgdGhpcmRRdWFydGVybmlvbkFDb21wb25lbnQgPSB0aGlyZChxdWF0ZXJuaW9uQUNvbXBvbmVudHMpLFxuICAgICAgICBmb3VydGhRdWFydGVybmlvbkFDb21wb25lbnQgPSBmb3VydGgocXVhdGVybmlvbkFDb21wb25lbnRzKSxcbiAgICAgICAgZmlyc3RRdWFydGVybmlvbkJDb21wb25lbnQgPSBmaXJzdChxdWF0ZXJuaW9uQkNvbXBvbmVudHMpLFxuICAgICAgICBzZWNvbmRRdWFydGVybmlvbkJDb21wb25lbnQgPSBzZWNvbmQocXVhdGVybmlvbkJDb21wb25lbnRzKSxcbiAgICAgICAgdGhpcmRRdWFydGVybmlvbkJDb21wb25lbnQgPSB0aGlyZChxdWF0ZXJuaW9uQkNvbXBvbmVudHMpLFxuICAgICAgICBmb3VydGhRdWFydGVybmlvbkJDb21wb25lbnQgPSBmb3VydGgocXVhdGVybmlvbkJDb21wb25lbnRzKSxcbiAgICAgICAgYTEgPSBmaXJzdFF1YXJ0ZXJuaW9uQUNvbXBvbmVudCxcbiAgICAgICAgYjEgPSBzZWNvbmRRdWFydGVybmlvbkFDb21wb25lbnQsXG4gICAgICAgIGMxID0gdGhpcmRRdWFydGVybmlvbkFDb21wb25lbnQsXG4gICAgICAgIGQxID0gZm91cnRoUXVhcnRlcm5pb25BQ29tcG9uZW50LFxuICAgICAgICBhMiA9IGZpcnN0UXVhcnRlcm5pb25CQ29tcG9uZW50LFxuICAgICAgICBiMiA9IHNlY29uZFF1YXJ0ZXJuaW9uQkNvbXBvbmVudCxcbiAgICAgICAgYzIgPSB0aGlyZFF1YXJ0ZXJuaW9uQkNvbXBvbmVudCxcbiAgICAgICAgZDIgPSBmb3VydGhRdWFydGVybmlvbkJDb21wb25lbnQsXG4gICAgICAgIGEgPSBhMSAqIGEyIC0gYjEgKiBiMiAtIGMxICogYzIgLSBkMSAqIGQyLFxuICAgICAgICBiID0gYTEgKiBiMiArIGIxICogYTIgKyBjMSAqIGQyIC0gZDEgKiBjMixcbiAgICAgICAgYyA9IGExICogYzIgLSBiMSAqIGQyICsgYzEgKiBhMiArIGQxICogYjIsXG4gICAgICAgIGQgPSBhMSAqIGQyICsgYjEgKiBjMiAtIGMxICogYjIgKyBkMSAqIGEyLFxuICAgICAgICBxdWF0ZXJuaW9uID0gWyBhLCBiLCBjLCBkIF07XG5cbiAgcmV0dXJuIHF1YXRlcm5pb247XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUltYWdpbmFyeVF1YXRlcm5pb24ocG9zaXRpb24pIHtcbiAgY29uc3QgcG9zaXRpb25Db21wb25lbnRzID0gcG9zaXRpb24sICAvLy9cbiAgICAgICAgZmlyc3RQb3NpdGlvbkNvbXBvbmVudCA9IGZpcnN0KHBvc2l0aW9uQ29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZFBvc2l0aW9uQ29tcG9uZW50ID0gc2Vjb25kKHBvc2l0aW9uQ29tcG9uZW50cyksXG4gICAgICAgIHRoaXJkUG9zaXRpb25Db21wb25lbnQgPSB0aGlyZChwb3NpdGlvbkNvbXBvbmVudHMpLFxuICAgICAgICBpbWFnaW5hcnlRdWF0ZXJuaW9uID0gW1xuICAgICAgICAgIDAsXG4gICAgICAgICAgZmlyc3RQb3NpdGlvbkNvbXBvbmVudCxcbiAgICAgICAgICBzZWNvbmRQb3NpdGlvbkNvbXBvbmVudCxcbiAgICAgICAgICB0aGlyZFBvc2l0aW9uQ29tcG9uZW50XG4gICAgICAgIF07XG5cbiAgcmV0dXJuIGltYWdpbmFyeVF1YXRlcm5pb247XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVBvc2l0aW9uKGltYWdpbmFyeVF1YXRlcm5pb24pIHtcbiAgY29uc3QgaW1hZ2luYXJ5UXVhdGVybmlvbkNvbXBvbmVudHMgPSBpbWFnaW5hcnlRdWF0ZXJuaW9uLCAgLy8vXG4gICAgICAgIHNlY29uZEltYWdpbmFyeVF1YXRlcm5pb25Db21wb25lbnQgPSBzZWNvbmQoaW1hZ2luYXJ5UXVhdGVybmlvbkNvbXBvbmVudHMpLFxuICAgICAgICB0aGlyZEltYWdpbmFyeVF1YXRlcm5pb25Db21wb25lbnQgPSB0aGlyZChpbWFnaW5hcnlRdWF0ZXJuaW9uQ29tcG9uZW50cyksXG4gICAgICAgIGZvdXJ0aEltYWdpbmFyeVF1YXRlcm5pb25Db21wb25lbnQgPSBmb3VydGgoaW1hZ2luYXJ5UXVhdGVybmlvbkNvbXBvbmVudHMpLFxuICAgICAgICBwb3NpdGlvbiA9IFtcbiAgICAgICAgICBzZWNvbmRJbWFnaW5hcnlRdWF0ZXJuaW9uQ29tcG9uZW50LFxuICAgICAgICAgIHRoaXJkSW1hZ2luYXJ5UXVhdGVybmlvbkNvbXBvbmVudCxcbiAgICAgICAgICBmb3VydGhJbWFnaW5hcnlRdWF0ZXJuaW9uQ29tcG9uZW50XG4gICAgICAgIF07XG5cbiAgcmV0dXJuIHBvc2l0aW9uO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVSb3RhdGlvblF1YXJ0ZXJuaW9uKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSwgdW5pdEF4aXNPZlJvdGF0aW9uKSB7XG4gIGNvbnN0IGhhbGZBbmdsZU9mUm90YXRpb25Db3NpbmUgPSBjYWxjdWxhdGVIYWxmQW5nbGVDb3NpbmUoYW5nbGVPZlJvdGF0aW9uQ29zaW5lKSxcbiAgICAgICAgaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmUgPSBjYWxjdWxhdGVIYWxmQW5nbGVTaW5lKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSksXG4gICAgICAgIHVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMgPSB1bml0QXhpc09mUm90YXRpb24sICAvLy9cbiAgICAgICAgZmlyc3RBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCA9IGZpcnN0KHVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMpLFxuICAgICAgICBzZWNvbmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCA9IHNlY29uZCh1bml0QXhpc09mUm90YXRpb25Db21wb25lbnRzKSxcbiAgICAgICAgdGhpcmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCA9IHRoaXJkKHVuaXRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudHMpLFxuICAgICAgICByb3RhdGlvblF1YXJ0ZXJuaW9uID0gW1xuICAgICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25Db3NpbmUsXG4gICAgICAgICAgZmlyc3RBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCAqIGhhbGZBbmdsZU9mUm90YXRpb25TaW5lLFxuICAgICAgICAgIHNlY29uZEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50ICogaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmUsXG4gICAgICAgICAgdGhpcmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCAqIGhhbGZBbmdsZU9mUm90YXRpb25TaW5lXG4gICAgICAgIF07XG5cbiAgcmV0dXJuIHJvdGF0aW9uUXVhcnRlcm5pb247XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXJ0ZXJuaW9uKHJvdGF0aW9uUXVhdGVybmlvbikge1xuICBjb25zdCByb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzID0gcm90YXRpb25RdWF0ZXJuaW9uLCAgLy8vXG4gICAgICAgIGZpcnN0Um90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50ID0gZmlyc3Qocm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCA9IHNlY29uZChyb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzKSxcbiAgICAgICAgdGhpcmRSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQgPSB0aGlyZChyb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzKSxcbiAgICAgICAgZm91cnRoUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50ID0gZm91cnRoKHJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMpLFxuICAgICAgICBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uID0gW1xuICAgICAgICAgIGZpcnN0Um90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50LFxuICAgICAgICAgIC1zZWNvbmRSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQsXG4gICAgICAgICAgLXRoaXJkUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50LFxuICAgICAgICAgIC1mb3VydGhSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRcbiAgICAgICAgXTtcblxuICByZXR1cm4gaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbjtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlSGFsZkFuZ2xlQ29zaW5lKGFuZ2xlQ29zaW5lKSB7XG4gIGNvbnN0IGhhbGZBbmdsZUNvc2luZSA9IE1hdGguc3FydCgoMSArIGFuZ2xlQ29zaW5lKSAvIDIpO1xuXG4gIHJldHVybiBoYWxmQW5nbGVDb3NpbmU7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUhhbGZBbmdsZVNpbmUoYW5nbGVDb3NpbmUpIHtcbiAgY29uc3QgaGFsZkFuZ2xlU2luZSA9IE1hdGguc3FydCgoMSAtIGFuZ2xlQ29zaW5lKSAvIDIpO1xuXG4gIHJldHVybiBoYWxmQW5nbGVTaW5lO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgY2FsY3VsYXRlSW50ZXJzZWN0aW9uT2ZQbGFuZXM6IGNhbGN1bGF0ZUludGVyc2VjdGlvbk9mUGxhbmVzXG59O1xuIl19