'use strict';

var constants = require('../constants'),
    matrixMaths = require('../maths/matrix'),
    vectorMaths = require('../maths/vector'),
    arrayUtilities = require('../utilities/array');

var scale3 = vectorMaths.scale3,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    DEGREES_TO_RADIANS_SCALAR = constants.DEGREES_TO_RADIANS_SCALAR,
    FIELD_OF_VIEW = constants.FIELD_OF_VIEW,
    Z_NEAR = constants.Z_NEAR,
    Z_FAR = constants.Z_FAR,
    identity4 = matrixMaths.identity4,
    scale4 = matrixMaths.scale4,
    invert4 = matrixMaths.invert4,
    rotate4 = matrixMaths.rotate4,
    translate4 = matrixMaths.translate4,
    transpose4 = matrixMaths.transpose4,
    perspective4 = matrixMaths.perspective4;


function scaleMatrixFromScale(scale) {
  var scaleMatrix = identity4();

  scaleMatrix = scale4(scaleMatrix, scale);

  return scaleMatrix;
}

function offsetsMatrixFromOffsets(offsets) {
  var offsetsMatrix = identity4(); ///

  offsetsMatrix = translate4(offsetsMatrix, offsets);

  return offsetsMatrix;
}

function positionMatrixFromNothing() {
  var positionMatrix = identity4(); ///

  return positionMatrix;
}

function positionMatrixFromDistance(distance) {
  var positionMatrix = identity4(); ///

  var x = 0,
      y = 0,
      z = -distance;

  positionMatrix = translate4(positionMatrix, [x, y, z]);

  return positionMatrix;
}

function positionMatrixFromPosition(position) {
  var positionMatrix = identity4(); ///

  positionMatrix = translate4(positionMatrix, position);

  return positionMatrix;
}

function rotationsMatrixFromAngles(angles) {
  var reverseOrder = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

  var rotationsMatrix = identity4(); ///

  var firstAngle = first(angles),
      secondAngle = second(angles),
      thirdAngle = third(angles),
      xAngle = firstAngle,
      yAngle = secondAngle,
      zAngle = thirdAngle,
      xAxis = [1, 0, 0],
      yAxis = [0, 1, 0],
      zAxis = [0, 0, 1];

  if (reverseOrder) {
    rotationsMatrix = rotate4(rotationsMatrix, zAngle, zAxis);

    rotationsMatrix = rotate4(rotationsMatrix, yAngle, yAxis);

    rotationsMatrix = rotate4(rotationsMatrix, xAngle, xAxis);
  } else {
    rotationsMatrix = rotate4(rotationsMatrix, xAngle, xAxis);

    rotationsMatrix = rotate4(rotationsMatrix, yAngle, yAxis);

    rotationsMatrix = rotate4(rotationsMatrix, zAngle, zAxis);
  }

  return rotationsMatrix;
}

function rotationsMatrixFromRotations(rotations) {
  var scalar = DEGREES_TO_RADIANS_SCALAR,
      angles = scale3(rotations, scalar),
      rotationsMatrix = rotationsMatrixFromAngles(angles);

  return rotationsMatrix;
}

function normalsMatrixFromRotationsMatrix(rotationsMatrix) {
  var normalsMatrix = invert4(rotationsMatrix);

  normalsMatrix = transpose4(normalsMatrix);

  return normalsMatrix;
}

function projectionMatrixFromWidthAndHeight(width, height) {
  var fieldOfView = FIELD_OF_VIEW,
      ///
  aspectRatio = width / height,
      zNear = Z_NEAR,
      ///
  zFar = Z_FAR,
      ///
  projectionMatrix = perspective4(fieldOfView, aspectRatio, zNear, zFar);

  return projectionMatrix;
}

module.exports = {
  scaleMatrixFromScale: scaleMatrixFromScale,
  offsetsMatrixFromOffsets: offsetsMatrixFromOffsets,
  positionMatrixFromNothing: positionMatrixFromNothing,
  positionMatrixFromDistance: positionMatrixFromDistance,
  positionMatrixFromPosition: positionMatrixFromPosition,
  rotationsMatrixFromAngles: rotationsMatrixFromAngles,
  rotationsMatrixFromRotations: rotationsMatrixFromRotations,
  normalsMatrixFromRotationsMatrix: normalsMatrixFromRotationsMatrix,
  projectionMatrixFromWidthAndHeight: projectionMatrixFromWidthAndHeight
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvbWF0cml4LmpzIl0sIm5hbWVzIjpbImNvbnN0YW50cyIsInJlcXVpcmUiLCJtYXRyaXhNYXRocyIsInZlY3Rvck1hdGhzIiwiYXJyYXlVdGlsaXRpZXMiLCJzY2FsZTMiLCJmaXJzdCIsInNlY29uZCIsInRoaXJkIiwiREVHUkVFU19UT19SQURJQU5TX1NDQUxBUiIsIkZJRUxEX09GX1ZJRVciLCJaX05FQVIiLCJaX0ZBUiIsImlkZW50aXR5NCIsInNjYWxlNCIsImludmVydDQiLCJyb3RhdGU0IiwidHJhbnNsYXRlNCIsInRyYW5zcG9zZTQiLCJwZXJzcGVjdGl2ZTQiLCJzY2FsZU1hdHJpeEZyb21TY2FsZSIsInNjYWxlIiwic2NhbGVNYXRyaXgiLCJvZmZzZXRzTWF0cml4RnJvbU9mZnNldHMiLCJvZmZzZXRzIiwib2Zmc2V0c01hdHJpeCIsInBvc2l0aW9uTWF0cml4RnJvbU5vdGhpbmciLCJwb3NpdGlvbk1hdHJpeCIsInBvc2l0aW9uTWF0cml4RnJvbURpc3RhbmNlIiwiZGlzdGFuY2UiLCJ4IiwieSIsInoiLCJwb3NpdGlvbk1hdHJpeEZyb21Qb3NpdGlvbiIsInBvc2l0aW9uIiwicm90YXRpb25zTWF0cml4RnJvbUFuZ2xlcyIsImFuZ2xlcyIsInJldmVyc2VPcmRlciIsInJvdGF0aW9uc01hdHJpeCIsImZpcnN0QW5nbGUiLCJzZWNvbmRBbmdsZSIsInRoaXJkQW5nbGUiLCJ4QW5nbGUiLCJ5QW5nbGUiLCJ6QW5nbGUiLCJ4QXhpcyIsInlBeGlzIiwiekF4aXMiLCJyb3RhdGlvbnNNYXRyaXhGcm9tUm90YXRpb25zIiwicm90YXRpb25zIiwic2NhbGFyIiwibm9ybWFsc01hdHJpeEZyb21Sb3RhdGlvbnNNYXRyaXgiLCJub3JtYWxzTWF0cml4IiwicHJvamVjdGlvbk1hdHJpeEZyb21XaWR0aEFuZEhlaWdodCIsIndpZHRoIiwiaGVpZ2h0IiwiZmllbGRPZlZpZXciLCJhc3BlY3RSYXRpbyIsInpOZWFyIiwi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Z0JsQyxXQUFXa0MsYUFBWCxDQUFoQjs7QUFFQSxTQUFPQSxhQUFQO0FBQ0Q7O0FBRUQsU0FBU0Msa0NBQVQsQ0FBNENDLEtBQTVDLEVBQW1EQyxNQUFuRCxFQUEyRDtBQUN6RCxNQUFNQyxjQUFjOUMsYUFBcEI7QUFBQSxNQUFvQztBQUM5QitDLGdCQUFjSCxRQUFRQyxNQUQ1QjtBQUFBLE1BRU1HLFFBQVEvQyxNQUZkO0FBQUEsTUFFc0I7QUFDaEJnRCxTQUFPL0MsS0FIYjtBQUFBLE1BR29CO0FBQ2RnRCxxQkFBbUJ6QyxhQUFhcUMsV0FBYixFQUEwQkMsV0FBMUIsRUFBdUNDLEtBQXZDLEVBQThDQyxJQUE5QyxDQUp6Qjs7QUFNQSxTQUFPQyxnQkFBUDtBQUNEOztBQUVEQyxPQUFPQyxPQUFQLEdBQWlCO0FBQ2YxQyw0Q0FEZTtBQUVmRyxvREFGZTtBQUdmRyxzREFIZTtBQUlmRSx3REFKZTtBQUtmSyx3REFMZTtBQU1mRSxzREFOZTtBQU9mYSw0REFQZTtBQVFmRyxvRUFSZTtBQVNmRTtBQVRlLENBQWpCIiwiZmlsZSI6Im1hdHJpeC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgY29uc3RhbnRzID0gcmVxdWlyZSgnLi4vY29uc3RhbnRzJyksXG4gICAgICBtYXRyaXhNYXRocyA9IHJlcXVpcmUoJy4uL21hdGhzL21hdHJpeCcpLFxuICAgICAgdmVjdG9yTWF0aHMgPSByZXF1aXJlKCcuLi9tYXRocy92ZWN0b3InKSxcbiAgICAgIGFycmF5VXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2FycmF5Jyk7XG5cbmNvbnN0IHsgc2NhbGUzIH0gPSB2ZWN0b3JNYXRocyxcbiAgICAgIHsgZmlyc3QsIHNlY29uZCwgdGhpcmQgfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBERUdSRUVTX1RPX1JBRElBTlNfU0NBTEFSLCBGSUVMRF9PRl9WSUVXLCBaX05FQVIsIFpfRkFSIH0gPSBjb25zdGFudHMsXG4gICAgICB7IGlkZW50aXR5NCwgc2NhbGU0LCBpbnZlcnQ0LCByb3RhdGU0LCB0cmFuc2xhdGU0LCB0cmFuc3Bvc2U0LCBwZXJzcGVjdGl2ZTQgfSA9IG1hdHJpeE1hdGhzO1xuXG5mdW5jdGlvbiBzY2FsZU1hdHJpeEZyb21TY2FsZShzY2FsZSkge1xuICBsZXQgc2NhbGVNYXRyaXggPSBpZGVudGl0eTQoKTtcblxuICBzY2FsZU1hdHJpeCA9IHNjYWxlNChzY2FsZU1hdHJpeCwgc2NhbGUpO1xuXG4gIHJldHVybiBzY2FsZU1hdHJpeDtcbn1cblxuZnVuY3Rpb24gb2Zmc2V0c01hdHJpeEZyb21PZmZzZXRzKG9mZnNldHMpIHtcbiAgbGV0IG9mZnNldHNNYXRyaXggPSBpZGVudGl0eTQoKTsgLy8vXG5cbiAgb2Zmc2V0c01hdHJpeCA9IHRyYW5zbGF0ZTQob2Zmc2V0c01hdHJpeCwgb2Zmc2V0cyk7XG5cbiAgcmV0dXJuIG9mZnNldHNNYXRyaXg7XG59XG5cbmZ1bmN0aW9uIHBvc2l0aW9uTWF0cml4RnJvbU5vdGhpbmcoKSB7XG4gIGxldCBwb3NpdGlvbk1hdHJpeCA9IGlkZW50aXR5NCgpOyAvLy9cblxuICByZXR1cm4gcG9zaXRpb25NYXRyaXg7XG59XG5cbmZ1bmN0aW9uIHBvc2l0aW9uTWF0cml4RnJvbURpc3RhbmNlKGRpc3RhbmNlKSB7XG4gIGxldCBwb3NpdGlvbk1hdHJpeCA9IGlkZW50aXR5NCgpOyAvLy9cblxuICBjb25zdCB4ID0gMCxcbiAgICAgICAgeSA9IDAsXG4gICAgICAgIHogPSAtZGlzdGFuY2U7XG5cbiAgcG9zaXRpb25NYXRyaXggPSB0cmFuc2xhdGU0KHBvc2l0aW9uTWF0cml4LCBbIHgsIHksIHogXSk7XG5cbiAgcmV0dXJuIHBvc2l0aW9uTWF0cml4O1xufVxuXG5mdW5jdGlvbiBwb3NpdGlvbk1hdHJpeEZyb21Qb3NpdGlvbihwb3NpdGlvbikge1xuICBsZXQgcG9zaXRpb25NYXRyaXggPSBpZGVudGl0eTQoKTsgLy8vXG5cbiAgcG9zaXRpb25NYXRyaXggPSB0cmFuc2xhdGU0KHBvc2l0aW9uTWF0cml4LCBwb3NpdGlvbik7XG5cbiAgcmV0dXJuIHBvc2l0aW9uTWF0cml4O1xufVxuXG5mdW5jdGlvbiByb3RhdGlvbnNNYXRyaXhGcm9tQW5nbGVzKGFuZ2xlcywgcmV2ZXJzZU9yZGVyID0gZmFsc2UpIHtcbiAgbGV0IHJvdGF0aW9uc01hdHJpeCA9IGlkZW50aXR5NCgpOyAvLy9cblxuICBjb25zdCBmaXJzdEFuZ2xlID0gZmlyc3QoYW5nbGVzKSxcbiAgICAgICAgc2Vjb25kQW5nbGUgPSBzZWNvbmQoYW5nbGVzKSxcbiAgICAgICAgdGhpcmRBbmdsZSA9IHRoaXJkKGFuZ2xlcyksXG4gICAgICAgIHhBbmdsZSA9IGZpcnN0QW5nbGUsXG4gICAgICAgIHlBbmdsZSA9IHNlY29uZEFuZ2xlLFxuICAgICAgICB6QW5nbGUgPSB0aGlyZEFuZ2xlLFxuICAgICAgICB4QXhpcyA9IFsgMSwgMCwgMCBdLFxuICAgICAgICB5QXhpcyA9IFsgMCwgMSwgMCBdLFxuICAgICAgICB6QXhpcyA9IFsgMCwgMCwgMSBdO1xuXG4gIGlmIChyZXZlcnNlT3JkZXIpIHtcbiAgICByb3RhdGlvbnNNYXRyaXggPSByb3RhdGU0KHJvdGF0aW9uc01hdHJpeCwgekFuZ2xlLCB6QXhpcyk7XG5cbiAgICByb3RhdGlvbnNNYXRyaXggPSByb3RhdGU0KHJvdGF0aW9uc01hdHJpeCwgeUFuZ2xlLCB5QXhpcyk7XG5cbiAgICByb3RhdGlvbnNNYXRyaXggPSByb3RhdGU0KHJvdGF0aW9uc01hdHJpeCwgeEFuZ2xlLCB4QXhpcyk7XG4gIH0gZWxzZSB7XG4gICAgcm90YXRpb25zTWF0cml4ID0gcm90YXRlNChyb3RhdGlvbnNNYXRyaXgsIHhBbmdsZSwgeEF4aXMpO1xuXG4gICAgcm90YXRpb25zTWF0cml4ID0gcm90YXRlNChyb3RhdGlvbnNNYXRyaXgsIHlBbmdsZSwgeUF4aXMpO1xuXG4gICAgcm90YXRpb25zTWF0cml4ID0gcm90YXRlNChyb3RhdGlvbnNNYXRyaXgsIHpBbmdsZSwgekF4aXMpO1xuICB9XG5cbiAgcmV0dXJuIHJvdGF0aW9uc01hdHJpeDtcbn1cblxuZnVuY3Rpb24gcm90YXRpb25zTWF0cml4RnJvbVJvdGF0aW9ucyhyb3RhdGlvbnMpIHtcbiAgY29uc3Qgc2NhbGFyID0gREVHUkVFU19UT19SQURJQU5TX1NDQUxBUixcbiAgICAgICAgYW5nbGVzID0gc2NhbGUzKHJvdGF0aW9ucywgc2NhbGFyKSxcbiAgICAgICAgcm90YXRpb25zTWF0cml4ID0gcm90YXRpb25zTWF0cml4RnJvbUFuZ2xlcyhhbmdsZXMpO1xuXG4gIHJldHVybiByb3RhdGlvbnNNYXRyaXg7XG59XG5cbmZ1bmN0aW9uIG5vcm1hbHNNYXRyaXhGcm9tUm90YXRpb25zTWF0cml4KHJvdGF0aW9uc01hdHJpeCkge1xuICBsZXQgbm9ybWFsc01hdHJpeCA9IGludmVydDQocm90YXRpb25zTWF0cml4KTtcblxuICBub3JtYWxzTWF0cml4ID0gdHJhbnNwb3NlNChub3JtYWxzTWF0cml4KTtcblxuICByZXR1cm4gbm9ybWFsc01hdHJpeDtcbn1cblxuZnVuY3Rpb24gcHJvamVjdGlvbk1hdHJpeEZyb21XaWR0aEFuZEhlaWdodCh3aWR0aCwgaGVpZ2h0KSB7XG4gIGNvbnN0IGZpZWxkT2ZWaWV3ID0gRklFTERfT0ZfVklFVywgIC8vL1xuICAgICAgICBhc3BlY3RSYXRpbyA9IHdpZHRoIC8gaGVpZ2h0LFxuICAgICAgICB6TmVhciA9IFpfTkVBUiwgLy8vXG4gICAgICAgIHpGYXIgPSBaX0ZBUiwgLy8vXG4gICAgICAgIHByb2plY3Rpb25NYXRyaXggPSBwZXJzcGVjdGl2ZTQoZmllbGRPZlZpZXcsIGFzcGVjdFJhdGlvLCB6TmVhciwgekZhcik7XG5cbiAgcmV0dXJuIHByb2plY3Rpb25NYXRyaXg7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBzY2FsZU1hdHJpeEZyb21TY2FsZSxcbiAgb2Zmc2V0c01hdHJpeEZyb21PZmZzZXRzLFxuICBwb3NpdGlvbk1hdHJpeEZyb21Ob3RoaW5nLFxuICBwb3NpdGlvbk1hdHJpeEZyb21EaXN0YW5jZSxcbiAgcG9zaXRpb25NYXRyaXhGcm9tUG9zaXRpb24sXG4gIHJvdGF0aW9uc01hdHJpeEZyb21BbmdsZXMsXG4gIHJvdGF0aW9uc01hdHJpeEZyb21Sb3RhdGlvbnMsXG4gIG5vcm1hbHNNYXRyaXhGcm9tUm90YXRpb25zTWF0cml4LFxuICBwcm9qZWN0aW9uTWF0cml4RnJvbVdpZHRoQW5kSGVpZ2h0XG59O1xuIl19