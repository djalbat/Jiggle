'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var arrayUtilities = require('./utilities/array'),
    rotationUtilities = require('./utilities/rotation'),
    approximateUtilities = require('./utilities/approximate');

var first = arrayUtilities.first,
    second = arrayUtilities.second,
    isApproximatelyEqualToZero = approximateUtilities.isApproximatelyEqualToZero,
    rotatePositionAboutZAxis = rotationUtilities.rotatePositionAboutZAxis,
    calculateRotationAboutZAxisMatrix = rotationUtilities.calculateRotationAboutZAxisMatrix,
    calculateForwardsRotationAboutZAxisMatrix = rotationUtilities.calculateForwardsRotationAboutZAxisMatrix,
    calculateBackwardsRotationAboutZAxisMatrix = rotationUtilities.calculateBackwardsRotationAboutZAxisMatrix;

var VerticalLine = function () {
  function VerticalLine(firstPositionComponent, rotationAboutZAxisMatrix) {
    _classCallCheck(this, VerticalLine);

    this.firstPositionComponent = firstPositionComponent;
    this.rotationAboutZAxisMatrix = rotationAboutZAxisMatrix;
  }

  _createClass(VerticalLine, [{
    key: 'getFirstPositionComponent',
    value: function getFirstPositionComponent() {
      return this.firstPositionComponent;
    }
  }, {
    key: 'getRotationAboutZAxisMatrix',
    value: function getRotationAboutZAxisMatrix() {
      return this.rotationAboutZAxisMatrix;
    }
  }, {
    key: 'splitFacets',
    value: function splitFacets(facets) {
      var smallerFacets = [],
          forwardsRotationAboutZAxisMatrix = calculateForwardsRotationAboutZAxisMatrix(this.rotationAboutZAxisMatrix),
          backwardsRotationAboutZAxisMatrix = calculateBackwardsRotationAboutZAxisMatrix(this.rotationAboutZAxisMatrix);

      facets.forEach(function (facet) {
        facet.rotateAboutZAxis(forwardsRotationAboutZAxisMatrix);

        this.splitFacet(facet, smallerFacets);
      }.bind(this));

      smallerFacets.forEach(function (smallerFacet) {
        smallerFacet.rotateAboutZAxis(backwardsRotationAboutZAxisMatrix);
      });

      return smallerFacets;
    }
  }, {
    key: 'splitFacet',
    value: function splitFacet(facet, smallerFacets) {
      var intersections = this.calculateIntersectionsWithFacet(facet);

      facet.split(intersections, smallerFacets);
    }
  }, {
    key: 'calculateIntersectionsWithFacet',
    value: function calculateIntersectionsWithFacet(facet) {
      var edges = facet.getEdges(),
          intersections = edges.map(function (edge) {
        var intersection = this.calculateIntersection(edge);

        return intersection;
      }.bind(this));

      return intersections;
    }
  }, {
    key: 'calculateIntersection',
    value: function calculateIntersection(edge) {
      var intersection = null;

      var edgeNonParallel = isEdgeNonParallel(edge);

      if (edgeNonParallel) {
        var edgeIntersection = this.calculateEdgeIntersection(edge),
            edgeIntersectionNonTrivial = isIntersectionNonTrivial(edgeIntersection);

        if (edgeIntersectionNonTrivial) {
          intersection = edgeIntersection; ///
        }
      }

      return intersection;
    }
  }, {
    key: 'calculateEdgeIntersection',
    value: function calculateEdgeIntersection(edge) {
      var edgePosition = edge.getPosition(),
          edgeExtent = edge.getExtent(),
          edgePositionComponents = edgePosition,
          ///
      edgeExtentComponents = edgeExtent,
          ///
      firstEdgePositionComponent = first(edgePositionComponents),
          firstEdgeExtentComponent = first(edgeExtentComponents),
          edgeIntersection = (this.firstPositionComponent - firstEdgePositionComponent) / firstEdgeExtentComponent;

      return edgeIntersection;
    }
  }], [{
    key: 'fromMaskingEdge',
    value: function fromMaskingEdge(maskingEdge) {
      var maskingEdgePosition = maskingEdge.getPosition(),
          rotationAboutZAxisMatrix = calculateRotationAboutZAxisMatrix(maskingEdge),
          position = rotatePositionAboutZAxis(maskingEdgePosition, rotationAboutZAxisMatrix),
          positionComponents = position,
          ///
      firstPositionComponent = first(positionComponents),
          verticalLine = new VerticalLine(firstPositionComponent, rotationAboutZAxisMatrix);

      return verticalLine;
    }
  }]);

  return VerticalLine;
}();

module.exports = VerticalLine;

function isEdgeNonParallel(edge) {
  var edgeExtent = edge.getExtent(),
      edgeExtentComponents = edgeExtent,
      ///
  firstEdgeExtentComponent = first(edgeExtentComponents),
      secondEdgeExtentComponent = second(edgeExtentComponents),
      edgeAngleTangent = firstEdgeExtentComponent / secondEdgeExtentComponent,
      edgeAngleTangentApproximatelyEqualToZero = isApproximatelyEqualToZero(edgeAngleTangent),
      edgeParallel = edgeAngleTangentApproximatelyEqualToZero,
      ///
  edgeNonParallel = !edgeParallel;

  return edgeNonParallel;
}

function isIntersectionNonTrivial(intersection) {
  var intersectionNonTrivial = intersection > 0 && intersection < 1;

  return intersectionNonTrivial;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi92ZXJ0aWNhbExpbmUuanMiXSwibmFtZXMiOlsiYXJyYXlVdGlsaXRpZXMiLCJyZXF1aXJlIiwicm90YXRpb25VdGlsaXRpZXMiLCJhcHByb3hpbWF0ZVV0aWxpdGllcyIsImZpcnN0Iiwic2Vjb25kIiwiaXNBcHByb3hpbWF0ZWx5RXF1YWxUb1plcm8iLCJyb3RhdGVQb3NpdGlvbkFib3V0WkF4aXMiLCJjYWxjdWxhdGVSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgiLCJjYWxjdWxhdGVGb3J3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCIsImNhbGN1bGF0ZUJhY2t3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCIsIlZlcnRpY2FsTGluZSIsImZpcnN0UG9zaXRpb25Db21wb25lbnQiLCJyb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgiLCJmYWNldHMiLCJzbWFsbGVyRmFjZXRzIiwiZm9yd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgiLCJiYWNrd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgiLCJmb3JFYWNoIiwiZmFjZXQiLCJyb3RhdGVBYm91dFpBeGlzIiwic3BsaXRGYWNldCIsImJpbmQiLCJzbWFsbGVyRmFjZXQiLCJpbnRlcnNlY3Rpb25zIiwiY2FsY3VsYXRlSW50ZXJzZWN0aW9uc1dpdGhGYWNldCIsInNwbGl0IiwiZWRnZXMiLCJnZXRFZGdlcyIsIm1hcCIsImVkZ2UiLCJpbnRlcnNlY3Rpb24iLCJjYWxjdWxhdGVJbnRlcnNlY3Rpb24iLCJlZGdlTm9uUGFyYWxsZWwiLCJpc0VkZ2VOb25QYXJhbGxlbCIsImVkZ2VJbnRlcnNlY3Rpb24iLCJjYWxjdWxhdGVFZGdlSW50ZXJzZWN0aW9uIiwiZWRnZUludGVyc2VjdGlvbk5vblRyaXZpYWwiLCJpc0ludGVyc2VjdGlvbk5vblRyaXZpYWwiLCJlZGdlUG9zaXRpb24iLCJnZXRQb3NpdGlvbiIsImVkZ2VFeHRlbnQiLCJnZXRFeHRlbnQiLCJlZGdlUG9zaXRpb25Db21wb25lbnRzIiwiZWRnZUV4dGVudENvbXBvbmVudHMiLCJmaXJzdEVkZ2VQb3NpdGlvbkNvbXBvbmVudCIsImZpcnN0RWRnZUV4dGVudENvbXBvbmVudCIsIm1hc2tpbmdFZGdlIiwibWFza2luZ0VkZ2VQb3NpdGlvbiIsInBvc2l0aW9uIiwicG9zaXRpb25Db21wb25lbnRzIiwidmVydGljYWxMaW5lIiwibW9kdWxlIiwiZXhwb3J0cyIsInNlY29uZEVkZ2VFeHRlbnRDb21wb25lbnQiLCJlZGdlQW5nbGVUYW5nZW50IiwiZWRnZUFuZ2xlVGFuZ2VudEFwcHJveGltYXRlbHlFcXVhbFRvWmVybyIsImVkZ2VQYXJhbGxlbCIsImludGVyc2VjdGlvbk5vblRyaXZpYWwiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7QUFFQSxJQUFNQSxpQkFBaUJDLFFBQVEsbUJBQVIsQ0FBdkI7QUFBQSxJQUNNQyxvQkFBb0JELFFBQVEsc0JBQVIsQ0FEMUI7QUFBQSxJQUVNRSx1QkFBdUJGLFFBQVEseUJBQVIsQ0FGN0I7O0lBSVFHLEssR0FBa0JKLGMsQ0FBbEJJLEs7SUFBT0MsTSxHQUFXTCxjLENBQVhLLE07SUFDUEMsMEIsR0FBK0JILG9CLENBQS9CRywwQjtJQUNBQyx3QixHQUF1SkwsaUIsQ0FBdkpLLHdCO0lBQTBCQyxpQyxHQUE2SE4saUIsQ0FBN0hNLGlDO0lBQW1DQyx5QyxHQUEwRlAsaUIsQ0FBMUZPLHlDO0lBQTJDQywwQyxHQUErQ1IsaUIsQ0FBL0NRLDBDOztJQUUxR0MsWTtBQUNKLHdCQUFZQyxzQkFBWixFQUFvQ0Msd0JBQXBDLEVBQThEO0FBQUE7O0FBQzVELFNBQUtELHNCQUFMLEdBQThCQSxzQkFBOUI7QUFDQSxTQUFLQyx3QkFBTCxHQUFnQ0Esd0JBQWhDO0FBQ0Q7Ozs7Z0RBRTJCO0FBQzFCLGFBQU8sS0FBS0Qsc0JBQVo7QUFDRDs7O2tEQUU2QjtBQUM1QixhQUFPLEtBQUtDLHdCQUFaO0FBQ0Q7OztnQ0FFV0MsTSxFQUFRO0FBQ2xCLFVBQU1DLGdCQUFnQixFQUF0QjtBQUFBLFVBQ01D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LE9BQU91QyxvQkFBUCxDQUhsQztBQUFBLE1BSU1XLG1CQUFtQlQsMkJBQTJCUSx5QkFKcEQ7QUFBQSxNQUtNRSwyQ0FBMkNsRCwyQkFBMkJpRCxnQkFBM0IsQ0FMakQ7QUFBQSxNQU1NRSxlQUFlRCx3Q0FOckI7QUFBQSxNQU0rRDtBQUN6RHZCLG9CQUFrQixDQUFDd0IsWUFQekI7O0FBU0EsU0FBT3hCLGVBQVA7QUFDRDs7QUFFRCxTQUFTSyx3QkFBVCxDQUFrQ1AsWUFBbEMsRUFBZ0Q7QUFDOUMsTUFBTTJCLHlCQUEyQjNCLGVBQWUsQ0FBaEIsSUFBd0JBLGVBQWUsQ0FBdkU7O0FBRUEsU0FBTzJCLHNCQUFQO0FBQ0QiLCJmaWxlIjoidmVydGljYWxMaW5lLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL2FycmF5JyksXG4gICAgICByb3RhdGlvblV0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL3JvdGF0aW9uJyksXG4gICAgICBhcHByb3hpbWF0ZVV0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL2FwcHJveGltYXRlJyk7XG5cbmNvbnN0IHsgZmlyc3QsIHNlY29uZCB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IGlzQXBwcm94aW1hdGVseUVxdWFsVG9aZXJvIH0gPSBhcHByb3hpbWF0ZVV0aWxpdGllcyxcbiAgICAgIHsgcm90YXRlUG9zaXRpb25BYm91dFpBeGlzLCBjYWxjdWxhdGVSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgsIGNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4LCBjYWxjdWxhdGVCYWNrd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXggfSA9IHJvdGF0aW9uVXRpbGl0aWVzO1xuXG5jbGFzcyBWZXJ0aWNhbExpbmUge1xuICBjb25zdHJ1Y3RvcihmaXJzdFBvc2l0aW9uQ29tcG9uZW50LCByb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgpIHtcbiAgICB0aGlzLmZpcnN0UG9zaXRpb25Db21wb25lbnQgPSBmaXJzdFBvc2l0aW9uQ29tcG9uZW50O1xuICAgIHRoaXMucm90YXRpb25BYm91dFpBeGlzTWF0cml4ID0gcm90YXRpb25BYm91dFpBeGlzTWF0cml4O1xuICB9XG5cbiAgZ2V0Rmlyc3RQb3NpdGlvbkNvbXBvbmVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5maXJzdFBvc2l0aW9uQ29tcG9uZW50O1xuICB9XG4gIFxuICBnZXRSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgoKSB7XG4gICAgcmV0dXJuIHRoaXMucm90YXRpb25BYm91dFpBeGlzTWF0cml4O1xuICB9XG5cbiAgc3BsaXRGYWNldHMoZmFjZXRzKSB7XG4gICAgY29uc3Qgc21hbGxlckZhY2V0cyA9IFtdLFxuICAgICAgICAgIGZvcndhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4ID0gY2FsY3VsYXRlRm9yd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgodGhpcy5yb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgpLFxuICAgICAgICAgIGJhY2t3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCA9IGNhbGN1bGF0ZUJhY2t3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCh0aGlzLnJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCk7XG4gICAgXG4gICAgZmFjZXRzLmZvckVhY2goZnVuY3Rpb24oZmFjZXQpIHtcbiAgICAgIGZhY2V0LnJvdGF0ZUFib3V0WkF4aXMoZm9yd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgpO1xuXG4gICAgICB0aGlzLnNwbGl0RmFjZXQoZmFjZXQsIHNtYWxsZXJGYWNldHMpO1xuICAgIH0uYmluZCh0aGlzKSk7XG4gICAgXG4gICAgc21hbGxlckZhY2V0cy5mb3JFYWNoKGZ1bmN0aW9uKHNtYWxsZXJGYWNldCkge1xuICAgICAgc21hbGxlckZhY2V0LnJvdGF0ZUFib3V0WkF4aXMoYmFja3dhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4KTtcbiAgICB9KTtcblxuICAgIHJldHVybiBzbWFsbGVyRmFjZXRzOyAgICBcbiAgfVxuXG4gIHNwbGl0RmFjZXQoZmFjZXQsIHNtYWxsZXJGYWNldHMpIHtcbiAgICBjb25zdCBpbnRlcnNlY3Rpb25zID0gdGhpcy5jYWxjdWxhdGVJbnRlcnNlY3Rpb25zV2l0aEZhY2V0KGZhY2V0KTtcblxuICAgIGZhY2V0LnNwbGl0KGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMpO1xuICB9XG5cbiAgY2FsY3VsYXRlSW50ZXJzZWN0aW9uc1dpdGhGYWNldChmYWNldCkge1xuICAgIGNvbnN0IGVkZ2VzID0gZmFjZXQuZ2V0RWRnZXMoKSxcbiAgICAgICAgICBpbnRlcnNlY3Rpb25zID0gZWRnZXMubWFwKGZ1bmN0aW9uKGVkZ2UpIHtcbiAgICAgICAgICAgIGNvbnN0IGludGVyc2VjdGlvbiA9IHRoaXMuY2FsY3VsYXRlSW50ZXJzZWN0aW9uKGVkZ2UpO1xuXG4gICAgICAgICAgICByZXR1cm4gaW50ZXJzZWN0aW9uO1xuICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICByZXR1cm4gaW50ZXJzZWN0aW9ucztcbiAgfVxuICBcbiAgY2FsY3VsYXRlSW50ZXJzZWN0aW9uKGVkZ2UpIHtcbiAgICBsZXQgaW50ZXJzZWN0aW9uID0gbnVsbDtcblxuICAgIGNvbnN0IGVkZ2VOb25QYXJhbGxlbCA9IGlzRWRnZU5vblBhcmFsbGVsKGVkZ2UpO1xuXG4gICAgaWYgKGVkZ2VOb25QYXJhbGxlbCkge1xuICAgICAgY29uc3QgZWRnZUludGVyc2VjdGlvbiA9IHRoaXMuY2FsY3VsYXRlRWRnZUludGVyc2VjdGlvbihlZGdlKSxcbiAgICAgICAgICAgIGVkZ2VJbnRlcnNlY3Rpb25Ob25Ucml2aWFsID0gaXNJbnRlcnNlY3Rpb25Ob25Ucml2aWFsKGVkZ2VJbnRlcnNlY3Rpb24pO1xuXG4gICAgICBpZiAoZWRnZUludGVyc2VjdGlvbk5vblRyaXZpYWwpIHtcbiAgICAgICAgaW50ZXJzZWN0aW9uID0gZWRnZUludGVyc2VjdGlvbjsgIC8vL1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBpbnRlcnNlY3Rpb247XG4gIH1cblxuICBjYWxjdWxhdGVFZGdlSW50ZXJzZWN0aW9uKGVkZ2UpIHtcbiAgICBjb25zdCBlZGdlUG9zaXRpb24gPSBlZGdlLmdldFBvc2l0aW9uKCksXG4gICAgICAgICAgZWRnZUV4dGVudCA9IGVkZ2UuZ2V0RXh0ZW50KCksXG4gICAgICAgICAgZWRnZVBvc2l0aW9uQ29tcG9uZW50cyA9IGVkZ2VQb3NpdGlvbiwgLy8vXG4gICAgICAgICAgZWRnZUV4dGVudENvbXBvbmVudHMgPSBlZGdlRXh0ZW50LCAvLy9cbiAgICAgICAgICBmaXJzdEVkZ2VQb3NpdGlvbkNvbXBvbmVudCA9IGZpcnN0KGVkZ2VQb3NpdGlvbkNvbXBvbmVudHMpLFxuICAgICAgICAgIGZpcnN0RWRnZUV4dGVudENvbXBvbmVudCA9IGZpcnN0KGVkZ2VFeHRlbnRDb21wb25lbnRzKSxcbiAgICAgICAgICBlZGdlSW50ZXJzZWN0aW9uID0gKHRoaXMuZmlyc3RQb3NpdGlvbkNvbXBvbmVudCAtIGZpcnN0RWRnZVBvc2l0aW9uQ29tcG9uZW50KSAvIGZpcnN0RWRnZUV4dGVudENvbXBvbmVudDtcbiAgICBcbiAgICByZXR1cm4gZWRnZUludGVyc2VjdGlvbjtcbiAgfVxuXG4gIHN0YXRpYyBmcm9tTWFza2luZ0VkZ2UobWFza2luZ0VkZ2UpIHtcbiAgICBjb25zdCBtYXNraW5nRWRnZVBvc2l0aW9uID0gbWFza2luZ0VkZ2UuZ2V0UG9zaXRpb24oKSxcbiAgICAgICAgICByb3RhdGlvbkFib3V0WkF4aXNNYXRyaXggPSBjYWxjdWxhdGVSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgobWFza2luZ0VkZ2UpLFxuICAgICAgICAgIHBvc2l0aW9uID0gcm90YXRlUG9zaXRpb25BYm91dFpBeGlzKG1hc2tpbmdFZGdlUG9zaXRpb24sIHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCksXG4gICAgICAgICAgcG9zaXRpb25Db21wb25lbnRzID0gcG9zaXRpb24sIC8vL1xuICAgICAgICAgIGZpcnN0UG9zaXRpb25Db21wb25lbnQgPSBmaXJzdChwb3NpdGlvbkNvbXBvbmVudHMpLFxuICAgICAgICAgIHZlcnRpY2FsTGluZSA9IG5ldyBWZXJ0aWNhbExpbmUoZmlyc3RQb3NpdGlvbkNvbXBvbmVudCwgcm90YXRpb25BYm91dFpBeGlzTWF0cml4KTtcblxuICAgIHJldHVybiB2ZXJ0aWNhbExpbmU7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBWZXJ0aWNhbExpbmU7XG5cbmZ1bmN0aW9uIGlzRWRnZU5vblBhcmFsbGVsKGVkZ2UpIHtcbiAgY29uc3QgZWRnZUV4dGVudCA9IGVkZ2UuZ2V0RXh0ZW50KCksXG4gICAgICAgIGVkZ2VFeHRlbnRDb21wb25lbnRzID0gZWRnZUV4dGVudCwgLy8vXG4gICAgICAgIGZpcnN0RWRnZUV4dGVudENvbXBvbmVudCA9IGZpcnN0KGVkZ2VFeHRlbnRDb21wb25lbnRzKSxcbiAgICAgICAgc2Vjb25kRWRnZUV4dGVudENvbXBvbmVudCA9IHNlY29uZChlZGdlRXh0ZW50Q29tcG9uZW50cyksXG4gICAgICAgIGVkZ2VBbmdsZVRhbmdlbnQgPSBmaXJzdEVkZ2VFeHRlbnRDb21wb25lbnQgLyBzZWNvbmRFZGdlRXh0ZW50Q29tcG9uZW50LFxuICAgICAgICBlZGdlQW5nbGVUYW5nZW50QXBwcm94aW1hdGVseUVxdWFsVG9aZXJvID0gaXNBcHByb3hpbWF0ZWx5RXF1YWxUb1plcm8oZWRnZUFuZ2xlVGFuZ2VudCksXG4gICAgICAgIGVkZ2VQYXJhbGxlbCA9IGVkZ2VBbmdsZVRhbmdlbnRBcHByb3hpbWF0ZWx5RXF1YWxUb1plcm8sIC8vL1xuICAgICAgICBlZGdlTm9uUGFyYWxsZWwgPSAhZWRnZVBhcmFsbGVsO1xuXG4gIHJldHVybiBlZGdlTm9uUGFyYWxsZWw7XG59XG5cbmZ1bmN0aW9uIGlzSW50ZXJzZWN0aW9uTm9uVHJpdmlhbChpbnRlcnNlY3Rpb24pIHtcbiAgY29uc3QgaW50ZXJzZWN0aW9uTm9uVHJpdmlhbCA9ICgoaW50ZXJzZWN0aW9uID4gMCApICYmIChpbnRlcnNlY3Rpb24gPCAxKSk7XG5cbiAgcmV0dXJuIGludGVyc2VjdGlvbk5vblRyaXZpYWw7XG59XG4iXX0=