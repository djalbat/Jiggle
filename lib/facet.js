'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var constants = require('./constants'),
    facetUtilities = require('./utilities/facet'),
    arrayUtilities = require('./utilities/array'),
    vectorUtilities = require('./utilities/vector'),
    vertexUtilities = require('./utilities/vertex'),
    approximateUtilities = require('./utilities/approximate');

var VERTICES_LENGTH = constants.VERTICES_LENGTH,
    _rotateAboutZAxis = vertexUtilities.rotateAboutZAxis,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    _permute = arrayUtilities.permute,
    isApproximatelyEqualToZero = approximateUtilities.isApproximatelyEqualToZero,
    add3 = vectorUtilities.add3,
    subtract3 = vectorUtilities.subtract3,
    scale3 = vectorUtilities.scale3,
    length3 = vectorUtilities.length3,
    normalise3 = vectorUtilities.normalise3,
    calculateEdges = facetUtilities.calculateEdges,
    calculateNormal = facetUtilities.calculateNormal,
    rotateVertices = facetUtilities.rotateVertices;

var Facet = function () {
  function Facet(vertices, normal, edges) {
    _classCallCheck(this, Facet);

    this.vertices = vertices;
    this.normal = normal;
    this.edges = edges;
  }

  _createClass(Facet, [{
    key: 'getVertices',
    value: function getVertices() {
      return this.vertices;
    }
  }, {
    key: 'getNormal',
    value: function getNormal() {
      return this.normal;
    }
  }, {
    key: 'getEdges',
    value: function getEdges() {
      return this.edges;
    }
  }, {
    key: 'getMidPoint',
    value: function getMidPoint() {
      var midPoint = this.vertices.reduce(function (midPoint, vertex) {
        var scaledVertex = scale3(vertex, 1 / 3);

        midPoint = add3(midPoint, scaledVertex);

        return midPoint;
      }, [0, 0, 0]);

      return midPoint;
    }
  }, {
    key: 'getVertexPositions',
    value: function getVertexPositions() {
      var vertexPositions = this.vertices.map(function (vertex) {
        var vertexPosition = vertex.slice(); ///

        return vertexPosition;
      });

      return vertexPositions;
    }
  }, {
    key: 'getVertexNormals',
    value: function getVertexNormals() {
      var vertexNormal = normalise3(this.normal),
          vertexNormals = [vertexNormal, vertexNormal, vertexNormal];

      return vertexNormals;
    }
  }, {
    key: 'getVertexIndexes',
    value: function getVertexIndexes(index) {
      ///
      var vertexIndex = index * 3,
          vertexIndexes = [vertexIndex + 0, vertexIndex + 1, vertexIndex + 2];

      return vertexIndexes;
    }
  }, {
    key: 'isTooSmall',
    value: function isTooSmall() {
      var normalLength = length3(this.normal),
          normalLengthApproximatelyEqualToZero = isApproximatelyEqualToZero(normalLength),
          tooSmall = normalLengthApproximatelyEqualToZero; ///

      return tooSmall;
    }
  }, {
    key: 'isMasked',
    value: function isMasked(maskingFacet) {
      var edgesInXYPlane = maskingFacet.getEdgesInXYPlane(),
          midPoint = this.getMidPoint(),
          midPointToOneSideOfEdgesInXYPlane = isMidPointToOneSideOfEdgesInXYPlane(midPoint, edgesInXYPlane),
          masked = midPointToOneSideOfEdgesInXYPlane; ///

      return masked;
    }
  }, {
    key: 'applyTransforms',
    value: function applyTransforms(transforms) {
      this.vertices = this.vertices.map(function (vertex) {
        transforms.forEach(function (transform) {
          vertex = transform(vertex);
        });

        return vertex;
      });

      this.normal = calculateNormal(this.vertices);

      this.edges = calculateEdges(this.vertices);
    }
  }, {
    key: 'rotate',
    value: function rotate(rotationQuaternion) {
      this.vertices = rotateVertices(this.vertices, rotationQuaternion);

      this.normal = calculateNormal(this.vertices);

      this.edges = calculateEdges(this.vertices);
    }
  }, {
    key: 'rotateAboutZAxis',
    value: function rotateAboutZAxis(rotationAboutZAxisMatrix) {
      this.vertices = this.vertices.map(function (vertex) {
        vertex = _rotateAboutZAxis(vertex, rotationAboutZAxisMatrix);

        return vertex;
      });

      this.normal = calculateNormal(this.vertices);

      this.edges = calculateEdges(this.vertices);
    }
  }, {
    key: 'split',
    value: function split(intersections, smallerFacets) {
      var nonNullIntersections = calculateNonNullIntersections(intersections),
          nonNullIntersectionsLength = nonNullIntersections.length;

      switch (nonNullIntersectionsLength) {
        case 2:
          this.splitWithTwoNonNullIntersections(intersections, smallerFacets);
          break;

        case 1:
          this.splitWithOneNonNullIntersection(intersections, smallerFacets);
          break;

        case 0:
          this.splitWithZeroNonNullIntersections(intersections, smallerFacets);
          break;
      }
    }
  }, {
    key: 'permute',
    value: function permute(places) {
      this.vertices = _permute(this.vertices, places);
    }
  }, {
    key: 'splitWithTwoNonNullIntersections',
    value: function splitWithTwoNonNullIntersections(intersections, smallerFacets, facet) {
      var nullIntersectionIndex = calculateNullIntersectionIndex(intersections),
          places = (VERTICES_LENGTH - nullIntersectionIndex) % VERTICES_LENGTH;

      intersections = _permute(intersections, places);

      intersections = intersections.slice(1); ///

      this.permute(places);

      var firstVertex = first(this.vertices),
          secondVertex = second(this.vertices),
          thirdVertex = third(this.vertices),
          firstIntersection = first(intersections),
          secondIntersection = second(intersections),
          firstIntermediateVertex = calculateIntermediateVertex(secondVertex, thirdVertex, firstIntersection),
          secondIntermediateVertex = calculateIntermediateVertex(thirdVertex, firstVertex, secondIntersection),
          firstVertices = [firstVertex, secondVertex, firstIntermediateVertex],
          secondVertices = [firstIntermediateVertex, secondIntermediateVertex, firstVertex],
          thirdVertices = [firstIntermediateVertex, thirdVertex, secondIntermediateVertex],
          firstFacet = facet.fromVertices(firstVertices),
          secondFacet = facet.fromVertices(secondVertices),
          thirdFacet = facet.fromVertices(thirdVertices),
          firstFacetTooSmall = firstFacet.isTooSmall(),
          secondFacetTooSmall = secondFacet.isTooSmall(),
          thirdFacetTooSmall = thirdFacet.isTooSmall();

      if (!firstFacetTooSmall) {
        smallerFacets.push(firstFacet);
      }

      if (!secondFacetTooSmall) {
        smallerFacets.push(secondFacet);
      }

      if (!thirdFacetTooSmall) {
        smallerFacets.push(thirdFacet);
      }
    }
  }, {
    key: 'splitWithOneNonNullIntersection',
    value: function splitWithOneNonNullIntersection(intersections, smallerFacets, facet) {
      var nonNullIntersectionIndex = calculateNonNullIntersectionIndex(intersections),
          places = (VERTICES_LENGTH - nonNullIntersectionIndex) % VERTICES_LENGTH;

      intersections = _permute(intersections, places);

      this.permute(places);

      var firstVertex = first(this.vertices),
          secondVertex = second(this.vertices),
          thirdVertex = third(this.vertices),
          firstIntersection = first(intersections),
          intermediateVertex = calculateIntermediateVertex(firstVertex, secondVertex, firstIntersection),
          firstVertices = [firstVertex, intermediateVertex, thirdVertex],
          secondVertices = [intermediateVertex, secondVertex, thirdVertex],
          parentVertices = this.vertices,
          firstFacet = facet.fromVertices(firstVertices),
          secondFacet = facet.fromVertices(secondVertices),
          firstFacetTooSmall = firstFacet.isTooSmall(),
          secondFacetTooSmall = secondFacet.isTooSmall();

      if (!firstFacetTooSmall) {
        smallerFacets.push(firstFacet);
      }

      if (!secondFacetTooSmall) {
        smallerFacets.push(secondFacet);
      }
    }
  }, {
    key: 'splitWithZeroNonNullIntersections',
    value: function splitWithZeroNonNullIntersections(intersections, smallerFacets) {
      var smallerFacet = this; ///

      smallerFacets.push(smallerFacet);
    }
  }, {
    key: 'calculateIntersectionsWithVerticalLineInXYPlane',
    value: function calculateIntersectionsWithVerticalLineInXYPlane(verticalLineInXYPlane) {
      var edges = this.getEdges(),
          intersections = edges.map(function (edge) {
        var intersection = edge.calculateIntersectionWithVerticalLineInXYPlane(verticalLineInXYPlane);

        return intersection;
      });

      return intersections;
    }
  }]);

  return Facet;
}();

module.exports = Facet;

function calculateIntermediateVertex(startVertex, endVertex, intersection) {
  var direction = subtract3(endVertex, startVertex),
      offset = scale3(direction, intersection),
      intermediateVertex = add3(startVertex, offset);

  return intermediateVertex;
}

function calculateNonNullIntersections(intersections) {
  var nonNullIntersections = intersections.reduce(function (nonNullIntersections, intersection) {
    if (intersection !== null) {
      var nonNullIntersection = intersection; ///

      nonNullIntersections.push(nonNullIntersection);
    }

    return nonNullIntersections;
  }, []);

  return nonNullIntersections;
}

function calculateNullIntersectionIndex(intersections) {
  var nullIntersectionIndex = intersections.reduce(function (nullIntersectionIndex, intersection, index) {
    if (nullIntersectionIndex === null) {
      if (intersection === null) {
        nullIntersectionIndex = index;
      }
    }

    return nullIntersectionIndex;
  }, null);

  return nullIntersectionIndex;
}

function calculateNonNullIntersectionIndex(intersections) {
  var nullIntersectionIndex = intersections.reduce(function (nullIntersectionIndex, intersection, index) {
    if (nullIntersectionIndex === null) {
      if (intersection !== null) {
        nullIntersectionIndex = index;
      }
    }

    return nullIntersectionIndex;
  }, null);

  return nullIntersectionIndex;
}

function isMidPointToOneSideOfEdgesInXYPlane(midPoint, edgesInXYPlane) {
  var midPointToTheLeftOfEdgesInXYPlane = isMidPointToTheLeftOfEdgesInXYPlane(midPoint, edgesInXYPlane),
      midPointToTheRightOfEdgesInXYPlane = isMidPointToTheRightOfEdgesInXYPlane(midPoint, edgesInXYPlane),
      midPointToOneSideOfEdgesInXYPlane = midPointToTheLeftOfEdgesInXYPlane || midPointToTheRightOfEdgesInXYPlane; ///

  return midPointToOneSideOfEdgesInXYPlane;
}

function isMidPointToTheLeftOfEdgesInXYPlane(midPoint, edgesInXYPlane) {
  var midPointToTheLeftOfEdgesInXYPlane = edgesInXYPlane.reduce(function (midPointToTheLeftOfEdgesInXYPlane, edgeInXYPlane) {
    if (midPointToTheLeftOfEdgesInXYPlane) {
      var midPointToTheLeftOfEdgeInXYPlane = edgeInXYPlane.isMidPointToTheLeft(midPoint);

      midPointToTheLeftOfEdgesInXYPlane = midPointToTheLeftOfEdgeInXYPlane;
    }

    return midPointToTheLeftOfEdgesInXYPlane;
  }, true);

  return midPointToTheLeftOfEdgesInXYPlane;
}

function isMidPointToTheRightOfEdgesInXYPlane(midPoint, edgesInXYPlane) {
  var midPointToTheRightOfEdgesInXYPlane = edgesInXYPlane.reduce(function (midPointToTheRightOfEdgesInXYPlane, edgeInXYPlane) {
    if (midPointToTheRightOfEdgesInXYPlane) {
      var midPointToTheRightOfEdgeInXYPlane = edgeInXYPlane.isMidPointToTheRight(midPoint);

      midPointToTheRightOfEdgesInXYPlane = midPointToTheRightOfEdgeInXYPlane;
    }

    return midPointToTheRightOfEdgesInXYPlane;
  }, true);

  return midPointToTheRightOfEdgesInXYPlane;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9mYWNldC5qcyJdLCJuYW1lcyI6WyJjb25zdGFudHMiLCJyZXF1aXJlIiwiZmFjZXRVdGlsaXRpZXMiLCJhcnJheVV0aWxpdGllcyIsInZlY3RvclV0aWxpdGllcyIsInZlcnRleFV0aWxpdGllcyIsImFwcHJveGltYXRlVXRpbGl0aWVzIiwiVkVSVElDRVNfTEVOR1RIIiwicm90YXRlQWJvdXRaQXhpcyIsImZpcnN0Iiwic2Vjb25kIiwidGhpcmQiLCJwZXJtdXRlIiwiaXNBcHByb3hpbWF0ZWx5RXF1YWxUb1plcm8iLCJhZGQzIiwic3VidHJhY3QzIiwic2NhbGUzIiwibGVuZ3RoMyIsIm5vcm1hbGlzZTMiLCJjYWxjdWxhdGVFZGdlcyIsImNhbGN1bGF0ZU5vcm1hbCIsInJvdGF0ZVZlcnRpY2VzIiwiRmFjZXQiLCJ2ZXJ0aWNlcyIsIm5vcm1hbCIsImVkZ2VzIiwibWlkUG9pbnQiLCJyZWR1Y2UiLCJ2ZXJ0ZXgiLCJzY2FsZWRWZXJ0ZXgiLCJ2ZXJ0ZXhQb3NpdGlvbnMiLCJtYXAiLCJ2ZXJ0ZXhQb3NpdGlvbiIsInNsaWNlIiwidmVydGV4Tm9ybWFsIiwidmVydGV4Tm9ybWFscyIsImluZGV4IiwidmVydGV4SW5kZXgiLCJ2ZXJ0ZXhJbmRleGVzIiwibm9ybWFsTGVuZ3RoIiwibm9ybWFsTGVuZ3RoQXBwcm94aW1hdGVseUVxdWFsVG9aZXJvIiwidG9vU21hbGwiLCJtYXNraW5nRmFjZXQiLCJlZGdlc0luWFlQbGFuZSIsImdldEVkZ2VzSW5YWVBsYW5lIiwiZ2V0TWlkUG9pbnQiLCJtaWRQb2ludFRvT25lU2lkZU9mRWRnZXNJblhZUGxhbmUiLCJpc01pZFBvaW50VG9PbmVTaWRlT2ZFZGdlc0luWFlQbGFuZSIsIm1hc2tlZCIsInRyYW5zZm9ybXMiLCJmb3JFYWNoIiwidHJhbnNmb3JtIiwicm90YXRpb25RdWF0ZXJuaW9uIiwicm90YXRpb25BYm91dFpBeGlzTWF0cml4IiwiaW50ZXJzZWN0aW9ucyIsInNtYWxsZXJGYWNldHMiLCJub25OdWxsSW50ZXJzZWN0aW9ucyIsImNhbGN1bGF0ZU5vbk51bGxJbnRlcnNlY3Rpb25zIiwibm9uTnVsbEludGVyc2VjdGlvbnNMZW5ndGgiLCJsZW5ndGgiLCJzcGxpdFdpdGhUd29Ob25OdWxsSW50ZXJzZWN0aW9ucyIsInNwbGl0V2l0aE9uZU5vbk51bGxJbnRlcnNlY3Rpb24iLCJzcGxpdFdpdGhaZXJvTm9uTnVsbEludGVyc2VjdGlvbnMiLCJwbGFjZXMiLCJmYWNldCIsIm51bGxJbnRlcnNlY3Rpb25JbmRleCIsImNhbGN1bGF0ZU51bGxJbnRlcnNlY3Rpb25JbmRleCIsImZpcnN0VmVydGV4Iiwic2Vjb25kVmVydGV4IiwidGhpcmRWZXJ0ZXgiLCJmaXJzdEludGVyc2VjdGlvbiIsInNlY29uZEludGVyc2VjdGlvbiIsImZpcnN0SW50ZXJtZWRpYXRlVmVydGV4IiwiY2FsY3VsYXRlSW50ZXJtZWRpYXRlVmVydGV4Iiwic2Vjb25kSW50ZXJtZWRpYXRlVmVydGV4IiwiZmlyc3RWZXJ0aWNlcyIsInNlY29uZFZlcnRpY2VzIiwidGhpcmRWZXJ0aWNlcyIsImZpcnN0RmFjZXQiLCJmcm9tVmVydGljZXMiLCJzZWNvbmRGYWNldCIsInRoaXJkRmFjZXQiLCJmaXJzdEZhY2V0VG9vU21hbGwiLCJpc1Rvb1NtYWxsIiwic2Vjb25kRmFjZXRUb29TbWFsbCIsInRoaXJkRmFjZXRUb29TbWFsbCIsInB1c2giLCJub25OdWxsSW50ZXJzZWN0aW9uSW5kZXgiLCJjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9uSW5kZXgiLCJpbnRlcm1lZGlhdGVWZXJ0ZXgiLCJwYXJlbnRWZXJ0aWNlcyIsInNtYWxsZXJGYWNldCIsInZlcnRpY2FsTGluZUluWFlQbGFuZSIsImdldEVkZ2VzIiwiZWRnZSIsImludGVyc2VjdGlvbiIsImNhbGN1bGF0ZUludGVyc2VjdGlvbldpdGhWZXJ0aWNhbExpbmVJblhZUGxhbmUiLCJtb2R1bGUiLCJleHBvcnRzIiwic3RhcnRWZXJ0ZXgiLCJlbmRWZXJ0ZXgiLCJkaXJlY3Rpb24iLCJvZmZzZXQiLCJub25OdWxsSW50ZXJzZWN0aW9uIiwibWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VzSW5YWVBsYW5lIiwiaXNNaWRQb2ludFRvVGhlTGVmdE9mRWRnZXNJblhZUGxhbmUiLCJtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lIiwiaXNNaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lIiwiZWRnZUluWFlQbGFuZSIsIm1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlSW5YWVBsYW5lIiwiaXNNaWRQb2ludFRvVGhlTGVmdCIsIm1pZFBvaW50VG9UaGVSaWdodE9mRWRnZUluWFlQbGFuZSIsImlzTWlkUG9pbnRUb1RoZVJpZ2h0Il0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FBRUEsSUFBTUEsWUFBWUMsUUFBUSxhQUFSLENBQWxCO0FBQUEsSUFDTUMsaUJBQWlCRCxRQUFRLG1CQUFSLENBRHZCO0FBQUEsSUFFTUUsaUJBQWlCRixRQUFRLG1CQUFSLENBRnZCO0FBQUEsSUFHTUcsa0JBQWtCSCxRQUFRLG9CQUFSLENBSHhCO0FBQUEsSUFJTUksa0JBQWtCSixRQUFRLG9CQUFSLENBSnhCO0FBQUEsSUFLTUssdUJBQXVCTCxRQUFRLHlCQUFSLENBTDdCOztBQU9NLElBQUVNLGVBQUYsR0FBc0JQLFNBQXRCLENBQUVPLGVBQUY7QUFBQSxJQUNFQyxpQkFERixHQUN1QkgsZUFEdkIsQ0FDRUcsZ0JBREY7QUFBQSxJQUVFQyxLQUZGLEdBRW9DTixjQUZwQyxDQUVFTSxLQUZGO0FBQUEsSUFFU0MsTUFGVCxHQUVvQ1AsY0FGcEMsQ0FFU08sTUFGVDtBQUFBLElBRWlCQyxLQUZqQixHQUVvQ1IsY0FGcEMsQ0FFaUJRLEtBRmpCO0FBQUEsSUFFd0JDLFFBRnhCLEdBRW9DVCxjQUZwQyxDQUV3QlMsT0FGeEI7QUFBQSxJQUdFQywwQkFIRixHQUdpQ1Asb0JBSGpDLENBR0VPLDBCQUhGO0FBQUEsSUFJRUMsSUFKRixHQUltRFYsZUFKbkQsQ0FJRVUsSUFKRjtBQUFBLElBSVFDLFNB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QUFVQSxTQUFPQSxrQ0FBUDtBQUNEIiwiZmlsZSI6ImZhY2V0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBjb25zdGFudHMgPSByZXF1aXJlKCcuL2NvbnN0YW50cycpLFxuICAgICAgZmFjZXRVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy9mYWNldCcpLFxuICAgICAgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgdmVjdG9yVXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvdmVjdG9yJyksXG4gICAgICB2ZXJ0ZXhVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy92ZXJ0ZXgnKSxcbiAgICAgIGFwcHJveGltYXRlVXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvYXBwcm94aW1hdGUnKTtcblxuY29uc3QgeyBWRVJUSUNFU19MRU5HVEggfSA9IGNvbnN0YW50cyxcbiAgICAgIHsgcm90YXRlQWJvdXRaQXhpcyB9ID0gdmVydGV4VXRpbGl0aWVzLFxuICAgICAgeyBmaXJzdCwgc2Vjb25kLCB0aGlyZCwgcGVybXV0ZSB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IGlzQXBwcm94aW1hdGVseUVxdWFsVG9aZXJvIH0gPSBhcHByb3hpbWF0ZVV0aWxpdGllcyxcbiAgICAgIHsgYWRkMywgc3VidHJhY3QzLCBzY2FsZTMsIGxlbmd0aDMsIG5vcm1hbGlzZTMgfSA9IHZlY3RvclV0aWxpdGllcyxcbiAgICAgIHsgY2FsY3VsYXRlRWRnZXMsIGNhbGN1bGF0ZU5vcm1hbCwgcm90YXRlVmVydGljZXMgfSA9IGZhY2V0VXRpbGl0aWVzO1xuXG5jbGFzcyBGYWNldCB7XG4gIGNvbnN0cnVjdG9yKHZlcnRpY2VzLCBub3JtYWwsIGVkZ2VzKSB7XG4gICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzO1xuICAgIHRoaXMubm9ybWFsID0gbm9ybWFsO1xuICAgIHRoaXMuZWRnZXMgPSBlZGdlcztcbiAgfVxuXG4gIGdldFZlcnRpY2VzKCkge1xuICAgIHJldHVybiB0aGlzLnZlcnRpY2VzO1xuICB9XG5cbiAgZ2V0Tm9ybWFsKCkge1xuICAgIHJldHVybiB0aGlzLm5vcm1hbDtcbiAgfVxuXG4gIGdldEVkZ2VzKCkge1xuICAgIHJldHVybiB0aGlzLmVkZ2VzO1xuICB9XG4gIFxuICBnZXRNaWRQb2ludCgpIHtcbiAgICBjb25zdCBtaWRQb2ludCA9IHRoaXMudmVydGljZXMucmVkdWNlKGZ1bmN0aW9uKG1pZFBvaW50LCB2ZXJ0ZXgpIHtcbiAgICAgIGNvbnN0IHNjYWxlZFZlcnRleCA9IHNjYWxlMyh2ZXJ0ZXgsIDEvMyk7XG4gICAgICBcbiAgICAgIG1pZFBvaW50ID0gYWRkMyhtaWRQb2ludCwgc2NhbGVkVmVydGV4KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIG1pZFBvaW50O1xuICAgIH0sIFsgMCwgMCwgMCBdKTtcbiAgICBcbiAgICByZXR1cm4gbWlkUG9pbnQ7XG4gIH1cbiAgXG4gIGdldFZlcnRleFBvc2l0aW9ucygpIHtcbiAgICBjb25zdCB2ZXJ0ZXhQb3NpdGlvbnMgPSB0aGlzLnZlcnRpY2VzLm1hcChmdW5jdGlvbih2ZXJ0ZXgpIHtcbiAgICAgIGNvbnN0IHZlcnRleFBvc2l0aW9uID0gdmVydGV4LnNsaWNlKCk7IC8vL1xuICAgICAgXG4gICAgICByZXR1cm4gdmVydGV4UG9zaXRpb247XG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIHZlcnRleFBvc2l0aW9ucztcbiAgfVxuICBcbiAgZ2V0VmVydGV4Tm9ybWFscygpIHtcbiAgICBjb25zdCB2ZXJ0ZXhOb3JtYWwgPSBub3JtYWxpc2UzKHRoaXMubm9ybWFsKSxcbiAgICAgICAgICB2ZXJ0ZXhOb3JtYWxzID0gW1xuICAgICAgICAgICAgdmVydGV4Tm9ybWFsLFxuICAgICAgICAgICAgdmVydGV4Tm9ybWFsLFxuICAgICAgICAgICAgdmVydGV4Tm9ybWFsLFxuICAgICAgICAgIF07XG4gICAgXG4gICAgcmV0dXJuIHZlcnRleE5vcm1hbHM7XG4gIH1cbiAgXG4gIGdldFZlcnRleEluZGV4ZXMoaW5kZXgpIHsgLy8vXG4gICAgY29uc3QgdmVydGV4SW5kZXggPSBpbmRleCAqIDMsXG4gICAgICAgICAgdmVydGV4SW5kZXhlcyA9IFtcbiAgICAgICAgICAgIHZlcnRleEluZGV4ICsgMCxcbiAgICAgICAgICAgIHZlcnRleEluZGV4ICsgMSxcbiAgICAgICAgICAgIHZlcnRleEluZGV4ICsgMixcbiAgICAgICAgICBdO1xuICAgIFxuICAgIHJldHVybiB2ZXJ0ZXhJbmRleGVzO1xuICB9XG4gIFxuICBpc1Rvb1NtYWxsKCkge1xuICAgIGNvbnN0IG5vcm1hbExlbmd0aCA9IGxlbmd0aDModGhpcy5ub3JtYWwpLFxuICAgICAgICAgIG5vcm1hbExlbmd0aEFwcHJveGltYXRlbHlFcXVhbFRvWmVybyA9IGlzQXBwcm94aW1hdGVseUVxdWFsVG9aZXJvKG5vcm1hbExlbmd0aCksXG4gICAgICAgICAgdG9vU21hbGwgPSBub3JtYWxMZW5ndGhBcHByb3hpbWF0ZWx5RXF1YWxUb1plcm87ICAvLy9cbiAgICBcbiAgICByZXR1cm4gdG9vU21hbGw7XG4gIH1cbiAgXG4gIGlzTWFza2VkKG1hc2tpbmdGYWNldCkge1xuICAgIGNvbnN0IGVkZ2VzSW5YWVBsYW5lID0gbWFza2luZ0ZhY2V0LmdldEVkZ2VzSW5YWVBsYW5lKCksXG4gICAgICAgICAgbWlkUG9pbnQgPSB0aGlzLmdldE1pZFBvaW50KCksXG4gICAgICAgICAgbWlkUG9pbnRUb09uZVNpZGVPZkVkZ2VzSW5YWVBsYW5lID0gaXNNaWRQb2ludFRvT25lU2lkZU9mRWRnZXNJblhZUGxhbmUobWlkUG9pbnQsIGVkZ2VzSW5YWVBsYW5lKSxcbiAgICAgICAgICBtYXNrZWQgPSBtaWRQb2ludFRvT25lU2lkZU9mRWRnZXNJblhZUGxhbmU7ICAvLy9cbiAgICBcbiAgICByZXR1cm4gbWFza2VkO1xuICB9XG4gIFxuICBhcHBseVRyYW5zZm9ybXModHJhbnNmb3Jtcykge1xuICAgIHRoaXMudmVydGljZXMgPSB0aGlzLnZlcnRpY2VzLm1hcChmdW5jdGlvbih2ZXJ0ZXgpIHtcbiAgICAgIHRyYW5zZm9ybXMuZm9yRWFjaChmdW5jdGlvbih0cmFuc2Zvcm0pIHtcbiAgICAgICAgdmVydGV4ID0gdHJhbnNmb3JtKHZlcnRleCk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHZlcnRleDtcbiAgICB9KTtcblxuICAgIHRoaXMubm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHRoaXMudmVydGljZXMpO1xuXG4gICAgdGhpcy5lZGdlcyA9IGNhbGN1bGF0ZUVkZ2VzKHRoaXMudmVydGljZXMpO1xuICB9XG4gIFxuICByb3RhdGUocm90YXRpb25RdWF0ZXJuaW9uKSB7XG4gICAgdGhpcy52ZXJ0aWNlcyA9IHJvdGF0ZVZlcnRpY2VzKHRoaXMudmVydGljZXMsIHJvdGF0aW9uUXVhdGVybmlvbik7XG4gICAgXG4gICAgdGhpcy5ub3JtYWwgPSBjYWxjdWxhdGVOb3JtYWwodGhpcy52ZXJ0aWNlcyk7XG5cbiAgICB0aGlzLmVkZ2VzID0gY2FsY3VsYXRlRWRnZXModGhpcy52ZXJ0aWNlcyk7XG4gIH1cblxuICByb3RhdGVBYm91dFpBeGlzKHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCkge1xuICAgIHRoaXMudmVydGljZXMgPSB0aGlzLnZlcnRpY2VzLm1hcChmdW5jdGlvbih2ZXJ0ZXgpIHtcbiAgICAgIHZlcnRleCA9IHJvdGF0ZUFib3V0WkF4aXModmVydGV4LCByb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgpO1xuXG4gICAgICByZXR1cm4gdmVydGV4O1xuICAgIH0pO1xuXG4gICAgdGhpcy5ub3JtYWwgPSBjYWxjdWxhdGVOb3JtYWwodGhpcy52ZXJ0aWNlcyk7XG5cbiAgICB0aGlzLmVkZ2VzID0gY2FsY3VsYXRlRWRnZXModGhpcy52ZXJ0aWNlcyk7XG4gIH1cbiAgXG4gIHNwbGl0KGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMpIHtcbiAgICBjb25zdCBub25OdWxsSW50ZXJzZWN0aW9ucyA9IGNhbGN1bGF0ZU5vbk51bGxJbnRlcnNlY3Rpb25zKGludGVyc2VjdGlvbnMpLFxuICAgICAgICAgIG5vbk51bGxJbnRlcnNlY3Rpb25zTGVuZ3RoID0gbm9uTnVsbEludGVyc2VjdGlvbnMubGVuZ3RoO1xuXG4gICAgc3dpdGNoIChub25OdWxsSW50ZXJzZWN0aW9uc0xlbmd0aCkge1xuICAgICAgY2FzZSAyIDpcbiAgICAgICAgdGhpcy5zcGxpdFdpdGhUd29Ob25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zLCBzbWFsbGVyRmFjZXRzKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgMSA6XG4gICAgICAgIHRoaXMuc3BsaXRXaXRoT25lTm9uTnVsbEludGVyc2VjdGlvbihpbnRlcnNlY3Rpb25zLCBzbWFsbGVyRmFjZXRzKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgMCA6XG4gICAgICAgIHRoaXMuc3BsaXRXaXRoWmVyb05vbk51bGxJbnRlcnNlY3Rpb25zKGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgXG4gIHBlcm11dGUocGxhY2VzKSB7XG4gICAgdGhpcy52ZXJ0aWNlcyA9IHBlcm11dGUodGhpcy52ZXJ0aWNlcywgcGxhY2VzKTtcbiAgfVxuXG4gIHNwbGl0V2l0aFR3b05vbk51bGxJbnRlcnNlY3Rpb25zKGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMsIGZhY2V0KSB7XG4gICAgY29uc3QgbnVsbEludGVyc2VjdGlvbkluZGV4ID0gY2FsY3VsYXRlTnVsbEludGVyc2VjdGlvbkluZGV4KGludGVyc2VjdGlvbnMpLFxuICAgICAgICAgIHBsYWNlcyA9IChWRVJUSUNFU19MRU5HVEggLSBudWxsSW50ZXJzZWN0aW9uSW5kZXgpICUgVkVSVElDRVNfTEVOR1RIO1xuXG4gICAgaW50ZXJzZWN0aW9ucyA9IHBlcm11dGUoaW50ZXJzZWN0aW9ucywgcGxhY2VzKTtcblxuICAgIGludGVyc2VjdGlvbnMgPSBpbnRlcnNlY3Rpb25zLnNsaWNlKDEpOyAvLy9cbiAgICBcbiAgICB0aGlzLnBlcm11dGUocGxhY2VzKTtcblxuICAgIGNvbnN0IGZpcnN0VmVydGV4ID0gZmlyc3QodGhpcy52ZXJ0aWNlcyksXG4gICAgICAgICAgc2Vjb25kVmVydGV4ID0gc2Vjb25kKHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIHRoaXJkVmVydGV4ID0gdGhpcmQodGhpcy52ZXJ0aWNlcyksXG4gICAgICAgICAgZmlyc3RJbnRlcnNlY3Rpb24gPSBmaXJzdChpbnRlcnNlY3Rpb25zKSxcbiAgICAgICAgICBzZWNvbmRJbnRlcnNlY3Rpb24gPSBzZWNvbmQoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgZmlyc3RJbnRlcm1lZGlhdGVWZXJ0ZXggPSBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgoc2Vjb25kVmVydGV4LCB0aGlyZFZlcnRleCwgZmlyc3RJbnRlcnNlY3Rpb24pLFxuICAgICAgICAgIHNlY29uZEludGVybWVkaWF0ZVZlcnRleCA9IGNhbGN1bGF0ZUludGVybWVkaWF0ZVZlcnRleCh0aGlyZFZlcnRleCwgZmlyc3RWZXJ0ZXgsIHNlY29uZEludGVyc2VjdGlvbiksXG4gICAgICAgICAgZmlyc3RWZXJ0aWNlcyA9IFtcbiAgICAgICAgICAgIGZpcnN0VmVydGV4LFxuICAgICAgICAgICAgc2Vjb25kVmVydGV4LFxuICAgICAgICAgICAgZmlyc3RJbnRlcm1lZGlhdGVWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIHNlY29uZFZlcnRpY2VzID0gW1xuICAgICAgICAgICAgZmlyc3RJbnRlcm1lZGlhdGVWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRJbnRlcm1lZGlhdGVWZXJ0ZXgsXG4gICAgICAgICAgICBmaXJzdFZlcnRleFxuICAgICAgICAgIF0sXG4gICAgICAgICAgdGhpcmRWZXJ0aWNlcyA9IFtcbiAgICAgICAgICAgIGZpcnN0SW50ZXJtZWRpYXRlVmVydGV4LFxuICAgICAgICAgICAgdGhpcmRWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRJbnRlcm1lZGlhdGVWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIGZpcnN0RmFjZXQgPSBmYWNldC5mcm9tVmVydGljZXMoZmlyc3RWZXJ0aWNlcyksXG4gICAgICAgICAgc2Vjb25kRmFjZXQgPSBmYWNldC5mcm9tVmVydGljZXMoc2Vjb25kVmVydGljZXMpLFxuICAgICAgICAgIHRoaXJkRmFjZXQgPSBmYWNldC5mcm9tVmVydGljZXModGhpcmRWZXJ0aWNlcyksXG4gICAgICAgICAgZmlyc3RGYWNldFRvb1NtYWxsID0gZmlyc3RGYWNldC5pc1Rvb1NtYWxsKCksXG4gICAgICAgICAgc2Vjb25kRmFjZXRUb29TbWFsbCA9IHNlY29uZEZhY2V0LmlzVG9vU21hbGwoKSxcbiAgICAgICAgICB0aGlyZEZhY2V0VG9vU21hbGwgPSB0aGlyZEZhY2V0LmlzVG9vU21hbGwoKTtcblxuICAgIGlmICghZmlyc3RGYWNldFRvb1NtYWxsKSB7XG4gICAgICBzbWFsbGVyRmFjZXRzLnB1c2goZmlyc3RGYWNldCk7XG4gICAgfVxuXG4gICAgaWYgKCFzZWNvbmRGYWNldFRvb1NtYWxsKSB7XG4gICAgICBzbWFsbGVyRmFjZXRzLnB1c2goc2Vjb25kRmFjZXQpO1xuICAgIH1cblxuICAgIGlmICghdGhpcmRGYWNldFRvb1NtYWxsKSB7XG4gICAgICBzbWFsbGVyRmFjZXRzLnB1c2godGhpcmRGYWNldCk7XG4gICAgfVxuICB9XG5cbiAgc3BsaXRXaXRoT25lTm9uTnVsbEludGVyc2VjdGlvbihpbnRlcnNlY3Rpb25zLCBzbWFsbGVyRmFjZXRzLCBmYWNldCkge1xuICAgIGNvbnN0IG5vbk51bGxJbnRlcnNlY3Rpb25JbmRleCA9IGNhbGN1bGF0ZU5vbk51bGxJbnRlcnNlY3Rpb25JbmRleChpbnRlcnNlY3Rpb25zKSxcbiAgICAgICAgICBwbGFjZXMgPSAoVkVSVElDRVNfTEVOR1RIIC0gbm9uTnVsbEludGVyc2VjdGlvbkluZGV4KSAlIFZFUlRJQ0VTX0xFTkdUSDtcblxuICAgIGludGVyc2VjdGlvbnMgPSBwZXJtdXRlKGludGVyc2VjdGlvbnMsIHBsYWNlcyk7XG5cbiAgICB0aGlzLnBlcm11dGUocGxhY2VzKTtcblxuICAgIGNvbnN0IGZpcnN0VmVydGV4ID0gZmlyc3QodGhpcy52ZXJ0aWNlcyksXG4gICAgICAgICAgc2Vjb25kVmVydGV4ID0gc2Vjb25kKHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIHRoaXJkVmVydGV4ID0gdGhpcmQodGhpcy52ZXJ0aWNlcyksXG4gICAgICAgICAgZmlyc3RJbnRlcnNlY3Rpb24gPSBmaXJzdChpbnRlcnNlY3Rpb25zKSxcbiAgICAgICAgICBpbnRlcm1lZGlhdGVWZXJ0ZXggPSBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgoZmlyc3RWZXJ0ZXgsIHNlY29uZFZlcnRleCwgZmlyc3RJbnRlcnNlY3Rpb24pLFxuICAgICAgICAgIGZpcnN0VmVydGljZXMgPSBbXG4gICAgICAgICAgICBmaXJzdFZlcnRleCxcbiAgICAgICAgICAgIGludGVybWVkaWF0ZVZlcnRleCxcbiAgICAgICAgICAgIHRoaXJkVmVydGV4XG4gICAgICAgICAgXSxcbiAgICAgICAgICBzZWNvbmRWZXJ0aWNlcyA9IFtcbiAgICAgICAgICAgIGludGVybWVkaWF0ZVZlcnRleCxcbiAgICAgICAgICAgIHNlY29uZFZlcnRleCxcbiAgICAgICAgICAgIHRoaXJkVmVydGV4XG4gICAgICAgICAgXSxcbiAgICAgICAgICBwYXJlbnRWZXJ0aWNlcyA9IHRoaXMudmVydGljZXMsXG4gICAgICAgICAgZmlyc3RGYWNldCA9IGZhY2V0LmZyb21WZXJ0aWNlcyhmaXJzdFZlcnRpY2VzKSxcbiAgICAgICAgICBzZWNvbmRGYWNldCA9IGZhY2V0LmZyb21WZXJ0aWNlcyhzZWNvbmRWZXJ0aWNlcyksXG4gICAgICAgICAgZmlyc3RGYWNldFRvb1NtYWxsID0gZmlyc3RGYWNldC5pc1Rvb1NtYWxsKCksXG4gICAgICAgICAgc2Vjb25kRmFjZXRUb29TbWFsbCA9IHNlY29uZEZhY2V0LmlzVG9vU21hbGwoKTtcblxuICAgIGlmICghZmlyc3RGYWNldFRvb1NtYWxsKSB7XG4gICAgICBzbWFsbGVyRmFjZXRzLnB1c2goZmlyc3RGYWNldCk7XG4gICAgfVxuXG4gICAgaWYgKCFzZWNvbmRGYWNldFRvb1NtYWxsKSB7XG4gICAgICBzbWFsbGVyRmFjZXRzLnB1c2goc2Vjb25kRmFjZXQpO1xuICAgIH1cbiAgfVxuXG4gIHNwbGl0V2l0aFplcm9Ob25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zLCBzbWFsbGVyRmFjZXRzKSB7XG4gICAgY29uc3Qgc21hbGxlckZhY2V0ID0gdGhpczsgIC8vL1xuXG4gICAgc21hbGxlckZhY2V0cy5wdXNoKHNtYWxsZXJGYWNldCk7XG4gIH1cblxuICBjYWxjdWxhdGVJbnRlcnNlY3Rpb25zV2l0aFZlcnRpY2FsTGluZUluWFlQbGFuZSh2ZXJ0aWNhbExpbmVJblhZUGxhbmUpIHtcbiAgICBjb25zdCBlZGdlcyA9IHRoaXMuZ2V0RWRnZXMoKSxcbiAgICAgICAgICBpbnRlcnNlY3Rpb25zID0gZWRnZXMubWFwKGZ1bmN0aW9uKGVkZ2UpIHtcbiAgICAgICAgICAgIGNvbnN0IGludGVyc2VjdGlvbiA9IGVkZ2UuY2FsY3VsYXRlSW50ZXJzZWN0aW9uV2l0aFZlcnRpY2FsTGluZUluWFlQbGFuZSh2ZXJ0aWNhbExpbmVJblhZUGxhbmUpO1xuICBcbiAgICAgICAgICAgIHJldHVybiBpbnRlcnNlY3Rpb247XG4gICAgICAgICAgfSk7XG5cbiAgICByZXR1cm4gaW50ZXJzZWN0aW9ucztcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEZhY2V0O1xuXG5mdW5jdGlvbiBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgoc3RhcnRWZXJ0ZXgsIGVuZFZlcnRleCwgaW50ZXJzZWN0aW9uKSB7XG4gIGNvbnN0IGRpcmVjdGlvbiA9IHN1YnRyYWN0MyhlbmRWZXJ0ZXgsIHN0YXJ0VmVydGV4KSxcbiAgICAgICAgb2Zmc2V0ID0gc2NhbGUzKGRpcmVjdGlvbiwgaW50ZXJzZWN0aW9uKSxcbiAgICAgICAgaW50ZXJtZWRpYXRlVmVydGV4ID0gYWRkMyhzdGFydFZlcnRleCwgb2Zmc2V0KTtcblxuICByZXR1cm4gaW50ZXJtZWRpYXRlVmVydGV4O1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zKSB7XG4gIGNvbnN0IG5vbk51bGxJbnRlcnNlY3Rpb25zID0gaW50ZXJzZWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24obm9uTnVsbEludGVyc2VjdGlvbnMsIGludGVyc2VjdGlvbikge1xuICAgIGlmIChpbnRlcnNlY3Rpb24gIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IG5vbk51bGxJbnRlcnNlY3Rpb24gPSBpbnRlcnNlY3Rpb247IC8vL1xuXG4gICAgICBub25OdWxsSW50ZXJzZWN0aW9ucy5wdXNoKG5vbk51bGxJbnRlcnNlY3Rpb24pO1xuICAgIH1cblxuICAgIHJldHVybiBub25OdWxsSW50ZXJzZWN0aW9ucztcbiAgfSwgW10pO1xuXG4gIHJldHVybiBub25OdWxsSW50ZXJzZWN0aW9ucztcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlTnVsbEludGVyc2VjdGlvbkluZGV4KGludGVyc2VjdGlvbnMpIHtcbiAgY29uc3QgbnVsbEludGVyc2VjdGlvbkluZGV4ID0gaW50ZXJzZWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24obnVsbEludGVyc2VjdGlvbkluZGV4LCBpbnRlcnNlY3Rpb24sIGluZGV4KSB7XG4gICAgaWYgKG51bGxJbnRlcnNlY3Rpb25JbmRleCA9PT0gbnVsbCkge1xuICAgICAgaWYgKGludGVyc2VjdGlvbiA9PT0gbnVsbCkge1xuICAgICAgICBudWxsSW50ZXJzZWN0aW9uSW5kZXggPSBpbmRleDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbEludGVyc2VjdGlvbkluZGV4O1xuICB9LCBudWxsKTtcblxuICByZXR1cm4gbnVsbEludGVyc2VjdGlvbkluZGV4O1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9uSW5kZXgoaW50ZXJzZWN0aW9ucykge1xuICBjb25zdCBudWxsSW50ZXJzZWN0aW9uSW5kZXggPSBpbnRlcnNlY3Rpb25zLnJlZHVjZShmdW5jdGlvbihudWxsSW50ZXJzZWN0aW9uSW5kZXgsIGludGVyc2VjdGlvbiwgaW5kZXgpIHtcbiAgICBpZiAobnVsbEludGVyc2VjdGlvbkluZGV4ID09PSBudWxsKSB7XG4gICAgICBpZiAoaW50ZXJzZWN0aW9uICE9PSBudWxsKSB7XG4gICAgICAgIG51bGxJbnRlcnNlY3Rpb25JbmRleCA9IGluZGV4O1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBudWxsSW50ZXJzZWN0aW9uSW5kZXg7XG4gIH0sIG51bGwpO1xuXG4gIHJldHVybiBudWxsSW50ZXJzZWN0aW9uSW5kZXg7XG59XG5cbmZ1bmN0aW9uIGlzTWlkUG9pbnRUb09uZVNpZGVPZkVkZ2VzSW5YWVBsYW5lKG1pZFBvaW50LCBlZGdlc0luWFlQbGFuZSkge1xuICBjb25zdCBtaWRQb2ludFRvVGhlTGVmdE9mRWRnZXNJblhZUGxhbmUgPSBpc01pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZShtaWRQb2ludCwgZWRnZXNJblhZUGxhbmUpLFxuICAgICAgICBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lID0gaXNNaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lKG1pZFBvaW50LCBlZGdlc0luWFlQbGFuZSksXG4gICAgICAgIG1pZFBvaW50VG9PbmVTaWRlT2ZFZGdlc0luWFlQbGFuZSA9IG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZSB8fCBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lOyAvLy9cblxuICByZXR1cm4gbWlkUG9pbnRUb09uZVNpZGVPZkVkZ2VzSW5YWVBsYW5lO1xufVxuXG5mdW5jdGlvbiBpc01pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZShtaWRQb2ludCwgZWRnZXNJblhZUGxhbmUpIHtcbiAgY29uc3QgbWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VzSW5YWVBsYW5lID0gZWRnZXNJblhZUGxhbmUucmVkdWNlKGZ1bmN0aW9uKG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZSwgZWRnZUluWFlQbGFuZSkge1xuICAgIGlmIChtaWRQb2ludFRvVGhlTGVmdE9mRWRnZXNJblhZUGxhbmUpIHtcbiAgICAgIGNvbnN0IG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlSW5YWVBsYW5lID0gZWRnZUluWFlQbGFuZS5pc01pZFBvaW50VG9UaGVMZWZ0KG1pZFBvaW50KTtcblxuICAgICAgbWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VzSW5YWVBsYW5lID0gbWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VJblhZUGxhbmU7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZTtcbiAgfSwgdHJ1ZSk7XG5cbiAgcmV0dXJuIG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZTtcbn1cblxuZnVuY3Rpb24gaXNNaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lKG1pZFBvaW50LCBlZGdlc0luWFlQbGFuZSkge1xuICBjb25zdCBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lID0gZWRnZXNJblhZUGxhbmUucmVkdWNlKGZ1bmN0aW9uKG1pZFBvaW50VG9UaGVSaWdodE9mRWRnZXNJblhZUGxhbmUsIGVkZ2VJblhZUGxhbmUpIHtcbiAgICBpZiAobWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlc0luWFlQbGFuZSkge1xuICAgICAgY29uc3QgbWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlSW5YWVBsYW5lID0gZWRnZUluWFlQbGFuZS5pc01pZFBvaW50VG9UaGVSaWdodChtaWRQb2ludCk7XG5cbiAgICAgIG1pZFBvaW50VG9UaGVSaWdodE9mRWRnZXNJblhZUGxhbmUgPSBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VJblhZUGxhbmU7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1pZFBvaW50VG9UaGVSaWdodE9mRWRnZXNJblhZUGxhbmU7XG4gIH0sIHRydWUpO1xuXG4gIHJldHVybiBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lO1xufVxuIl19