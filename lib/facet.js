'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Edge = require('./edge'),
    constants = require('./constants'),
    arrayUtilities = require('./utilities/array'),
    vectorUtilities = require('./utilities/vector'),
    vertexUtilities = require('./utilities/vertex'),
    verticesUtilities = require('./utilities/vertices'),
    approximateUtilities = require('./utilities/approximate');

var VERTICES_LENGTH = constants.VERTICES_LENGTH,
    _rotateAboutZAxis = vertexUtilities.rotateAboutZAxis,
    isApproximatelyEqualToZero = approximateUtilities.isApproximatelyEqualToZero,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    permute = arrayUtilities.permute,
    calculateNormal = verticesUtilities.calculateNormal,
    rotateVertices = verticesUtilities.rotateVertices,
    add3 = vectorUtilities.add3,
    subtract3 = vectorUtilities.subtract3,
    scale3 = vectorUtilities.scale3,
    length3 = vectorUtilities.length3;

var Facet = function () {
  function Facet(vertices, normal) {
    _classCallCheck(this, Facet);

    this.vertices = vertices;
    this.normal = normal;
  }

  _createClass(Facet, [{
    key: 'getVertices',
    value: function getVertices() {
      return this.vertices;
    }
  }, {
    key: 'getNormal',
    value: function getNormal() {
      return this.normal;
    }
  }, {
    key: 'getEdges',
    value: function getEdges() {
      var edges = this.vertices.map(function (vertex, index) {
        var startIndex = index,
            endIndex = (startIndex + 1) % VERTICES_LENGTH,
            startVertex = this.vertices[startIndex],
            endVertex = this.vertices[endIndex],
            edge = Edge.fromVertices(startVertex, endVertex);

        return edge;
      }.bind(this));

      return edges;
    }
  }, {
    key: 'getMidPoint',
    value: function getMidPoint() {
      var midPoint = this.vertices.reduce(function (midPoint, vertex) {
        var scaledVertex = scale3(vertex, 1 / 3);

        midPoint = add3(midPoint, scaledVertex);

        return midPoint;
      }, [0, 0, 0]);

      return midPoint;
    }
  }, {
    key: 'isTooSmall',
    value: function isTooSmall() {
      var normalLength = length3(this.normal),
          normalLengthApproximatelyEqualToZero = isApproximatelyEqualToZero(normalLength),
          tooSmall = normalLengthApproximatelyEqualToZero; ///

      return tooSmall;
    }
  }, {
    key: 'isMasked',
    value: function isMasked(maskingFacet) {
      var edgesInXYPlane = maskingFacet.getEdgesInXYPlane(),
          midPoint = this.getMidPoint(),
          midPointToOneSideOfEdgesInXYPlane = isMidPointToOneSideOfEdgesInXYPlane(midPoint, edgesInXYPlane),
          masked = midPointToOneSideOfEdgesInXYPlane; ///

      return masked;
    }
  }, {
    key: 'applyTransforms',
    value: function applyTransforms(transforms) {
      this.vertices = this.vertices.map(function (vertex) {
        transforms.forEach(function (transform) {
          vertex = transform(vertex);
        });

        return vertex;
      });

      this.normal = calculateNormal(this.vertices);
    }
  }, {
    key: 'rotate',
    value: function rotate(rotationQuaternion) {
      this.vertices = rotateVertices(this.vertices, rotationQuaternion);

      this.normal = calculateNormal(this.vertices);
    }
  }, {
    key: 'rotateAboutZAxis',
    value: function rotateAboutZAxis(rotationAboutZAxisMatrix) {
      this.vertices = this.vertices.map(function (vertex) {
        vertex = _rotateAboutZAxis(vertex, rotationAboutZAxisMatrix);

        return vertex;
      });

      this.normal = calculateNormal(this.vertices);
    }
  }, {
    key: 'split',
    value: function split(intersections, smallerFacets) {
      var nonNullIntersections = calculateNonNullIntersections(intersections),
          nonNullIntersectionsLength = nonNullIntersections.length;

      switch (nonNullIntersectionsLength) {
        case 2:
          this.splitWithTwoNonNullIntersections(intersections, smallerFacets);
          break;

        case 1:
          this.splitWithOneNonNullIntersection(intersections, smallerFacets);
          break;

        case 0:
          this.splitWithZeroNonNullIntersections(intersections, smallerFacets);
          break;
      }
    }
  }, {
    key: 'splitWithTwoNonNullIntersections',
    value: function splitWithTwoNonNullIntersections(intersections, smallerFacets) {
      var nullIntersectionIndex = calculateNullIntersectionIndex(intersections),
          places = (VERTICES_LENGTH - nullIntersectionIndex) % VERTICES_LENGTH;

      intersections = permute(intersections, places);

      intersections = intersections.slice(1); ///

      this.vertices = permute(this.vertices, places);

      var firstVertex = first(this.vertices),
          secondVertex = second(this.vertices),
          thirdVertex = third(this.vertices),
          firstIntersection = first(intersections),
          secondIntersection = second(intersections),
          firstIntermediateVertex = calculateIntermediateVertex(secondVertex, thirdVertex, firstIntersection),
          secondIntermediateVertex = calculateIntermediateVertex(thirdVertex, firstVertex, secondIntersection),
          firstVertices = [firstVertex, secondVertex, firstIntermediateVertex],
          secondVertices = [firstIntermediateVertex, secondIntermediateVertex, firstVertex],
          thirdVertices = [firstIntermediateVertex, thirdVertex, secondIntermediateVertex],
          firstFacet = Facet.fromVertices(firstVertices),
          secondFacet = Facet.fromVertices(secondVertices),
          thirdFacet = Facet.fromVertices(thirdVertices),
          firstFacetTooSmall = firstFacet.isTooSmall(),
          secondFacetTooSmall = secondFacet.isTooSmall(),
          thirdFacetTooSmall = thirdFacet.isTooSmall();

      if (!firstFacetTooSmall) {
        smallerFacets.push(firstFacet);
      }

      if (!secondFacetTooSmall) {
        smallerFacets.push(secondFacet);
      }

      if (!thirdFacetTooSmall) {
        smallerFacets.push(thirdFacet);
      }
    }
  }, {
    key: 'splitWithOneNonNullIntersection',
    value: function splitWithOneNonNullIntersection(intersections, smallerFacets) {
      var nonNullIntersectionIndex = calculateNonNullIntersectionIndex(intersections),
          places = (VERTICES_LENGTH - nonNullIntersectionIndex) % VERTICES_LENGTH;

      intersections = permute(intersections, places);

      this.vertices = permute(this.vertices, places);

      var firstVertex = first(this.vertices),
          secondVertex = second(this.vertices),
          thirdVertex = third(this.vertices),
          firstIntersection = first(intersections),
          intermediateVertex = calculateIntermediateVertex(firstVertex, secondVertex, firstIntersection),
          firstVertices = [firstVertex, intermediateVertex, thirdVertex],
          secondVertices = [intermediateVertex, secondVertex, thirdVertex],
          firstFacet = Facet.fromVertices(firstVertices),
          secondFacet = Facet.fromVertices(secondVertices),
          firstFacetTooSmall = firstFacet.isTooSmall(),
          secondFacetTooSmall = secondFacet.isTooSmall();

      if (!firstFacetTooSmall) {
        smallerFacets.push(firstFacet);
      }

      if (!secondFacetTooSmall) {
        smallerFacets.push(secondFacet);
      }
    }
  }, {
    key: 'splitWithZeroNonNullIntersections',
    value: function splitWithZeroNonNullIntersections(intersections, smallerFacets) {
      var smallerFacet = this; ///

      smallerFacets.push(smallerFacet);
    }
  }, {
    key: 'calculateIntersectionsWithVerticalLineInXYPlane',
    value: function calculateIntersectionsWithVerticalLineInXYPlane(verticalLineInXYPlane) {
      var edges = this.getEdges(),
          intersections = edges.map(function (edge) {
        var intersection = edge.calculateIntersectionWithVerticalLineInXYPlane(verticalLineInXYPlane);

        return intersection;
      });

      return intersections;
    }
  }, {
    key: 'clone',
    value: function clone() {
      var vertices = this.vertices.map(function (vertex) {
        return vertex.slice();
      }),
          normal = this.normal.slice(),
          facet = new Facet(vertices, normal);

      return facet;
    }
  }], [{
    key: 'fromVertices',
    value: function fromVertices(vertices) {
      var normal = calculateNormal(vertices),
          facet = new Facet(vertices, normal);

      return facet;
    }
  }, {
    key: 'fromVerticesAndIndexes',
    value: function fromVerticesAndIndexes(vertices, indexes) {
      vertices = indexes.map(function (index) {
        var vertex = vertices[index];

        return vertex;
      });

      var facet = Facet.fromVertices(vertices);

      return facet;
    }
  }]);

  return Facet;
}();

module.exports = Facet;

function calculateIntermediateVertex(startVertex, endVertex, intersection) {
  var direction = subtract3(endVertex, startVertex),
      offset = scale3(direction, intersection),
      intermediateVertex = add3(startVertex, offset);

  return intermediateVertex;
}

function calculateNonNullIntersections(intersections) {
  var nonNullIntersections = intersections.reduce(function (nonNullIntersections, intersection) {
    if (intersection !== null) {
      var nonNullIntersection = intersection; ///

      nonNullIntersections.push(nonNullIntersection);
    }

    return nonNullIntersections;
  }, []);

  return nonNullIntersections;
}

function calculateNullIntersectionIndex(intersections) {
  var nullIntersectionIndex = intersections.reduce(function (nullIntersectionIndex, intersection, index) {
    if (nullIntersectionIndex === null) {
      if (intersection === null) {
        nullIntersectionIndex = index;
      }
    }

    return nullIntersectionIndex;
  }, null);

  return nullIntersectionIndex;
}

function calculateNonNullIntersectionIndex(intersections) {
  var nullIntersectionIndex = intersections.reduce(function (nullIntersectionIndex, intersection, index) {
    if (nullIntersectionIndex === null) {
      if (intersection !== null) {
        nullIntersectionIndex = index;
      }
    }

    return nullIntersectionIndex;
  }, null);

  return nullIntersectionIndex;
}

function isMidPointToOneSideOfEdgesInXYPlane(midPoint, edgesInXYPlane) {
  var midPointToTheLeftOfEdgesInXYPlane = isMidPointToTheLeftOfEdgesInXYPlane(midPoint, edgesInXYPlane),
      midPointToTheRightOfEdgesInXYPlane = isMidPointToTheRightOfEdgesInXYPlane(midPoint, edgesInXYPlane),
      midPointToOneSideOfEdgesInXYPlane = midPointToTheLeftOfEdgesInXYPlane || midPointToTheRightOfEdgesInXYPlane; ///

  return midPointToOneSideOfEdgesInXYPlane;
}

function isMidPointToTheLeftOfEdgesInXYPlane(midPoint, edgesInXYPlane) {
  var midPointToTheLeftOfEdgesInXYPlane = edgesInXYPlane.reduce(function (midPointToTheLeftOfEdgesInXYPlane, edgeInXYPlane) {
    if (midPointToTheLeftOfEdgesInXYPlane) {
      var midPointToTheLeftOfEdgeInXYPlane = edgeInXYPlane.isMidPointToTheLeft(midPoint);

      midPointToTheLeftOfEdgesInXYPlane = midPointToTheLeftOfEdgeInXYPlane;
    }

    return midPointToTheLeftOfEdgesInXYPlane;
  }, true);

  return midPointToTheLeftOfEdgesInXYPlane;
}

function isMidPointToTheRightOfEdgesInXYPlane(midPoint, edgesInXYPlane) {
  var midPointToTheRightOfEdgesInXYPlane = edgesInXYPlane.reduce(function (midPointToTheRightOfEdgesInXYPlane, edgeInXYPlane) {
    if (midPointToTheRightOfEdgesInXYPlane) {
      var midPointToTheRightOfEdgeInXYPlane = edgeInXYPlane.isMidPointToTheRight(midPoint);

      midPointToTheRightOfEdgesInXYPlane = midPointToTheRightOfEdgeInXYPlane;
    }

    return midPointToTheRightOfEdgesInXYPlane;
  }, true);

  return midPointToTheRightOfEdgesInXYPlane;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9mYWNldC5qcyJdLCJuYW1lcyI6WyJFZGdlIiwicmVxdWlyZSIsImNvbnN0YW50cyIsImFycmF5VXRpbGl0aWVzIiwidmVjdG9yVXRpbGl0aWVzIiwidmVydGV4VXRpbGl0aWVzIiwidmVydGljZXNVdGlsaXRpZXMiLCJhcHByb3hpbWF0ZVV0aWxpdGllcyIsIlZFUlRJQ0VTX0xFTkdUSCIsInJvdGF0ZUFib3V0WkF4aXMiLCJpc0FwcHJveGltYXRlbHlFcXVhbFRvWmVybyIsImZpcnN0Iiwic2Vjb25kIiwidGhpcmQiLCJwZXJtdXRlIiwiY2FsY3VsYXRlTm9ybWFsIiwicm90YXRlVmVydGljZXMiLCJhZGQzIiwic3VidHJhY3QzIiwic2NhbGUzIiwibGVuZ3RoMyIsIkZhY2V0IiwidmVydGljZXMiLCJub3JtYWwiLCJlZGdlcyIsIm1hcCIsInZlcnRleCIsImluZGV4Iiwic3RhcnRJbmRleCIsImVuZEluZGV4Iiwic3RhcnRWZXJ0ZXgiLCJlbmRWZXJ0ZXgiLCJlZGdlIiwiZnJvbVZlcnRpY2VzIiwiYmluZCIsIm1pZFBvaW50IiwicmVkdWNlIiwic2NhbGVkVmVydGV4Iiwibm9ybWFsTGVuZ3RoIiwibm9ybWFsTGVuZ3RoQXBwcm94aW1hdGVseUVxdWFsVG9aZXJvIiwidG9vU21hbGwiLCJtYXNraW5nRmFjZXQiLCJlZGdlc0luWFlQbGFuZSIsImdldEVkZ2VzSW5YWVBsYW5lIiwiZ2V0TWlkUG9pbnQiLCJtaWRQb2ludFRvT25lU2lkZU9mRWRnZXNJblhZUGxhbmUiLCJpc01pZFBvaW50VG9PbmVTaWRlT2ZFZGdlc0luWFlQbGFuZSIsIm1hc2tlZCIsInRyYW5zZm9ybXMiLCJmb3JFYWNoIiwidHJhbnNmb3JtIiwicm90YXRpb25RdWF0ZXJuaW9uIiwicm90YXRpb25BYm91dFpBeGlzTWF0cml4IiwiaW50ZXJzZWN0aW9ucyIsInNtYWxsZXJGYWNldHMiLCJub25OdWxsSW50ZXJzZWN0aW9ucyIsImNhbGN1bGF0ZU5vbk51bGxJbnRlcnNlY3Rpb25zIiwibm9uTnVsbEludGVyc2VjdGlvbnNMZW5ndGgiLCJsZW5ndGgiLCJzcGxpdFdpdGhUd29Ob25OdWxsSW50ZXJzZWN0aW9ucyIsInNwbGl0V2l0aE9uZU5vbk51bGxJbnRlcnNlY3Rpb24iLCJzcGxpdFdpdGhaZXJvTm9uTnVsbEludGVyc2VjdGlvbnMiLCJudWxsSW50ZXJzZWN0aW9uSW5kZXgiLCJjYWxjdWxhdGVOdWxsSW50ZXJzZWN0aW9uSW5kZXgiLCJwbGFjZXMiLCJzbGljZSIsImZpcnN0VmVydGV4Iiwic2Vjb25kVmVydGV4IiwidGhpcmRWZXJ0ZXgiLCJmaXJzdEludGVyc2VjdGlvbiIsInNlY29uZEludGVyc2VjdGlvbiIsImZpcnN0SW50ZXJtZWRpYXRlVmVydGV4IiwiY2FsY3VsYXRlSW50ZXJtZWRpYXRlVmVydGV4Iiwic2Vjb25kSW50ZXJtZWRpYXRlVmVydGV4IiwiZmlyc3RWZXJ0aWNlcyIsInNlY29uZFZlcnRpY2VzIiwidGhpcmRWZXJ0aWNlcyIsImZpcnN0RmFjZXQiLCJzZWNvbmRGYWNldCIsInRoaXJkRmFjZXQiLCJmaXJzdEZhY2V0VG9vU21hbGwiLCJpc1Rvb1NtYWxsIiwic2Vjb25kRmFjZXRUb29TbWFsbCIsInRoaXJkRmFjZXRUb29TbWFsbCIsInB1c2giLCJub25OdWxsSW50ZXJzZWN0aW9uSW5kZXgiLCJjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9uSW5kZXgiLCJpbnRlcm1lZGlhdGVWZXJ0ZXgiLCJzbWFsbGVyRmFjZXQiLCJ2ZXJ0aWNhbExpbmVJblhZUGxhbmUiLCJnZXRFZGdlcyIsImludGVyc2VjdGlvbiIsImNhbGN1bGF0ZUludGVyc2VjdGlvbldpdGhWZXJ0aWNhbExpbmVJblhZUGxhbmUiLCJmYWNldCIsImluZGV4ZXMiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGlyZWN0aW9uIiwib2Zmc2V0Iiwibm9uTnVsbEludGVyc2VjdGlvbiIsIm1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZSIsImlzTWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VzSW5YWVBsYW5lIiwibWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlc0luWFlQbGFuZSIsImlzTWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlc0luWFlQbGFuZSIsImVkZ2VJblhZUGxhbmUiLCJtaWRQb2ludFRvVGhlTGVmdE9mRWRnZUluWFlQbGFuZSIsImlzTWlkUG9pbnRUb1RoZUxlZnQiLCJtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VJblhZUGxhbmUiLCJpc01pZFBvaW50VG9UaGVSaWdodCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQUVBLElBQU1BLE9BQU9DLFFBQVEsUUFBUixDQUFiO0FBQUEsSUFDTUMsWUFBWUQsUUFBUSxhQUFSLENBRGxCO0FBQUEsSUFFTUUsaUJBQWlCRixRQUFRLG1CQUFSLENBRnZCO0FBQUEsSUFHTUcsa0JBQWtCSCxRQUFRLG9CQUFSLENBSHhCO0FBQUEsSUFJTUksa0JBQWtCSixRQUFRLG9CQUFSLENBSnhCO0FBQUEsSUFLTUssb0JBQW9CTCxRQUFRLHNCQUFSLENBTDFCO0FBQUEsSUFNTU0sdUJBQXVCTixRQUFRLHlCQUFSLENBTjdCOztBQVFNLElBQUVPLGVBQUYsR0FBc0JOLFNBQXRCLENBQUVNLGVBQUY7QUFBQSxJQUNFQyxpQkFERixHQUN1QkosZUFEdkIsQ0FDRUksZ0JBREY7QUFBQSxJQUVFQywwQkFGRixHQUVpQ0gsb0JBRmpDLENBRUVHLDBCQUZGO0FBQUEsSUFHRUMsS0FIRixHQUdvQ1IsY0FIcEMsQ0FHRVEsS0FIRjtBQUFBLElBR1NDLE1BSFQsR0FHb0NULGNBSHBDLENBR1NTLE1BSFQ7QUFBQSxJQUdpQkMsS0FIakIsR0FHb0NWLGNBSHBDLENBR2lCVSxLQUhqQjtBQUFBLElBR3dCQyxPQUh4QixHQUdvQ1gsY0FIcEMsQ0FHd0JXLE9BSHhCO0FBQUEsSUFJRUMsZUFKRixHQUlzQ1QsaUJBSnRDLENBSUVTLGVBSkY7QUFBQSxJQUltQkMsY0FKbkIsR0FJc0NWLGlCQUp0QyxDQUltQlUsY0FKbkI7QUFBQSxJQUtFQyxJQUxGLEdBS3VDYixlQUx2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QW1DekUsUUFBbkMsQ0FBMUM7O0FBRUFtRSwyQ0FBcUNLLGlDQUFyQztBQUNEOztBQUVELFdBQU9MLGtDQUFQO0FBQ0QsR0FSMEMsRUFReEMsSUFSd0MsQ0FBM0M7O0FBVUEsU0FBT0Esa0NBQVA7QUFDRCIsImZpbGUiOiJmYWNldC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgRWRnZSA9IHJlcXVpcmUoJy4vZWRnZScpLFxuICAgICAgY29uc3RhbnRzID0gcmVxdWlyZSgnLi9jb25zdGFudHMnKSxcbiAgICAgIGFycmF5VXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvYXJyYXknKSxcbiAgICAgIHZlY3RvclV0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL3ZlY3RvcicpLFxuICAgICAgdmVydGV4VXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvdmVydGV4JyksXG4gICAgICB2ZXJ0aWNlc1V0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL3ZlcnRpY2VzJyksXG4gICAgICBhcHByb3hpbWF0ZVV0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL2FwcHJveGltYXRlJyk7XG5cbmNvbnN0IHsgVkVSVElDRVNfTEVOR1RIIH0gPSBjb25zdGFudHMsXG4gICAgICB7IHJvdGF0ZUFib3V0WkF4aXMgfSA9IHZlcnRleFV0aWxpdGllcyxcbiAgICAgIHsgaXNBcHByb3hpbWF0ZWx5RXF1YWxUb1plcm8gfSA9IGFwcHJveGltYXRlVXRpbGl0aWVzLFxuICAgICAgeyBmaXJzdCwgc2Vjb25kLCB0aGlyZCwgcGVybXV0ZSB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IGNhbGN1bGF0ZU5vcm1hbCwgcm90YXRlVmVydGljZXMgfSA9IHZlcnRpY2VzVXRpbGl0aWVzLFxuICAgICAgeyBhZGQzLCBzdWJ0cmFjdDMsIHNjYWxlMywgbGVuZ3RoMyB9ID0gdmVjdG9yVXRpbGl0aWVzO1xuXG5jbGFzcyBGYWNldCB7XG4gIGNvbnN0cnVjdG9yKHZlcnRpY2VzLCBub3JtYWwpIHtcbiAgICB0aGlzLnZlcnRpY2VzID0gdmVydGljZXM7XG4gICAgdGhpcy5ub3JtYWwgPSBub3JtYWw7XG4gIH1cblxuICBnZXRWZXJ0aWNlcygpIHtcbiAgICByZXR1cm4gdGhpcy52ZXJ0aWNlcztcbiAgfVxuXG4gIGdldE5vcm1hbCgpIHtcbiAgICByZXR1cm4gdGhpcy5ub3JtYWw7XG4gIH1cblxuICBnZXRFZGdlcygpIHtcbiAgICBjb25zdCBlZGdlcyA9IHRoaXMudmVydGljZXMubWFwKGZ1bmN0aW9uKHZlcnRleCwgaW5kZXgpIHtcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0SW5kZXggPSBpbmRleCxcbiAgICAgICAgICAgICAgICAgIGVuZEluZGV4ID0gKHN0YXJ0SW5kZXggKyAxKSAlIFZFUlRJQ0VTX0xFTkdUSCxcbiAgICAgICAgICAgICAgICAgIHN0YXJ0VmVydGV4ID0gdGhpcy52ZXJ0aWNlc1tzdGFydEluZGV4XSxcbiAgICAgICAgICAgICAgICAgIGVuZFZlcnRleCA9IHRoaXMudmVydGljZXNbZW5kSW5kZXhdLFxuICAgICAgICAgICAgICAgICAgZWRnZSA9IEVkZ2UuZnJvbVZlcnRpY2VzKHN0YXJ0VmVydGV4LCBlbmRWZXJ0ZXgpO1xuICBcbiAgICAgICAgICAgIHJldHVybiBlZGdlO1xuICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICByZXR1cm4gZWRnZXM7XG4gIH1cbiAgXG4gIGdldE1pZFBvaW50KCkge1xuICAgIGNvbnN0IG1pZFBvaW50ID0gdGhpcy52ZXJ0aWNlcy5yZWR1Y2UoZnVuY3Rpb24obWlkUG9pbnQsIHZlcnRleCkge1xuICAgICAgY29uc3Qgc2NhbGVkVmVydGV4ID0gc2NhbGUzKHZlcnRleCwgMS8zKTtcbiAgICAgIFxuICAgICAgbWlkUG9pbnQgPSBhZGQzKG1pZFBvaW50LCBzY2FsZWRWZXJ0ZXgpO1xuICAgICAgXG4gICAgICByZXR1cm4gbWlkUG9pbnQ7XG4gICAgfSwgWyAwLCAwLCAwIF0pO1xuICAgIFxuICAgIHJldHVybiBtaWRQb2ludDtcbiAgfVxuICBcbiAgaXNUb29TbWFsbCgpIHtcbiAgICBjb25zdCBub3JtYWxMZW5ndGggPSBsZW5ndGgzKHRoaXMubm9ybWFsKSxcbiAgICAgICAgICBub3JtYWxMZW5ndGhBcHByb3hpbWF0ZWx5RXF1YWxUb1plcm8gPSBpc0FwcHJveGltYXRlbHlFcXVhbFRvWmVybyhub3JtYWxMZW5ndGgpLFxuICAgICAgICAgIHRvb1NtYWxsID0gbm9ybWFsTGVuZ3RoQXBwcm94aW1hdGVseUVxdWFsVG9aZXJvOyAgLy8vXG4gICAgXG4gICAgcmV0dXJuIHRvb1NtYWxsO1xuICB9XG4gIFxuICBpc01hc2tlZChtYXNraW5nRmFjZXQpIHtcbiAgICBjb25zdCBlZGdlc0luWFlQbGFuZSA9IG1hc2tpbmdGYWNldC5nZXRFZGdlc0luWFlQbGFuZSgpLFxuICAgICAgICAgIG1pZFBvaW50ID0gdGhpcy5nZXRNaWRQb2ludCgpLFxuICAgICAgICAgIG1pZFBvaW50VG9PbmVTaWRlT2ZFZGdlc0luWFlQbGFuZSA9IGlzTWlkUG9pbnRUb09uZVNpZGVPZkVkZ2VzSW5YWVBsYW5lKG1pZFBvaW50LCBlZGdlc0luWFlQbGFuZSksXG4gICAgICAgICAgbWFza2VkID0gbWlkUG9pbnRUb09uZVNpZGVPZkVkZ2VzSW5YWVBsYW5lOyAgLy8vXG4gICAgXG4gICAgcmV0dXJuIG1hc2tlZDtcbiAgfVxuICBcbiAgYXBwbHlUcmFuc2Zvcm1zKHRyYW5zZm9ybXMpIHtcbiAgICB0aGlzLnZlcnRpY2VzID0gdGhpcy52ZXJ0aWNlcy5tYXAoZnVuY3Rpb24odmVydGV4KSB7XG4gICAgICB0cmFuc2Zvcm1zLmZvckVhY2goZnVuY3Rpb24odHJhbnNmb3JtKSB7XG4gICAgICAgIHZlcnRleCA9IHRyYW5zZm9ybSh2ZXJ0ZXgpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB2ZXJ0ZXg7XG4gICAgfSk7XG5cbiAgICB0aGlzLm5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCh0aGlzLnZlcnRpY2VzKTtcbiAgfVxuICBcbiAgcm90YXRlKHJvdGF0aW9uUXVhdGVybmlvbikge1xuICAgIHRoaXMudmVydGljZXMgPSByb3RhdGVWZXJ0aWNlcyh0aGlzLnZlcnRpY2VzLCByb3RhdGlvblF1YXRlcm5pb24pO1xuICAgIFxuICAgIHRoaXMubm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHRoaXMudmVydGljZXMpO1xuICB9XG5cbiAgcm90YXRlQWJvdXRaQXhpcyhyb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgpIHtcbiAgICB0aGlzLnZlcnRpY2VzID0gdGhpcy52ZXJ0aWNlcy5tYXAoZnVuY3Rpb24odmVydGV4KSB7XG4gICAgICB2ZXJ0ZXggPSByb3RhdGVBYm91dFpBeGlzKHZlcnRleCwgcm90YXRpb25BYm91dFpBeGlzTWF0cml4KTtcblxuICAgICAgcmV0dXJuIHZlcnRleDtcbiAgICB9KTtcblxuICAgIHRoaXMubm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHRoaXMudmVydGljZXMpO1xuICB9XG4gIFxuICBzcGxpdChpbnRlcnNlY3Rpb25zLCBzbWFsbGVyRmFjZXRzKSB7XG4gICAgY29uc3Qgbm9uTnVsbEludGVyc2VjdGlvbnMgPSBjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zKSxcbiAgICAgICAgICBub25OdWxsSW50ZXJzZWN0aW9uc0xlbmd0aCA9IG5vbk51bGxJbnRlcnNlY3Rpb25zLmxlbmd0aDtcblxuICAgIHN3aXRjaCAobm9uTnVsbEludGVyc2VjdGlvbnNMZW5ndGgpIHtcbiAgICAgIGNhc2UgMiA6XG4gICAgICAgIHRoaXMuc3BsaXRXaXRoVHdvTm9uTnVsbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucywgc21hbGxlckZhY2V0cyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIDEgOlxuICAgICAgICB0aGlzLnNwbGl0V2l0aE9uZU5vbk51bGxJbnRlcnNlY3Rpb24oaW50ZXJzZWN0aW9ucywgc21hbGxlckZhY2V0cyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIDAgOlxuICAgICAgICB0aGlzLnNwbGl0V2l0aFplcm9Ob25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zLCBzbWFsbGVyRmFjZXRzKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgc3BsaXRXaXRoVHdvTm9uTnVsbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucywgc21hbGxlckZhY2V0cykge1xuICAgIGNvbnN0IG51bGxJbnRlcnNlY3Rpb25JbmRleCA9IGNhbGN1bGF0ZU51bGxJbnRlcnNlY3Rpb25JbmRleChpbnRlcnNlY3Rpb25zKSxcbiAgICAgICAgICBwbGFjZXMgPSAoVkVSVElDRVNfTEVOR1RIIC0gbnVsbEludGVyc2VjdGlvbkluZGV4KSAlIFZFUlRJQ0VTX0xFTkdUSDtcblxuICAgIGludGVyc2VjdGlvbnMgPSBwZXJtdXRlKGludGVyc2VjdGlvbnMsIHBsYWNlcyk7XG5cbiAgICBpbnRlcnNlY3Rpb25zID0gaW50ZXJzZWN0aW9ucy5zbGljZSgxKTsgLy8vXG5cbiAgICB0aGlzLnZlcnRpY2VzID0gcGVybXV0ZSh0aGlzLnZlcnRpY2VzLCBwbGFjZXMpO1xuXG4gICAgY29uc3QgZmlyc3RWZXJ0ZXggPSBmaXJzdCh0aGlzLnZlcnRpY2VzKSxcbiAgICAgICAgICBzZWNvbmRWZXJ0ZXggPSBzZWNvbmQodGhpcy52ZXJ0aWNlcyksXG4gICAgICAgICAgdGhpcmRWZXJ0ZXggPSB0aGlyZCh0aGlzLnZlcnRpY2VzKSxcbiAgICAgICAgICBmaXJzdEludGVyc2VjdGlvbiA9IGZpcnN0KGludGVyc2VjdGlvbnMpLFxuICAgICAgICAgIHNlY29uZEludGVyc2VjdGlvbiA9IHNlY29uZChpbnRlcnNlY3Rpb25zKSxcbiAgICAgICAgICBmaXJzdEludGVybWVkaWF0ZVZlcnRleCA9IGNhbGN1bGF0ZUludGVybWVkaWF0ZVZlcnRleChzZWNvbmRWZXJ0ZXgsIHRoaXJkVmVydGV4LCBmaXJzdEludGVyc2VjdGlvbiksXG4gICAgICAgICAgc2Vjb25kSW50ZXJtZWRpYXRlVmVydGV4ID0gY2FsY3VsYXRlSW50ZXJtZWRpYXRlVmVydGV4KHRoaXJkVmVydGV4LCBmaXJzdFZlcnRleCwgc2Vjb25kSW50ZXJzZWN0aW9uKSxcbiAgICAgICAgICBmaXJzdFZlcnRpY2VzID0gW1xuICAgICAgICAgICAgZmlyc3RWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRWZXJ0ZXgsXG4gICAgICAgICAgICBmaXJzdEludGVybWVkaWF0ZVZlcnRleFxuICAgICAgICAgIF0sXG4gICAgICAgICAgc2Vjb25kVmVydGljZXMgPSBbXG4gICAgICAgICAgICBmaXJzdEludGVybWVkaWF0ZVZlcnRleCxcbiAgICAgICAgICAgIHNlY29uZEludGVybWVkaWF0ZVZlcnRleCxcbiAgICAgICAgICAgIGZpcnN0VmVydGV4XG4gICAgICAgICAgXSxcbiAgICAgICAgICB0aGlyZFZlcnRpY2VzID0gW1xuICAgICAgICAgICAgZmlyc3RJbnRlcm1lZGlhdGVWZXJ0ZXgsXG4gICAgICAgICAgICB0aGlyZFZlcnRleCxcbiAgICAgICAgICAgIHNlY29uZEludGVybWVkaWF0ZVZlcnRleFxuICAgICAgICAgIF0sXG4gICAgICAgICAgZmlyc3RGYWNldCA9IEZhY2V0LmZyb21WZXJ0aWNlcyhmaXJzdFZlcnRpY2VzKSxcbiAgICAgICAgICBzZWNvbmRGYWNldCA9IEZhY2V0LmZyb21WZXJ0aWNlcyhzZWNvbmRWZXJ0aWNlcyksXG4gICAgICAgICAgdGhpcmRGYWNldCA9IEZhY2V0LmZyb21WZXJ0aWNlcyh0aGlyZFZlcnRpY2VzKSxcbiAgICAgICAgICBmaXJzdEZhY2V0VG9vU21hbGwgPSBmaXJzdEZhY2V0LmlzVG9vU21hbGwoKSxcbiAgICAgICAgICBzZWNvbmRGYWNldFRvb1NtYWxsID0gc2Vjb25kRmFjZXQuaXNUb29TbWFsbCgpLFxuICAgICAgICAgIHRoaXJkRmFjZXRUb29TbWFsbCA9IHRoaXJkRmFjZXQuaXNUb29TbWFsbCgpO1xuXG4gICAgaWYgKCFmaXJzdEZhY2V0VG9vU21hbGwpIHtcbiAgICAgIHNtYWxsZXJGYWNldHMucHVzaChmaXJzdEZhY2V0KTtcbiAgICB9XG5cbiAgICBpZiAoIXNlY29uZEZhY2V0VG9vU21hbGwpIHtcbiAgICAgIHNtYWxsZXJGYWNldHMucHVzaChzZWNvbmRGYWNldCk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlyZEZhY2V0VG9vU21hbGwpIHtcbiAgICAgIHNtYWxsZXJGYWNldHMucHVzaCh0aGlyZEZhY2V0KTtcbiAgICB9XG4gIH1cblxuICBzcGxpdFdpdGhPbmVOb25OdWxsSW50ZXJzZWN0aW9uKGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMpIHtcbiAgICBjb25zdCBub25OdWxsSW50ZXJzZWN0aW9uSW5kZXggPSBjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9uSW5kZXgoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgcGxhY2VzID0gKFZFUlRJQ0VTX0xFTkdUSCAtIG5vbk51bGxJbnRlcnNlY3Rpb25JbmRleCkgJSBWRVJUSUNFU19MRU5HVEg7XG5cbiAgICBpbnRlcnNlY3Rpb25zID0gcGVybXV0ZShpbnRlcnNlY3Rpb25zLCBwbGFjZXMpO1xuXG4gICAgdGhpcy52ZXJ0aWNlcyA9IHBlcm11dGUodGhpcy52ZXJ0aWNlcywgcGxhY2VzKTtcblxuICAgIGNvbnN0IGZpcnN0VmVydGV4ID0gZmlyc3QodGhpcy52ZXJ0aWNlcyksXG4gICAgICAgICAgc2Vjb25kVmVydGV4ID0gc2Vjb25kKHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIHRoaXJkVmVydGV4ID0gdGhpcmQodGhpcy52ZXJ0aWNlcyksXG4gICAgICAgICAgZmlyc3RJbnRlcnNlY3Rpb24gPSBmaXJzdChpbnRlcnNlY3Rpb25zKSxcbiAgICAgICAgICBpbnRlcm1lZGlhdGVWZXJ0ZXggPSBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgoZmlyc3RWZXJ0ZXgsIHNlY29uZFZlcnRleCwgZmlyc3RJbnRlcnNlY3Rpb24pLFxuICAgICAgICAgIGZpcnN0VmVydGljZXMgPSBbXG4gICAgICAgICAgICBmaXJzdFZlcnRleCxcbiAgICAgICAgICAgIGludGVybWVkaWF0ZVZlcnRleCxcbiAgICAgICAgICAgIHRoaXJkVmVydGV4XG4gICAgICAgICAgXSxcbiAgICAgICAgICBzZWNvbmRWZXJ0aWNlcyA9IFtcbiAgICAgICAgICAgIGludGVybWVkaWF0ZVZlcnRleCxcbiAgICAgICAgICAgIHNlY29uZFZlcnRleCxcbiAgICAgICAgICAgIHRoaXJkVmVydGV4XG4gICAgICAgICAgXSxcbiAgICAgICAgICBmaXJzdEZhY2V0ID0gRmFjZXQuZnJvbVZlcnRpY2VzKGZpcnN0VmVydGljZXMpLFxuICAgICAgICAgIHNlY29uZEZhY2V0ID0gRmFjZXQuZnJvbVZlcnRpY2VzKHNlY29uZFZlcnRpY2VzKSxcbiAgICAgICAgICBmaXJzdEZhY2V0VG9vU21hbGwgPSBmaXJzdEZhY2V0LmlzVG9vU21hbGwoKSxcbiAgICAgICAgICBzZWNvbmRGYWNldFRvb1NtYWxsID0gc2Vjb25kRmFjZXQuaXNUb29TbWFsbCgpO1xuXG4gICAgaWYgKCFmaXJzdEZhY2V0VG9vU21hbGwpIHtcbiAgICAgIHNtYWxsZXJGYWNldHMucHVzaChmaXJzdEZhY2V0KTtcbiAgICB9XG5cbiAgICBpZiAoIXNlY29uZEZhY2V0VG9vU21hbGwpIHtcbiAgICAgIHNtYWxsZXJGYWNldHMucHVzaChzZWNvbmRGYWNldCk7XG4gICAgfVxuICB9XG5cbiAgc3BsaXRXaXRoWmVyb05vbk51bGxJbnRlcnNlY3Rpb25zKGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMpIHtcbiAgICBjb25zdCBzbWFsbGVyRmFjZXQgPSB0aGlzOyAgLy8vXG5cbiAgICBzbWFsbGVyRmFjZXRzLnB1c2goc21hbGxlckZhY2V0KTtcbiAgfVxuXG4gIGNhbGN1bGF0ZUludGVyc2VjdGlvbnNXaXRoVmVydGljYWxMaW5lSW5YWVBsYW5lKHZlcnRpY2FsTGluZUluWFlQbGFuZSkge1xuICAgIGNvbnN0IGVkZ2VzID0gdGhpcy5nZXRFZGdlcygpLFxuICAgICAgICAgIGludGVyc2VjdGlvbnMgPSBlZGdlcy5tYXAoZnVuY3Rpb24oZWRnZSkge1xuICAgICAgICAgICAgY29uc3QgaW50ZXJzZWN0aW9uID0gZWRnZS5jYWxjdWxhdGVJbnRlcnNlY3Rpb25XaXRoVmVydGljYWxMaW5lSW5YWVBsYW5lKHZlcnRpY2FsTGluZUluWFlQbGFuZSk7XG4gIFxuICAgICAgICAgICAgcmV0dXJuIGludGVyc2VjdGlvbjtcbiAgICAgICAgICB9KTtcblxuICAgIHJldHVybiBpbnRlcnNlY3Rpb25zO1xuICB9XG5cbiAgY2xvbmUoKSB7XG4gICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzLm1hcChmdW5jdGlvbih2ZXJ0ZXgpIHtcbiAgICAgICAgICAgIHJldHVybiB2ZXJ0ZXguc2xpY2UoKTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBub3JtYWwgPSB0aGlzLm5vcm1hbC5zbGljZSgpLFxuICAgICAgICAgIGZhY2V0ID0gbmV3IEZhY2V0KHZlcnRpY2VzLCBub3JtYWwpO1xuXG4gICAgcmV0dXJuIGZhY2V0O1xuICB9XG5cbiAgc3RhdGljIGZyb21WZXJ0aWNlcyh2ZXJ0aWNlcykge1xuICAgIGNvbnN0IG5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCh2ZXJ0aWNlcyksXG4gICAgICAgICAgZmFjZXQgPSBuZXcgRmFjZXQodmVydGljZXMsIG5vcm1hbCk7XG5cbiAgICByZXR1cm4gZmFjZXQ7XG4gIH1cblxuICBzdGF0aWMgZnJvbVZlcnRpY2VzQW5kSW5kZXhlcyh2ZXJ0aWNlcywgaW5kZXhlcykge1xuICAgIHZlcnRpY2VzID0gaW5kZXhlcy5tYXAoZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgIGNvbnN0IHZlcnRleCA9IHZlcnRpY2VzW2luZGV4XTtcblxuICAgICAgcmV0dXJuIHZlcnRleDtcbiAgICB9KTtcblxuICAgIGNvbnN0IGZhY2V0ID0gRmFjZXQuZnJvbVZlcnRpY2VzKHZlcnRpY2VzKTtcblxuICAgIHJldHVybiBmYWNldDtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEZhY2V0O1xuXG5mdW5jdGlvbiBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgoc3RhcnRWZXJ0ZXgsIGVuZFZlcnRleCwgaW50ZXJzZWN0aW9uKSB7XG4gIGNvbnN0IGRpcmVjdGlvbiA9IHN1YnRyYWN0MyhlbmRWZXJ0ZXgsIHN0YXJ0VmVydGV4KSxcbiAgICAgICAgb2Zmc2V0ID0gc2NhbGUzKGRpcmVjdGlvbiwgaW50ZXJzZWN0aW9uKSxcbiAgICAgICAgaW50ZXJtZWRpYXRlVmVydGV4ID0gYWRkMyhzdGFydFZlcnRleCwgb2Zmc2V0KTtcblxuICByZXR1cm4gaW50ZXJtZWRpYXRlVmVydGV4O1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zKSB7XG4gIGNvbnN0IG5vbk51bGxJbnRlcnNlY3Rpb25zID0gaW50ZXJzZWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24obm9uTnVsbEludGVyc2VjdGlvbnMsIGludGVyc2VjdGlvbikge1xuICAgIGlmIChpbnRlcnNlY3Rpb24gIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IG5vbk51bGxJbnRlcnNlY3Rpb24gPSBpbnRlcnNlY3Rpb247IC8vL1xuXG4gICAgICBub25OdWxsSW50ZXJzZWN0aW9ucy5wdXNoKG5vbk51bGxJbnRlcnNlY3Rpb24pO1xuICAgIH1cblxuICAgIHJldHVybiBub25OdWxsSW50ZXJzZWN0aW9ucztcbiAgfSwgW10pO1xuXG4gIHJldHVybiBub25OdWxsSW50ZXJzZWN0aW9ucztcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlTnVsbEludGVyc2VjdGlvbkluZGV4KGludGVyc2VjdGlvbnMpIHtcbiAgY29uc3QgbnVsbEludGVyc2VjdGlvbkluZGV4ID0gaW50ZXJzZWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24obnVsbEludGVyc2VjdGlvbkluZGV4LCBpbnRlcnNlY3Rpb24sIGluZGV4KSB7XG4gICAgaWYgKG51bGxJbnRlcnNlY3Rpb25JbmRleCA9PT0gbnVsbCkge1xuICAgICAgaWYgKGludGVyc2VjdGlvbiA9PT0gbnVsbCkge1xuICAgICAgICBudWxsSW50ZXJzZWN0aW9uSW5kZXggPSBpbmRleDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbEludGVyc2VjdGlvbkluZGV4O1xuICB9LCBudWxsKTtcblxuICByZXR1cm4gbnVsbEludGVyc2VjdGlvbkluZGV4O1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9uSW5kZXgoaW50ZXJzZWN0aW9ucykge1xuICBjb25zdCBudWxsSW50ZXJzZWN0aW9uSW5kZXggPSBpbnRlcnNlY3Rpb25zLnJlZHVjZShmdW5jdGlvbihudWxsSW50ZXJzZWN0aW9uSW5kZXgsIGludGVyc2VjdGlvbiwgaW5kZXgpIHtcbiAgICBpZiAobnVsbEludGVyc2VjdGlvbkluZGV4ID09PSBudWxsKSB7XG4gICAgICBpZiAoaW50ZXJzZWN0aW9uICE9PSBudWxsKSB7XG4gICAgICAgIG51bGxJbnRlcnNlY3Rpb25JbmRleCA9IGluZGV4O1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBudWxsSW50ZXJzZWN0aW9uSW5kZXg7XG4gIH0sIG51bGwpO1xuXG4gIHJldHVybiBudWxsSW50ZXJzZWN0aW9uSW5kZXg7XG59XG5cbmZ1bmN0aW9uIGlzTWlkUG9pbnRUb09uZVNpZGVPZkVkZ2VzSW5YWVBsYW5lKG1pZFBvaW50LCBlZGdlc0luWFlQbGFuZSkge1xuICBjb25zdCBtaWRQb2ludFRvVGhlTGVmdE9mRWRnZXNJblhZUGxhbmUgPSBpc01pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZShtaWRQb2ludCwgZWRnZXNJblhZUGxhbmUpLFxuICAgICAgICBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lID0gaXNNaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lKG1pZFBvaW50LCBlZGdlc0luWFlQbGFuZSksXG4gICAgICAgIG1pZFBvaW50VG9PbmVTaWRlT2ZFZGdlc0luWFlQbGFuZSA9IG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZSB8fCBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lOyAvLy9cblxuICByZXR1cm4gbWlkUG9pbnRUb09uZVNpZGVPZkVkZ2VzSW5YWVBsYW5lO1xufVxuXG5mdW5jdGlvbiBpc01pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZShtaWRQb2ludCwgZWRnZXNJblhZUGxhbmUpIHtcbiAgY29uc3QgbWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VzSW5YWVBsYW5lID0gZWRnZXNJblhZUGxhbmUucmVkdWNlKGZ1bmN0aW9uKG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZSwgZWRnZUluWFlQbGFuZSkge1xuICAgIGlmIChtaWRQb2ludFRvVGhlTGVmdE9mRWRnZXNJblhZUGxhbmUpIHtcbiAgICAgIGNvbnN0IG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlSW5YWVBsYW5lID0gZWRnZUluWFlQbGFuZS5pc01pZFBvaW50VG9UaGVMZWZ0KG1pZFBvaW50KTtcblxuICAgICAgbWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VzSW5YWVBsYW5lID0gbWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VJblhZUGxhbmU7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZTtcbiAgfSwgdHJ1ZSk7XG5cbiAgcmV0dXJuIG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZTtcbn1cblxuZnVuY3Rpb24gaXNNaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lKG1pZFBvaW50LCBlZGdlc0luWFlQbGFuZSkge1xuICBjb25zdCBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lID0gZWRnZXNJblhZUGxhbmUucmVkdWNlKGZ1bmN0aW9uKG1pZFBvaW50VG9UaGVSaWdodE9mRWRnZXNJblhZUGxhbmUsIGVkZ2VJblhZUGxhbmUpIHtcbiAgICBpZiAobWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlc0luWFlQbGFuZSkge1xuICAgICAgY29uc3QgbWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlSW5YWVBsYW5lID0gZWRnZUluWFlQbGFuZS5pc01pZFBvaW50VG9UaGVSaWdodChtaWRQb2ludCk7XG5cbiAgICAgIG1pZFBvaW50VG9UaGVSaWdodE9mRWRnZXNJblhZUGxhbmUgPSBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VJblhZUGxhbmU7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1pZFBvaW50VG9UaGVSaWdodE9mRWRnZXNJblhZUGxhbmU7XG4gIH0sIHRydWUpO1xuXG4gIHJldHVybiBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lO1xufVxuIl19