'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Line = require('./line'),
    vec3 = require('./maths/vec3'),
    arrayUtilities = require('./utilities/array'),
    verticesUtilities = require('./utilities/vertices');

var add = vec3.add,
    subtract = vec3.subtract,
    scale = vec3.scale,
    transform = vec3.transform,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    permute = arrayUtilities.permute,
    calculateNormal = verticesUtilities.calculateNormal,
    rotateVertices = verticesUtilities.rotateVertices;

var Facet = function () {
  function Facet(vertices, normal) {
    _classCallCheck(this, Facet);

    this.vertices = vertices;
    this.normal = normal;
  }

  _createClass(Facet, [{
    key: 'getVertices',
    value: function getVertices() {
      return this.vertices;
    }
  }, {
    key: 'getNormal',
    value: function getNormal() {
      return this.normal;
    }
  }, {
    key: 'getLines',
    value: function getLines() {
      var verticesLength = 3,
          ///
      lines = this.vertices.map(function (vertex, index) {
        var startIndex = index,
            endIndex = (startIndex + 1) % verticesLength,
            startVertex = this.vertices[startIndex],
            endVertex = this.vertices[endIndex],
            line = Line.fromVertices(startVertex, endVertex);

        return line;
      }.bind(this));

      return lines;
    }
  }, {
    key: 'isOutsideLinesInXYPlane',
    value: function isOutsideLinesInXYPlane(linesInXYPlane) {
      return true;
    }
  }, {
    key: 'rotate',
    value: function rotate(rotationQuaternion) {
      this.vertices = rotateVertices(this.vertices, rotationQuaternion);

      this.normal = calculateNormal(this.vertices);
    }
  }, {
    key: 'rotateAboutZAxis',
    value: function rotateAboutZAxis(rotationAboutZAxisMatrix) {
      var mat2 = rotationAboutZAxisMatrix; ///

      this.vertices = this.vertices.map(function (vertex) {
        var vec = vertex;

        vec = transform(vec, mat2);

        vertex = vec;

        return vertex;
      });

      this.normal = calculateNormal(this.vertices);
    }
  }, {
    key: 'splitWithNullIntersection',
    value: function splitWithNullIntersection(intersections) {
      var facets = void 0;

      var nonNullIntersections = calculateNonNullIntersections(intersections),
          nonTrivialNonNullIntersections = calculateNonTrivialIntersections(nonNullIntersections),
          nonTrivialNonNullIntersectionsLength = nonTrivialNonNullIntersections.length;

      switch (nonTrivialNonNullIntersectionsLength) {
        case 2:
          facets = this.splitWithTwoNonTrivialNonNullIntersections(intersections);
          break;

        default:
          facets = this.splitWithNoNonTrivialNonNullIntersections();
          break;
      }

      return facets;
    }
  }, {
    key: 'splitWithoutNullIntersection',
    value: function splitWithoutNullIntersection(intersections) {
      var facets = void 0;

      var nonTrivialIntersections = calculateNonTrivialIntersections(intersections),
          nonTrivialIntersectionsLength = nonTrivialIntersections.length;

      switch (nonTrivialIntersectionsLength) {
        case 2:
          facets = this.splitWithTwoNonTrivialIntersections(intersections);
          break;

        case 1:
          facets = this.splitWithOneNonTrivialIntersection(intersections);
          break;

        default:
          facets = this.splitWithNoNonTrivialIntersections();
          break;
      }

      return facets;
    }
  }, {
    key: 'splitWithTwoNonTrivialNonNullIntersections',
    value: function splitWithTwoNonTrivialNonNullIntersections(intersections) {
      var verticesLength = 3,
          nullIntersectionIndex = calculateNonNullIntersectionIndex(intersections),
          places = (verticesLength - nullIntersectionIndex) % verticesLength;

      intersections = permute(intersections, places);

      this.vertices = permute(this.vertices, places);

      var firstVertex = first(this.vertices),
          secondVertex = second(this.vertices),
          thirdVertex = third(this.vertices),
          nonNullIntersections = intersections.slice(1),
          firstNonNullIntersection = first(nonNullIntersections),
          secondNonNullIntersection = second(nonNullIntersections),
          firstIntermediateVertex = calculateIntermediateVertex(secondVertex, thirdVertex, firstNonNullIntersection),
          secondIntermediateVertex = calculateIntermediateVertex(thirdVertex, firstVertex, secondNonNullIntersection),
          firstVertices = [firstVertex, secondVertex, secondIntermediateVertex],
          secondVertices = [secondVertex, firstIntermediateVertex, secondIntermediateVertex],
          thirdVertices = [firstIntermediateVertex, thirdVertex, secondIntermediateVertex],
          firstFacet = Facet.fromVertices(firstVertices),
          secondFacet = Facet.fromVertices(secondVertices),
          thirdFacet = Facet.fromVertices(thirdVertices),
          facets = [firstFacet, secondFacet, thirdFacet];

      return facets;
    }
  }, {
    key: 'splitWithNoNonTrivialNonNullIntersections',
    value: function splitWithNoNonTrivialNonNullIntersections() {
      var facet = this,
          ///
      facets = [facet];

      return facets;
    }
  }, {
    key: 'splitWithTwoNonTrivialIntersections',
    value: function splitWithTwoNonTrivialIntersections(intersections) {
      var verticesLength = 3,
          trivialIntersectionIndex = calculateTrivialIntersectionIndex(intersections),
          places = (verticesLength - trivialIntersectionIndex) % verticesLength;

      intersections = permute(intersections, places);

      this.vertices = permute(this.vertices, places);

      var firstVertex = first(this.vertices),
          secondVertex = second(this.vertices),
          thirdVertex = third(this.vertices),
          nonTrivialIntersections = intersections.slice(1),
          firstNonTrivialIntersection = first(nonTrivialIntersections),
          secondNonTrivialIntersection = second(nonTrivialIntersections),
          firstIntermediateVertex = calculateIntermediateVertex(secondVertex, thirdVertex, firstNonTrivialIntersection),
          secondIntermediateVertex = calculateIntermediateVertex(thirdVertex, firstVertex, secondNonTrivialIntersection),
          firstVertices = [firstVertex, secondVertex, firstIntermediateVertex],
          secondVertices = [firstVertex, firstIntermediateVertex, secondIntermediateVertex],
          thirdVertices = [firstIntermediateVertex, thirdVertex, secondIntermediateVertex],
          firstFacetInXYPlane = Facet.fromVertices(firstVertices),
          secondFacetInXYPlane = Facet.fromVertices(secondVertices),
          thirdFacetInXYPlane = Facet.fromVertices(thirdVertices),
          facets = [firstFacetInXYPlane, secondFacetInXYPlane, thirdFacetInXYPlane];

      return facets;
    }
  }, {
    key: 'splitWithOneNonTrivialIntersection',
    value: function splitWithOneNonTrivialIntersection(intersections) {
      var verticesLength = 3,
          nonTrivialIntersectionIndex = calculateNonTrivialIntersectionIndex(intersections),
          places = (verticesLength - nonTrivialIntersectionIndex) % verticesLength;

      intersections = permute(intersections, places);

      this.vertices = permute(this.vertices, places);

      var firstVertex = first(this.vertices),
          secondVertex = second(this.vertices),
          thirdVertex = third(this.vertices),
          firstIntersection = first(intersections),
          nonTrivialIntersection = firstIntersection,
          ///
      intermediateVertex = calculateIntermediateVertex(firstVertex, secondVertex, nonTrivialIntersection),
          firstVertices = [firstVertex, intermediateVertex, thirdVertex],
          secondVertices = [intermediateVertex, secondVertex, thirdVertex],
          firstFacetInXYPlane = Facet.fromVertices(firstVertices),
          secondFacetInXYPlane = Facet.fromVertices(secondVertices),
          facets = [firstFacetInXYPlane, secondFacetInXYPlane];

      return facets;
    }
  }, {
    key: 'splitWithNoNonTrivialIntersections',
    value: function splitWithNoNonTrivialIntersections() {
      var facet = this,
          ///
      facets = [facet];

      return facets;
    }
  }, {
    key: 'calculateIntersectionsWithVerticalLineInXYPlane',
    value: function calculateIntersectionsWithVerticalLineInXYPlane(verticalLineInXYPlane) {
      var lines = this.getLines(),
          intersections = lines.map(function (line) {
        var intersection = line.calculateIntersectionWithVerticalLineInXYPlane(verticalLineInXYPlane);

        return intersection;
      });

      return intersections;
    }
  }], [{
    key: 'fromVertices',
    value: function fromVertices(vertices) {
      var normal = calculateNormal(vertices),
          facet = new Facet(vertices, normal);

      return facet;
    }
  }]);

  return Facet;
}();

module.exports = Facet;

function isIntersectionTrivial(intersection) {
  var intersectionNonTrivial = isIntersectionNonTrivial(intersection),
      intersectionTrivial = !intersectionNonTrivial;

  return intersectionTrivial;
}

function isIntersectionNonTrivial(intersection) {
  var intersectionNonTrivial = intersection > 0 && intersection < 1;

  return intersectionNonTrivial;
}

function calculateIntermediateVertex(startVertex, endVertex, nonNullIntersection) {
  var direction = subtract(endVertex, startVertex),
      offset = scale(direction, nonNullIntersection),
      intermediateVertex = add(startVertex, offset);

  return intermediateVertex;
}

function calculateNonNullIntersections(intersections) {
  var nonNullIntersections = intersections.reduce(function (nonNullIntersections, intersection) {
    var intersectionNonNull = intersection !== null;

    if (intersectionNonNull) {
      var nonNullIntersection = intersection; ///

      nonNullIntersections.push(nonNullIntersection);
    }

    return nonNullIntersections;
  }, []);

  return nonNullIntersections;
}

function calculateNonTrivialIntersections(intersections) {
  var nonTrivialIntersections = intersections.reduce(function (nonTrivialIntersections, intersection) {
    var intersectionNonTrivial = isIntersectionNonTrivial(intersection);

    if (intersectionNonTrivial) {
      var nonTrivialIntersection = intersection; ///

      nonTrivialIntersections.push(nonTrivialIntersection);
    }

    return nonTrivialIntersections;
  }, []);

  return nonTrivialIntersections;
}

function calculateNonNullIntersectionIndex(intersections) {
  var nullIntersectionIndex = intersections.indexOf(null);

  return nullIntersectionIndex;
}

function calculateTrivialIntersectionIndex(intersections) {
  var trivialIntersectionIndex = intersections.reduce(function (trivialIntersectionIndex, intersection, index) {
    if (trivialIntersectionIndex === null) {
      var intersectionNonTrivial = isIntersectionTrivial(intersection);

      if (intersectionNonTrivial) {
        trivialIntersectionIndex = index;
      }
    }

    return trivialIntersectionIndex;
  }, null);

  return trivialIntersectionIndex;
}

function calculateNonTrivialIntersectionIndex(intersections) {
  var nonTrivialIntersectionIndex = intersections.reduce(function (nonTrivialIntersectionIndex, intersection, index) {
    if (nonTrivialIntersectionIndex === null) {
      var intersectionNonTrivial = isIntersectionNonTrivial(intersection);

      if (intersectionNonTrivial) {
        nonTrivialIntersectionIndex = index;
      }
    }

    return nonTrivialIntersectionIndex;
  }, null);

  return nonTrivialIntersectionIndex;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9mYWNldC5qcyJdLCJuYW1lcyI6WyJMaW5lIiwicmVxdWlyZSIsInZlYzMiLCJhcnJheVV0aWxpdGllcyIsInZlcnRpY2VzVXRpbGl0aWVzIiwiYWRkIiwic3VidHJhY3QiLCJzY2FsZSIsInRyYW5zZm9ybSIsImZpcnN0Iiwic2Vjb25kIiwidGhpcmQiLCJwZXJtdXRlIiwiY2FsY3VsYXRlTm9ybWFsIiwicm90YXRlVmVydGljZXMiLCJGYWNldCIsInZlcnRpY2VzIiwibm9ybWFsIiwidmVydGljZXNMZW5ndGgiLCJsaW5lcyIsIm1hcCIsInZlcnRleCIsImluZGV4Iiwic3RhcnRJbmRleCIsImVuZEluZGV4Iiwic3RhcnRWZXJ0ZXgiLCJlbmRWZXJ0ZXgiLCJsaW5lIiwiZnJvbVZlcnRpY2VzIiwiYmluZCIsImxpbmVzSW5YWVBsYW5lIiwicm90YXRpb25RdWF0ZXJuaW9uIiwicm90YXRpb25BYm91dFpBeGlzTWF0cml4IiwibWF0MiIsInZlYyIsImludGVyc2VjdGlvbnMiLCJmYWNldHMiLCJub25OdWxsSW50ZXJzZWN0aW9ucyIsImNhbGN1bGF0ZU5vbk51bGxJbnRlcnNlY3Rpb25zIiwibm9uVHJpdmlhbE5vbk51bGxJbnRlcnNlY3Rpb25zIiwiY2FsY3VsYXRlTm9uVHJpdmlhbEludGVyc2VjdGlvbnMiLCJub25Ucml2aWFsTm9uTnVsbEludGVyc2VjdGlvbnNMZW5ndGgiLCJsZW5ndGgiLCJzcGxpdFdpdGhUd29Ob25Ucml2aWFsTm9uTnVsbEludGVyc2VjdGlvbnMiLCJzcGxpdFdpdGhOb05vblRyaXZpYWxOb25OdWxsSW50ZXJzZWN0aW9ucyIsIm5vblRyaXZpYWxJbnRlcnNlY3Rpb25zIiwibm9uVHJpdmlhbEludGVyc2VjdGlvbnNMZW5ndGgiLCJzcGxpdFdpdGhUd29Ob25Ucml2aWFsSW50ZXJzZWN0aW9ucyIsInNwbGl0V2l0aE9uZU5vblRyaXZpYWxJbnRlcnNlY3Rpb24iLCJzcGxpdFdpdGhOb05vblRyaXZpYWxJbnRlcnNlY3Rpb25zIiwibnVsbEludGVyc2VjdGlvbkluZGV4IiwiY2FsY3VsYXRlTm9uTnVsbEludGVyc2VjdGlvbkluZGV4IiwicGxhY2VzIiwiZmlyc3RWZXJ0ZXgiLCJzZWNvbmRWZXJ0ZXgiLCJ0aGlyZFZlcnRleCIsInNsaWNlIiwiZmlyc3ROb25OdWxsSW50ZXJzZWN0aW9uIiwic2Vjb25kTm9uTnVsbEludGVyc2VjdGlvbiIsImZpcnN0SW50ZXJtZWRpYXRlVmVydGV4IiwiY2FsY3VsYXRlSW50ZXJtZWRpYXRlVmVydGV4Iiwic2Vjb25kSW50ZXJtZWRpYXRlVmVydGV4IiwiZmlyc3RWZXJ0aWNlcyIsInNlY29uZFZlcnRpY2VzIiwidGhpcmRWZXJ0aWNlcyIsImZpcnN0RmFjZXQiLCJzZWNvbmRGYWNldCIsInRoaXJkRmFjZXQiLCJmYWNldCIsInRyaXZpYWxJbnRlcnNlY3Rpb25JbmRleCIsImNhbGN1bGF0ZVRyaXZpYWxJbnRlcnNlY3Rpb25JbmRleCIsImZpcnN0Tm9uVHJpdmlhbEludGVyc2VjdGlvbiIsInNlY29uZE5vblRyaXZpYWxJbnRlcnNlY3Rpb24iLCJmaXJzdEZhY2V0SW5YWVBsYW5lIiwic2Vjb25kRmFjZXRJblhZUGxhbmUiLCJ0aGlyZEZhY2V0SW5YWVBsYW5lIiwibm9uVHJpdmlhbEludGVyc2VjdGlvbkluZGV4IiwiY2FsY3VsYXRlTm9uVHJpdmlhbEludGVyc2VjdGlvbkluZGV4IiwiZmlyc3RJbnRlcnNlY3Rpb24iLCJub25Ucml2aWFsSW50ZXJzZWN0aW9uIiwiaW50ZXJtZWRpYXRlVmVydGV4IiwidmVydGljYWxMaW5lSW5YWVBsYW5lIiwiZ2V0TGluZXMiLCJpbnRlcnNlY3Rpb24iLCJjYWxjdWxhdGVJbnRlcnNlY3Rpb25XaXRoVmVydGljYWxMaW5lSW5YWVBsYW5lIiwibW9kdWxlIiwiZXhwb3J0cyIsImlzSW50ZXJzZWN0aW9uVHJpdmlhbCIsImludGVyc2VjdGlvbk5vblRyaXZpYWwiLCJpc0ludGVyc2VjdGlvbk5vblRyaXZpYWwiLCJpbnRlcnNlY3Rpb25Ucml2aWFsIiwibm9uTnVsbEludGVyc2VjdGlvbiIsImRpcmVjdGlvbiIsIm9mZnNldCIsInJlZHVjZSIsImludGVyc2VjdGlvbk5vbk51bGwiLCJwdXNoIiwiaW5kZXhPZiJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQUVBLElBQU1BLE9BQU9DLFFBQVEsUUFBUixDQUFiO0FBQUEsSUFDTUMsT0FBT0QsUUFBUSxjQUFSLENBRGI7QUFBQSxJQUVNRSxpQkFBaUJGLFFBQVEsbUJBQVIsQ0FGdkI7QUFBQSxJQUdNRyxvQkFBb0JILFFBQVEsc0JBQVIsQ0FIMUI7O0lBS1FJLEcsR0FBb0NILEksQ0FBcENHLEc7SUFBS0MsUSxHQUErQkosSSxDQUEvQkksUTtJQUFVQyxLLEdBQXFCTCxJLENBQXJCSyxLO0lBQU9DLFMsR0FBY04sSSxDQUFkTSxTO0lBQ3RCQyxLLEdBQWtDTixjLENBQWxDTSxLO0lBQU9DLE0sR0FBMkJQLGMsQ0FBM0JPLE07SUFBUUMsSyxHQUFtQlIsYyxDQUFuQlEsSztJQUFPQyxPLEdBQVlULGMsQ0FBWlMsTztJQUN0QkMsZSxHQUFvQ1QsaUIsQ0FBcENTLGU7SUFBaUJDLGMsR0FBbUJWLGlCLENBQW5CVSxjOztJQUVuQkMsSztBQUNKLGlCQUFZQyxRQUFaLEVBQXNCQyxNQUF0QixFQUE4QjtBQUFBOztBQUM1QixTQUFLRCxRQUFMLEdBQWdCQSxRQUFoQjtBQUNBLFNBQUtDLE1BQUwsR0FBY0EsTUFBZDtBQUNEOzs7O2tDQUVhO0FBQ1osYUFBTyxLQUFLRCxRQUFaO0FBQ0Q7OztnQ0FFVztBQUNWLGFBQU8sS0FBS0MsTUFBWjtBQUNEOzs7K0JBRVU7QUFDVCxVQUFNQyxpQkFBaUIsQ0FBdkI7QUFBQSxVQUEwQjtBQUNwQkMsY0FBUSxLQUFLSCxRQUFMLENBQWNJLEdBQWQsQ0FBa0IsVUFBU0MsTUFBVCxFQUFpQkMsS0FBakIsRUFBd0I7QUFDaEQsWUFBTUMsYUFBYUQsS0FBbkI7QUFBQSxZQUNNRSxXQUFXLENBQUNELGFBQWEsQ0FBZCxJQUFtQkwsY0FEcEM7QUFBQSxZQUVNTyxjQUFjLEtB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O0FBQ0QsR0FWZ0MsRUFVOUIsSUFWOEIsQ0FBakM7O0FBWUEsU0FBT0Esd0JBQVA7QUFDRDs7QUFFRCxTQUFTUSxvQ0FBVCxDQUE4QzFDLGFBQTlDLEVBQTZEO0FBQzNELE1BQU15Qyw4QkFBOEJ6QyxjQUFjMkQsTUFBZCxDQUFxQixVQUFTbEIsMkJBQVQsRUFBc0NPLFlBQXRDLEVBQW9EN0QsS0FBcEQsRUFBMkQ7QUFDbEgsUUFBSXNELGdDQUFnQyxJQUFwQyxFQUEwQztBQUN4QyxVQUFNWSx5QkFBeUJDLHlCQUF5Qk4sWUFBekIsQ0FBL0I7O0FBRUEsVUFBSUssc0JBQUosRUFBNEI7QUFDMUJaLHNDQUE4QnRELEtBQTlCO0FBQ0Q7QUFDRjs7QUFFRCxXQUFPc0QsMkJBQVA7QUFDRCxHQVZtQyxFQVVqQyxJQVZpQyxDQUFwQzs7QUFZQSxTQUFPQSwyQkFBUDtBQUNEIiwiZmlsZSI6ImZhY2V0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBMaW5lID0gcmVxdWlyZSgnLi9saW5lJyksXG4gICAgICB2ZWMzID0gcmVxdWlyZSgnLi9tYXRocy92ZWMzJyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL2FycmF5JyksXG4gICAgICB2ZXJ0aWNlc1V0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL3ZlcnRpY2VzJyk7XG5cbmNvbnN0IHsgYWRkLCBzdWJ0cmFjdCwgc2NhbGUsIHRyYW5zZm9ybSB9ID0gdmVjMyxcbiAgICAgIHsgZmlyc3QsIHNlY29uZCwgdGhpcmQsIHBlcm11dGUgfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBjYWxjdWxhdGVOb3JtYWwsIHJvdGF0ZVZlcnRpY2VzIH0gPSB2ZXJ0aWNlc1V0aWxpdGllcztcblxuY2xhc3MgRmFjZXQge1xuICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgbm9ybWFsKSB7XG4gICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzO1xuICAgIHRoaXMubm9ybWFsID0gbm9ybWFsO1xuICB9XG5cbiAgZ2V0VmVydGljZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMudmVydGljZXM7XG4gIH1cblxuICBnZXROb3JtYWwoKSB7XG4gICAgcmV0dXJuIHRoaXMubm9ybWFsO1xuICB9XG5cbiAgZ2V0TGluZXMoKSB7XG4gICAgY29uc3QgdmVydGljZXNMZW5ndGggPSAzLCAvLy9cbiAgICAgICAgICBsaW5lcyA9IHRoaXMudmVydGljZXMubWFwKGZ1bmN0aW9uKHZlcnRleCwgaW5kZXgpIHtcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0SW5kZXggPSBpbmRleCxcbiAgICAgICAgICAgICAgICAgIGVuZEluZGV4ID0gKHN0YXJ0SW5kZXggKyAxKSAlIHZlcnRpY2VzTGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgc3RhcnRWZXJ0ZXggPSB0aGlzLnZlcnRpY2VzW3N0YXJ0SW5kZXhdLFxuICAgICAgICAgICAgICAgICAgZW5kVmVydGV4ID0gdGhpcy52ZXJ0aWNlc1tlbmRJbmRleF0sXG4gICAgICAgICAgICAgICAgICBsaW5lID0gTGluZS5mcm9tVmVydGljZXMoc3RhcnRWZXJ0ZXgsIGVuZFZlcnRleCk7XG4gIFxuICAgICAgICAgICAgcmV0dXJuIGxpbmU7XG4gICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgIHJldHVybiBsaW5lcztcbiAgfVxuXG4gIGlzT3V0c2lkZUxpbmVzSW5YWVBsYW5lKGxpbmVzSW5YWVBsYW5lKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgXG4gIHJvdGF0ZShyb3RhdGlvblF1YXRlcm5pb24pIHtcbiAgICB0aGlzLnZlcnRpY2VzID0gcm90YXRlVmVydGljZXModGhpcy52ZXJ0aWNlcywgcm90YXRpb25RdWF0ZXJuaW9uKTtcbiAgICBcbiAgICB0aGlzLm5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCh0aGlzLnZlcnRpY2VzKTtcbiAgfVxuXG4gIHJvdGF0ZUFib3V0WkF4aXMocm90YXRpb25BYm91dFpBeGlzTWF0cml4KSB7XG4gICAgY29uc3QgbWF0MiA9IHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeDsgIC8vL1xuXG4gICAgdGhpcy52ZXJ0aWNlcyA9IHRoaXMudmVydGljZXMubWFwKGZ1bmN0aW9uKHZlcnRleCkge1xuICAgICAgbGV0IHZlYyA9IHZlcnRleDtcblxuICAgICAgdmVjID0gdHJhbnNmb3JtKHZlYywgbWF0Mik7XG5cbiAgICAgIHZlcnRleCA9IHZlYztcblxuICAgICAgcmV0dXJuIHZlcnRleDtcbiAgICB9KTtcblxuICAgIHRoaXMubm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHRoaXMudmVydGljZXMpO1xuICB9XG5cbiAgc3BsaXRXaXRoTnVsbEludGVyc2VjdGlvbihpbnRlcnNlY3Rpb25zKSB7XG4gICAgbGV0IGZhY2V0cztcblxuICAgIGNvbnN0IG5vbk51bGxJbnRlcnNlY3Rpb25zID0gY2FsY3VsYXRlTm9uTnVsbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgbm9uVHJpdmlhbE5vbk51bGxJbnRlcnNlY3Rpb25zID0gY2FsY3VsYXRlTm9uVHJpdmlhbEludGVyc2VjdGlvbnMobm9uTnVsbEludGVyc2VjdGlvbnMpLFxuICAgICAgICAgIG5vblRyaXZpYWxOb25OdWxsSW50ZXJzZWN0aW9uc0xlbmd0aCA9IG5vblRyaXZpYWxOb25OdWxsSW50ZXJzZWN0aW9ucy5sZW5ndGg7XG5cbiAgICBzd2l0Y2ggKG5vblRyaXZpYWxOb25OdWxsSW50ZXJzZWN0aW9uc0xlbmd0aCkge1xuICAgICAgY2FzZSAyIDpcbiAgICAgICAgZmFjZXRzID0gdGhpcy5zcGxpdFdpdGhUd29Ob25Ucml2aWFsTm9uTnVsbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0IDpcbiAgICAgICAgZmFjZXRzID0gdGhpcy5zcGxpdFdpdGhOb05vblRyaXZpYWxOb25OdWxsSW50ZXJzZWN0aW9ucygpO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gZmFjZXRzO1xuICB9XG5cbiAgc3BsaXRXaXRob3V0TnVsbEludGVyc2VjdGlvbihpbnRlcnNlY3Rpb25zKSB7XG4gICAgbGV0IGZhY2V0cztcblxuICAgIGNvbnN0IG5vblRyaXZpYWxJbnRlcnNlY3Rpb25zID0gY2FsY3VsYXRlTm9uVHJpdmlhbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgbm9uVHJpdmlhbEludGVyc2VjdGlvbnNMZW5ndGggPSBub25Ucml2aWFsSW50ZXJzZWN0aW9ucy5sZW5ndGg7XG5cbiAgICBzd2l0Y2gobm9uVHJpdmlhbEludGVyc2VjdGlvbnNMZW5ndGgpIHtcbiAgICAgIGNhc2UgMiA6XG4gICAgICAgIGZhY2V0cyA9IHRoaXMuc3BsaXRXaXRoVHdvTm9uVHJpdmlhbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIDEgOlxuICAgICAgICBmYWNldHMgPSB0aGlzLnNwbGl0V2l0aE9uZU5vblRyaXZpYWxJbnRlcnNlY3Rpb24oaW50ZXJzZWN0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0IDpcbiAgICAgICAgZmFjZXRzID0gdGhpcy5zcGxpdFdpdGhOb05vblRyaXZpYWxJbnRlcnNlY3Rpb25zKCk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHJldHVybiBmYWNldHM7XG4gIH1cblxuICBzcGxpdFdpdGhUd29Ob25Ucml2aWFsTm9uTnVsbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucykge1xuICAgIGNvbnN0IHZlcnRpY2VzTGVuZ3RoID0gMyxcbiAgICAgICAgICBudWxsSW50ZXJzZWN0aW9uSW5kZXggPSBjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9uSW5kZXgoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgcGxhY2VzID0gKHZlcnRpY2VzTGVuZ3RoIC0gbnVsbEludGVyc2VjdGlvbkluZGV4KSAlIHZlcnRpY2VzTGVuZ3RoO1xuXG4gICAgaW50ZXJzZWN0aW9ucyA9IHBlcm11dGUoaW50ZXJzZWN0aW9ucywgcGxhY2VzKTtcblxuICAgIHRoaXMudmVydGljZXMgPSBwZXJtdXRlKHRoaXMudmVydGljZXMsIHBsYWNlcyk7XG5cbiAgICBjb25zdCBmaXJzdFZlcnRleCA9IGZpcnN0KHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIHNlY29uZFZlcnRleCA9IHNlY29uZCh0aGlzLnZlcnRpY2VzKSxcbiAgICAgICAgICB0aGlyZFZlcnRleCA9IHRoaXJkKHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIG5vbk51bGxJbnRlcnNlY3Rpb25zID0gaW50ZXJzZWN0aW9ucy5zbGljZSgxKSxcbiAgICAgICAgICBmaXJzdE5vbk51bGxJbnRlcnNlY3Rpb24gPSBmaXJzdChub25OdWxsSW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgc2Vjb25kTm9uTnVsbEludGVyc2VjdGlvbiA9IHNlY29uZChub25OdWxsSW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgZmlyc3RJbnRlcm1lZGlhdGVWZXJ0ZXggPSBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgoc2Vjb25kVmVydGV4LCB0aGlyZFZlcnRleCwgZmlyc3ROb25OdWxsSW50ZXJzZWN0aW9uKSxcbiAgICAgICAgICBzZWNvbmRJbnRlcm1lZGlhdGVWZXJ0ZXggPSBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgodGhpcmRWZXJ0ZXgsIGZpcnN0VmVydGV4LCBzZWNvbmROb25OdWxsSW50ZXJzZWN0aW9uKSxcbiAgICAgICAgICBmaXJzdFZlcnRpY2VzID0gW1xuICAgICAgICAgICAgZmlyc3RWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRJbnRlcm1lZGlhdGVWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIHNlY29uZFZlcnRpY2VzID0gW1xuICAgICAgICAgICAgc2Vjb25kVmVydGV4LFxuICAgICAgICAgICAgZmlyc3RJbnRlcm1lZGlhdGVWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRJbnRlcm1lZGlhdGVWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIHRoaXJkVmVydGljZXMgPSBbXG4gICAgICAgICAgICBmaXJzdEludGVybWVkaWF0ZVZlcnRleCxcbiAgICAgICAgICAgIHRoaXJkVmVydGV4LFxuICAgICAgICAgICAgc2Vjb25kSW50ZXJtZWRpYXRlVmVydGV4XG4gICAgICAgICAgXSxcbiAgICAgICAgICBmaXJzdEZhY2V0ID0gRmFjZXQuZnJvbVZlcnRpY2VzKGZpcnN0VmVydGljZXMpLFxuICAgICAgICAgIHNlY29uZEZhY2V0ID0gRmFjZXQuZnJvbVZlcnRpY2VzKHNlY29uZFZlcnRpY2VzKSxcbiAgICAgICAgICB0aGlyZEZhY2V0ID0gRmFjZXQuZnJvbVZlcnRpY2VzKHRoaXJkVmVydGljZXMpLFxuICAgICAgICAgIGZhY2V0cyA9IFtcbiAgICAgICAgICAgIGZpcnN0RmFjZXQsXG4gICAgICAgICAgICBzZWNvbmRGYWNldCxcbiAgICAgICAgICAgIHRoaXJkRmFjZXRcbiAgICAgICAgICBdO1xuXG4gICAgcmV0dXJuIGZhY2V0cztcbiAgfVxuXG4gIHNwbGl0V2l0aE5vTm9uVHJpdmlhbE5vbk51bGxJbnRlcnNlY3Rpb25zKCkge1xuICAgIGNvbnN0IGZhY2V0ID0gdGhpcywgIC8vL1xuICAgICAgICBmYWNldHMgPSBbXG4gICAgICAgICAgZmFjZXRcbiAgICAgICAgXTtcblxuICAgIHJldHVybiBmYWNldHM7XG4gIH1cblxuICBzcGxpdFdpdGhUd29Ob25Ucml2aWFsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zKSB7XG4gICAgY29uc3QgdmVydGljZXNMZW5ndGggPSAzLFxuICAgICAgICAgIHRyaXZpYWxJbnRlcnNlY3Rpb25JbmRleCA9IGNhbGN1bGF0ZVRyaXZpYWxJbnRlcnNlY3Rpb25JbmRleChpbnRlcnNlY3Rpb25zKSxcbiAgICAgICAgICBwbGFjZXMgPSAodmVydGljZXNMZW5ndGggLSB0cml2aWFsSW50ZXJzZWN0aW9uSW5kZXgpICUgdmVydGljZXNMZW5ndGg7XG5cbiAgICBpbnRlcnNlY3Rpb25zID0gcGVybXV0ZShpbnRlcnNlY3Rpb25zLCBwbGFjZXMpO1xuXG4gICAgdGhpcy52ZXJ0aWNlcyA9IHBlcm11dGUodGhpcy52ZXJ0aWNlcywgcGxhY2VzKTtcblxuICAgIGNvbnN0IGZpcnN0VmVydGV4ID0gZmlyc3QodGhpcy52ZXJ0aWNlcyksXG4gICAgICAgICAgc2Vjb25kVmVydGV4ID0gc2Vjb25kKHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIHRoaXJkVmVydGV4ID0gdGhpcmQodGhpcy52ZXJ0aWNlcyksXG4gICAgICAgICAgbm9uVHJpdmlhbEludGVyc2VjdGlvbnMgPSBpbnRlcnNlY3Rpb25zLnNsaWNlKDEpLFxuICAgICAgICAgIGZpcnN0Tm9uVHJpdmlhbEludGVyc2VjdGlvbiA9IGZpcnN0KG5vblRyaXZpYWxJbnRlcnNlY3Rpb25zKSxcbiAgICAgICAgICBzZWNvbmROb25Ucml2aWFsSW50ZXJzZWN0aW9uID0gc2Vjb25kKG5vblRyaXZpYWxJbnRlcnNlY3Rpb25zKSxcbiAgICAgICAgICBmaXJzdEludGVybWVkaWF0ZVZlcnRleCA9IGNhbGN1bGF0ZUludGVybWVkaWF0ZVZlcnRleChzZWNvbmRWZXJ0ZXgsIHRoaXJkVmVydGV4LCBmaXJzdE5vblRyaXZpYWxJbnRlcnNlY3Rpb24pLFxuICAgICAgICAgIHNlY29uZEludGVybWVkaWF0ZVZlcnRleCA9IGNhbGN1bGF0ZUludGVybWVkaWF0ZVZlcnRleCh0aGlyZFZlcnRleCwgZmlyc3RWZXJ0ZXgsIHNlY29uZE5vblRyaXZpYWxJbnRlcnNlY3Rpb24pLFxuICAgICAgICAgIGZpcnN0VmVydGljZXMgPSBbXG4gICAgICAgICAgICBmaXJzdFZlcnRleCxcbiAgICAgICAgICAgIHNlY29uZFZlcnRleCxcbiAgICAgICAgICAgIGZpcnN0SW50ZXJtZWRpYXRlVmVydGV4XG4gICAgICAgICAgXSxcbiAgICAgICAgICBzZWNvbmRWZXJ0aWNlcyA9IFtcbiAgICAgICAgICAgIGZpcnN0VmVydGV4LFxuICAgICAgICAgICAgZmlyc3RJbnRlcm1lZGlhdGVWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRJbnRlcm1lZGlhdGVWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIHRoaXJkVmVydGljZXMgPSBbXG4gICAgICAgICAgICBmaXJzdEludGVybWVkaWF0ZVZlcnRleCxcbiAgICAgICAgICAgIHRoaXJkVmVydGV4LFxuICAgICAgICAgICAgc2Vjb25kSW50ZXJtZWRpYXRlVmVydGV4XG4gICAgICAgICAgXSxcbiAgICAgICAgICBmaXJzdEZhY2V0SW5YWVBsYW5lID0gRmFjZXQuZnJvbVZlcnRpY2VzKGZpcnN0VmVydGljZXMpLFxuICAgICAgICAgIHNlY29uZEZhY2V0SW5YWVBsYW5lID0gRmFjZXQuZnJvbVZlcnRpY2VzKHNlY29uZFZlcnRpY2VzKSxcbiAgICAgICAgICB0aGlyZEZhY2V0SW5YWVBsYW5lID0gRmFjZXQuZnJvbVZlcnRpY2VzKHRoaXJkVmVydGljZXMpLFxuICAgICAgICAgIGZhY2V0cyA9IFtcbiAgICAgICAgICAgIGZpcnN0RmFjZXRJblhZUGxhbmUsXG4gICAgICAgICAgICBzZWNvbmRGYWNldEluWFlQbGFuZSxcbiAgICAgICAgICAgIHRoaXJkRmFjZXRJblhZUGxhbmVcbiAgICAgICAgICBdO1xuXG4gICAgcmV0dXJuIGZhY2V0cztcbiAgfVxuXG4gIHNwbGl0V2l0aE9uZU5vblRyaXZpYWxJbnRlcnNlY3Rpb24oaW50ZXJzZWN0aW9ucykge1xuICAgIGNvbnN0IHZlcnRpY2VzTGVuZ3RoID0gMyxcbiAgICAgICAgICBub25Ucml2aWFsSW50ZXJzZWN0aW9uSW5kZXggPSBjYWxjdWxhdGVOb25Ucml2aWFsSW50ZXJzZWN0aW9uSW5kZXgoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgcGxhY2VzID0gKHZlcnRpY2VzTGVuZ3RoIC0gbm9uVHJpdmlhbEludGVyc2VjdGlvbkluZGV4KSAlIHZlcnRpY2VzTGVuZ3RoO1xuXG4gICAgaW50ZXJzZWN0aW9ucyA9IHBlcm11dGUoaW50ZXJzZWN0aW9ucywgcGxhY2VzKTtcblxuICAgIHRoaXMudmVydGljZXMgPSBwZXJtdXRlKHRoaXMudmVydGljZXMsIHBsYWNlcyk7XG5cbiAgICBjb25zdCBmaXJzdFZlcnRleCA9IGZpcnN0KHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIHNlY29uZFZlcnRleCA9IHNlY29uZCh0aGlzLnZlcnRpY2VzKSxcbiAgICAgICAgICB0aGlyZFZlcnRleCA9IHRoaXJkKHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIGZpcnN0SW50ZXJzZWN0aW9uID0gZmlyc3QoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgbm9uVHJpdmlhbEludGVyc2VjdGlvbiA9IGZpcnN0SW50ZXJzZWN0aW9uLCAvLy9cbiAgICAgICAgICBpbnRlcm1lZGlhdGVWZXJ0ZXggPSBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgoZmlyc3RWZXJ0ZXgsIHNlY29uZFZlcnRleCwgbm9uVHJpdmlhbEludGVyc2VjdGlvbiksXG4gICAgICAgICAgZmlyc3RWZXJ0aWNlcyA9IFtcbiAgICAgICAgICAgIGZpcnN0VmVydGV4LFxuICAgICAgICAgICAgaW50ZXJtZWRpYXRlVmVydGV4LFxuICAgICAgICAgICAgdGhpcmRWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIHNlY29uZFZlcnRpY2VzID0gW1xuICAgICAgICAgICAgaW50ZXJtZWRpYXRlVmVydGV4LFxuICAgICAgICAgICAgc2Vjb25kVmVydGV4LFxuICAgICAgICAgICAgdGhpcmRWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIGZpcnN0RmFjZXRJblhZUGxhbmUgPSBGYWNldC5mcm9tVmVydGljZXMoZmlyc3RWZXJ0aWNlcyksXG4gICAgICAgICAgc2Vjb25kRmFjZXRJblhZUGxhbmUgPSBGYWNldC5mcm9tVmVydGljZXMoc2Vjb25kVmVydGljZXMpLFxuICAgICAgICAgIGZhY2V0cyA9IFtcbiAgICAgICAgICAgIGZpcnN0RmFjZXRJblhZUGxhbmUsXG4gICAgICAgICAgICBzZWNvbmRGYWNldEluWFlQbGFuZVxuICAgICAgICAgIF07XG5cbiAgICByZXR1cm4gZmFjZXRzO1xuICB9XG5cbiAgc3BsaXRXaXRoTm9Ob25Ucml2aWFsSW50ZXJzZWN0aW9ucygpIHtcbiAgICBjb25zdCBmYWNldCA9IHRoaXMsICAvLy9cbiAgICAgICAgICBmYWNldHMgPSBbXG4gICAgICAgICAgICBmYWNldFxuICAgICAgICAgIF07XG5cbiAgICByZXR1cm4gZmFjZXRzO1xuICB9XG5cbiAgY2FsY3VsYXRlSW50ZXJzZWN0aW9uc1dpdGhWZXJ0aWNhbExpbmVJblhZUGxhbmUodmVydGljYWxMaW5lSW5YWVBsYW5lKSB7XG4gICAgY29uc3QgbGluZXMgPSB0aGlzLmdldExpbmVzKCksXG4gICAgICAgICAgaW50ZXJzZWN0aW9ucyA9IGxpbmVzLm1hcChmdW5jdGlvbihsaW5lKSB7XG4gICAgICAgICAgICBjb25zdCBpbnRlcnNlY3Rpb24gPSBsaW5lLmNhbGN1bGF0ZUludGVyc2VjdGlvbldpdGhWZXJ0aWNhbExpbmVJblhZUGxhbmUodmVydGljYWxMaW5lSW5YWVBsYW5lKTtcbiAgXG4gICAgICAgICAgICByZXR1cm4gaW50ZXJzZWN0aW9uO1xuICAgICAgICAgIH0pO1xuXG4gICAgcmV0dXJuIGludGVyc2VjdGlvbnM7XG4gIH1cblxuICBzdGF0aWMgZnJvbVZlcnRpY2VzKHZlcnRpY2VzKSB7XG4gICAgY29uc3Qgbm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHZlcnRpY2VzKSxcbiAgICAgICAgICBmYWNldCA9IG5ldyBGYWNldCh2ZXJ0aWNlcywgbm9ybWFsKTtcblxuICAgIHJldHVybiBmYWNldDtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEZhY2V0O1xuXG5mdW5jdGlvbiBpc0ludGVyc2VjdGlvblRyaXZpYWwoaW50ZXJzZWN0aW9uKSB7XG4gIGNvbnN0IGludGVyc2VjdGlvbk5vblRyaXZpYWwgPSBpc0ludGVyc2VjdGlvbk5vblRyaXZpYWwoaW50ZXJzZWN0aW9uKSxcbiAgICAgIGludGVyc2VjdGlvblRyaXZpYWwgPSAhaW50ZXJzZWN0aW9uTm9uVHJpdmlhbDtcblxuICByZXR1cm4gaW50ZXJzZWN0aW9uVHJpdmlhbDtcbn1cblxuZnVuY3Rpb24gaXNJbnRlcnNlY3Rpb25Ob25Ucml2aWFsKGludGVyc2VjdGlvbikge1xuICBjb25zdCBpbnRlcnNlY3Rpb25Ob25Ucml2aWFsID0gKChpbnRlcnNlY3Rpb24gPiAwKSAmJiAoaW50ZXJzZWN0aW9uIDwgMSkpO1xuXG4gIHJldHVybiBpbnRlcnNlY3Rpb25Ob25Ucml2aWFsO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgoc3RhcnRWZXJ0ZXgsIGVuZFZlcnRleCwgbm9uTnVsbEludGVyc2VjdGlvbikge1xuICBjb25zdCBkaXJlY3Rpb24gPSBzdWJ0cmFjdChlbmRWZXJ0ZXgsIHN0YXJ0VmVydGV4KSxcbiAgICAgIG9mZnNldCA9IHNjYWxlKGRpcmVjdGlvbiwgbm9uTnVsbEludGVyc2VjdGlvbiksXG4gICAgICBpbnRlcm1lZGlhdGVWZXJ0ZXggPSBhZGQoc3RhcnRWZXJ0ZXgsIG9mZnNldCk7XG5cbiAgcmV0dXJuIGludGVybWVkaWF0ZVZlcnRleDtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlTm9uTnVsbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucykge1xuICBjb25zdCBub25OdWxsSW50ZXJzZWN0aW9ucyA9IGludGVyc2VjdGlvbnMucmVkdWNlKGZ1bmN0aW9uKG5vbk51bGxJbnRlcnNlY3Rpb25zLCBpbnRlcnNlY3Rpb24pIHtcbiAgICBjb25zdCBpbnRlcnNlY3Rpb25Ob25OdWxsID0gKGludGVyc2VjdGlvbiAhPT0gbnVsbCk7XG5cbiAgICBpZiAoaW50ZXJzZWN0aW9uTm9uTnVsbCkge1xuICAgICAgY29uc3Qgbm9uTnVsbEludGVyc2VjdGlvbiA9IGludGVyc2VjdGlvbjsgLy8vXG5cbiAgICAgIG5vbk51bGxJbnRlcnNlY3Rpb25zLnB1c2gobm9uTnVsbEludGVyc2VjdGlvbik7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5vbk51bGxJbnRlcnNlY3Rpb25zO1xuICB9LCBbXSk7XG5cbiAgcmV0dXJuIG5vbk51bGxJbnRlcnNlY3Rpb25zO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVOb25Ucml2aWFsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zKSB7XG4gIGNvbnN0IG5vblRyaXZpYWxJbnRlcnNlY3Rpb25zID0gaW50ZXJzZWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24obm9uVHJpdmlhbEludGVyc2VjdGlvbnMsIGludGVyc2VjdGlvbikge1xuICAgIGNvbnN0IGludGVyc2VjdGlvbk5vblRyaXZpYWwgPSBpc0ludGVyc2VjdGlvbk5vblRyaXZpYWwoaW50ZXJzZWN0aW9uKTtcblxuICAgIGlmIChpbnRlcnNlY3Rpb25Ob25Ucml2aWFsKSB7XG4gICAgICBjb25zdCBub25Ucml2aWFsSW50ZXJzZWN0aW9uID0gaW50ZXJzZWN0aW9uOyAgLy8vXG5cbiAgICAgIG5vblRyaXZpYWxJbnRlcnNlY3Rpb25zLnB1c2gobm9uVHJpdmlhbEludGVyc2VjdGlvbik7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5vblRyaXZpYWxJbnRlcnNlY3Rpb25zO1xuICB9LCBbXSk7XG5cbiAgcmV0dXJuIG5vblRyaXZpYWxJbnRlcnNlY3Rpb25zO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9uSW5kZXgoaW50ZXJzZWN0aW9ucykge1xuICBjb25zdCBudWxsSW50ZXJzZWN0aW9uSW5kZXggPSBpbnRlcnNlY3Rpb25zLmluZGV4T2YobnVsbCk7XG5cbiAgcmV0dXJuIG51bGxJbnRlcnNlY3Rpb25JbmRleDtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVHJpdmlhbEludGVyc2VjdGlvbkluZGV4KGludGVyc2VjdGlvbnMpIHtcbiAgY29uc3QgdHJpdmlhbEludGVyc2VjdGlvbkluZGV4ID0gaW50ZXJzZWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24odHJpdmlhbEludGVyc2VjdGlvbkluZGV4LCBpbnRlcnNlY3Rpb24sIGluZGV4KSB7XG4gICAgaWYgKHRyaXZpYWxJbnRlcnNlY3Rpb25JbmRleCA9PT0gbnVsbCkge1xuICAgICAgY29uc3QgaW50ZXJzZWN0aW9uTm9uVHJpdmlhbCA9IGlzSW50ZXJzZWN0aW9uVHJpdmlhbChpbnRlcnNlY3Rpb24pO1xuXG4gICAgICBpZiAoaW50ZXJzZWN0aW9uTm9uVHJpdmlhbCkge1xuICAgICAgICB0cml2aWFsSW50ZXJzZWN0aW9uSW5kZXggPSBpbmRleDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdHJpdmlhbEludGVyc2VjdGlvbkluZGV4O1xuICB9LCBudWxsKTtcblxuICByZXR1cm4gdHJpdmlhbEludGVyc2VjdGlvbkluZGV4O1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVOb25Ucml2aWFsSW50ZXJzZWN0aW9uSW5kZXgoaW50ZXJzZWN0aW9ucykge1xuICBjb25zdCBub25Ucml2aWFsSW50ZXJzZWN0aW9uSW5kZXggPSBpbnRlcnNlY3Rpb25zLnJlZHVjZShmdW5jdGlvbihub25Ucml2aWFsSW50ZXJzZWN0aW9uSW5kZXgsIGludGVyc2VjdGlvbiwgaW5kZXgpIHtcbiAgICBpZiAobm9uVHJpdmlhbEludGVyc2VjdGlvbkluZGV4ID09PSBudWxsKSB7XG4gICAgICBjb25zdCBpbnRlcnNlY3Rpb25Ob25Ucml2aWFsID0gaXNJbnRlcnNlY3Rpb25Ob25Ucml2aWFsKGludGVyc2VjdGlvbik7XG5cbiAgICAgIGlmIChpbnRlcnNlY3Rpb25Ob25Ucml2aWFsKSB7XG4gICAgICAgIG5vblRyaXZpYWxJbnRlcnNlY3Rpb25JbmRleCA9IGluZGV4O1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBub25Ucml2aWFsSW50ZXJzZWN0aW9uSW5kZXg7XG4gIH0sIG51bGwpO1xuXG4gIHJldHVybiBub25Ucml2aWFsSW50ZXJzZWN0aW9uSW5kZXg7XG59XG4iXX0=