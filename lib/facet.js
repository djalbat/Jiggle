'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Edge = require('./facet/edge'),
    arrayUtilities = require('./utilities/array'),
    vectorUtilities = require('./utilities/vector'),
    vertexUtilities = require('./utilities/vertex'),
    verticesUtilities = require('./utilities/vertices'),
    approximateUtilities = require('./utilities/approximate');

var _rotateAboutZAxis = vertexUtilities.rotateAboutZAxis,
    isApproximatelyEqualToZero = approximateUtilities.isApproximatelyEqualToZero,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    permute = arrayUtilities.permute,
    calculateNormal = verticesUtilities.calculateNormal,
    rotateVertices = verticesUtilities.rotateVertices,
    add3 = vectorUtilities.add3,
    subtract3 = vectorUtilities.subtract3,
    scale3 = vectorUtilities.scale3,
    length3 = vectorUtilities.length3;

var Facet = function () {
  function Facet(vertices, normal) {
    _classCallCheck(this, Facet);

    this.vertices = vertices;
    this.normal = normal;
  }

  _createClass(Facet, [{
    key: 'getVertices',
    value: function getVertices() {
      return this.vertices;
    }
  }, {
    key: 'getNormal',
    value: function getNormal() {
      return this.normal;
    }
  }, {
    key: 'getEdges',
    value: function getEdges() {
      var verticesLength = 3,
          ///
      edges = this.vertices.map(function (vertex, index) {
        var startIndex = index,
            endIndex = (startIndex + 1) % verticesLength,
            startVertex = this.vertices[startIndex],
            endVertex = this.vertices[endIndex],
            edge = Edge.fromVertices(startVertex, endVertex);

        return edge;
      }.bind(this));

      return edges;
    }
  }, {
    key: 'getMidPoint',
    value: function getMidPoint() {
      var midPoint = this.vertices.reduce(function (midPoint, vertex) {
        var scaledVertex = scale3(vertex, 1 / 3);

        midPoint = add3(midPoint, scaledVertex);

        return midPoint;
      }, [0, 0, 0]);

      return midPoint;
    }
  }, {
    key: 'isTooSmall',
    value: function isTooSmall() {
      var normalLength = length3(this.normal),
          normalLengthApproximatelyEqualToZero = isApproximatelyEqualToZero(normalLength),
          tooSmall = normalLengthApproximatelyEqualToZero; ///

      return tooSmall;
    }
  }, {
    key: 'isMasked',
    value: function isMasked(maskingFacet) {
      var edgesInXYPlane = maskingFacet.getEdgesInXYPlane(),
          midPoint = this.getMidPoint(),
          midPointToOneSideOfEdgesInXYPlane = isMidPointToOneSideOfEdgesInXYPlane(midPoint, edgesInXYPlane),
          masked = midPointToOneSideOfEdgesInXYPlane; ///

      return masked;
    }
  }, {
    key: 'applyTransforms',
    value: function applyTransforms(transforms) {
      this.vertices = this.vertices.map(function (vertex) {
        transforms.forEach(function (transform) {
          vertex = transform(vertex);
        });

        return vertex;
      });

      this.normal = calculateNormal(this.vertices);
    }
  }, {
    key: 'rotate',
    value: function rotate(rotationQuaternion) {
      this.vertices = rotateVertices(this.vertices, rotationQuaternion);

      this.normal = calculateNormal(this.vertices);
    }
  }, {
    key: 'rotateAboutZAxis',
    value: function rotateAboutZAxis(rotationAboutZAxisMatrix) {
      this.vertices = this.vertices.map(function (vertex) {
        vertex = _rotateAboutZAxis(vertex, rotationAboutZAxisMatrix);

        return vertex;
      });

      this.normal = calculateNormal(this.vertices);
    }
  }, {
    key: 'split',
    value: function split(intersections, smallerFacets) {
      var nonNullIntersections = calculateNonNullIntersections(intersections),
          nonNullIntersectionsLength = nonNullIntersections.length;

      switch (nonNullIntersectionsLength) {
        case 2:
          this.splitWithTwoNonNullIntersections(intersections, smallerFacets);
          break;

        case 1:
          this.splitWithOneNonNullIntersection(intersections, smallerFacets);
          break;

        default:
          var smallerFacet = this; ///

          smallerFacets.push(smallerFacet);
          break;
      }
    }
  }, {
    key: 'splitWithTwoNonNullIntersections',
    value: function splitWithTwoNonNullIntersections(intersections, smallerFacets) {
      var verticesLength = 3,
          nullIntersectionIndex = calculateNullIntersectionIndex(intersections),
          places = (verticesLength - nullIntersectionIndex) % verticesLength;

      intersections = permute(intersections, places);

      intersections = intersections.slice(1); ///

      this.vertices = permute(this.vertices, places);

      var firstVertex = first(this.vertices),
          secondVertex = second(this.vertices),
          thirdVertex = third(this.vertices),
          firstIntersection = first(intersections),
          secondIntersection = second(intersections),
          firstIntermediateVertex = calculateIntermediateVertex(secondVertex, thirdVertex, firstIntersection),
          secondIntermediateVertex = calculateIntermediateVertex(thirdVertex, firstVertex, secondIntersection),
          firstVertices = [firstVertex, secondVertex, firstIntermediateVertex],
          secondVertices = [firstIntermediateVertex, secondIntermediateVertex, firstVertex],
          thirdVertices = [firstIntermediateVertex, thirdVertex, secondIntermediateVertex],
          firstFacet = Facet.fromVertices(firstVertices),
          secondFacet = Facet.fromVertices(secondVertices),
          thirdFacet = Facet.fromVertices(thirdVertices),
          firstFacetTooSmall = firstFacet.isTooSmall(),
          secondFacetTooSmall = secondFacet.isTooSmall(),
          thirdFacetTooSmall = thirdFacet.isTooSmall();

      if (!firstFacetTooSmall) {
        smallerFacets.push(firstFacet);
      }

      if (!secondFacetTooSmall) {
        smallerFacets.push(secondFacet);
      }

      if (!thirdFacetTooSmall) {
        smallerFacets.push(thirdFacet);
      }
    }
  }, {
    key: 'splitWithOneNonNullIntersection',
    value: function splitWithOneNonNullIntersection(intersections, smallerFacets) {
      var verticesLength = 3,
          nonNullIntersectionIndex = calculateNonNullIntersectionIndex(intersections),
          places = (verticesLength - nonNullIntersectionIndex) % verticesLength;

      intersections = permute(intersections, places);

      this.vertices = permute(this.vertices, places);

      var firstVertex = first(this.vertices),
          secondVertex = second(this.vertices),
          thirdVertex = third(this.vertices),
          firstIntersection = first(intersections),
          intermediateVertex = calculateIntermediateVertex(firstVertex, secondVertex, firstIntersection),
          firstVertices = [firstVertex, intermediateVertex, thirdVertex],
          secondVertices = [intermediateVertex, secondVertex, thirdVertex],
          firstFacet = Facet.fromVertices(firstVertices),
          secondFacet = Facet.fromVertices(secondVertices),
          firstFacetTooSmall = firstFacet.isTooSmall(),
          secondFacetTooSmall = secondFacet.isTooSmall();

      if (!firstFacetTooSmall) {
        smallerFacets.push(firstFacet);
      }

      if (!secondFacetTooSmall) {
        smallerFacets.push(secondFacet);
      }
    }
  }, {
    key: 'calculateIntersectionsWithVerticalLineInXYPlane',
    value: function calculateIntersectionsWithVerticalLineInXYPlane(verticalLineInXYPlane) {
      var edges = this.getEdges(),
          intersections = edges.map(function (edge) {
        var intersection = edge.calculateIntersectionWithVerticalLineInXYPlane(verticalLineInXYPlane);

        return intersection;
      });

      return intersections;
    }
  }, {
    key: 'clone',
    value: function clone() {
      var vertices = this.vertices.map(function (vertex) {
        return vertex.slice();
      }),
          normal = this.normal.slice(),
          facet = new Facet(vertices, normal);

      return facet;
    }
  }], [{
    key: 'fromVertices',
    value: function fromVertices(vertices) {
      var normal = calculateNormal(vertices),
          facet = new Facet(vertices, normal);

      return facet;
    }
  }, {
    key: 'fromVerticesAndIndexes',
    value: function fromVerticesAndIndexes(vertices, indexes) {
      vertices = indexes.map(function (index) {
        var vertex = vertices[index];

        return vertex;
      });

      var facet = Facet.fromVertices(vertices);

      return facet;
    }
  }]);

  return Facet;
}();

module.exports = Facet;

function calculateIntermediateVertex(startVertex, endVertex, intersection) {
  var direction = subtract3(endVertex, startVertex),
      offset = scale3(direction, intersection),
      intermediateVertex = add3(startVertex, offset);

  return intermediateVertex;
}

function calculateNonNullIntersections(intersections) {
  var nonNullIntersections = intersections.reduce(function (nonNullIntersections, intersection) {
    if (intersection !== null) {
      var nonNullIntersection = intersection; ///

      nonNullIntersections.push(nonNullIntersection);
    }

    return nonNullIntersections;
  }, []);

  return nonNullIntersections;
}

function calculateNullIntersectionIndex(intersections) {
  var nullIntersectionIndex = intersections.reduce(function (nullIntersectionIndex, intersection, index) {
    if (nullIntersectionIndex === null) {
      if (intersection === null) {
        nullIntersectionIndex = index;
      }
    }

    return nullIntersectionIndex;
  }, null);

  return nullIntersectionIndex;
}

function calculateNonNullIntersectionIndex(intersections) {
  var nullIntersectionIndex = intersections.reduce(function (nullIntersectionIndex, intersection, index) {
    if (nullIntersectionIndex === null) {
      if (intersection !== null) {
        nullIntersectionIndex = index;
      }
    }

    return nullIntersectionIndex;
  }, null);

  return nullIntersectionIndex;
}

function isMidPointToOneSideOfEdgesInXYPlane(midPoint, edgesInXYPlane) {
  var midPointToTheLeftOfEdgesInXYPlane = isMidPointToTheLeftOfEdgesInXYPlane(midPoint, edgesInXYPlane),
      midPointToTheRightOfEdgesInXYPlane = isMidPointToTheRightOfEdgesInXYPlane(midPoint, edgesInXYPlane),
      midPointToOneSideOfEdgesInXYPlane = midPointToTheLeftOfEdgesInXYPlane || midPointToTheRightOfEdgesInXYPlane; ///

  return midPointToOneSideOfEdgesInXYPlane;
}

function isMidPointToTheLeftOfEdgesInXYPlane(midPoint, edgesInXYPlane) {
  var midPointToTheLeftOfEdgesInXYPlane = edgesInXYPlane.reduce(function (midPointToTheLeftOfEdgesInXYPlane, edgeInXYPlane) {
    if (midPointToTheLeftOfEdgesInXYPlane) {
      var midPointToTheLeftOfEdgeInXYPlane = edgeInXYPlane.isMidPointToTheLeft(midPoint);

      midPointToTheLeftOfEdgesInXYPlane = midPointToTheLeftOfEdgeInXYPlane;
    }

    return midPointToTheLeftOfEdgesInXYPlane;
  }, true);

  return midPointToTheLeftOfEdgesInXYPlane;
}

function isMidPointToTheRightOfEdgesInXYPlane(midPoint, edgesInXYPlane) {
  var midPointToTheRightOfEdgesInXYPlane = edgesInXYPlane.reduce(function (midPointToTheRightOfEdgesInXYPlane, edgeInXYPlane) {
    if (midPointToTheRightOfEdgesInXYPlane) {
      var midPointToTheRightOfEdgeInXYPlane = edgeInXYPlane.isMidPointToTheRight(midPoint);

      midPointToTheRightOfEdgesInXYPlane = midPointToTheRightOfEdgeInXYPlane;
    }

    return midPointToTheRightOfEdgesInXYPlane;
  }, true);

  return midPointToTheRightOfEdgesInXYPlane;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9mYWNldC5qcyJdLCJuYW1lcyI6WyJFZGdlIiwicmVxdWlyZSIsImFycmF5VXRpbGl0aWVzIiwidmVjdG9yVXRpbGl0aWVzIiwidmVydGV4VXRpbGl0aWVzIiwidmVydGljZXNVdGlsaXRpZXMiLCJhcHByb3hpbWF0ZVV0aWxpdGllcyIsInJvdGF0ZUFib3V0WkF4aXMiLCJpc0FwcHJveGltYXRlbHlFcXVhbFRvWmVybyIsImZpcnN0Iiwic2Vjb25kIiwidGhpcmQiLCJwZXJtdXRlIiwiY2FsY3VsYXRlTm9ybWFsIiwicm90YXRlVmVydGljZXMiLCJhZGQzIiwic3VidHJhY3QzIiwic2NhbGUzIiwibGVuZ3RoMyIsIkZhY2V0IiwidmVydGljZXMiLCJub3JtYWwiLCJ2ZXJ0aWNlc0xlbmd0aCIsImVkZ2VzIiwibWFwIiwidmVydGV4IiwiaW5kZXgiLCJzdGFydEluZGV4IiwiZW5kSW5kZXgiLCJzdGFydFZlcnRleCIsImVuZFZlcnRleCIsImVkZ2UiLCJmcm9tVmVydGljZXMiLCJiaW5kIiwibWlkUG9pbnQiLCJyZWR1Y2UiLCJzY2FsZWRWZXJ0ZXgiLCJub3JtYWxMZW5ndGgiLCJub3JtYWxMZW5ndGhBcHByb3hpbWF0ZWx5RXF1YWxUb1plcm8iLCJ0b29TbWFsbCIsIm1hc2tpbmdGYWNldCIsImVkZ2VzSW5YWVBsYW5lIiwiZ2V0RWRnZXNJblhZUGxhbmUiLCJnZXRNaWRQb2ludCIsIm1pZFBvaW50VG9PbmVTaWRlT2ZFZGdlc0luWFlQbGFuZSIsImlzTWlkUG9pbnRUb09uZVNpZGVPZkVkZ2VzSW5YWVBsYW5lIiwibWFza2VkIiwidHJhbnNmb3JtcyIsImZvckVhY2giLCJ0cmFuc2Zvcm0iLCJyb3RhdGlvblF1YXRlcm5pb24iLCJyb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgiLCJpbnRlcnNlY3Rpb25zIiwic21hbGxlckZhY2V0cyIsIm5vbk51bGxJbnRlcnNlY3Rpb25zIiwiY2FsY3VsYXRlTm9uTnVsbEludGVyc2VjdGlvbnMiLCJub25OdWxsSW50ZXJzZWN0aW9uc0xlbmd0aCIsImxlbmd0aCIsInNwbGl0V2l0aFR3b05vbk51bGxJbnRlcnNlY3Rpb25zIiwic3BsaXRXaXRoT25lTm9uTnVsbEludGVyc2VjdGlvbiIsInNtYWxsZXJGYWNldCIsInB1c2giLCJudWxsSW50ZXJzZWN0aW9uSW5kZXgiLCJjYWxjdWxhdGVOdWxsSW50ZXJzZWN0aW9uSW5kZXgiLCJwbGFjZXMiLCJzbGljZSIsImZpcnN0VmVydGV4Iiwic2Vjb25kVmVydGV4IiwidGhpcmRWZXJ0ZXgiLCJmaXJzdEludGVyc2VjdGlvbiIsInNlY29uZEludGVyc2VjdGlvbiIsImZpcnN0SW50ZXJtZWRpYXRlVmVydGV4IiwiY2FsY3VsYXRlSW50ZXJtZWRpYXRlVmVydGV4Iiwic2Vjb25kSW50ZXJtZWRpYXRlVmVydGV4IiwiZmlyc3RWZXJ0aWNlcyIsInNlY29uZFZlcnRpY2VzIiwidGhpcmRWZXJ0aWNlcyIsImZpcnN0RmFjZXQiLCJzZWNvbmRGYWNldCIsInRoaXJkRmFjZXQiLCJmaXJzdEZhY2V0VG9vU21hbGwiLCJpc1Rvb1NtYWxsIiwic2Vjb25kRmFjZXRUb29TbWFsbCIsInRoaXJkRmFjZXRUb29TbWFsbCIsIm5vbk51bGxJbnRlcnNlY3Rpb25JbmRleCIsImNhbGN1bGF0ZU5vbk51bGxJbnRlcnNlY3Rpb25JbmRleCIsImludGVybWVkaWF0ZVZlcnRleCIsInZlcnRpY2FsTGluZUluWFlQbGFuZSIsImdldEVkZ2VzIiwiaW50ZXJzZWN0aW9uIiwiY2FsY3VsYXRlSW50ZXJzZWN0aW9uV2l0aFZlcnRpY2FsTGluZUluWFlQbGFuZSIsImZhY2V0IiwiaW5kZXhlcyIsIm1vZHVsZSIsImV4cG9ydHMiLCJkaXJlY3Rpb24iLCJvZmZzZXQiLCJub25OdWxsSW50ZXJzZWN0aW9uIiwibWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VzSW5YWVBsYW5lIiwiaXNNaWRQb2ludFRvVGhlTGVmdE9mRWRnZXNJblhZUGxhbmUiLCJtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lIiwiaXNNaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lIiwiZWRnZUluWFlQbGFuZSIsIm1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlSW5YWVBsYW5lIiwiaXNNaWRQb2ludFRvVGhlTGVmdCIsIm1pZFBvaW50VG9UaGVSaWdodE9mRWRnZUluWFlQbGFuZSIsImlzTWlkUG9pbnRUb1RoZVJpZ2h0Il0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FBRUEsSUFBTUEsT0FBT0MsUUFBUSxjQUFSLENBQWI7QUFBQSxJQUNNQyxpQkFBaUJELFFBQVEsbUJBQVIsQ0FEdkI7QUFBQSxJQUVNRSxrQkFBa0JGLFFBQVEsb0JBQVIsQ0FGeEI7QUFBQSxJQUdNRyxrQkFBa0JILFFBQVEsb0JBQVIsQ0FIeEI7QUFBQSxJQUlNSSxvQkFBb0JKLFFBQVEsc0JBQVIsQ0FKMUI7QUFBQSxJQUtNSyx1QkFBdUJMLFFBQVEseUJBQVIsQ0FMN0I7O0FBT00sSUFBRU0saUJBQUYsR0FBdUJILGVBQXZCLENBQUVHLGdCQUFGO0FBQUEsSUFDRUMsMEJBREYsR0FDaUNGLG9CQURqQyxDQUNFRSwwQkFERjtBQUFBLElBRUVDLEtBRkYsR0FFb0NQLGNBRnBDLENBRUVPLEtBRkY7QUFBQSxJQUVTQyxNQUZULEdBRW9DUixjQUZwQyxDQUVTUSxNQUZUO0FBQUEsSUFFaUJDLEtBRmpCLEdBRW9DVCxjQUZwQyxDQUVpQlMsS0FGakI7QUFBQSxJQUV3QkMsT0FGeEIsR0FFb0NWLGNBRnBDLENBRXdCVSxPQUZ4QjtBQUFBLElBR0VDLGVBSEYsR0FHc0NSLGlCQUh0QyxDQUdFUSxlQUhGO0FBQUEsSUFHbUJDLGNBSG5CLEdBR3NDVCxpQkFIdEMsQ0FHbUJTLGNBSG5CO0FBQUEsSUFJRUMsSUFKRixHQUl1Q1osZUFKdkMsQ0FJRVksSUFKRjtBQUFBLElBSVFDLFNBSlIsR0FJdUNiLGVBSnZDLENBSVFhLFNBSlI7QUFBQSxJQUltQkMsTUFKbkIsR0FJdUNkLGVBSnZDLENBSW1CYyxNQUpuQjtBQUFBLElBSTJCQyxPQUozQixHQUl1Q2Ys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Iiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBFZGdlID0gcmVxdWlyZSgnLi9mYWNldC9lZGdlJyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL2FycmF5JyksXG4gICAgICB2ZWN0b3JVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy92ZWN0b3InKSxcbiAgICAgIHZlcnRleFV0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL3ZlcnRleCcpLFxuICAgICAgdmVydGljZXNVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy92ZXJ0aWNlcycpLFxuICAgICAgYXBwcm94aW1hdGVVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy9hcHByb3hpbWF0ZScpO1xuXG5jb25zdCB7IHJvdGF0ZUFib3V0WkF4aXMgfSA9IHZlcnRleFV0aWxpdGllcyxcbiAgICAgIHsgaXNBcHByb3hpbWF0ZWx5RXF1YWxUb1plcm8gfSA9IGFwcHJveGltYXRlVXRpbGl0aWVzLFxuICAgICAgeyBmaXJzdCwgc2Vjb25kLCB0aGlyZCwgcGVybXV0ZSB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IGNhbGN1bGF0ZU5vcm1hbCwgcm90YXRlVmVydGljZXMgfSA9IHZlcnRpY2VzVXRpbGl0aWVzLFxuICAgICAgeyBhZGQzLCBzdWJ0cmFjdDMsIHNjYWxlMywgbGVuZ3RoMyB9ID0gdmVjdG9yVXRpbGl0aWVzO1xuXG5jbGFzcyBGYWNldCB7XG4gIGNvbnN0cnVjdG9yKHZlcnRpY2VzLCBub3JtYWwpIHtcbiAgICB0aGlzLnZlcnRpY2VzID0gdmVydGljZXM7XG4gICAgdGhpcy5ub3JtYWwgPSBub3JtYWw7XG4gIH1cblxuICBnZXRWZXJ0aWNlcygpIHtcbiAgICByZXR1cm4gdGhpcy52ZXJ0aWNlcztcbiAgfVxuXG4gIGdldE5vcm1hbCgpIHtcbiAgICByZXR1cm4gdGhpcy5ub3JtYWw7XG4gIH1cblxuICBnZXRFZGdlcygpIHtcbiAgICBjb25zdCB2ZXJ0aWNlc0xlbmd0aCA9IDMsIC8vL1xuICAgICAgICAgIGVkZ2VzID0gdGhpcy52ZXJ0aWNlcy5tYXAoZnVuY3Rpb24odmVydGV4LCBpbmRleCkge1xuICAgICAgICAgICAgY29uc3Qgc3RhcnRJbmRleCA9IGluZGV4LFxuICAgICAgICAgICAgICAgICAgZW5kSW5kZXggPSAoc3RhcnRJbmRleCArIDEpICUgdmVydGljZXNMZW5ndGgsXG4gICAgICAgICAgICAgICAgICBzdGFydFZlcnRleCA9IHRoaXMudmVydGljZXNbc3RhcnRJbmRleF0sXG4gICAgICAgICAgICAgICAgICBlbmRWZXJ0ZXggPSB0aGlzLnZlcnRpY2VzW2VuZEluZGV4XSxcbiAgICAgICAgICAgICAgICAgIGVkZ2UgPSBFZGdlLmZyb21WZXJ0aWNlcyhzdGFydFZlcnRleCwgZW5kVmVydGV4KTtcbiAgXG4gICAgICAgICAgICByZXR1cm4gZWRnZTtcbiAgICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgcmV0dXJuIGVkZ2VzO1xuICB9XG4gIFxuICBnZXRNaWRQb2ludCgpIHtcbiAgICBjb25zdCBtaWRQb2ludCA9IHRoaXMudmVydGljZXMucmVkdWNlKGZ1bmN0aW9uKG1pZFBvaW50LCB2ZXJ0ZXgpIHtcbiAgICAgIGNvbnN0IHNjYWxlZFZlcnRleCA9IHNjYWxlMyh2ZXJ0ZXgsIDEvMyk7XG4gICAgICBcbiAgICAgIG1pZFBvaW50ID0gYWRkMyhtaWRQb2ludCwgc2NhbGVkVmVydGV4KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIG1pZFBvaW50O1xuICAgIH0sIFsgMCwgMCwgMCBdKTtcbiAgICBcbiAgICByZXR1cm4gbWlkUG9pbnQ7XG4gIH1cbiAgXG4gIGlzVG9vU21hbGwoKSB7XG4gICAgY29uc3Qgbm9ybWFsTGVuZ3RoID0gbGVuZ3RoMyh0aGlzLm5vcm1hbCksXG4gICAgICAgICAgbm9ybWFsTGVuZ3RoQXBwcm94aW1hdGVseUVxdWFsVG9aZXJvID0gaXNBcHByb3hpbWF0ZWx5RXF1YWxUb1plcm8obm9ybWFsTGVuZ3RoKSxcbiAgICAgICAgICB0b29TbWFsbCA9IG5vcm1hbExlbmd0aEFwcHJveGltYXRlbHlFcXVhbFRvWmVybzsgIC8vL1xuICAgIFxuICAgIHJldHVybiB0b29TbWFsbDtcbiAgfVxuICBcbiAgaXNNYXNrZWQobWFza2luZ0ZhY2V0KSB7XG4gICAgY29uc3QgZWRnZXNJblhZUGxhbmUgPSBtYXNraW5nRmFjZXQuZ2V0RWRnZXNJblhZUGxhbmUoKSxcbiAgICAgICAgICBtaWRQb2ludCA9IHRoaXMuZ2V0TWlkUG9pbnQoKSxcbiAgICAgICAgICBtaWRQb2ludFRvT25lU2lkZU9mRWRnZXNJblhZUGxhbmUgPSBpc01pZFBvaW50VG9PbmVTaWRlT2ZFZGdlc0luWFlQbGFuZShtaWRQb2ludCwgZWRnZXNJblhZUGxhbmUpLFxuICAgICAgICAgIG1hc2tlZCA9IG1pZFBvaW50VG9PbmVTaWRlT2ZFZGdlc0luWFlQbGFuZTsgIC8vL1xuICAgIFxuICAgIHJldHVybiBtYXNrZWQ7XG4gIH1cbiAgXG4gIGFwcGx5VHJhbnNmb3Jtcyh0cmFuc2Zvcm1zKSB7XG4gICAgdGhpcy52ZXJ0aWNlcyA9IHRoaXMudmVydGljZXMubWFwKGZ1bmN0aW9uKHZlcnRleCkge1xuICAgICAgdHJhbnNmb3Jtcy5mb3JFYWNoKGZ1bmN0aW9uKHRyYW5zZm9ybSkge1xuICAgICAgICB2ZXJ0ZXggPSB0cmFuc2Zvcm0odmVydGV4KTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdmVydGV4O1xuICAgIH0pO1xuXG4gICAgdGhpcy5ub3JtYWwgPSBjYWxjdWxhdGVOb3JtYWwodGhpcy52ZXJ0aWNlcyk7XG4gIH1cbiAgXG4gIHJvdGF0ZShyb3RhdGlvblF1YXRlcm5pb24pIHtcbiAgICB0aGlzLnZlcnRpY2VzID0gcm90YXRlVmVydGljZXModGhpcy52ZXJ0aWNlcywgcm90YXRpb25RdWF0ZXJuaW9uKTtcbiAgICBcbiAgICB0aGlzLm5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCh0aGlzLnZlcnRpY2VzKTtcbiAgfVxuXG4gIHJvdGF0ZUFib3V0WkF4aXMocm90YXRpb25BYm91dFpBeGlzTWF0cml4KSB7XG4gICAgdGhpcy52ZXJ0aWNlcyA9IHRoaXMudmVydGljZXMubWFwKGZ1bmN0aW9uKHZlcnRleCkge1xuICAgICAgdmVydGV4ID0gcm90YXRlQWJvdXRaQXhpcyh2ZXJ0ZXgsIHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCk7XG5cbiAgICAgIHJldHVybiB2ZXJ0ZXg7XG4gICAgfSk7XG5cbiAgICB0aGlzLm5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCh0aGlzLnZlcnRpY2VzKTtcbiAgfVxuICBcbiAgc3BsaXQoaW50ZXJzZWN0aW9ucywgc21hbGxlckZhY2V0cykge1xuICAgIGNvbnN0IG5vbk51bGxJbnRlcnNlY3Rpb25zID0gY2FsY3VsYXRlTm9uTnVsbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgbm9uTnVsbEludGVyc2VjdGlvbnNMZW5ndGggPSBub25OdWxsSW50ZXJzZWN0aW9ucy5sZW5ndGg7XG5cbiAgICBzd2l0Y2ggKG5vbk51bGxJbnRlcnNlY3Rpb25zTGVuZ3RoKSB7XG4gICAgICBjYXNlIDIgOlxuICAgICAgICB0aGlzLnNwbGl0V2l0aFR3b05vbk51bGxJbnRlcnNlY3Rpb25zKGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAxIDpcbiAgICAgICAgdGhpcy5zcGxpdFdpdGhPbmVOb25OdWxsSW50ZXJzZWN0aW9uKGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMpO1xuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdCA6XG4gICAgICAgIGNvbnN0IHNtYWxsZXJGYWNldCA9IHRoaXM7ICAvLy9cblxuICAgICAgICBzbWFsbGVyRmFjZXRzLnB1c2goc21hbGxlckZhY2V0KTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgc3BsaXRXaXRoVHdvTm9uTnVsbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucywgc21hbGxlckZhY2V0cykge1xuICAgIGNvbnN0IHZlcnRpY2VzTGVuZ3RoID0gMyxcbiAgICAgICAgICBudWxsSW50ZXJzZWN0aW9uSW5kZXggPSBjYWxjdWxhdGVOdWxsSW50ZXJzZWN0aW9uSW5kZXgoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgcGxhY2VzID0gKHZlcnRpY2VzTGVuZ3RoIC0gbnVsbEludGVyc2VjdGlvbkluZGV4KSAlIHZlcnRpY2VzTGVuZ3RoO1xuXG4gICAgaW50ZXJzZWN0aW9ucyA9IHBlcm11dGUoaW50ZXJzZWN0aW9ucywgcGxhY2VzKTtcblxuICAgIGludGVyc2VjdGlvbnMgPSBpbnRlcnNlY3Rpb25zLnNsaWNlKDEpOyAvLy9cblxuICAgIHRoaXMudmVydGljZXMgPSBwZXJtdXRlKHRoaXMudmVydGljZXMsIHBsYWNlcyk7XG5cbiAgICBjb25zdCBmaXJzdFZlcnRleCA9IGZpcnN0KHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIHNlY29uZFZlcnRleCA9IHNlY29uZCh0aGlzLnZlcnRpY2VzKSxcbiAgICAgICAgICB0aGlyZFZlcnRleCA9IHRoaXJkKHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIGZpcnN0SW50ZXJzZWN0aW9uID0gZmlyc3QoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgc2Vjb25kSW50ZXJzZWN0aW9uID0gc2Vjb25kKGludGVyc2VjdGlvbnMpLFxuICAgICAgICAgIGZpcnN0SW50ZXJtZWRpYXRlVmVydGV4ID0gY2FsY3VsYXRlSW50ZXJtZWRpYXRlVmVydGV4KHNlY29uZFZlcnRleCwgdGhpcmRWZXJ0ZXgsIGZpcnN0SW50ZXJzZWN0aW9uKSxcbiAgICAgICAgICBzZWNvbmRJbnRlcm1lZGlhdGVWZXJ0ZXggPSBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgodGhpcmRWZXJ0ZXgsIGZpcnN0VmVydGV4LCBzZWNvbmRJbnRlcnNlY3Rpb24pLFxuICAgICAgICAgIGZpcnN0VmVydGljZXMgPSBbXG4gICAgICAgICAgICBmaXJzdFZlcnRleCxcbiAgICAgICAgICAgIHNlY29uZFZlcnRleCxcbiAgICAgICAgICAgIGZpcnN0SW50ZXJtZWRpYXRlVmVydGV4XG4gICAgICAgICAgXSxcbiAgICAgICAgICBzZWNvbmRWZXJ0aWNlcyA9IFtcbiAgICAgICAgICAgIGZpcnN0SW50ZXJtZWRpYXRlVmVydGV4LFxuICAgICAgICAgICAgc2Vjb25kSW50ZXJtZWRpYXRlVmVydGV4LFxuICAgICAgICAgICAgZmlyc3RWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIHRoaXJkVmVydGljZXMgPSBbXG4gICAgICAgICAgICBmaXJzdEludGVybWVkaWF0ZVZlcnRleCxcbiAgICAgICAgICAgIHRoaXJkVmVydGV4LFxuICAgICAgICAgICAgc2Vjb25kSW50ZXJtZWRpYXRlVmVydGV4XG4gICAgICAgICAgXSxcbiAgICAgICAgICBmaXJzdEZhY2V0ID0gRmFjZXQuZnJvbVZlcnRpY2VzKGZpcnN0VmVydGljZXMpLFxuICAgICAgICAgIHNlY29uZEZhY2V0ID0gRmFjZXQuZnJvbVZlcnRpY2VzKHNlY29uZFZlcnRpY2VzKSxcbiAgICAgICAgICB0aGlyZEZhY2V0ID0gRmFjZXQuZnJvbVZlcnRpY2VzKHRoaXJkVmVydGljZXMpLFxuICAgICAgICAgIGZpcnN0RmFjZXRUb29TbWFsbCA9IGZpcnN0RmFjZXQuaXNUb29TbWFsbCgpLFxuICAgICAgICAgIHNlY29uZEZhY2V0VG9vU21hbGwgPSBzZWNvbmRGYWNldC5pc1Rvb1NtYWxsKCksXG4gICAgICAgICAgdGhpcmRGYWNldFRvb1NtYWxsID0gdGhpcmRGYWNldC5pc1Rvb1NtYWxsKCk7XG5cbiAgICBpZiAoIWZpcnN0RmFjZXRUb29TbWFsbCkge1xuICAgICAgc21hbGxlckZhY2V0cy5wdXNoKGZpcnN0RmFjZXQpO1xuICAgIH1cblxuICAgIGlmICghc2Vjb25kRmFjZXRUb29TbWFsbCkge1xuICAgICAgc21hbGxlckZhY2V0cy5wdXNoKHNlY29uZEZhY2V0KTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXJkRmFjZXRUb29TbWFsbCkge1xuICAgICAgc21hbGxlckZhY2V0cy5wdXNoKHRoaXJkRmFjZXQpO1xuICAgIH1cbiAgfVxuXG4gIHNwbGl0V2l0aE9uZU5vbk51bGxJbnRlcnNlY3Rpb24oaW50ZXJzZWN0aW9ucywgc21hbGxlckZhY2V0cykge1xuICAgIGNvbnN0IHZlcnRpY2VzTGVuZ3RoID0gMyxcbiAgICAgICAgICBub25OdWxsSW50ZXJzZWN0aW9uSW5kZXggPSBjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9uSW5kZXgoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgcGxhY2VzID0gKHZlcnRpY2VzTGVuZ3RoIC0gbm9uTnVsbEludGVyc2VjdGlvbkluZGV4KSAlIHZlcnRpY2VzTGVuZ3RoO1xuXG4gICAgaW50ZXJzZWN0aW9ucyA9IHBlcm11dGUoaW50ZXJzZWN0aW9ucywgcGxhY2VzKTtcblxuICAgIHRoaXMudmVydGljZXMgPSBwZXJtdXRlKHRoaXMudmVydGljZXMsIHBsYWNlcyk7XG5cbiAgICBjb25zdCBmaXJzdFZlcnRleCA9IGZpcnN0KHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIHNlY29uZFZlcnRleCA9IHNlY29uZCh0aGlzLnZlcnRpY2VzKSxcbiAgICAgICAgICB0aGlyZFZlcnRleCA9IHRoaXJkKHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIGZpcnN0SW50ZXJzZWN0aW9uID0gZmlyc3QoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgaW50ZXJtZWRpYXRlVmVydGV4ID0gY2FsY3VsYXRlSW50ZXJtZWRpYXRlVmVydGV4KGZpcnN0VmVydGV4LCBzZWNvbmRWZXJ0ZXgsIGZpcnN0SW50ZXJzZWN0aW9uKSxcbiAgICAgICAgICBmaXJzdFZlcnRpY2VzID0gW1xuICAgICAgICAgICAgZmlyc3RWZXJ0ZXgsXG4gICAgICAgICAgICBpbnRlcm1lZGlhdGVWZXJ0ZXgsXG4gICAgICAgICAgICB0aGlyZFZlcnRleFxuICAgICAgICAgIF0sXG4gICAgICAgICAgc2Vjb25kVmVydGljZXMgPSBbXG4gICAgICAgICAgICBpbnRlcm1lZGlhdGVWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRWZXJ0ZXgsXG4gICAgICAgICAgICB0aGlyZFZlcnRleFxuICAgICAgICAgIF0sXG4gICAgICAgICAgZmlyc3RGYWNldCA9IEZhY2V0LmZyb21WZXJ0aWNlcyhmaXJzdFZlcnRpY2VzKSxcbiAgICAgICAgICBzZWNvbmRGYWNldCA9IEZhY2V0LmZyb21WZXJ0aWNlcyhzZWNvbmRWZXJ0aWNlcyksXG4gICAgICAgICAgZmlyc3RGYWNldFRvb1NtYWxsID0gZmlyc3RGYWNldC5pc1Rvb1NtYWxsKCksXG4gICAgICAgICAgc2Vjb25kRmFjZXRUb29TbWFsbCA9IHNlY29uZEZhY2V0LmlzVG9vU21hbGwoKTtcblxuICAgIGlmICghZmlyc3RGYWNldFRvb1NtYWxsKSB7XG4gICAgICBzbWFsbGVyRmFjZXRzLnB1c2goZmlyc3RGYWNldCk7XG4gICAgfVxuXG4gICAgaWYgKCFzZWNvbmRGYWNldFRvb1NtYWxsKSB7XG4gICAgICBzbWFsbGVyRmFjZXRzLnB1c2goc2Vjb25kRmFjZXQpO1xuICAgIH1cbiAgfVxuXG4gIGNhbGN1bGF0ZUludGVyc2VjdGlvbnNXaXRoVmVydGljYWxMaW5lSW5YWVBsYW5lKHZlcnRpY2FsTGluZUluWFlQbGFuZSkge1xuICAgIGNvbnN0IGVkZ2VzID0gdGhpcy5nZXRFZGdlcygpLFxuICAgICAgICAgIGludGVyc2VjdGlvbnMgPSBlZGdlcy5tYXAoZnVuY3Rpb24oZWRnZSkge1xuICAgICAgICAgICAgY29uc3QgaW50ZXJzZWN0aW9uID0gZWRnZS5jYWxjdWxhdGVJbnRlcnNlY3Rpb25XaXRoVmVydGljYWxMaW5lSW5YWVBsYW5lKHZlcnRpY2FsTGluZUluWFlQbGFuZSk7XG4gIFxuICAgICAgICAgICAgcmV0dXJuIGludGVyc2VjdGlvbjtcbiAgICAgICAgICB9KTtcblxuICAgIHJldHVybiBpbnRlcnNlY3Rpb25zO1xuICB9XG5cbiAgY2xvbmUoKSB7XG4gICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzLm1hcChmdW5jdGlvbih2ZXJ0ZXgpIHtcbiAgICAgICAgICAgIHJldHVybiB2ZXJ0ZXguc2xpY2UoKTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBub3JtYWwgPSB0aGlzLm5vcm1hbC5zbGljZSgpLFxuICAgICAgICAgIGZhY2V0ID0gbmV3IEZhY2V0KHZlcnRpY2VzLCBub3JtYWwpO1xuXG4gICAgcmV0dXJuIGZhY2V0O1xuICB9XG5cbiAgc3RhdGljIGZyb21WZXJ0aWNlcyh2ZXJ0aWNlcykge1xuICAgIGNvbnN0IG5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCh2ZXJ0aWNlcyksXG4gICAgICAgICAgZmFjZXQgPSBuZXcgRmFjZXQodmVydGljZXMsIG5vcm1hbCk7XG5cbiAgICByZXR1cm4gZmFjZXQ7XG4gIH1cblxuICBzdGF0aWMgZnJvbVZlcnRpY2VzQW5kSW5kZXhlcyh2ZXJ0aWNlcywgaW5kZXhlcykge1xuICAgIHZlcnRpY2VzID0gaW5kZXhlcy5tYXAoZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgIGNvbnN0IHZlcnRleCA9IHZlcnRpY2VzW2luZGV4XTtcblxuICAgICAgcmV0dXJuIHZlcnRleDtcbiAgICB9KTtcblxuICAgIGNvbnN0IGZhY2V0ID0gRmFjZXQuZnJvbVZlcnRpY2VzKHZlcnRpY2VzKTtcblxuICAgIHJldHVybiBmYWNldDtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEZhY2V0O1xuXG5mdW5jdGlvbiBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgoc3RhcnRWZXJ0ZXgsIGVuZFZlcnRleCwgaW50ZXJzZWN0aW9uKSB7XG4gIGNvbnN0IGRpcmVjdGlvbiA9IHN1YnRyYWN0MyhlbmRWZXJ0ZXgsIHN0YXJ0VmVydGV4KSxcbiAgICAgICAgb2Zmc2V0ID0gc2NhbGUzKGRpcmVjdGlvbiwgaW50ZXJzZWN0aW9uKSxcbiAgICAgICAgaW50ZXJtZWRpYXRlVmVydGV4ID0gYWRkMyhzdGFydFZlcnRleCwgb2Zmc2V0KTtcblxuICByZXR1cm4gaW50ZXJtZWRpYXRlVmVydGV4O1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zKSB7XG4gIGNvbnN0IG5vbk51bGxJbnRlcnNlY3Rpb25zID0gaW50ZXJzZWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24obm9uTnVsbEludGVyc2VjdGlvbnMsIGludGVyc2VjdGlvbikge1xuICAgIGlmIChpbnRlcnNlY3Rpb24gIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IG5vbk51bGxJbnRlcnNlY3Rpb24gPSBpbnRlcnNlY3Rpb247IC8vL1xuXG4gICAgICBub25OdWxsSW50ZXJzZWN0aW9ucy5wdXNoKG5vbk51bGxJbnRlcnNlY3Rpb24pO1xuICAgIH1cblxuICAgIHJldHVybiBub25OdWxsSW50ZXJzZWN0aW9ucztcbiAgfSwgW10pO1xuXG4gIHJldHVybiBub25OdWxsSW50ZXJzZWN0aW9ucztcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlTnVsbEludGVyc2VjdGlvbkluZGV4KGludGVyc2VjdGlvbnMpIHtcbiAgY29uc3QgbnVsbEludGVyc2VjdGlvbkluZGV4ID0gaW50ZXJzZWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24obnVsbEludGVyc2VjdGlvbkluZGV4LCBpbnRlcnNlY3Rpb24sIGluZGV4KSB7XG4gICAgaWYgKG51bGxJbnRlcnNlY3Rpb25JbmRleCA9PT0gbnVsbCkge1xuICAgICAgaWYgKGludGVyc2VjdGlvbiA9PT0gbnVsbCkge1xuICAgICAgICBudWxsSW50ZXJzZWN0aW9uSW5kZXggPSBpbmRleDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbEludGVyc2VjdGlvbkluZGV4O1xuICB9LCBudWxsKTtcblxuICByZXR1cm4gbnVsbEludGVyc2VjdGlvbkluZGV4O1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9uSW5kZXgoaW50ZXJzZWN0aW9ucykge1xuICBjb25zdCBudWxsSW50ZXJzZWN0aW9uSW5kZXggPSBpbnRlcnNlY3Rpb25zLnJlZHVjZShmdW5jdGlvbihudWxsSW50ZXJzZWN0aW9uSW5kZXgsIGludGVyc2VjdGlvbiwgaW5kZXgpIHtcbiAgICBpZiAobnVsbEludGVyc2VjdGlvbkluZGV4ID09PSBudWxsKSB7XG4gICAgICBpZiAoaW50ZXJzZWN0aW9uICE9PSBudWxsKSB7XG4gICAgICAgIG51bGxJbnRlcnNlY3Rpb25JbmRleCA9IGluZGV4O1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBudWxsSW50ZXJzZWN0aW9uSW5kZXg7XG4gIH0sIG51bGwpO1xuXG4gIHJldHVybiBudWxsSW50ZXJzZWN0aW9uSW5kZXg7XG59XG5cbmZ1bmN0aW9uIGlzTWlkUG9pbnRUb09uZVNpZGVPZkVkZ2VzSW5YWVBsYW5lKG1pZFBvaW50LCBlZGdlc0luWFlQbGFuZSkge1xuICBjb25zdCBtaWRQb2ludFRvVGhlTGVmdE9mRWRnZXNJblhZUGxhbmUgPSBpc01pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZShtaWRQb2ludCwgZWRnZXNJblhZUGxhbmUpLFxuICAgICAgICBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lID0gaXNNaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lKG1pZFBvaW50LCBlZGdlc0luWFlQbGFuZSksXG4gICAgICAgIG1pZFBvaW50VG9PbmVTaWRlT2ZFZGdlc0luWFlQbGFuZSA9IG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZSB8fCBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lOyAvLy9cblxuICByZXR1cm4gbWlkUG9pbnRUb09uZVNpZGVPZkVkZ2VzSW5YWVBsYW5lO1xufVxuXG5mdW5jdGlvbiBpc01pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZShtaWRQb2ludCwgZWRnZXNJblhZUGxhbmUpIHtcbiAgY29uc3QgbWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VzSW5YWVBsYW5lID0gZWRnZXNJblhZUGxhbmUucmVkdWNlKGZ1bmN0aW9uKG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZSwgZWRnZUluWFlQbGFuZSkge1xuICAgIGlmIChtaWRQb2ludFRvVGhlTGVmdE9mRWRnZXNJblhZUGxhbmUpIHtcbiAgICAgIGNvbnN0IG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlSW5YWVBsYW5lID0gZWRnZUluWFlQbGFuZS5pc01pZFBvaW50VG9UaGVMZWZ0KG1pZFBvaW50KTtcblxuICAgICAgbWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VzSW5YWVBsYW5lID0gbWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VJblhZUGxhbmU7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZTtcbiAgfSwgdHJ1ZSk7XG5cbiAgcmV0dXJuIG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZTtcbn1cblxuZnVuY3Rpb24gaXNNaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lKG1pZFBvaW50LCBlZGdlc0luWFlQbGFuZSkge1xuICBjb25zdCBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lID0gZWRnZXNJblhZUGxhbmUucmVkdWNlKGZ1bmN0aW9uKG1pZFBvaW50VG9UaGVSaWdodE9mRWRnZXNJblhZUGxhbmUsIGVkZ2VJblhZUGxhbmUpIHtcbiAgICBpZiAobWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlc0luWFlQbGFuZSkge1xuICAgICAgY29uc3QgbWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlSW5YWVBsYW5lID0gZWRnZUluWFlQbGFuZS5pc01pZFBvaW50VG9UaGVSaWdodChtaWRQb2ludCk7XG5cbiAgICAgIG1pZFBvaW50VG9UaGVSaWdodE9mRWRnZXNJblhZUGxhbmUgPSBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VJblhZUGxhbmU7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1pZFBvaW50VG9UaGVSaWdodE9mRWRnZXNJblhZUGxhbmU7XG4gIH0sIHRydWUpO1xuXG4gIHJldHVybiBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lO1xufVxuIl19