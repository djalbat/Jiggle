'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Edge = require('./facet/edge'),
    constants = require('./constants'),
    arrayUtilities = require('./utilities/array'),
    vectorUtilities = require('./utilities/vector'),
    vertexUtilities = require('./utilities/vertex'),
    verticesUtilities = require('./utilities/vertices'),
    approximateUtilities = require('./utilities/approximate');

var VERTICES_LENGTH = constants.VERTICES_LENGTH,
    _rotateAboutZAxis = vertexUtilities.rotateAboutZAxis,
    isApproximatelyEqualToZero = approximateUtilities.isApproximatelyEqualToZero,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    permute = arrayUtilities.permute,
    calculateNormal = verticesUtilities.calculateNormal,
    rotateVertices = verticesUtilities.rotateVertices,
    add3 = vectorUtilities.add3,
    subtract3 = vectorUtilities.subtract3,
    scale3 = vectorUtilities.scale3,
    length3 = vectorUtilities.length3;

var Facet = function () {
  function Facet(vertices, textureCoordinates, normal) {
    _classCallCheck(this, Facet);

    this.vertices = vertices;
    this.normal = normal;
  }

  _createClass(Facet, [{
    key: 'getVertices',
    value: function getVertices() {
      return this.vertices;
    }
  }, {
    key: 'getNormal',
    value: function getNormal() {
      return this.normal;
    }
  }, {
    key: 'getEdges',
    value: function getEdges() {
      var edges = this.vertices.map(function (vertex, index) {
        var startIndex = index,
            endIndex = (startIndex + 1) % VERTICES_LENGTH,
            startVertex = this.vertices[startIndex],
            endVertex = this.vertices[endIndex],
            edge = Edge.fromVertices(startVertex, endVertex);

        return edge;
      }.bind(this));

      return edges;
    }
  }, {
    key: 'getMidPoint',
    value: function getMidPoint() {
      var midPoint = this.vertices.reduce(function (midPoint, vertex) {
        var scaledVertex = scale3(vertex, 1 / 3);

        midPoint = add3(midPoint, scaledVertex);

        return midPoint;
      }, [0, 0, 0]);

      return midPoint;
    }
  }, {
    key: 'isTooSmall',
    value: function isTooSmall() {
      var normalLength = length3(this.normal),
          normalLengthApproximatelyEqualToZero = isApproximatelyEqualToZero(normalLength),
          tooSmall = normalLengthApproximatelyEqualToZero; ///

      return tooSmall;
    }
  }, {
    key: 'isMasked',
    value: function isMasked(maskingFacet) {
      var edgesInXYPlane = maskingFacet.getEdgesInXYPlane(),
          midPoint = this.getMidPoint(),
          midPointToOneSideOfEdgesInXYPlane = isMidPointToOneSideOfEdgesInXYPlane(midPoint, edgesInXYPlane),
          masked = midPointToOneSideOfEdgesInXYPlane; ///

      return masked;
    }
  }, {
    key: 'applyTransforms',
    value: function applyTransforms(transforms) {
      this.vertices = this.vertices.map(function (vertex) {
        transforms.forEach(function (transform) {
          vertex = transform(vertex);
        });

        return vertex;
      });

      this.normal = calculateNormal(this.vertices);
    }
  }, {
    key: 'rotate',
    value: function rotate(rotationQuaternion) {
      this.vertices = rotateVertices(this.vertices, rotationQuaternion);

      this.normal = calculateNormal(this.vertices);
    }
  }, {
    key: 'rotateAboutZAxis',
    value: function rotateAboutZAxis(rotationAboutZAxisMatrix) {
      this.vertices = this.vertices.map(function (vertex) {
        vertex = _rotateAboutZAxis(vertex, rotationAboutZAxisMatrix);

        return vertex;
      });

      this.normal = calculateNormal(this.vertices);
    }
  }, {
    key: 'split',
    value: function split(intersections, smallerFacets) {
      var nonNullIntersections = calculateNonNullIntersections(intersections),
          nonNullIntersectionsLength = nonNullIntersections.length;

      switch (nonNullIntersectionsLength) {
        case 2:
          this.splitWithTwoNonNullIntersections(intersections, smallerFacets);
          break;

        case 1:
          this.splitWithOneNonNullIntersection(intersections, smallerFacets);
          break;

        case 0:
          this.splitWithZeroNonNullIntersections(intersections, smallerFacets);
          break;
      }
    }
  }, {
    key: 'splitWithTwoNonNullIntersections',
    value: function splitWithTwoNonNullIntersections(intersections, smallerFacets) {
      var nullIntersectionIndex = calculateNullIntersectionIndex(intersections),
          places = (VERTICES_LENGTH - nullIntersectionIndex) % VERTICES_LENGTH;

      intersections = permute(intersections, places);

      intersections = intersections.slice(1); ///

      this.vertices = permute(this.vertices, places);

      var firstVertex = first(this.vertices),
          secondVertex = second(this.vertices),
          thirdVertex = third(this.vertices),
          firstIntersection = first(intersections),
          secondIntersection = second(intersections),
          firstIntermediateVertex = calculateIntermediateVertex(secondVertex, thirdVertex, firstIntersection),
          secondIntermediateVertex = calculateIntermediateVertex(thirdVertex, firstVertex, secondIntersection),
          firstVertices = [firstVertex, secondVertex, firstIntermediateVertex],
          secondVertices = [firstIntermediateVertex, secondIntermediateVertex, firstVertex],
          thirdVertices = [firstIntermediateVertex, thirdVertex, secondIntermediateVertex],
          firstFacet = Facet.fromVertices(firstVertices),
          secondFacet = Facet.fromVertices(secondVertices),
          thirdFacet = Facet.fromVertices(thirdVertices),
          firstFacetTooSmall = firstFacet.isTooSmall(),
          secondFacetTooSmall = secondFacet.isTooSmall(),
          thirdFacetTooSmall = thirdFacet.isTooSmall();

      if (!firstFacetTooSmall) {
        smallerFacets.push(firstFacet);
      }

      if (!secondFacetTooSmall) {
        smallerFacets.push(secondFacet);
      }

      if (!thirdFacetTooSmall) {
        smallerFacets.push(thirdFacet);
      }
    }
  }, {
    key: 'splitWithOneNonNullIntersection',
    value: function splitWithOneNonNullIntersection(intersections, smallerFacets) {
      var nonNullIntersectionIndex = calculateNonNullIntersectionIndex(intersections),
          places = (VERTICES_LENGTH - nonNullIntersectionIndex) % VERTICES_LENGTH;

      intersections = permute(intersections, places);

      this.vertices = permute(this.vertices, places);

      var firstVertex = first(this.vertices),
          secondVertex = second(this.vertices),
          thirdVertex = third(this.vertices),
          firstIntersection = first(intersections),
          intermediateVertex = calculateIntermediateVertex(firstVertex, secondVertex, firstIntersection),
          firstVertices = [firstVertex, intermediateVertex, thirdVertex],
          secondVertices = [intermediateVertex, secondVertex, thirdVertex],
          firstFacet = Facet.fromVertices(firstVertices),
          secondFacet = Facet.fromVertices(secondVertices),
          firstFacetTooSmall = firstFacet.isTooSmall(),
          secondFacetTooSmall = secondFacet.isTooSmall();

      if (!firstFacetTooSmall) {
        smallerFacets.push(firstFacet);
      }

      if (!secondFacetTooSmall) {
        smallerFacets.push(secondFacet);
      }
    }
  }, {
    key: 'splitWithZeroNonNullIntersections',
    value: function splitWithZeroNonNullIntersections(intersections, smallerFacets) {
      var smallerFacet = this; ///

      smallerFacets.push(smallerFacet);
    }
  }, {
    key: 'calculateIntersectionsWithVerticalLineInXYPlane',
    value: function calculateIntersectionsWithVerticalLineInXYPlane(verticalLineInXYPlane) {
      var edges = this.getEdges(),
          intersections = edges.map(function (edge) {
        var intersection = edge.calculateIntersectionWithVerticalLineInXYPlane(verticalLineInXYPlane);

        return intersection;
      });

      return intersections;
    }
  }, {
    key: 'clone',
    value: function clone() {
      var vertices = this.vertices.map(function (vertex) {
        return vertex.slice();
      }),
          normal = this.normal.slice(),
          facet = new Facet(vertices, normal);

      return facet;
    }
  }], [{
    key: 'fromVertices',
    value: function fromVertices(vertices) {
      var normal = calculateNormal(vertices),
          facet = new Facet(vertices, normal);

      return facet;
    }
  }, {
    key: 'fromVerticesAndIndexes',
    value: function fromVerticesAndIndexes(vertices, indexes) {
      vertices = indexes.map(function (index) {
        var vertex = vertices[index];

        return vertex;
      });

      var facet = Facet.fromVertices(vertices);

      return facet;
    }
  }]);

  return Facet;
}();

module.exports = Facet;

function calculateIntermediateVertex(startVertex, endVertex, intersection) {
  var direction = subtract3(endVertex, startVertex),
      offset = scale3(direction, intersection),
      intermediateVertex = add3(startVertex, offset);

  return intermediateVertex;
}

function calculateNonNullIntersections(intersections) {
  var nonNullIntersections = intersections.reduce(function (nonNullIntersections, intersection) {
    if (intersection !== null) {
      var nonNullIntersection = intersection; ///

      nonNullIntersections.push(nonNullIntersection);
    }

    return nonNullIntersections;
  }, []);

  return nonNullIntersections;
}

function calculateNullIntersectionIndex(intersections) {
  var nullIntersectionIndex = intersections.reduce(function (nullIntersectionIndex, intersection, index) {
    if (nullIntersectionIndex === null) {
      if (intersection === null) {
        nullIntersectionIndex = index;
      }
    }

    return nullIntersectionIndex;
  }, null);

  return nullIntersectionIndex;
}

function calculateNonNullIntersectionIndex(intersections) {
  var nullIntersectionIndex = intersections.reduce(function (nullIntersectionIndex, intersection, index) {
    if (nullIntersectionIndex === null) {
      if (intersection !== null) {
        nullIntersectionIndex = index;
      }
    }

    return nullIntersectionIndex;
  }, null);

  return nullIntersectionIndex;
}

function isMidPointToOneSideOfEdgesInXYPlane(midPoint, edgesInXYPlane) {
  var midPointToTheLeftOfEdgesInXYPlane = isMidPointToTheLeftOfEdgesInXYPlane(midPoint, edgesInXYPlane),
      midPointToTheRightOfEdgesInXYPlane = isMidPointToTheRightOfEdgesInXYPlane(midPoint, edgesInXYPlane),
      midPointToOneSideOfEdgesInXYPlane = midPointToTheLeftOfEdgesInXYPlane || midPointToTheRightOfEdgesInXYPlane; ///

  return midPointToOneSideOfEdgesInXYPlane;
}

function isMidPointToTheLeftOfEdgesInXYPlane(midPoint, edgesInXYPlane) {
  var midPointToTheLeftOfEdgesInXYPlane = edgesInXYPlane.reduce(function (midPointToTheLeftOfEdgesInXYPlane, edgeInXYPlane) {
    if (midPointToTheLeftOfEdgesInXYPlane) {
      var midPointToTheLeftOfEdgeInXYPlane = edgeInXYPlane.isMidPointToTheLeft(midPoint);

      midPointToTheLeftOfEdgesInXYPlane = midPointToTheLeftOfEdgeInXYPlane;
    }

    return midPointToTheLeftOfEdgesInXYPlane;
  }, true);

  return midPointToTheLeftOfEdgesInXYPlane;
}

function isMidPointToTheRightOfEdgesInXYPlane(midPoint, edgesInXYPlane) {
  var midPointToTheRightOfEdgesInXYPlane = edgesInXYPlane.reduce(function (midPointToTheRightOfEdgesInXYPlane, edgeInXYPlane) {
    if (midPointToTheRightOfEdgesInXYPlane) {
      var midPointToTheRightOfEdgeInXYPlane = edgeInXYPlane.isMidPointToTheRight(midPoint);

      midPointToTheRightOfEdgesInXYPlane = midPointToTheRightOfEdgeInXYPlane;
    }

    return midPointToTheRightOfEdgesInXYPlane;
  }, true);

  return midPointToTheRightOfEdgesInXYPlane;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9mYWNldC5qcyJdLCJuYW1lcyI6WyJFZGdlIiwicmVxdWlyZSIsImNvbnN0YW50cyIsImFycmF5VXRpbGl0aWVzIiwidmVjdG9yVXRpbGl0aWVzIiwidmVydGV4VXRpbGl0aWVzIiwidmVydGljZXNVdGlsaXRpZXMiLCJhcHByb3hpbWF0ZVV0aWxpdGllcyIsIlZFUlRJQ0VTX0xFTkdUSCIsInJvdGF0ZUFib3V0WkF4aXMiLCJpc0FwcHJveGltYXRlbHlFcXVhbFRvWmVybyIsImZpcnN0Iiwic2Vjb25kIiwidGhpcmQiLCJwZXJtdXRlIiwiY2FsY3VsYXRlTm9ybWFsIiwicm90YXRlVmVydGljZXMiLCJhZGQzIiwic3VidHJhY3QzIiwic2NhbGUzIiwibGVuZ3RoMyIsIkZhY2V0IiwidmVydGljZXMiLCJ0ZXh0dXJlQ29vcmRpbmF0ZXMiLCJub3JtYWwiLCJlZGdlcyIsIm1hcCIsInZlcnRleCIsImluZGV4Iiwic3RhcnRJbmRleCIsImVuZEluZGV4Iiwic3RhcnRWZXJ0ZXgiLCJlbmRWZXJ0ZXgiLCJlZGdlIiwiZnJvbVZlcnRpY2VzIiwiYmluZCIsIm1pZFBvaW50IiwicmVkdWNlIiwic2NhbGVkVmVydGV4Iiwibm9ybWFsTGVuZ3RoIiwibm9ybWFsTGVuZ3RoQXBwcm94aW1hdGVseUVxdWFsVG9aZXJvIiwidG9vU21hbGwiLCJtYXNraW5nRmFjZXQiLCJlZGdlc0luWFlQbGFuZSIsImdldEVkZ2VzSW5YWVBsYW5lIiwiZ2V0TWlkUG9pbnQiLCJtaWRQb2ludFRvT25lU2lkZU9mRWRnZXNJblhZUGxhbmUiLCJpc01pZFBvaW50VG9PbmVTaWRlT2ZFZGdlc0luWFlQbGFuZSIsIm1hc2tlZCIsInRyYW5zZm9ybXMiLCJmb3JFYWNoIiwidHJhbnNmb3JtIiwicm90YXRpb25RdWF0ZXJuaW9uIiwicm90YXRpb25BYm91dFpBeGlzTWF0cml4IiwiaW50ZXJzZWN0aW9ucyIsInNtYWxsZXJGYWNldHMiLCJub25OdWxsSW50ZXJzZWN0aW9ucyIsImNhbGN1bGF0ZU5vbk51bGxJbnRlcnNlY3Rpb25zIiwibm9uTnVsbEludGVyc2VjdGlvbnNMZW5ndGgiLCJsZW5ndGgiLCJzcGxpdFdpdGhUd29Ob25OdWxsSW50ZXJzZWN0aW9ucyIsInNwbGl0V2l0aE9uZU5vbk51bGxJbnRlcnNlY3Rpb24iLCJzcGxpdFdpdGhaZXJvTm9uTnVsbEludGVyc2VjdGlvbnMiLCJudWxsSW50ZXJzZWN0aW9uSW5kZXgiLCJjYWxjdWxhdGVOdWxsSW50ZXJzZWN0aW9uSW5kZXgiLCJwbGFjZXMiLCJzbGljZSIsImZpcnN0VmVydGV4Iiwic2Vjb25kVmVydGV4IiwidGhpcmRWZXJ0ZXgiLCJmaXJzdEludGVyc2VjdGlvbiIsInNlY29uZEludGVyc2VjdGlvbiIsImZpcnN0SW50ZXJtZWRpYXRlVmVydGV4IiwiY2FsY3VsYXRlSW50ZXJtZWRpYXRlVmVydGV4Iiwic2Vjb25kSW50ZXJtZWRpYXRlVmVydGV4IiwiZmlyc3RWZXJ0aWNlcyIsInNlY29uZFZlcnRpY2VzIiwidGhpcmRWZXJ0aWNlcyIsImZpcnN0RmFjZXQiLCJzZWNvbmRGYWNldCIsInRoaXJkRmFjZXQiLCJmaXJzdEZhY2V0VG9vU21hbGwiLCJpc1Rvb1NtYWxsIiwic2Vjb25kRmFjZXRUb29TbWFsbCIsInRoaXJkRmFjZXRUb29TbWFsbCIsInB1c2giLCJub25OdWxsSW50ZXJzZWN0aW9uSW5kZXgiLCJjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9uSW5kZXgiLCJpbnRlcm1lZGlhdGVWZXJ0ZXgiLCJzbWFsbGVyRmFjZXQiLCJ2ZXJ0aWNhbExpbmVJblhZUGxhbmUiLCJnZXRFZGdlcyIsImludGVyc2VjdGlvbiIsImNhbGN1bGF0ZUludGVyc2VjdGlvbldpdGhWZXJ0aWNhbExpbmVJblhZUGxhbmUiLCJmYWNldCIsImluZGV4ZXMiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGlyZWN0aW9uIiwib2Zmc2V0Iiwibm9uTnVsbEludGVyc2VjdGlvbiIsIm1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZSIsImlzTWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VzSW5YWVBsYW5lIiwibWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlc0luWFlQbGFuZSIsImlzTWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlc0luWFlQbGFuZSIsImVkZ2VJblhZUGxhbmUiLCJtaWRQb2ludFRvVGhlTGVmdE9mRWRnZUluWFlQbGFuZSIsImlzTWlkUG9pbnRUb1RoZUxlZnQiLCJtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VJblhZUGxhbmUiLCJpc01pZFBvaW50VG9UaGVSaWdodCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQUVBLElBQU1BLE9BQU9DLFFBQVEsY0FBUixDQUFiO0FBQUEsSUFDTUMsWUFBWUQsUUFBUSxhQUFSLENBRGxCO0FBQUEsSUFFTUUsaUJBQWlCRixRQUFRLG1CQUFSLENBRnZCO0FBQUEsSUFHTUcsa0JBQWtCSCxRQUFRLG9CQUFSLENBSHhCO0FBQUEsSUFJTUksa0JBQWtCSixRQUFRLG9CQUFSLENBSnhCO0FBQUEsSUFLTUssb0JBQW9CTCxRQUFRLHNCQUFSLENBTDFCO0FBQUEsSUFNTU0sdUJBQXVCTixRQUFRLHlCQUFSLENBTjdCOztBQVFNLElBQUVPLGVBQUYsR0FBc0JOLFNBQXRCLENBQUVNLGVBQUY7QUFBQSxJQUNFQyxpQkFERixHQUN1QkosZUFEdkIsQ0FDRUksZ0JBREY7QUFBQSxJQUVFQywwQkFGRixHQUVpQ0gsb0JBRmpDLENBRUVHLDBCQUZGO0FBQUEsSUFHRUMsS0FIRixHQUdvQ1IsY0FIcEMsQ0FHRVEsS0FIRjtBQUFBLElBR1NDLE1BSFQsR0FHb0NULGNBSHBDLENBR1NTLE1BSFQ7QUFBQSxJQUdpQkMsS0FIakIsR0FHb0NWLGNBSHBDLENBR2lCVSxLQUhqQjtBQUFBLElBR3dCQyxPQUh4QixHQUdvQ1gsY0FIcEMsQ0FHd0JXLE9BSHhCO0FBQUEsSUFJRUMsZUFKRixHQUlzQ1QsaUJBSnRDLENBSUVTLGVBSkY7QUFBQSxJQUltQkMsY0FKbkIsR0FJc0NWLGlCQUp0QyxDQUltQlUsY0FKbkI7QUFBQSxJ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O0FBQ3RDLFVBQU1LLG9DQUFvQ0gsY0FBY0ksb0JBQWQsQ0FBbUN6RSxRQUFuQyxDQUExQzs7QUFFQW1FLDJDQUFxQ0ssaUNBQXJDO0FBQ0Q7O0FBRUQsV0FBT0wsa0NBQVA7QUFDRCxHQVIwQyxFQVF4QyxJQVJ3QyxDQUEzQzs7QUFVQSxTQUFPQSxrQ0FBUDtBQUNEIiwiZmlsZSI6ImZhY2V0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBFZGdlID0gcmVxdWlyZSgnLi9mYWNldC9lZGdlJyksXG4gICAgICBjb25zdGFudHMgPSByZXF1aXJlKCcuL2NvbnN0YW50cycpLFxuICAgICAgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgdmVjdG9yVXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvdmVjdG9yJyksXG4gICAgICB2ZXJ0ZXhVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy92ZXJ0ZXgnKSxcbiAgICAgIHZlcnRpY2VzVXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvdmVydGljZXMnKSxcbiAgICAgIGFwcHJveGltYXRlVXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvYXBwcm94aW1hdGUnKTtcblxuY29uc3QgeyBWRVJUSUNFU19MRU5HVEggfSA9IGNvbnN0YW50cyxcbiAgICAgIHsgcm90YXRlQWJvdXRaQXhpcyB9ID0gdmVydGV4VXRpbGl0aWVzLFxuICAgICAgeyBpc0FwcHJveGltYXRlbHlFcXVhbFRvWmVybyB9ID0gYXBwcm94aW1hdGVVdGlsaXRpZXMsXG4gICAgICB7IGZpcnN0LCBzZWNvbmQsIHRoaXJkLCBwZXJtdXRlIH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgY2FsY3VsYXRlTm9ybWFsLCByb3RhdGVWZXJ0aWNlcyB9ID0gdmVydGljZXNVdGlsaXRpZXMsXG4gICAgICB7IGFkZDMsIHN1YnRyYWN0Mywgc2NhbGUzLCBsZW5ndGgzIH0gPSB2ZWN0b3JVdGlsaXRpZXM7XG5cbmNsYXNzIEZhY2V0IHtcbiAgY29uc3RydWN0b3IodmVydGljZXMsIHRleHR1cmVDb29yZGluYXRlcywgbm9ybWFsKSB7XG4gICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzO1xuICAgIHRoaXMubm9ybWFsID0gbm9ybWFsO1xuICB9XG5cbiAgZ2V0VmVydGljZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMudmVydGljZXM7XG4gIH1cblxuICBnZXROb3JtYWwoKSB7XG4gICAgcmV0dXJuIHRoaXMubm9ybWFsO1xuICB9XG5cbiAgZ2V0RWRnZXMoKSB7XG4gICAgY29uc3QgZWRnZXMgPSB0aGlzLnZlcnRpY2VzLm1hcChmdW5jdGlvbih2ZXJ0ZXgsIGluZGV4KSB7XG4gICAgICAgICAgICBjb25zdCBzdGFydEluZGV4ID0gaW5kZXgsXG4gICAgICAgICAgICAgICAgICBlbmRJbmRleCA9IChzdGFydEluZGV4ICsgMSkgJSBWRVJUSUNFU19MRU5HVEgsXG4gICAgICAgICAgICAgICAgICBzdGFydFZlcnRleCA9IHRoaXMudmVydGljZXNbc3RhcnRJbmRleF0sXG4gICAgICAgICAgICAgICAgICBlbmRWZXJ0ZXggPSB0aGlzLnZlcnRpY2VzW2VuZEluZGV4XSxcbiAgICAgICAgICAgICAgICAgIGVkZ2UgPSBFZGdlLmZyb21WZXJ0aWNlcyhzdGFydFZlcnRleCwgZW5kVmVydGV4KTtcbiAgXG4gICAgICAgICAgICByZXR1cm4gZWRnZTtcbiAgICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgcmV0dXJuIGVkZ2VzO1xuICB9XG4gIFxuICBnZXRNaWRQb2ludCgpIHtcbiAgICBjb25zdCBtaWRQb2ludCA9IHRoaXMudmVydGljZXMucmVkdWNlKGZ1bmN0aW9uKG1pZFBvaW50LCB2ZXJ0ZXgpIHtcbiAgICAgIGNvbnN0IHNjYWxlZFZlcnRleCA9IHNjYWxlMyh2ZXJ0ZXgsIDEvMyk7XG4gICAgICBcbiAgICAgIG1pZFBvaW50ID0gYWRkMyhtaWRQb2ludCwgc2NhbGVkVmVydGV4KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIG1pZFBvaW50O1xuICAgIH0sIFsgMCwgMCwgMCBdKTtcbiAgICBcbiAgICByZXR1cm4gbWlkUG9pbnQ7XG4gIH1cbiAgXG4gIGlzVG9vU21hbGwoKSB7XG4gICAgY29uc3Qgbm9ybWFsTGVuZ3RoID0gbGVuZ3RoMyh0aGlzLm5vcm1hbCksXG4gICAgICAgICAgbm9ybWFsTGVuZ3RoQXBwcm94aW1hdGVseUVxdWFsVG9aZXJvID0gaXNBcHByb3hpbWF0ZWx5RXF1YWxUb1plcm8obm9ybWFsTGVuZ3RoKSxcbiAgICAgICAgICB0b29TbWFsbCA9IG5vcm1hbExlbmd0aEFwcHJveGltYXRlbHlFcXVhbFRvWmVybzsgIC8vL1xuICAgIFxuICAgIHJldHVybiB0b29TbWFsbDtcbiAgfVxuICBcbiAgaXNNYXNrZWQobWFza2luZ0ZhY2V0KSB7XG4gICAgY29uc3QgZWRnZXNJblhZUGxhbmUgPSBtYXNraW5nRmFjZXQuZ2V0RWRnZXNJblhZUGxhbmUoKSxcbiAgICAgICAgICBtaWRQb2ludCA9IHRoaXMuZ2V0TWlkUG9pbnQoKSxcbiAgICAgICAgICBtaWRQb2ludFRvT25lU2lkZU9mRWRnZXNJblhZUGxhbmUgPSBpc01pZFBvaW50VG9PbmVTaWRlT2ZFZGdlc0luWFlQbGFuZShtaWRQb2ludCwgZWRnZXNJblhZUGxhbmUpLFxuICAgICAgICAgIG1hc2tlZCA9IG1pZFBvaW50VG9PbmVTaWRlT2ZFZGdlc0luWFlQbGFuZTsgIC8vL1xuICAgIFxuICAgIHJldHVybiBtYXNrZWQ7XG4gIH1cbiAgXG4gIGFwcGx5VHJhbnNmb3Jtcyh0cmFuc2Zvcm1zKSB7XG4gICAgdGhpcy52ZXJ0aWNlcyA9IHRoaXMudmVydGljZXMubWFwKGZ1bmN0aW9uKHZlcnRleCkge1xuICAgICAgdHJhbnNmb3Jtcy5mb3JFYWNoKGZ1bmN0aW9uKHRyYW5zZm9ybSkge1xuICAgICAgICB2ZXJ0ZXggPSB0cmFuc2Zvcm0odmVydGV4KTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdmVydGV4O1xuICAgIH0pO1xuXG4gICAgdGhpcy5ub3JtYWwgPSBjYWxjdWxhdGVOb3JtYWwodGhpcy52ZXJ0aWNlcyk7XG4gIH1cbiAgXG4gIHJvdGF0ZShyb3RhdGlvblF1YXRlcm5pb24pIHtcbiAgICB0aGlzLnZlcnRpY2VzID0gcm90YXRlVmVydGljZXModGhpcy52ZXJ0aWNlcywgcm90YXRpb25RdWF0ZXJuaW9uKTtcbiAgICBcbiAgICB0aGlzLm5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCh0aGlzLnZlcnRpY2VzKTtcbiAgfVxuXG4gIHJvdGF0ZUFib3V0WkF4aXMocm90YXRpb25BYm91dFpBeGlzTWF0cml4KSB7XG4gICAgdGhpcy52ZXJ0aWNlcyA9IHRoaXMudmVydGljZXMubWFwKGZ1bmN0aW9uKHZlcnRleCkge1xuICAgICAgdmVydGV4ID0gcm90YXRlQWJvdXRaQXhpcyh2ZXJ0ZXgsIHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCk7XG5cbiAgICAgIHJldHVybiB2ZXJ0ZXg7XG4gICAgfSk7XG5cbiAgICB0aGlzLm5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCh0aGlzLnZlcnRpY2VzKTtcbiAgfVxuICBcbiAgc3BsaXQoaW50ZXJzZWN0aW9ucywgc21hbGxlckZhY2V0cykge1xuICAgIGNvbnN0IG5vbk51bGxJbnRlcnNlY3Rpb25zID0gY2FsY3VsYXRlTm9uTnVsbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgbm9uTnVsbEludGVyc2VjdGlvbnNMZW5ndGggPSBub25OdWxsSW50ZXJzZWN0aW9ucy5sZW5ndGg7XG5cbiAgICBzd2l0Y2ggKG5vbk51bGxJbnRlcnNlY3Rpb25zTGVuZ3RoKSB7XG4gICAgICBjYXNlIDIgOlxuICAgICAgICB0aGlzLnNwbGl0V2l0aFR3b05vbk51bGxJbnRlcnNlY3Rpb25zKGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAxIDpcbiAgICAgICAgdGhpcy5zcGxpdFdpdGhPbmVOb25OdWxsSW50ZXJzZWN0aW9uKGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAwIDpcbiAgICAgICAgdGhpcy5zcGxpdFdpdGhaZXJvTm9uTnVsbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucywgc21hbGxlckZhY2V0cyk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHNwbGl0V2l0aFR3b05vbk51bGxJbnRlcnNlY3Rpb25zKGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMpIHtcbiAgICBjb25zdCBudWxsSW50ZXJzZWN0aW9uSW5kZXggPSBjYWxjdWxhdGVOdWxsSW50ZXJzZWN0aW9uSW5kZXgoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgcGxhY2VzID0gKFZFUlRJQ0VTX0xFTkdUSCAtIG51bGxJbnRlcnNlY3Rpb25JbmRleCkgJSBWRVJUSUNFU19MRU5HVEg7XG5cbiAgICBpbnRlcnNlY3Rpb25zID0gcGVybXV0ZShpbnRlcnNlY3Rpb25zLCBwbGFjZXMpO1xuXG4gICAgaW50ZXJzZWN0aW9ucyA9IGludGVyc2VjdGlvbnMuc2xpY2UoMSk7IC8vL1xuXG4gICAgdGhpcy52ZXJ0aWNlcyA9IHBlcm11dGUodGhpcy52ZXJ0aWNlcywgcGxhY2VzKTtcblxuICAgIGNvbnN0IGZpcnN0VmVydGV4ID0gZmlyc3QodGhpcy52ZXJ0aWNlcyksXG4gICAgICAgICAgc2Vjb25kVmVydGV4ID0gc2Vjb25kKHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIHRoaXJkVmVydGV4ID0gdGhpcmQodGhpcy52ZXJ0aWNlcyksXG4gICAgICAgICAgZmlyc3RJbnRlcnNlY3Rpb24gPSBmaXJzdChpbnRlcnNlY3Rpb25zKSxcbiAgICAgICAgICBzZWNvbmRJbnRlcnNlY3Rpb24gPSBzZWNvbmQoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgZmlyc3RJbnRlcm1lZGlhdGVWZXJ0ZXggPSBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgoc2Vjb25kVmVydGV4LCB0aGlyZFZlcnRleCwgZmlyc3RJbnRlcnNlY3Rpb24pLFxuICAgICAgICAgIHNlY29uZEludGVybWVkaWF0ZVZlcnRleCA9IGNhbGN1bGF0ZUludGVybWVkaWF0ZVZlcnRleCh0aGlyZFZlcnRleCwgZmlyc3RWZXJ0ZXgsIHNlY29uZEludGVyc2VjdGlvbiksXG4gICAgICAgICAgZmlyc3RWZXJ0aWNlcyA9IFtcbiAgICAgICAgICAgIGZpcnN0VmVydGV4LFxuICAgICAgICAgICAgc2Vjb25kVmVydGV4LFxuICAgICAgICAgICAgZmlyc3RJbnRlcm1lZGlhdGVWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIHNlY29uZFZlcnRpY2VzID0gW1xuICAgICAgICAgICAgZmlyc3RJbnRlcm1lZGlhdGVWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRJbnRlcm1lZGlhdGVWZXJ0ZXgsXG4gICAgICAgICAgICBmaXJzdFZlcnRleFxuICAgICAgICAgIF0sXG4gICAgICAgICAgdGhpcmRWZXJ0aWNlcyA9IFtcbiAgICAgICAgICAgIGZpcnN0SW50ZXJtZWRpYXRlVmVydGV4LFxuICAgICAgICAgICAgdGhpcmRWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRJbnRlcm1lZGlhdGVWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIGZpcnN0RmFjZXQgPSBGYWNldC5mcm9tVmVydGljZXMoZmlyc3RWZXJ0aWNlcyksXG4gICAgICAgICAgc2Vjb25kRmFjZXQgPSBGYWNldC5mcm9tVmVydGljZXMoc2Vjb25kVmVydGljZXMpLFxuICAgICAgICAgIHRoaXJkRmFjZXQgPSBGYWNldC5mcm9tVmVydGljZXModGhpcmRWZXJ0aWNlcyksXG4gICAgICAgICAgZmlyc3RGYWNldFRvb1NtYWxsID0gZmlyc3RGYWNldC5pc1Rvb1NtYWxsKCksXG4gICAgICAgICAgc2Vjb25kRmFjZXRUb29TbWFsbCA9IHNlY29uZEZhY2V0LmlzVG9vU21hbGwoKSxcbiAgICAgICAgICB0aGlyZEZhY2V0VG9vU21hbGwgPSB0aGlyZEZhY2V0LmlzVG9vU21hbGwoKTtcblxuICAgIGlmICghZmlyc3RGYWNldFRvb1NtYWxsKSB7XG4gICAgICBzbWFsbGVyRmFjZXRzLnB1c2goZmlyc3RGYWNldCk7XG4gICAgfVxuXG4gICAgaWYgKCFzZWNvbmRGYWNldFRvb1NtYWxsKSB7XG4gICAgICBzbWFsbGVyRmFjZXRzLnB1c2goc2Vjb25kRmFjZXQpO1xuICAgIH1cblxuICAgIGlmICghdGhpcmRGYWNldFRvb1NtYWxsKSB7XG4gICAgICBzbWFsbGVyRmFjZXRzLnB1c2godGhpcmRGYWNldCk7XG4gICAgfVxuICB9XG5cbiAgc3BsaXRXaXRoT25lTm9uTnVsbEludGVyc2VjdGlvbihpbnRlcnNlY3Rpb25zLCBzbWFsbGVyRmFjZXRzKSB7XG4gICAgY29uc3Qgbm9uTnVsbEludGVyc2VjdGlvbkluZGV4ID0gY2FsY3VsYXRlTm9uTnVsbEludGVyc2VjdGlvbkluZGV4KGludGVyc2VjdGlvbnMpLFxuICAgICAgICAgIHBsYWNlcyA9IChWRVJUSUNFU19MRU5HVEggLSBub25OdWxsSW50ZXJzZWN0aW9uSW5kZXgpICUgVkVSVElDRVNfTEVOR1RIO1xuXG4gICAgaW50ZXJzZWN0aW9ucyA9IHBlcm11dGUoaW50ZXJzZWN0aW9ucywgcGxhY2VzKTtcblxuICAgIHRoaXMudmVydGljZXMgPSBwZXJtdXRlKHRoaXMudmVydGljZXMsIHBsYWNlcyk7XG5cbiAgICBjb25zdCBmaXJzdFZlcnRleCA9IGZpcnN0KHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIHNlY29uZFZlcnRleCA9IHNlY29uZCh0aGlzLnZlcnRpY2VzKSxcbiAgICAgICAgICB0aGlyZFZlcnRleCA9IHRoaXJkKHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIGZpcnN0SW50ZXJzZWN0aW9uID0gZmlyc3QoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgaW50ZXJtZWRpYXRlVmVydGV4ID0gY2FsY3VsYXRlSW50ZXJtZWRpYXRlVmVydGV4KGZpcnN0VmVydGV4LCBzZWNvbmRWZXJ0ZXgsIGZpcnN0SW50ZXJzZWN0aW9uKSxcbiAgICAgICAgICBmaXJzdFZlcnRpY2VzID0gW1xuICAgICAgICAgICAgZmlyc3RWZXJ0ZXgsXG4gICAgICAgICAgICBpbnRlcm1lZGlhdGVWZXJ0ZXgsXG4gICAgICAgICAgICB0aGlyZFZlcnRleFxuICAgICAgICAgIF0sXG4gICAgICAgICAgc2Vjb25kVmVydGljZXMgPSBbXG4gICAgICAgICAgICBpbnRlcm1lZGlhdGVWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRWZXJ0ZXgsXG4gICAgICAgICAgICB0aGlyZFZlcnRleFxuICAgICAgICAgIF0sXG4gICAgICAgICAgZmlyc3RGYWNldCA9IEZhY2V0LmZyb21WZXJ0aWNlcyhmaXJzdFZlcnRpY2VzKSxcbiAgICAgICAgICBzZWNvbmRGYWNldCA9IEZhY2V0LmZyb21WZXJ0aWNlcyhzZWNvbmRWZXJ0aWNlcyksXG4gICAgICAgICAgZmlyc3RGYWNldFRvb1NtYWxsID0gZmlyc3RGYWNldC5pc1Rvb1NtYWxsKCksXG4gICAgICAgICAgc2Vjb25kRmFjZXRUb29TbWFsbCA9IHNlY29uZEZhY2V0LmlzVG9vU21hbGwoKTtcblxuICAgIGlmICghZmlyc3RGYWNldFRvb1NtYWxsKSB7XG4gICAgICBzbWFsbGVyRmFjZXRzLnB1c2goZmlyc3RGYWNldCk7XG4gICAgfVxuXG4gICAgaWYgKCFzZWNvbmRGYWNldFRvb1NtYWxsKSB7XG4gICAgICBzbWFsbGVyRmFjZXRzLnB1c2goc2Vjb25kRmFjZXQpO1xuICAgIH1cbiAgfVxuXG4gIHNwbGl0V2l0aFplcm9Ob25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zLCBzbWFsbGVyRmFjZXRzKSB7XG4gICAgY29uc3Qgc21hbGxlckZhY2V0ID0gdGhpczsgIC8vL1xuXG4gICAgc21hbGxlckZhY2V0cy5wdXNoKHNtYWxsZXJGYWNldCk7XG4gIH1cblxuICBjYWxjdWxhdGVJbnRlcnNlY3Rpb25zV2l0aFZlcnRpY2FsTGluZUluWFlQbGFuZSh2ZXJ0aWNhbExpbmVJblhZUGxhbmUpIHtcbiAgICBjb25zdCBlZGdlcyA9IHRoaXMuZ2V0RWRnZXMoKSxcbiAgICAgICAgICBpbnRlcnNlY3Rpb25zID0gZWRnZXMubWFwKGZ1bmN0aW9uKGVkZ2UpIHtcbiAgICAgICAgICAgIGNvbnN0IGludGVyc2VjdGlvbiA9IGVkZ2UuY2FsY3VsYXRlSW50ZXJzZWN0aW9uV2l0aFZlcnRpY2FsTGluZUluWFlQbGFuZSh2ZXJ0aWNhbExpbmVJblhZUGxhbmUpO1xuICBcbiAgICAgICAgICAgIHJldHVybiBpbnRlcnNlY3Rpb247XG4gICAgICAgICAgfSk7XG5cbiAgICByZXR1cm4gaW50ZXJzZWN0aW9ucztcbiAgfVxuXG4gIGNsb25lKCkge1xuICAgIGNvbnN0IHZlcnRpY2VzID0gdGhpcy52ZXJ0aWNlcy5tYXAoZnVuY3Rpb24odmVydGV4KSB7XG4gICAgICAgICAgICByZXR1cm4gdmVydGV4LnNsaWNlKCk7XG4gICAgICAgICAgfSksXG4gICAgICAgICAgbm9ybWFsID0gdGhpcy5ub3JtYWwuc2xpY2UoKSxcbiAgICAgICAgICBmYWNldCA9IG5ldyBGYWNldCh2ZXJ0aWNlcywgbm9ybWFsKTtcblxuICAgIHJldHVybiBmYWNldDtcbiAgfVxuXG4gIHN0YXRpYyBmcm9tVmVydGljZXModmVydGljZXMpIHtcbiAgICBjb25zdCBub3JtYWwgPSBjYWxjdWxhdGVOb3JtYWwodmVydGljZXMpLFxuICAgICAgICAgIGZhY2V0ID0gbmV3IEZhY2V0KHZlcnRpY2VzLCBub3JtYWwpO1xuXG4gICAgcmV0dXJuIGZhY2V0O1xuICB9XG5cbiAgc3RhdGljIGZyb21WZXJ0aWNlc0FuZEluZGV4ZXModmVydGljZXMsIGluZGV4ZXMpIHtcbiAgICB2ZXJ0aWNlcyA9IGluZGV4ZXMubWFwKGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICBjb25zdCB2ZXJ0ZXggPSB2ZXJ0aWNlc1tpbmRleF07XG5cbiAgICAgIHJldHVybiB2ZXJ0ZXg7XG4gICAgfSk7XG5cbiAgICBjb25zdCBmYWNldCA9IEZhY2V0LmZyb21WZXJ0aWNlcyh2ZXJ0aWNlcyk7XG5cbiAgICByZXR1cm4gZmFjZXQ7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBGYWNldDtcblxuZnVuY3Rpb24gY2FsY3VsYXRlSW50ZXJtZWRpYXRlVmVydGV4KHN0YXJ0VmVydGV4LCBlbmRWZXJ0ZXgsIGludGVyc2VjdGlvbikge1xuICBjb25zdCBkaXJlY3Rpb24gPSBzdWJ0cmFjdDMoZW5kVmVydGV4LCBzdGFydFZlcnRleCksXG4gICAgICAgIG9mZnNldCA9IHNjYWxlMyhkaXJlY3Rpb24sIGludGVyc2VjdGlvbiksXG4gICAgICAgIGludGVybWVkaWF0ZVZlcnRleCA9IGFkZDMoc3RhcnRWZXJ0ZXgsIG9mZnNldCk7XG5cbiAgcmV0dXJuIGludGVybWVkaWF0ZVZlcnRleDtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlTm9uTnVsbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucykge1xuICBjb25zdCBub25OdWxsSW50ZXJzZWN0aW9ucyA9IGludGVyc2VjdGlvbnMucmVkdWNlKGZ1bmN0aW9uKG5vbk51bGxJbnRlcnNlY3Rpb25zLCBpbnRlcnNlY3Rpb24pIHtcbiAgICBpZiAoaW50ZXJzZWN0aW9uICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBub25OdWxsSW50ZXJzZWN0aW9uID0gaW50ZXJzZWN0aW9uOyAvLy9cblxuICAgICAgbm9uTnVsbEludGVyc2VjdGlvbnMucHVzaChub25OdWxsSW50ZXJzZWN0aW9uKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbm9uTnVsbEludGVyc2VjdGlvbnM7XG4gIH0sIFtdKTtcblxuICByZXR1cm4gbm9uTnVsbEludGVyc2VjdGlvbnM7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZU51bGxJbnRlcnNlY3Rpb25JbmRleChpbnRlcnNlY3Rpb25zKSB7XG4gIGNvbnN0IG51bGxJbnRlcnNlY3Rpb25JbmRleCA9IGludGVyc2VjdGlvbnMucmVkdWNlKGZ1bmN0aW9uKG51bGxJbnRlcnNlY3Rpb25JbmRleCwgaW50ZXJzZWN0aW9uLCBpbmRleCkge1xuICAgIGlmIChudWxsSW50ZXJzZWN0aW9uSW5kZXggPT09IG51bGwpIHtcbiAgICAgIGlmIChpbnRlcnNlY3Rpb24gPT09IG51bGwpIHtcbiAgICAgICAgbnVsbEludGVyc2VjdGlvbkluZGV4ID0gaW5kZXg7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGxJbnRlcnNlY3Rpb25JbmRleDtcbiAgfSwgbnVsbCk7XG5cbiAgcmV0dXJuIG51bGxJbnRlcnNlY3Rpb25JbmRleDtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlTm9uTnVsbEludGVyc2VjdGlvbkluZGV4KGludGVyc2VjdGlvbnMpIHtcbiAgY29uc3QgbnVsbEludGVyc2VjdGlvbkluZGV4ID0gaW50ZXJzZWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24obnVsbEludGVyc2VjdGlvbkluZGV4LCBpbnRlcnNlY3Rpb24sIGluZGV4KSB7XG4gICAgaWYgKG51bGxJbnRlcnNlY3Rpb25JbmRleCA9PT0gbnVsbCkge1xuICAgICAgaWYgKGludGVyc2VjdGlvbiAhPT0gbnVsbCkge1xuICAgICAgICBudWxsSW50ZXJzZWN0aW9uSW5kZXggPSBpbmRleDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbEludGVyc2VjdGlvbkluZGV4O1xuICB9LCBudWxsKTtcblxuICByZXR1cm4gbnVsbEludGVyc2VjdGlvbkluZGV4O1xufVxuXG5mdW5jdGlvbiBpc01pZFBvaW50VG9PbmVTaWRlT2ZFZGdlc0luWFlQbGFuZShtaWRQb2ludCwgZWRnZXNJblhZUGxhbmUpIHtcbiAgY29uc3QgbWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VzSW5YWVBsYW5lID0gaXNNaWRQb2ludFRvVGhlTGVmdE9mRWRnZXNJblhZUGxhbmUobWlkUG9pbnQsIGVkZ2VzSW5YWVBsYW5lKSxcbiAgICAgICAgbWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlc0luWFlQbGFuZSA9IGlzTWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlc0luWFlQbGFuZShtaWRQb2ludCwgZWRnZXNJblhZUGxhbmUpLFxuICAgICAgICBtaWRQb2ludFRvT25lU2lkZU9mRWRnZXNJblhZUGxhbmUgPSBtaWRQb2ludFRvVGhlTGVmdE9mRWRnZXNJblhZUGxhbmUgfHwgbWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlc0luWFlQbGFuZTsgLy8vXG5cbiAgcmV0dXJuIG1pZFBvaW50VG9PbmVTaWRlT2ZFZGdlc0luWFlQbGFuZTtcbn1cblxuZnVuY3Rpb24gaXNNaWRQb2ludFRvVGhlTGVmdE9mRWRnZXNJblhZUGxhbmUobWlkUG9pbnQsIGVkZ2VzSW5YWVBsYW5lKSB7XG4gIGNvbnN0IG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZSA9IGVkZ2VzSW5YWVBsYW5lLnJlZHVjZShmdW5jdGlvbihtaWRQb2ludFRvVGhlTGVmdE9mRWRnZXNJblhZUGxhbmUsIGVkZ2VJblhZUGxhbmUpIHtcbiAgICBpZiAobWlkUG9pbnRUb1RoZUxlZnRPZkVkZ2VzSW5YWVBsYW5lKSB7XG4gICAgICBjb25zdCBtaWRQb2ludFRvVGhlTGVmdE9mRWRnZUluWFlQbGFuZSA9IGVkZ2VJblhZUGxhbmUuaXNNaWRQb2ludFRvVGhlTGVmdChtaWRQb2ludCk7XG5cbiAgICAgIG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlc0luWFlQbGFuZSA9IG1pZFBvaW50VG9UaGVMZWZ0T2ZFZGdlSW5YWVBsYW5lO1xuICAgIH1cblxuICAgIHJldHVybiBtaWRQb2ludFRvVGhlTGVmdE9mRWRnZXNJblhZUGxhbmU7XG4gIH0sIHRydWUpO1xuXG4gIHJldHVybiBtaWRQb2ludFRvVGhlTGVmdE9mRWRnZXNJblhZUGxhbmU7XG59XG5cbmZ1bmN0aW9uIGlzTWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlc0luWFlQbGFuZShtaWRQb2ludCwgZWRnZXNJblhZUGxhbmUpIHtcbiAgY29uc3QgbWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlc0luWFlQbGFuZSA9IGVkZ2VzSW5YWVBsYW5lLnJlZHVjZShmdW5jdGlvbihtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lLCBlZGdlSW5YWVBsYW5lKSB7XG4gICAgaWYgKG1pZFBvaW50VG9UaGVSaWdodE9mRWRnZXNJblhZUGxhbmUpIHtcbiAgICAgIGNvbnN0IG1pZFBvaW50VG9UaGVSaWdodE9mRWRnZUluWFlQbGFuZSA9IGVkZ2VJblhZUGxhbmUuaXNNaWRQb2ludFRvVGhlUmlnaHQobWlkUG9pbnQpO1xuXG4gICAgICBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lID0gbWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlSW5YWVBsYW5lO1xuICAgIH1cblxuICAgIHJldHVybiBtaWRQb2ludFRvVGhlUmlnaHRPZkVkZ2VzSW5YWVBsYW5lO1xuICB9LCB0cnVlKTtcblxuICByZXR1cm4gbWlkUG9pbnRUb1RoZVJpZ2h0T2ZFZGdlc0luWFlQbGFuZTtcbn1cbiJdfQ==