'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Line = require('./line'),
    vec3 = require('./maths/vec3'),
    arrayUtilities = require('./utilities/array'),
    verticesUtilities = require('./utilities/vertices');

var add = vec3.add,
    subtract = vec3.subtract,
    scale = vec3.scale,
    transform = vec3.transform,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    permute = arrayUtilities.permute,
    calculateNormal = verticesUtilities.calculateNormal,
    rotateVertices = verticesUtilities.rotateVertices;

var Facet = function () {
  function Facet(vertices, normal) {
    _classCallCheck(this, Facet);

    this.vertices = vertices;
    this.normal = normal;
  }

  _createClass(Facet, [{
    key: 'getVertices',
    value: function getVertices() {
      return this.vertices;
    }
  }, {
    key: 'getNormal',
    value: function getNormal() {
      return this.normal;
    }
  }, {
    key: 'getLines',
    value: function getLines() {
      var verticesLength = 3,
          ///
      lines = this.vertices.map(function (vertex, index) {
        var startIndex = index,
            endIndex = (startIndex + 1) % verticesLength,
            startVertex = this.vertices[startIndex],
            endVertex = this.vertices[endIndex],
            line = Line.fromVertices(startVertex, endVertex);

        return line;
      }.bind(this));

      return lines;
    }
  }, {
    key: 'rotate',
    value: function rotate(rotationQuaternion) {
      this.vertices = rotateVertices(this.vertices, rotationQuaternion);

      this.normal = calculateNormal(this.vertices);
    }
  }, {
    key: 'rotateAboutZAxis',
    value: function rotateAboutZAxis(rotationAboutZAxisMatrix) {
      var mat2 = rotationAboutZAxisMatrix; ///

      this.vertices = this.vertices.map(function (vertex) {
        var vec = vertex;

        vec = transform(vec, mat2);

        vertex = vec;

        return vertex;
      });

      this.normal = calculateNormal(this.vertices);
    }
  }, {
    key: 'possiblySplitWithVerticalLineInXYPlane',
    value: function possiblySplitWithVerticalLineInXYPlane(verticalLineInXYPlane) {
      var intersections = this.calculateIntersectionsWithVerticalLineInXYPlane(verticalLineInXYPlane),
          intersectionsIncludesNull = intersections.includes(null),
          facets = intersectionsIncludesNull ? this.possiblySplitWithNullIntersection(intersections) : this.possiblySplitWithoutNullIntersection(intersections);

      return facets;
    }
  }, {
    key: 'possiblySplitWithNullIntersection',
    value: function possiblySplitWithNullIntersection(intersections) {
      var facets = void 0;

      var nonNullIntersections = calculateNonNullIntersections(intersections),
          nonTrivialNonNullIntersections = calculateNonTrivialIntersections(nonNullIntersections),
          nonTrivialNonNullIntersectionsLength = nonTrivialNonNullIntersections.length;

      switch (nonTrivialNonNullIntersectionsLength) {
        case 2:
          facets = this.splitWithNullIntersection(intersections);
          break;

        default:
          facets = this.doNotSplit();
          break;
      }

      return facets;
    }
  }, {
    key: 'possiblySplitWithoutNullIntersection',
    value: function possiblySplitWithoutNullIntersection(intersections) {
      var facets = void 0;
      var nonTrivialIntersections = calculateNonTrivialIntersections(intersections),
          nonTrivialIntersectionsLength = nonTrivialIntersections.length;

      switch (nonTrivialIntersectionsLength) {
        case 1:
          facets = this.splitWithOneNonTrivialIntersection(intersections);
          break;

        case 2:
          facets = this.splitWithTwoNonTrivialIntersection(intersections);
          break;

        default:
          facets = this.doNotSplit();
          break;
      }

      return facets;
    }
  }, {
    key: 'splitWithNullIntersection',
    value: function splitWithNullIntersection(intersections) {
      var verticesLength = 3,
          nullIntersectionIndex = calculateNonNullIntersectionIndex(intersections),
          places = (verticesLength - nullIntersectionIndex) % verticesLength;

      intersections = permute(intersections, places);

      this.vertices = permute(this.vertices, places);

      var firstVertex = first(this.vertices),
          secondVertex = second(this.vertices),
          thirdVertex = third(this.vertices),
          nonNullIntersections = intersections.slice(1),
          firstNonNullIntersection = first(nonNullIntersections),
          secondNonNullIntersection = second(nonNullIntersections),
          firstIntermediateVertex = calculateIntermediateVertex(secondVertex, thirdVertex, firstNonNullIntersection),
          secondIntermediateVertex = calculateIntermediateVertex(thirdVertex, firstVertex, secondNonNullIntersection),
          firstVertices = [firstVertex, secondVertex, secondIntermediateVertex],
          secondVertices = [secondVertex, firstIntermediateVertex, secondIntermediateVertex],
          thirdVertices = [firstIntermediateVertex, thirdVertex, secondIntermediateVertex],
          firstFacet = Facet.fromVertices(firstVertices),
          secondFacet = Facet.fromVertices(secondVertices),
          thirdFacet = Facet.fromVertices(thirdVertices),
          facets = [firstFacet, secondFacet, thirdFacet];

      return facets;
    }
  }, {
    key: 'splitWithOneNonTrivialIntersection',
    value: function splitWithOneNonTrivialIntersection(intersections) {
      var verticesLength = 3,
          nonTrivialIntersectionIndex = calculateNonTrivialIntersectionIndex(intersections),
          places = (verticesLength - nonTrivialIntersectionIndex) % verticesLength;

      intersections = permute(intersections, places);

      this.vertices = permute(this.vertices, places);

      var firstVertex = first(this.vertices),
          secondVertex = second(this.vertices),
          thirdVertex = third(this.vertices),
          firstIntersection = first(intersections),
          nonTrivialIntersection = firstIntersection,
          ///
      intermediateVertex = calculateIntermediateVertex(firstVertex, secondVertex, nonTrivialIntersection),
          firstVertices = [firstVertex, intermediateVertex, thirdVertex],
          secondVertices = [intermediateVertex, secondVertex, thirdVertex],
          firstFacetInXYPlane = Facet.fromVertices(firstVertices),
          secondFacetInXYPlane = Facet.fromVertices(secondVertices),
          facets = [firstFacetInXYPlane, secondFacetInXYPlane];

      return facets;
    }
  }, {
    key: 'splitWithTwoNonTrivialIntersection',
    value: function splitWithTwoNonTrivialIntersection(intersections) {
      var verticesLength = 3,
          trivialIntersectionIndex = calculateTrivialIntersectionIndex(intersections),
          places = (verticesLength - trivialIntersectionIndex) % verticesLength;

      intersections = permute(intersections, places);

      this.vertices = permute(this.vertices, places);

      var firstVertex = first(this.vertices),
          secondVertex = second(this.vertices),
          thirdVertex = third(this.vertices),
          nonTrivialIntersections = intersections.slice(1),
          firstNonTrivialIntersection = first(nonTrivialIntersections),
          secondNonTrivialIntersection = second(nonTrivialIntersections),
          firstIntermediateVertex = calculateIntermediateVertex(secondVertex, thirdVertex, firstNonTrivialIntersection),
          secondIntermediateVertex = calculateIntermediateVertex(thirdVertex, firstVertex, secondNonTrivialIntersection),
          firstVertices = [firstVertex, secondVertex, firstIntermediateVertex],
          secondVertices = [firstVertex, firstIntermediateVertex, secondIntermediateVertex],
          thirdVertices = [firstIntermediateVertex, thirdVertex, secondIntermediateVertex],
          firstFacetInXYPlane = Facet.fromVertices(firstVertices),
          secondFacetInXYPlane = Facet.fromVertices(secondVertices),
          thirdFacetInXYPlane = Facet.fromVertices(thirdVertices),
          facets = [firstFacetInXYPlane, secondFacetInXYPlane, thirdFacetInXYPlane];

      return facets;
    }
  }, {
    key: 'doNotSplit',
    value: function doNotSplit() {
      var facet = this,
          ///
      facets = [facet];

      return facets;
    }
  }, {
    key: 'calculateIntersectionsWithVerticalLineInXYPlane',
    value: function calculateIntersectionsWithVerticalLineInXYPlane(verticalLineInXYPlane) {
      var lines = this.getLines(),
          intersections = lines.map(function (line) {
        var intersection = line.calculateIntersectionWithVerticalLineInXYPlane(verticalLineInXYPlane);

        return intersection;
      });

      return intersections;
    }
  }], [{
    key: 'fromVertices',
    value: function fromVertices(vertices) {
      var normal = calculateNormal(vertices),
          facet = new Facet(vertices, normal);

      return facet;
    }
  }]);

  return Facet;
}();

module.exports = Facet;

function isIntersectionTrivial(intersection) {
  var intersectionNonTrivial = isIntersectionNonTrivial(intersection),
      intersectionTrivial = !intersectionNonTrivial;

  return intersectionTrivial;
}

function isIntersectionNonTrivial(intersection) {
  var intersectionNonTrivial = intersection > 0 && intersection < 1;

  return intersectionNonTrivial;
}

function calculateIntermediateVertex(startVertex, endVertex, nonNullIntersection) {
  var direction = subtract(endVertex, startVertex),
      offset = scale(direction, nonNullIntersection),
      intermediateVertex = add(startVertex, offset);

  return intermediateVertex;
}

function calculateNonNullIntersections(intersections) {
  var nonNullIntersections = intersections.reduce(function (nonNullIntersections, intersection) {
    var intersectionNonNull = intersection !== null;

    if (intersectionNonNull) {
      var nonNullIntersection = intersection; ///

      nonNullIntersections.push(nonNullIntersection);
    }

    return nonNullIntersections;
  }, []);

  return nonNullIntersections;
}

function calculateNonTrivialIntersections(intersections) {
  var nonTrivialIntersections = intersections.reduce(function (nonTrivialIntersections, intersection) {
    var intersectionNonTrivial = isIntersectionNonTrivial(intersection);

    if (intersectionNonTrivial) {
      var nonTrivialIntersection = intersection; ///

      nonTrivialIntersections.push(nonTrivialIntersection);
    }

    return nonTrivialIntersections;
  }, []);

  return nonTrivialIntersections;
}

function calculateNonNullIntersectionIndex(intersections) {
  var nullIntersectionIndex = intersections.indexOf(null);

  return nullIntersectionIndex;
}

function calculateTrivialIntersectionIndex(intersections) {
  var trivialIntersectionIndex = intersections.reduce(function (trivialIntersectionIndex, intersection, index) {
    if (trivialIntersectionIndex === null) {
      var intersectionNonTrivial = isIntersectionTrivial(intersection);

      if (intersectionNonTrivial) {
        trivialIntersectionIndex = index;
      }
    }

    return trivialIntersectionIndex;
  }, null);

  return trivialIntersectionIndex;
}

function calculateNonTrivialIntersectionIndex(intersections) {
  var nonTrivialIntersectionIndex = intersections.reduce(function (nonTrivialIntersectionIndex, intersection, index) {
    if (nonTrivialIntersectionIndex === null) {
      var intersectionNonTrivial = isIntersectionNonTrivial(intersection);

      if (intersectionNonTrivial) {
        nonTrivialIntersectionIndex = index;
      }
    }

    return nonTrivialIntersectionIndex;
  }, null);

  return nonTrivialIntersectionIndex;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9mYWNldC5qcyJdLCJuYW1lcyI6WyJMaW5lIiwicmVxdWlyZSIsInZlYzMiLCJhcnJheVV0aWxpdGllcyIsInZlcnRpY2VzVXRpbGl0aWVzIiwiYWRkIiwic3VidHJhY3QiLCJzY2FsZSIsInRyYW5zZm9ybSIsImZpcnN0Iiwic2Vjb25kIiwidGhpcmQiLCJwZXJtdXRlIiwiY2FsY3VsYXRlTm9ybWFsIiwicm90YXRlVmVydGljZXMiLCJGYWNldCIsInZlcnRpY2VzIiwibm9ybWFsIiwidmVydGljZXNMZW5ndGgiLCJsaW5lcyIsIm1hcCIsInZlcnRleCIsImluZGV4Iiwic3RhcnRJbmRleCIsImVuZEluZGV4Iiwic3RhcnRWZXJ0ZXgiLCJlbmRWZXJ0ZXgiLCJsaW5lIiwiZnJvbVZlcnRpY2VzIiwiYmluZCIsInJvdGF0aW9uUXVhdGVybmlvbiIsInJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCIsIm1hdDIiLCJ2ZWMiLCJ2ZXJ0aWNhbExpbmVJblhZUGxhbmUiLCJpbnRlcnNlY3Rpb25zIiwiY2FsY3VsYXRlSW50ZXJzZWN0aW9uc1dpdGhWZXJ0aWNhbExpbmVJblhZUGxhbmUiLCJpbnRlcnNlY3Rpb25zSW5jbHVkZXNOdWxsIiwiaW5jbHVkZXMiLCJmYWNldHMiLCJwb3NzaWJseVNwbGl0V2l0aE51bGxJbnRlcnNlY3Rpb24iLCJwb3NzaWJseVNwbGl0V2l0aG91dE51bGxJbnRlcnNlY3Rpb24iLCJub25OdWxsSW50ZXJzZWN0aW9ucyIsImNhbGN1bGF0ZU5vbk51bGxJbnRlcnNlY3Rpb25zIiwibm9uVHJpdmlhbE5vbk51bGxJbnRlcnNlY3Rpb25zIiwiY2FsY3VsYXRlTm9uVHJpdmlhbEludGVyc2VjdGlvbnMiLCJub25Ucml2aWFsTm9uTnVsbEludGVyc2VjdGlvbnNMZW5ndGgiLCJsZW5ndGgiLCJzcGxpdFdpdGhOdWxsSW50ZXJzZWN0aW9uIiwiZG9Ob3RTcGxpdCIsIm5vblRyaXZpYWxJbnRlcnNlY3Rpb25zIiwibm9uVHJpdmlhbEludGVyc2VjdGlvbnNMZW5ndGgiLCJzcGxpdFdpdGhPbmVOb25Ucml2aWFsSW50ZXJzZWN0aW9uIiwic3BsaXRXaXRoVHdvTm9uVHJpdmlhbEludGVyc2VjdGlvbiIsIm51bGxJbnRlcnNlY3Rpb25JbmRleCIsImNhbGN1bGF0ZU5vbk51bGxJbnRlcnNlY3Rpb25JbmRleCIsInBsYWNlcyIsImZpcnN0VmVydGV4Iiwic2Vjb25kVmVydGV4IiwidGhpcmRWZXJ0ZXgiLCJzbGljZSIsImZpcnN0Tm9uTnVsbEludGVyc2VjdGlvbiIsInNlY29uZE5vbk51bGxJbnRlcnNlY3Rpb24iLCJmaXJzdEludGVybWVkaWF0ZVZlcnRleCIsImNhbGN1bGF0ZUludGVybWVkaWF0ZVZlcnRleCIsInNlY29uZEludGVybWVkaWF0ZVZlcnRleCIsImZpcnN0VmVydGljZXMiLCJzZWNvbmRWZXJ0aWNlcyIsInRoaXJkVmVydGljZXMiLCJmaXJzdEZhY2V0Iiwic2Vjb25kRmFjZXQiLCJ0aGlyZEZhY2V0Iiwibm9uVHJpdmlhbEludGVyc2VjdGlvbkluZGV4IiwiY2FsY3VsYXRlTm9uVHJpdmlhbEludGVyc2VjdGlvbkluZGV4IiwiZmlyc3RJbnRlcnNlY3Rpb24iLCJub25Ucml2aWFsSW50ZXJzZWN0aW9uIiwiaW50ZXJtZWRpYXRlVmVydGV4IiwiZmlyc3RGYWNldEluWFlQbGFuZSIsInNlY29uZEZhY2V0SW5YWVBsYW5lIiwidHJpdmlhbEludGVyc2VjdGlvbkluZGV4IiwiY2FsY3VsYXRlVHJpdmlhbEludGVyc2VjdGlvbkluZGV4IiwiZmlyc3ROb25Ucml2aWFsSW50ZXJzZWN0aW9uIiwic2Vjb25kTm9uVHJpdmlhbEludGVyc2VjdGlvbiIsInRoaXJkRmFjZXRJblhZUGxhbmUiLCJmYWNldCIsImdldExpbmVzIiwiaW50ZXJzZWN0aW9uIiwiY2FsY3VsYXRlSW50ZXJzZWN0aW9uV2l0aFZlcnRpY2FsTGluZUluWFlQbGFuZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJpc0ludGVyc2VjdGlvblRyaXZpYWwiLCJpbnRlcnNlY3Rpb25Ob25Ucml2aWFsIiwiaXNJbnRlcnNlY3Rpb25Ob25Ucml2aWFsIiwiaW50ZXJzZWN0aW9uVHJpdmlhbCIsIm5vbk51bGxJbnRlcnNlY3Rpb24iLCJkaXJlY3Rpb24iLCJvZmZzZXQiLCJyZWR1Y2UiLCJpbnRlcnNlY3Rpb25Ob25OdWxsIiwicHVzaCIsImluZGV4T2YiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7QUFFQSxJQUFNQSxPQUFPQyxRQUFRLFFBQVIsQ0FBYjtBQUFBLElBQ01DLE9BQU9ELFFBQVEsY0FBUixDQURiO0FBQUEsSUFFTUUsaUJBQWlCRixRQUFRLG1CQUFSLENBRnZCO0FBQUEsSUFHTUcsb0JBQW9CSCxRQUFRLHNCQUFSLENBSDFCOztJQUtRSSxHLEdBQW9DSCxJLENBQXBDRyxHO0lBQUtDLFEsR0FBK0JKLEksQ0FBL0JJLFE7SUFBVUMsSyxHQUFxQkwsSSxDQUFyQkssSztJQUFPQyxTLEdBQWNOLEksQ0FBZE0sUztJQUN0QkMsSyxHQUFrQ04sYyxDQUFsQ00sSztJQUFPQyxNLEdBQTJCUCxjLENBQTNCTyxNO0lBQVFDLEssR0FBbUJSLGMsQ0FBbkJRLEs7SUFBT0MsTyxHQUFZVCxjLENBQVpTLE87SUFDdEJDLGUsR0FBb0NULGlCLENBQXBDUyxlO0lBQWlCQyxjLEdBQW1CVixpQixDQUFuQlUsYzs7SUFFbkJDLEs7QUFDSixpQkFBWUMsUUFBWixFQUFzQkMsTUFBdEIsRUFBOEI7QUFBQTs7QUFDNUIsU0FBS0QsUUFBTCxHQUFnQkEsUUFBaEI7QUFDQSxTQUFLQyxNQUFMLEdBQWNBLE1BQWQ7QUFDRDs7OztrQ0FFYTtBQUNaLGFBQU8sS0FBS0QsUUFBWjtBQUNEOzs7Z0NBRVc7QUFDVixhQUFPLEtBQUtDLE1BQVo7QUFDRDs7OytCQUVVO0FBQ1QsVUFBTUMsaUJBQWlCLENBQXZCO0FBQUEsVUFBMEI7QUFDcEJDLGNBQVEsS0FBS0gsUUFBTCxDQUFjSSxHQUFkLENBQWtCLFVBQVNDLE1BQVQsRUFBaUJDLEtBQWpCLEVBQXdCO0FBQ2hELFlBQU1DLGFBQWFELEtBQW5CO0FB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RCxFQUF3RDtBQUM1RyxRQUFJeUQsNkJBQTZCLElBQWpDLEVBQXVDO0FBQ3JDLFVBQU1ZLHlCQUF5QkQsc0JBQXNCSixZQUF0QixDQUEvQjs7QUFFQSxVQUFJSyxzQkFBSixFQUE0QjtBQUMxQlosbUNBQTJCekQsS0FBM0I7QUFDRDtBQUNGOztBQUVELFdBQU95RCx3QkFBUDtBQUNELEdBVmdDLEVBVTlCLElBVjhCLENBQWpDOztBQVlBLFNBQU9BLHdCQUFQO0FBQ0Q7O0FBRUQsU0FBU04sb0NBQVQsQ0FBOEN0QyxhQUE5QyxFQUE2RDtBQUMzRCxNQUFNcUMsOEJBQThCckMsY0FBYzhELE1BQWQsQ0FBcUIsVUFBU3pCLDJCQUFULEVBQXNDYyxZQUF0QyxFQUFvRGhFLEtBQXBELEVBQTJEO0FBQ2xILFFBQUlrRCxnQ0FBZ0MsSUFBcEMsRUFBMEM7QUFDeEMsVUFBTW1CLHlCQUF5QkMseUJBQXlCTixZQUF6QixDQUEvQjs7QUFFQSxVQUFJSyxzQkFBSixFQUE0QjtBQUMxQm5CLHNDQUE4QmxELEtBQTlCO0FBQ0Q7QUFDRjs7QUFFRCxXQUFPa0QsMkJBQVA7QUFDRCxHQVZtQyxFQVVqQyxJQVZpQyxDQUFwQzs7QUFZQSxTQUFPQSwyQkFBUDtBQUNEIiwiZmlsZSI6ImZhY2V0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBMaW5lID0gcmVxdWlyZSgnLi9saW5lJyksXG4gICAgICB2ZWMzID0gcmVxdWlyZSgnLi9tYXRocy92ZWMzJyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL2FycmF5JyksXG4gICAgICB2ZXJ0aWNlc1V0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL3ZlcnRpY2VzJyk7XG5cbmNvbnN0IHsgYWRkLCBzdWJ0cmFjdCwgc2NhbGUsIHRyYW5zZm9ybSB9ID0gdmVjMyxcbiAgICAgIHsgZmlyc3QsIHNlY29uZCwgdGhpcmQsIHBlcm11dGUgfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBjYWxjdWxhdGVOb3JtYWwsIHJvdGF0ZVZlcnRpY2VzIH0gPSB2ZXJ0aWNlc1V0aWxpdGllcztcblxuY2xhc3MgRmFjZXQge1xuICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgbm9ybWFsKSB7XG4gICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzO1xuICAgIHRoaXMubm9ybWFsID0gbm9ybWFsO1xuICB9XG5cbiAgZ2V0VmVydGljZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMudmVydGljZXM7XG4gIH1cblxuICBnZXROb3JtYWwoKSB7XG4gICAgcmV0dXJuIHRoaXMubm9ybWFsO1xuICB9XG5cbiAgZ2V0TGluZXMoKSB7XG4gICAgY29uc3QgdmVydGljZXNMZW5ndGggPSAzLCAvLy9cbiAgICAgICAgICBsaW5lcyA9IHRoaXMudmVydGljZXMubWFwKGZ1bmN0aW9uKHZlcnRleCwgaW5kZXgpIHtcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0SW5kZXggPSBpbmRleCxcbiAgICAgICAgICAgICAgICAgIGVuZEluZGV4ID0gKHN0YXJ0SW5kZXggKyAxKSAlIHZlcnRpY2VzTGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgc3RhcnRWZXJ0ZXggPSB0aGlzLnZlcnRpY2VzW3N0YXJ0SW5kZXhdLFxuICAgICAgICAgICAgICAgICAgZW5kVmVydGV4ID0gdGhpcy52ZXJ0aWNlc1tlbmRJbmRleF0sXG4gICAgICAgICAgICAgICAgICBsaW5lID0gTGluZS5mcm9tVmVydGljZXMoc3RhcnRWZXJ0ZXgsIGVuZFZlcnRleCk7XG4gIFxuICAgICAgICAgICAgcmV0dXJuIGxpbmU7XG4gICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgIHJldHVybiBsaW5lcztcbiAgfVxuICBcbiAgcm90YXRlKHJvdGF0aW9uUXVhdGVybmlvbikge1xuICAgIHRoaXMudmVydGljZXMgPSByb3RhdGVWZXJ0aWNlcyh0aGlzLnZlcnRpY2VzLCByb3RhdGlvblF1YXRlcm5pb24pO1xuICAgIFxuICAgIHRoaXMubm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHRoaXMudmVydGljZXMpO1xuICB9XG5cbiAgcm90YXRlQWJvdXRaQXhpcyhyb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgpIHtcbiAgICBjb25zdCBtYXQyID0gcm90YXRpb25BYm91dFpBeGlzTWF0cml4OyAgLy8vXG5cbiAgICB0aGlzLnZlcnRpY2VzID0gdGhpcy52ZXJ0aWNlcy5tYXAoZnVuY3Rpb24odmVydGV4KSB7XG4gICAgICBsZXQgdmVjID0gdmVydGV4O1xuXG4gICAgICB2ZWMgPSB0cmFuc2Zvcm0odmVjLCBtYXQyKTtcblxuICAgICAgdmVydGV4ID0gdmVjO1xuXG4gICAgICByZXR1cm4gdmVydGV4O1xuICAgIH0pO1xuXG4gICAgdGhpcy5ub3JtYWwgPSBjYWxjdWxhdGVOb3JtYWwodGhpcy52ZXJ0aWNlcyk7XG4gIH1cbiAgXG4gIHBvc3NpYmx5U3BsaXRXaXRoVmVydGljYWxMaW5lSW5YWVBsYW5lKHZlcnRpY2FsTGluZUluWFlQbGFuZSkge1xuICAgIGNvbnN0IGludGVyc2VjdGlvbnMgPSB0aGlzLmNhbGN1bGF0ZUludGVyc2VjdGlvbnNXaXRoVmVydGljYWxMaW5lSW5YWVBsYW5lKHZlcnRpY2FsTGluZUluWFlQbGFuZSksXG4gICAgICAgICAgaW50ZXJzZWN0aW9uc0luY2x1ZGVzTnVsbCA9IGludGVyc2VjdGlvbnMuaW5jbHVkZXMobnVsbCksXG4gICAgICAgICAgZmFjZXRzID0gaW50ZXJzZWN0aW9uc0luY2x1ZGVzTnVsbCA/XG4gICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc3NpYmx5U3BsaXRXaXRoTnVsbEludGVyc2VjdGlvbihpbnRlcnNlY3Rpb25zKSA6XG4gICAgICAgICAgICAgICAgICAgICAgIHRoaXMucG9zc2libHlTcGxpdFdpdGhvdXROdWxsSW50ZXJzZWN0aW9uKGludGVyc2VjdGlvbnMpO1xuXG4gICAgcmV0dXJuIGZhY2V0cztcbiAgfVxuXG4gIHBvc3NpYmx5U3BsaXRXaXRoTnVsbEludGVyc2VjdGlvbihpbnRlcnNlY3Rpb25zKSB7XG4gICAgbGV0IGZhY2V0cztcblxuICAgIGNvbnN0IG5vbk51bGxJbnRlcnNlY3Rpb25zID0gY2FsY3VsYXRlTm9uTnVsbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgbm9uVHJpdmlhbE5vbk51bGxJbnRlcnNlY3Rpb25zID0gY2FsY3VsYXRlTm9uVHJpdmlhbEludGVyc2VjdGlvbnMobm9uTnVsbEludGVyc2VjdGlvbnMpLFxuICAgICAgICAgIG5vblRyaXZpYWxOb25OdWxsSW50ZXJzZWN0aW9uc0xlbmd0aCA9IG5vblRyaXZpYWxOb25OdWxsSW50ZXJzZWN0aW9ucy5sZW5ndGg7XG5cbiAgICBzd2l0Y2ggKG5vblRyaXZpYWxOb25OdWxsSW50ZXJzZWN0aW9uc0xlbmd0aCkge1xuICAgICAgY2FzZSAyIDpcbiAgICAgICAgZmFjZXRzID0gdGhpcy5zcGxpdFdpdGhOdWxsSW50ZXJzZWN0aW9uKGludGVyc2VjdGlvbnMpO1xuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdCA6XG4gICAgICAgIGZhY2V0cyA9IHRoaXMuZG9Ob3RTcGxpdCgpO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gZmFjZXRzO1xuICB9XG5cbiAgcG9zc2libHlTcGxpdFdpdGhvdXROdWxsSW50ZXJzZWN0aW9uKGludGVyc2VjdGlvbnMpIHtcbiAgICBsZXQgZmFjZXRzO1xuICAgIGNvbnN0IG5vblRyaXZpYWxJbnRlcnNlY3Rpb25zID0gY2FsY3VsYXRlTm9uVHJpdmlhbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgbm9uVHJpdmlhbEludGVyc2VjdGlvbnNMZW5ndGggPSBub25Ucml2aWFsSW50ZXJzZWN0aW9ucy5sZW5ndGg7XG5cbiAgICBzd2l0Y2gobm9uVHJpdmlhbEludGVyc2VjdGlvbnNMZW5ndGgpIHtcbiAgICAgIGNhc2UgMSA6XG4gICAgICAgIGZhY2V0cyA9IHRoaXMuc3BsaXRXaXRoT25lTm9uVHJpdmlhbEludGVyc2VjdGlvbihpbnRlcnNlY3Rpb25zKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgMiA6XG4gICAgICAgIGZhY2V0cyA9IHRoaXMuc3BsaXRXaXRoVHdvTm9uVHJpdmlhbEludGVyc2VjdGlvbihpbnRlcnNlY3Rpb25zKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQgOlxuICAgICAgICBmYWNldHMgPSB0aGlzLmRvTm90U3BsaXQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhY2V0cztcbiAgfVxuXG4gIHNwbGl0V2l0aE51bGxJbnRlcnNlY3Rpb24oaW50ZXJzZWN0aW9ucykge1xuICAgIGNvbnN0IHZlcnRpY2VzTGVuZ3RoID0gMyxcbiAgICAgICAgICBudWxsSW50ZXJzZWN0aW9uSW5kZXggPSBjYWxjdWxhdGVOb25OdWxsSW50ZXJzZWN0aW9uSW5kZXgoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgcGxhY2VzID0gKHZlcnRpY2VzTGVuZ3RoIC0gbnVsbEludGVyc2VjdGlvbkluZGV4KSAlIHZlcnRpY2VzTGVuZ3RoO1xuXG4gICAgaW50ZXJzZWN0aW9ucyA9IHBlcm11dGUoaW50ZXJzZWN0aW9ucywgcGxhY2VzKTtcblxuICAgIHRoaXMudmVydGljZXMgPSBwZXJtdXRlKHRoaXMudmVydGljZXMsIHBsYWNlcyk7XG5cbiAgICBjb25zdCBmaXJzdFZlcnRleCA9IGZpcnN0KHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIHNlY29uZFZlcnRleCA9IHNlY29uZCh0aGlzLnZlcnRpY2VzKSxcbiAgICAgICAgICB0aGlyZFZlcnRleCA9IHRoaXJkKHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIG5vbk51bGxJbnRlcnNlY3Rpb25zID0gaW50ZXJzZWN0aW9ucy5zbGljZSgxKSxcbiAgICAgICAgICBmaXJzdE5vbk51bGxJbnRlcnNlY3Rpb24gPSBmaXJzdChub25OdWxsSW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgc2Vjb25kTm9uTnVsbEludGVyc2VjdGlvbiA9IHNlY29uZChub25OdWxsSW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgZmlyc3RJbnRlcm1lZGlhdGVWZXJ0ZXggPSBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgoc2Vjb25kVmVydGV4LCB0aGlyZFZlcnRleCwgZmlyc3ROb25OdWxsSW50ZXJzZWN0aW9uKSxcbiAgICAgICAgICBzZWNvbmRJbnRlcm1lZGlhdGVWZXJ0ZXggPSBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgodGhpcmRWZXJ0ZXgsIGZpcnN0VmVydGV4LCBzZWNvbmROb25OdWxsSW50ZXJzZWN0aW9uKSxcbiAgICAgICAgICBmaXJzdFZlcnRpY2VzID0gW1xuICAgICAgICAgICAgZmlyc3RWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRJbnRlcm1lZGlhdGVWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIHNlY29uZFZlcnRpY2VzID0gW1xuICAgICAgICAgICAgc2Vjb25kVmVydGV4LFxuICAgICAgICAgICAgZmlyc3RJbnRlcm1lZGlhdGVWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRJbnRlcm1lZGlhdGVWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIHRoaXJkVmVydGljZXMgPSBbXG4gICAgICAgICAgICBmaXJzdEludGVybWVkaWF0ZVZlcnRleCxcbiAgICAgICAgICAgIHRoaXJkVmVydGV4LFxuICAgICAgICAgICAgc2Vjb25kSW50ZXJtZWRpYXRlVmVydGV4XG4gICAgICAgICAgXSxcbiAgICAgICAgICBmaXJzdEZhY2V0ID0gRmFjZXQuZnJvbVZlcnRpY2VzKGZpcnN0VmVydGljZXMpLFxuICAgICAgICAgIHNlY29uZEZhY2V0ID0gRmFjZXQuZnJvbVZlcnRpY2VzKHNlY29uZFZlcnRpY2VzKSxcbiAgICAgICAgICB0aGlyZEZhY2V0ID0gRmFjZXQuZnJvbVZlcnRpY2VzKHRoaXJkVmVydGljZXMpLFxuICAgICAgICAgIGZhY2V0cyA9IFtcbiAgICAgICAgICAgIGZpcnN0RmFjZXQsXG4gICAgICAgICAgICBzZWNvbmRGYWNldCxcbiAgICAgICAgICAgIHRoaXJkRmFjZXRcbiAgICAgICAgICBdO1xuXG4gICAgcmV0dXJuIGZhY2V0cztcbiAgfVxuXG4gIHNwbGl0V2l0aE9uZU5vblRyaXZpYWxJbnRlcnNlY3Rpb24oaW50ZXJzZWN0aW9ucykge1xuICAgIGNvbnN0IHZlcnRpY2VzTGVuZ3RoID0gMyxcbiAgICAgICAgICBub25Ucml2aWFsSW50ZXJzZWN0aW9uSW5kZXggPSBjYWxjdWxhdGVOb25Ucml2aWFsSW50ZXJzZWN0aW9uSW5kZXgoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgcGxhY2VzID0gKHZlcnRpY2VzTGVuZ3RoIC0gbm9uVHJpdmlhbEludGVyc2VjdGlvbkluZGV4KSAlIHZlcnRpY2VzTGVuZ3RoO1xuXG4gICAgaW50ZXJzZWN0aW9ucyA9IHBlcm11dGUoaW50ZXJzZWN0aW9ucywgcGxhY2VzKTtcblxuICAgIHRoaXMudmVydGljZXMgPSBwZXJtdXRlKHRoaXMudmVydGljZXMsIHBsYWNlcyk7XG5cbiAgICBjb25zdCBmaXJzdFZlcnRleCA9IGZpcnN0KHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIHNlY29uZFZlcnRleCA9IHNlY29uZCh0aGlzLnZlcnRpY2VzKSxcbiAgICAgICAgICB0aGlyZFZlcnRleCA9IHRoaXJkKHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIGZpcnN0SW50ZXJzZWN0aW9uID0gZmlyc3QoaW50ZXJzZWN0aW9ucyksXG4gICAgICAgICAgbm9uVHJpdmlhbEludGVyc2VjdGlvbiA9IGZpcnN0SW50ZXJzZWN0aW9uLCAvLy9cbiAgICAgICAgICBpbnRlcm1lZGlhdGVWZXJ0ZXggPSBjYWxjdWxhdGVJbnRlcm1lZGlhdGVWZXJ0ZXgoZmlyc3RWZXJ0ZXgsIHNlY29uZFZlcnRleCwgbm9uVHJpdmlhbEludGVyc2VjdGlvbiksXG4gICAgICAgICAgZmlyc3RWZXJ0aWNlcyA9IFtcbiAgICAgICAgICAgIGZpcnN0VmVydGV4LFxuICAgICAgICAgICAgaW50ZXJtZWRpYXRlVmVydGV4LFxuICAgICAgICAgICAgdGhpcmRWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIHNlY29uZFZlcnRpY2VzID0gW1xuICAgICAgICAgICAgaW50ZXJtZWRpYXRlVmVydGV4LFxuICAgICAgICAgICAgc2Vjb25kVmVydGV4LFxuICAgICAgICAgICAgdGhpcmRWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIGZpcnN0RmFjZXRJblhZUGxhbmUgPSBGYWNldC5mcm9tVmVydGljZXMoZmlyc3RWZXJ0aWNlcyksXG4gICAgICAgICAgc2Vjb25kRmFjZXRJblhZUGxhbmUgPSBGYWNldC5mcm9tVmVydGljZXMoc2Vjb25kVmVydGljZXMpLFxuICAgICAgICAgIGZhY2V0cyA9IFtcbiAgICAgICAgICAgIGZpcnN0RmFjZXRJblhZUGxhbmUsXG4gICAgICAgICAgICBzZWNvbmRGYWNldEluWFlQbGFuZVxuICAgICAgICAgIF07XG5cbiAgICByZXR1cm4gZmFjZXRzO1xuICB9XG5cbiAgc3BsaXRXaXRoVHdvTm9uVHJpdmlhbEludGVyc2VjdGlvbihpbnRlcnNlY3Rpb25zKSB7XG4gICAgY29uc3QgdmVydGljZXNMZW5ndGggPSAzLFxuICAgICAgICAgIHRyaXZpYWxJbnRlcnNlY3Rpb25JbmRleCA9IGNhbGN1bGF0ZVRyaXZpYWxJbnRlcnNlY3Rpb25JbmRleChpbnRlcnNlY3Rpb25zKSxcbiAgICAgICAgICBwbGFjZXMgPSAodmVydGljZXNMZW5ndGggLSB0cml2aWFsSW50ZXJzZWN0aW9uSW5kZXgpICUgdmVydGljZXNMZW5ndGg7XG5cbiAgICBpbnRlcnNlY3Rpb25zID0gcGVybXV0ZShpbnRlcnNlY3Rpb25zLCBwbGFjZXMpO1xuXG4gICAgdGhpcy52ZXJ0aWNlcyA9IHBlcm11dGUodGhpcy52ZXJ0aWNlcywgcGxhY2VzKTtcblxuICAgIGNvbnN0IGZpcnN0VmVydGV4ID0gZmlyc3QodGhpcy52ZXJ0aWNlcyksXG4gICAgICAgICAgc2Vjb25kVmVydGV4ID0gc2Vjb25kKHRoaXMudmVydGljZXMpLFxuICAgICAgICAgIHRoaXJkVmVydGV4ID0gdGhpcmQodGhpcy52ZXJ0aWNlcyksXG4gICAgICAgICAgbm9uVHJpdmlhbEludGVyc2VjdGlvbnMgPSBpbnRlcnNlY3Rpb25zLnNsaWNlKDEpLFxuICAgICAgICAgIGZpcnN0Tm9uVHJpdmlhbEludGVyc2VjdGlvbiA9IGZpcnN0KG5vblRyaXZpYWxJbnRlcnNlY3Rpb25zKSxcbiAgICAgICAgICBzZWNvbmROb25Ucml2aWFsSW50ZXJzZWN0aW9uID0gc2Vjb25kKG5vblRyaXZpYWxJbnRlcnNlY3Rpb25zKSxcbiAgICAgICAgICBmaXJzdEludGVybWVkaWF0ZVZlcnRleCA9IGNhbGN1bGF0ZUludGVybWVkaWF0ZVZlcnRleChzZWNvbmRWZXJ0ZXgsIHRoaXJkVmVydGV4LCBmaXJzdE5vblRyaXZpYWxJbnRlcnNlY3Rpb24pLFxuICAgICAgICAgIHNlY29uZEludGVybWVkaWF0ZVZlcnRleCA9IGNhbGN1bGF0ZUludGVybWVkaWF0ZVZlcnRleCh0aGlyZFZlcnRleCwgZmlyc3RWZXJ0ZXgsIHNlY29uZE5vblRyaXZpYWxJbnRlcnNlY3Rpb24pLFxuICAgICAgICAgIGZpcnN0VmVydGljZXMgPSBbXG4gICAgICAgICAgICBmaXJzdFZlcnRleCxcbiAgICAgICAgICAgIHNlY29uZFZlcnRleCxcbiAgICAgICAgICAgIGZpcnN0SW50ZXJtZWRpYXRlVmVydGV4XG4gICAgICAgICAgXSxcbiAgICAgICAgICBzZWNvbmRWZXJ0aWNlcyA9IFtcbiAgICAgICAgICAgIGZpcnN0VmVydGV4LFxuICAgICAgICAgICAgZmlyc3RJbnRlcm1lZGlhdGVWZXJ0ZXgsXG4gICAgICAgICAgICBzZWNvbmRJbnRlcm1lZGlhdGVWZXJ0ZXhcbiAgICAgICAgICBdLFxuICAgICAgICAgIHRoaXJkVmVydGljZXMgPSBbXG4gICAgICAgICAgICBmaXJzdEludGVybWVkaWF0ZVZlcnRleCxcbiAgICAgICAgICAgIHRoaXJkVmVydGV4LFxuICAgICAgICAgICAgc2Vjb25kSW50ZXJtZWRpYXRlVmVydGV4XG4gICAgICAgICAgXSxcbiAgICAgICAgICBmaXJzdEZhY2V0SW5YWVBsYW5lID0gRmFjZXQuZnJvbVZlcnRpY2VzKGZpcnN0VmVydGljZXMpLFxuICAgICAgICAgIHNlY29uZEZhY2V0SW5YWVBsYW5lID0gRmFjZXQuZnJvbVZlcnRpY2VzKHNlY29uZFZlcnRpY2VzKSxcbiAgICAgICAgICB0aGlyZEZhY2V0SW5YWVBsYW5lID0gRmFjZXQuZnJvbVZlcnRpY2VzKHRoaXJkVmVydGljZXMpLFxuICAgICAgICAgIGZhY2V0cyA9IFtcbiAgICAgICAgICAgIGZpcnN0RmFjZXRJblhZUGxhbmUsXG4gICAgICAgICAgICBzZWNvbmRGYWNldEluWFlQbGFuZSxcbiAgICAgICAgICAgIHRoaXJkRmFjZXRJblhZUGxhbmVcbiAgICAgICAgICBdO1xuXG4gICAgcmV0dXJuIGZhY2V0cztcbiAgfVxuXG4gIGRvTm90U3BsaXQoKSB7XG4gICAgY29uc3QgZmFjZXQgPSB0aGlzLCAgLy8vXG4gICAgICAgICAgZmFjZXRzID0gW1xuICAgICAgICAgICAgZmFjZXRcbiAgICAgICAgICBdO1xuXG4gICAgcmV0dXJuIGZhY2V0cztcbiAgfVxuXG4gIGNhbGN1bGF0ZUludGVyc2VjdGlvbnNXaXRoVmVydGljYWxMaW5lSW5YWVBsYW5lKHZlcnRpY2FsTGluZUluWFlQbGFuZSkge1xuICAgIGNvbnN0IGxpbmVzID0gdGhpcy5nZXRMaW5lcygpLFxuICAgICAgICAgIGludGVyc2VjdGlvbnMgPSBsaW5lcy5tYXAoZnVuY3Rpb24obGluZSkge1xuICAgICAgICAgICAgY29uc3QgaW50ZXJzZWN0aW9uID0gbGluZS5jYWxjdWxhdGVJbnRlcnNlY3Rpb25XaXRoVmVydGljYWxMaW5lSW5YWVBsYW5lKHZlcnRpY2FsTGluZUluWFlQbGFuZSk7XG4gIFxuICAgICAgICAgICAgcmV0dXJuIGludGVyc2VjdGlvbjtcbiAgICAgICAgICB9KTtcblxuICAgIHJldHVybiBpbnRlcnNlY3Rpb25zO1xuICB9XG5cbiAgc3RhdGljIGZyb21WZXJ0aWNlcyh2ZXJ0aWNlcykge1xuICAgIGNvbnN0IG5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCh2ZXJ0aWNlcyksXG4gICAgICAgICAgZmFjZXQgPSBuZXcgRmFjZXQodmVydGljZXMsIG5vcm1hbCk7XG5cbiAgICByZXR1cm4gZmFjZXQ7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBGYWNldDtcblxuZnVuY3Rpb24gaXNJbnRlcnNlY3Rpb25Ucml2aWFsKGludGVyc2VjdGlvbikge1xuICBjb25zdCBpbnRlcnNlY3Rpb25Ob25Ucml2aWFsID0gaXNJbnRlcnNlY3Rpb25Ob25Ucml2aWFsKGludGVyc2VjdGlvbiksXG4gICAgICBpbnRlcnNlY3Rpb25Ucml2aWFsID0gIWludGVyc2VjdGlvbk5vblRyaXZpYWw7XG5cbiAgcmV0dXJuIGludGVyc2VjdGlvblRyaXZpYWw7XG59XG5cbmZ1bmN0aW9uIGlzSW50ZXJzZWN0aW9uTm9uVHJpdmlhbChpbnRlcnNlY3Rpb24pIHtcbiAgY29uc3QgaW50ZXJzZWN0aW9uTm9uVHJpdmlhbCA9ICgoaW50ZXJzZWN0aW9uID4gMCkgJiYgKGludGVyc2VjdGlvbiA8IDEpKTtcblxuICByZXR1cm4gaW50ZXJzZWN0aW9uTm9uVHJpdmlhbDtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlSW50ZXJtZWRpYXRlVmVydGV4KHN0YXJ0VmVydGV4LCBlbmRWZXJ0ZXgsIG5vbk51bGxJbnRlcnNlY3Rpb24pIHtcbiAgY29uc3QgZGlyZWN0aW9uID0gc3VidHJhY3QoZW5kVmVydGV4LCBzdGFydFZlcnRleCksXG4gICAgICBvZmZzZXQgPSBzY2FsZShkaXJlY3Rpb24sIG5vbk51bGxJbnRlcnNlY3Rpb24pLFxuICAgICAgaW50ZXJtZWRpYXRlVmVydGV4ID0gYWRkKHN0YXJ0VmVydGV4LCBvZmZzZXQpO1xuXG4gIHJldHVybiBpbnRlcm1lZGlhdGVWZXJ0ZXg7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZU5vbk51bGxJbnRlcnNlY3Rpb25zKGludGVyc2VjdGlvbnMpIHtcbiAgY29uc3Qgbm9uTnVsbEludGVyc2VjdGlvbnMgPSBpbnRlcnNlY3Rpb25zLnJlZHVjZShmdW5jdGlvbihub25OdWxsSW50ZXJzZWN0aW9ucywgaW50ZXJzZWN0aW9uKSB7XG4gICAgY29uc3QgaW50ZXJzZWN0aW9uTm9uTnVsbCA9IChpbnRlcnNlY3Rpb24gIT09IG51bGwpO1xuXG4gICAgaWYgKGludGVyc2VjdGlvbk5vbk51bGwpIHtcbiAgICAgIGNvbnN0IG5vbk51bGxJbnRlcnNlY3Rpb24gPSBpbnRlcnNlY3Rpb247IC8vL1xuXG4gICAgICBub25OdWxsSW50ZXJzZWN0aW9ucy5wdXNoKG5vbk51bGxJbnRlcnNlY3Rpb24pO1xuICAgIH1cblxuICAgIHJldHVybiBub25OdWxsSW50ZXJzZWN0aW9ucztcbiAgfSwgW10pO1xuXG4gIHJldHVybiBub25OdWxsSW50ZXJzZWN0aW9ucztcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlTm9uVHJpdmlhbEludGVyc2VjdGlvbnMoaW50ZXJzZWN0aW9ucykge1xuICBjb25zdCBub25Ucml2aWFsSW50ZXJzZWN0aW9ucyA9IGludGVyc2VjdGlvbnMucmVkdWNlKGZ1bmN0aW9uKG5vblRyaXZpYWxJbnRlcnNlY3Rpb25zLCBpbnRlcnNlY3Rpb24pIHtcbiAgICBjb25zdCBpbnRlcnNlY3Rpb25Ob25Ucml2aWFsID0gaXNJbnRlcnNlY3Rpb25Ob25Ucml2aWFsKGludGVyc2VjdGlvbik7XG5cbiAgICBpZiAoaW50ZXJzZWN0aW9uTm9uVHJpdmlhbCkge1xuICAgICAgY29uc3Qgbm9uVHJpdmlhbEludGVyc2VjdGlvbiA9IGludGVyc2VjdGlvbjsgIC8vL1xuXG4gICAgICBub25Ucml2aWFsSW50ZXJzZWN0aW9ucy5wdXNoKG5vblRyaXZpYWxJbnRlcnNlY3Rpb24pO1xuICAgIH1cblxuICAgIHJldHVybiBub25Ucml2aWFsSW50ZXJzZWN0aW9ucztcbiAgfSwgW10pO1xuXG4gIHJldHVybiBub25Ucml2aWFsSW50ZXJzZWN0aW9ucztcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlTm9uTnVsbEludGVyc2VjdGlvbkluZGV4KGludGVyc2VjdGlvbnMpIHtcbiAgY29uc3QgbnVsbEludGVyc2VjdGlvbkluZGV4ID0gaW50ZXJzZWN0aW9ucy5pbmRleE9mKG51bGwpO1xuXG4gIHJldHVybiBudWxsSW50ZXJzZWN0aW9uSW5kZXg7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVRyaXZpYWxJbnRlcnNlY3Rpb25JbmRleChpbnRlcnNlY3Rpb25zKSB7XG4gIGNvbnN0IHRyaXZpYWxJbnRlcnNlY3Rpb25JbmRleCA9IGludGVyc2VjdGlvbnMucmVkdWNlKGZ1bmN0aW9uKHRyaXZpYWxJbnRlcnNlY3Rpb25JbmRleCwgaW50ZXJzZWN0aW9uLCBpbmRleCkge1xuICAgIGlmICh0cml2aWFsSW50ZXJzZWN0aW9uSW5kZXggPT09IG51bGwpIHtcbiAgICAgIGNvbnN0IGludGVyc2VjdGlvbk5vblRyaXZpYWwgPSBpc0ludGVyc2VjdGlvblRyaXZpYWwoaW50ZXJzZWN0aW9uKTtcblxuICAgICAgaWYgKGludGVyc2VjdGlvbk5vblRyaXZpYWwpIHtcbiAgICAgICAgdHJpdmlhbEludGVyc2VjdGlvbkluZGV4ID0gaW5kZXg7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRyaXZpYWxJbnRlcnNlY3Rpb25JbmRleDtcbiAgfSwgbnVsbCk7XG5cbiAgcmV0dXJuIHRyaXZpYWxJbnRlcnNlY3Rpb25JbmRleDtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlTm9uVHJpdmlhbEludGVyc2VjdGlvbkluZGV4KGludGVyc2VjdGlvbnMpIHtcbiAgY29uc3Qgbm9uVHJpdmlhbEludGVyc2VjdGlvbkluZGV4ID0gaW50ZXJzZWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24obm9uVHJpdmlhbEludGVyc2VjdGlvbkluZGV4LCBpbnRlcnNlY3Rpb24sIGluZGV4KSB7XG4gICAgaWYgKG5vblRyaXZpYWxJbnRlcnNlY3Rpb25JbmRleCA9PT0gbnVsbCkge1xuICAgICAgY29uc3QgaW50ZXJzZWN0aW9uTm9uVHJpdmlhbCA9IGlzSW50ZXJzZWN0aW9uTm9uVHJpdmlhbChpbnRlcnNlY3Rpb24pO1xuXG4gICAgICBpZiAoaW50ZXJzZWN0aW9uTm9uVHJpdmlhbCkge1xuICAgICAgICBub25Ucml2aWFsSW50ZXJzZWN0aW9uSW5kZXggPSBpbmRleDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbm9uVHJpdmlhbEludGVyc2VjdGlvbkluZGV4O1xuICB9LCBudWxsKTtcblxuICByZXR1cm4gbm9uVHJpdmlhbEludGVyc2VjdGlvbkluZGV4O1xufVxuIl19