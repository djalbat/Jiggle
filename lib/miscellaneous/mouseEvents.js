"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var constants = require("../constants");

var MOUSE_UP = constants.MOUSE_UP,
    MOUSE_DOWN = constants.MOUSE_DOWN,
    MOUSE_MOVE = constants.MOUSE_MOVE,
    MOUSE_WHEEL = constants.MOUSE_WHEEL;

var MouseEvents = /*#__PURE__*/function () {
  function MouseEvents(handlersMap, mouseDown) {
    _classCallCheck(this, MouseEvents);

    this.handlersMap = handlersMap;
    this.mouseDown = mouseDown;
  }

  _createClass(MouseEvents, [{
    key: "mouseEventListener",
    value: function mouseEventListener(event, eventType) {
      var _this = this;

      var handlers = this.handlersMap[eventType],
          mouseCoordinates = mouseCoordinatesFromEvent(event);
      handlers.forEach(function (handler) {
        return handler(mouseCoordinates, _this.mouseDown);
      });
      event.preventDefault();
    }
  }, {
    key: "mouseUpEventListener",
    value: function mouseUpEventListener(event) {
      this.mouseDown = false;
      this.mouseEventListener(event, MOUSE_UP);
    }
  }, {
    key: "mouseDownEventListener",
    value: function mouseDownEventListener(event) {
      this.mouseDown = true;
      this.mouseEventListener(event, MOUSE_DOWN);
    }
  }, {
    key: "mouseMoveEventListener",
    value: function mouseMoveEventListener(event) {
      this.mouseEventListener(event, MOUSE_MOVE);
    }
  }, {
    key: "mouseWheelEventListener",
    value: function mouseWheelEventListener(event) {
      var handlers = this.handlersMap[MOUSE_WHEEL],
          mouseWheelDelta = mouseWheelDeltaFromEvent(event);
      handlers.forEach(function (handler) {
        return handler(mouseWheelDelta);
      });
      event.preventDefault();
    }
  }, {
    key: "addMouseUpHandler",
    value: function addMouseUpHandler(mouseUpHandler) {
      var mouseUpHandlers = this.handlersMap[MOUSE_UP];
      mouseUpHandlers.push(mouseUpHandler);
    }
  }, {
    key: "addMouseDownHandler",
    value: function addMouseDownHandler(mouseDownHandler) {
      var mouseDownHandlers = this.handlersMap[MOUSE_DOWN];
      mouseDownHandlers.push(mouseDownHandler);
    }
  }, {
    key: "addMouseMoveHandler",
    value: function addMouseMoveHandler(mouseMoveHandler) {
      var mouseMoveHandlers = this.handlersMap[MOUSE_MOVE];
      mouseMoveHandlers.push(mouseMoveHandler);
    }
  }, {
    key: "addMouseWheelHandler",
    value: function addMouseWheelHandler(mouseWheelHandler) {
      var mouseWheelHandlers = this.handlersMap[MOUSE_WHEEL];
      mouseWheelHandlers.push(mouseWheelHandler);
    }
  }, {
    key: "initialise",
    value: function initialise(canvas) {
      var canvasDOMElement = canvas.getDOMElement(),
          mouseUpEventListener = this.mouseUpEventListener.bind(this),
          mouseDownEventListener = this.mouseDownEventListener.bind(this),
          mouseMoveEventListener = this.mouseMoveEventListener.bind(this),
          mouseWheelEventListener = this.mouseWheelEventListener.bind(this);
      this.handlersMap[MOUSE_UP] = [];
      this.handlersMap[MOUSE_DOWN] = [];
      this.handlersMap[MOUSE_MOVE] = [];
      this.handlersMap[MOUSE_WHEEL] = [];
      canvasDOMElement.addEventListener("mouseup", mouseUpEventListener);
      canvasDOMElement.addEventListener("mousedown", mouseDownEventListener);
      canvasDOMElement.addEventListener("mousemove", mouseMoveEventListener);
      canvasDOMElement.addEventListener("mousewheel", mouseWheelEventListener);
    }
  }], [{
    key: "fromNothing",
    value: function fromNothing() {
      var handlersMap = {},
          mouseDown = false,
          ///
      mouseEvents = new MouseEvents(handlersMap, mouseDown);
      return mouseEvents;
    }
  }]);

  return MouseEvents;
}();

module.exports = MouseEvents;

function mouseWheelDeltaFromEvent(event) {
  var mouseWheelDelta = Math.max(-1, Math.min(1, event.wheelDelta)); ///

  return mouseWheelDelta;
}

function mouseCoordinatesFromEvent(event) {
  var target = event.target,
      clientX = event.clientX,
      clientY = event.clientY,
      canvasDOMElement = target,
      boundingClientRect = canvasDOMElement.getBoundingClientRect(),
      top = boundingClientRect.top,
      left = boundingClientRect.left,
      mouseCoordinates = [clientX - left, top - clientY];
  return mouseCoordinates;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vdXNlRXZlbnRzLmpzIl0sIm5hbWVzIjpbImNvbnN0YW50cyIsInJlcXVpcmUiLCJNT1VTRV9VUCIsIk1PVVNFX0RPV04iLCJNT1VTRV9NT1ZFIiwiTU9VU0VfV0hFRUwiLCJNb3VzZUV2ZW50cyIsImhhbmRsZXJzTWFwIiwibW91c2VEb3duIiwiZXZlbnQiLCJldmVudFR5cGUiLCJoYW5kbGVycyIsIm1vdXNlQ29vcmRpbmF0ZXMiLCJtb3VzZUNvb3JkaW5hdGVzRnJvbUV2ZW50IiwiZm9yRWFjaCIsImhhbmRsZXIiLCJwcmV2ZW50RGVmYXVsdCIsIm1vdXNlRXZlbnRMaXN0ZW5lciIsIm1vdXNlV2hlZWxEZWx0YSIsIm1vdXNlV2hlZWxEZWx0YUZyb21FdmVudCIsIm1vdXNlVXBIYW5kbGVyIiwibW91c2VVcEhhbmRsZXJzIiwicHVzaCIsIm1vdXNlRG93bkhhbmRsZXIiLCJtb3VzZURvd25IYW5kbGVycyIsIm1vdXNlTW92ZUhhbmRsZXIiLCJtb3VzZU1vdmVIYW5kbGVycyIsIm1vdXNlV2hlZWxIYW5kbGVyIiwibW91c2VXaGVlbEhhbmRsZXJzIiwiY2FudmFzIiwiY2FudmFzRE9NRWxlbWVudCIsImdldERPTUVsZW1lbnQiLCJtb3VzZVVwRXZlbnRMaXN0ZW5lciIsImJpbmQiLCJtb3VzZURvd25FdmVudExpc3RlbmVyIiwibW91c2VNb3ZlRXZlbnRMaXN0ZW5lciIsIm1vdXNlV2hlZWxFdmVudExpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm1vdXNlRXZlbnRzIiwibW9kdWxlIiwiZXhwb3J0cyIsIk1hdGgiLCJtYXgiLCJtaW4iLCJ3aGVlbERlbHRhIiwidGFyZ2V0IiwiY2xpZW50WCIsImNsaWVudFkiLCJib3VuZGluZ0NsaWVudFJlY3QiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJ0b3AiLCJsZWZ0Il0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7QUFFQSxJQUFNQSxTQUFTLEdBQUdDLE9BQU8sQ0FBQyxjQUFELENBQXpCOztJQUVR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QkMsT0FEd0IsR0FDSHJDLEtBREcsQ0FDeEJxQyxPQUR3QjtBQUFBLE1BQ2ZDLE9BRGUsR0FDSHRDLEtBREcsQ0FDZnNDLE9BRGU7QUFBQSxNQUVsQ2pCLGdCQUZrQyxHQUVmZSxNQUZlO0FBQUEsTUFHbENHLGtCQUhrQyxHQUdibEIsZ0JBQWdCLENBQUNtQixxQkFBakIsRUFIYTtBQUFBLE1BSWxDQyxHQUprQyxHQUk1QkYsa0JBQWtCLENBQUNFLEdBSlM7QUFBQSxNQUtsQ0MsSUFMa0MsR0FLM0JILGtCQUFrQixDQUFDRyxJQUxRO0FBQUEsTUFNbEN2QyxnQkFOa0MsR0FNZixDQUVqQmtDLE9BQU8sR0FBR0ssSUFGTyxFQUlqQkQsR0FBRyxHQUFHSCxPQUpXLENBTmU7QUFjeEMsU0FBT25DLGdCQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuY29uc3QgY29uc3RhbnRzID0gcmVxdWlyZShcIi4uL2NvbnN0YW50c1wiKTtcblxuY29uc3QgeyBNT1VTRV9VUCwgTU9VU0VfRE9XTiwgTU9VU0VfTU9WRSwgTU9VU0VfV0hFRUwgfSA9IGNvbnN0YW50cztcblxuY2xhc3MgTW91c2VFdmVudHMge1xuICBjb25zdHJ1Y3RvcihoYW5kbGVyc01hcCwgbW91c2VEb3duKSB7XG4gICAgdGhpcy5oYW5kbGVyc01hcCA9IGhhbmRsZXJzTWFwO1xuICAgIHRoaXMubW91c2VEb3duID0gbW91c2VEb3duO1xuICB9XG5cbiAgbW91c2VFdmVudExpc3RlbmVyKGV2ZW50LCBldmVudFR5cGUpIHtcbiAgICBjb25zdCBoYW5kbGVycyA9IHRoaXMuaGFuZGxlcnNNYXBbZXZlbnRUeXBlXSxcbiAgICAgICAgICBtb3VzZUNvb3JkaW5hdGVzID0gbW91c2VDb29yZGluYXRlc0Zyb21FdmVudChldmVudCk7XG5cbiAgICBoYW5kbGVycy5mb3JFYWNoKChoYW5kbGVyKSA9PiBoYW5kbGVyKG1vdXNlQ29vcmRpbmF0ZXMsIHRoaXMubW91c2VEb3duKSk7XG5cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG5cbiAgbW91c2VVcEV2ZW50TGlzdGVuZXIoZXZlbnQpIHtcbiAgICB0aGlzLm1vdXNlRG93biA9IGZhbHNlO1xuXG4gICAgdGhpcy5tb3VzZUV2ZW50TGlzdGVuZXIoZXZlbnQsIE1PVVNFX1VQKTtcbiAgfVxuXG5cdG1vdXNlRG93bkV2ZW50TGlzdGVuZXIoZXZlbnQpIHtcbiAgICB0aGlzLm1vdXNlRG93biA9IHRydWU7XG5cbiAgICB0aGlzLm1vdXNlRXZlbnRMaXN0ZW5lcihldmVudCwgTU9VU0VfRE9XTik7XG4gIH1cblxuXHRtb3VzZU1vdmVFdmVudExpc3RlbmVyKGV2ZW50KSB7XG4gICAgdGhpcy5tb3VzZUV2ZW50TGlzdGVuZXIoZXZlbnQsIE1PVVNFX01PVkUpO1xuICB9XG5cbiAgbW91c2VXaGVlbEV2ZW50TGlzdGVuZXIoZXZlbnQpIHtcbiAgICBjb25zdCBoYW5kbGVycyA9IHRoaXMuaGFuZGxlcnNNYXBbIE1PVVNFX1dIRUVMIF0sXG4gICAgICAgICAgbW91c2VXaGVlbERlbHRhID0gbW91c2VXaGVlbERlbHRhRnJvbUV2ZW50KGV2ZW50KTtcblxuICAgIGhhbmRsZXJzLmZvckVhY2goKGhhbmRsZXIpID0+IGhhbmRsZXIobW91c2VXaGVlbERlbHRhKSk7XG5cblx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG5cbiAgYWRkTW91c2VVcEhhbmRsZXIobW91c2VVcEhhbmRsZXIpIHtcbiAgICBjb25zdCBtb3VzZVVwSGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzTWFwWyBNT1VTRV9VUCBdO1xuXG4gICAgbW91c2VVcEhhbmRsZXJzLnB1c2gobW91c2VVcEhhbmRsZXIpO1xuICB9XG5cbiAgYWRkTW91c2VEb3duSGFuZGxlcihtb3VzZURvd25IYW5kbGVyKSB7XG4gICAgY29uc3QgbW91c2VEb3duSGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzTWFwWyBNT1VTRV9ET1dOIF07XG5cbiAgICBtb3VzZURvd25IYW5kbGVycy5wdXNoKG1vdXNlRG93bkhhbmRsZXIpO1xuICB9XG5cbiAgYWRkTW91c2VNb3ZlSGFuZGxlcihtb3VzZU1vdmVIYW5kbGVyKSB7XG4gICAgY29uc3QgbW91c2VNb3ZlSGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzTWFwWyBNT1VTRV9NT1ZFIF07XG5cbiAgICBtb3VzZU1vdmVIYW5kbGVycy5wdXNoKG1vdXNlTW92ZUhhbmRsZXIpO1xuICB9XG5cbiAgYWRkTW91c2VXaGVlbEhhbmRsZXIobW91c2VXaGVlbEhhbmRsZXIpIHtcbiAgICBjb25zdCBtb3VzZVdoZWVsSGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzTWFwWyBNT1VTRV9XSEVFTCBdO1xuXG4gICAgbW91c2VXaGVlbEhhbmRsZXJzLnB1c2gobW91c2VXaGVlbEhhbmRsZXIpO1xuICB9XG5cbiAgaW5pdGlhbGlzZShjYW52YXMpIHtcbiAgICAgIGNvbnN0IGNhbnZhc0RPTUVsZW1lbnQgPSBjYW52YXMuZ2V0RE9NRWxlbWVudCgpLFxuICAgICAgICAgICAgbW91c2VVcEV2ZW50TGlzdGVuZXIgPSB0aGlzLm1vdXNlVXBFdmVudExpc3RlbmVyLmJpbmQodGhpcyksXG4gICAgICAgICAgICBtb3VzZURvd25FdmVudExpc3RlbmVyID0gdGhpcy5tb3VzZURvd25FdmVudExpc3RlbmVyLmJpbmQodGhpcyksXG4gICAgICAgICAgICBtb3VzZU1vdmVFdmVudExpc3RlbmVyID0gdGhpcy5tb3VzZU1vdmVFdmVudExpc3RlbmVyLmJpbmQodGhpcyksXG4gICAgICAgICAgICBtb3VzZVdoZWVsRXZlbnRMaXN0ZW5lciA9IHRoaXMubW91c2VXaGVlbEV2ZW50TGlzdGVuZXIuYmluZCh0aGlzKTtcblxuICAgIHRoaXMuaGFuZGxlcnNNYXBbIE1PVVNFX1VQIF0gPSBbXTtcbiAgICB0aGlzLmhhbmRsZXJzTWFwWyBNT1VTRV9ET1dOIF0gPSBbXTtcbiAgICB0aGlzLmhhbmRsZXJzTWFwWyBNT1VTRV9NT1ZFIF0gPSBbXTtcbiAgICB0aGlzLmhhbmRsZXJzTWFwWyBNT1VTRV9XSEVFTCBdID0gW107XG5cbiAgICBjYW52YXNET01FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIG1vdXNlVXBFdmVudExpc3RlbmVyKTtcblxuICAgIGNhbnZhc0RPTUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBtb3VzZURvd25FdmVudExpc3RlbmVyKTtcblxuICAgIGNhbnZhc0RPTUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBtb3VzZU1vdmVFdmVudExpc3RlbmVyKTtcblxuICAgIGNhbnZhc0RPTUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNld2hlZWxcIiwgbW91c2VXaGVlbEV2ZW50TGlzdGVuZXIpO1xuICB9XG5cbiAgc3RhdGljIGZyb21Ob3RoaW5nKCkge1xuICAgIGNvbnN0IGhhbmRsZXJzTWFwID0ge30sXG4gICAgICAgICAgbW91c2VEb3duID0gZmFsc2UsICAvLy9cblx0XHRcdFx0XHRtb3VzZUV2ZW50cyA9IG5ldyBNb3VzZUV2ZW50cyhoYW5kbGVyc01hcCwgbW91c2VEb3duKTtcblxuICAgIHJldHVybiBtb3VzZUV2ZW50cztcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IE1vdXNlRXZlbnRzO1xuXG5mdW5jdGlvbiBtb3VzZVdoZWVsRGVsdGFGcm9tRXZlbnQoZXZlbnQpIHtcbiAgY29uc3QgbW91c2VXaGVlbERlbHRhID0gTWF0aC5tYXgoLTEsIE1hdGgubWluKDEsIGV2ZW50LndoZWVsRGVsdGEpKTsgLy8vXG5cbiAgcmV0dXJuIG1vdXNlV2hlZWxEZWx0YTtcbn1cblxuZnVuY3Rpb24gbW91c2VDb29yZGluYXRlc0Zyb21FdmVudChldmVudCkge1xuICBjb25zdCB7IHRhcmdldCwgY2xpZW50WCwgY2xpZW50WSB9ID0gZXZlbnQsXG4gICAgICAgIGNhbnZhc0RPTUVsZW1lbnQgPSB0YXJnZXQsICAvLy9cbiAgICAgICAgYm91bmRpbmdDbGllbnRSZWN0ID0gY2FudmFzRE9NRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgdG9wID0gYm91bmRpbmdDbGllbnRSZWN0LnRvcCxcbiAgICAgICAgbGVmdCA9IGJvdW5kaW5nQ2xpZW50UmVjdC5sZWZ0LFxuICAgICAgICBtb3VzZUNvb3JkaW5hdGVzID0gW1xuXG4gICAgICAgICAgY2xpZW50WCAtIGxlZnQsXG5cbiAgICAgICAgICB0b3AgLSBjbGllbnRZLFxuXG4gICAgICAgIF07XG5cbiAgcmV0dXJuIG1vdXNlQ29vcmRpbmF0ZXM7XG59XG4iXX0=