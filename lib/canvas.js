'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var mat4 = require('gl-mat4'); ///

var domUtilities = require('./utilities/dom'),
    bufferMixin = require('./mixin/buffer'),
    shaderMixin = require('./mixin/shader'),
    colourMixin = require('./mixin/colour'),
    depthMixin = require('./mixin/depth');

var domElementFromSelector = domUtilities.domElementFromSelector;


var defaultOffset = 0;

var Canvas = function () {
  function Canvas() {
    var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'canvas';

    _classCallCheck(this, Canvas);

    var domElement = domElementFromSelector(selector),
        context = domElement.getContext('webgl');

    if (!context) {
      throw new Error('Unable to initialise the context.');
    }

    this.context = context;

    this.domElement = domElement;

    this.FLOAT_TYPE = this.context.FLOAT; ///
    this.TRIANGLES_MODE = this.context.TRIANGLES; ///
    this.DEPTH_TEST_CAP = this.context.DEPTH_TEST; ///
    this.LEQUAL_FUNCTION = this.context.LEQUAL; ///
    this.STATIC_DRAW_USAGE = this.context.STATIC_DRAW; ///
    this.LINK_STATUS_PNAME = this.context.LINK_STATUS; ///
    this.VERTEX_SHADER_TYPE = this.context.VERTEX_SHADER; ///
    this.ARRAY_BUFFER_TARGET = this.context.ARRAY_BUFFER; ///
    this.UNSIGNED_SHORT_TYPE = this.context.UNSIGNED_SHORT; ///
    this.TRIANGLE_STRIP_MODE = this.context.TRIANGLE_STRIP; ///
    this.COMPILE_STATUS_PNAME = this.context.COMPILE_STATUS; ///
    this.FRAGMENT_SHADER_TYPE = this.context.FRAGMENT_SHADER; ///
    this.COLOR_BUFFER_BIT_MASK = this.context.COLOR_BUFFER_BIT; ///
    this.DEPTH_BUFFER_BIT_MASK = this.context.DEPTH_BUFFER_BIT; ///
    this.ELEMENT_ARRAY_BUFFER_TARGET = this.context.ELEMENT_ARRAY_BUFFER; ///
  }

  _createClass(Canvas, [{
    key: 'getContext',
    value: function getContext() {
      return this.context;
    }
  }, {
    key: 'getClientWidth',
    value: function getClientWidth() {
      return this.domElement.clientWidth;
    }
  }, {
    key: 'getClientHeight',
    value: function getClientHeight() {
      return this.domElement.clientHeight;
    }
  }, {
    key: 'getUniformLocation',
    value: function getUniformLocation(program, name) {
      return this.context.getUniformLocation(program, name);
    }
  }, {
    key: 'getAttributeLocation',
    value: function getAttributeLocation(program, name) {
      return this.context.getAttribLocation(program, name);
    }
  }, {
    key: 'useProgram',
    value: function useProgram(program) {
      this.context.useProgram(program);
    }
  }, {
    key: 'render',
    value: function render(shaderProgram, projection, modelView, elapsedTime) {
      var projectionMatrix = projection.getMatrix(),
          modelViewMatrix = modelView.getMatrix(),
          projectionMatrixUniformLocation = this.getUniformLocation(shaderProgram, 'uProjectionMatrix'),
          modelViewMatrixUniformLocation = this.getUniformLocation(shaderProgram, 'uModelViewMatrix');

      this.clearColour();
      this.clearDepth();
      this.clearColourBuffer();
      this.clearDepthBuffer();

      var rotation = elapsedTime / 1000;

      var rotatedModelViewMatrix = mat4.clone(modelViewMatrix),
          xAxisVectorArray = [1, 0, 0],
          yAxisVectorArray = [0, 1, 0];

      mat4.rotate(rotatedModelViewMatrix, rotatedModelViewMatrix, rotation, xAxisVectorArray);
      mat4.rotate(rotatedModelViewMatrix, rotatedModelViewMatrix, rotation, yAxisVectorArray);

      this.applyMatrix(projectionMatrixUniformLocation, projectionMatrix);
      this.applyMatrix(modelViewMatrixUniformLocation, rotatedModelViewMatrix);
    }
  }, {
    key: 'applyMatrix',
    value: function applyMatrix(uniformLocation, matrix) {
      var transpose = false; ///

      this.context.uniformMatrix4fv(uniformLocation, transpose, matrix);
    }
  }, {
    key: 'drawElements',
    value: function drawElements(count) {
      var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultOffset;

      var mode = this.TRIANGLES_MODE,
          type = this.UNSIGNED_SHORT_TYPE;

      this.context.drawElements(mode, count, type, offset);
    }
  }]);

  return Canvas;
}();

Object.assign(Canvas.prototype, bufferMixin);
Object.assign(Canvas.prototype, shaderMixin);
Object.assign(Canvas.prototype, colourMixin);
Object.assign(Canvas.prototype, depthMixin);

module.exports = Canvas;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9jYW52YXMuanMiXSwibmFtZXMiOlsibWF0NCIsInJlcXVpcmUiLCJkb21VdGlsaXRpZXMiLCJidWZmZXJNaXhpbiIsInNoYWRlck1peGluIiwiY29sb3VyTWl4aW4iLCJkZXB0aE1peGluIiwiZG9tRWxlbWVudEZyb21TZWxlY3RvciIsImRlZmF1bHRPZmZzZXQiLCJDYW52YXMiLCJzZWxlY3RvciIsImRvbUVsZW1lbnQiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsIkVycm9yIiwiRkxPQVRfVFlQRSIsIkZMT0FUIiwiVFJJQU5HTEVTX01PREUiLCJUUklBTkdMRVMiLCJERVBUSF9URVNUX0NBUCIsIkRFUFRIX1RFU1QiLCJMRVFVQUxfRlVOQ1RJT04iLCJMRVFVQUwiLCJTVEFUSUNfRFJBV19VU0FHRSIsIlNUQVRJQ19EUkFXIiwiTElOS19TVEFUVVNfUE5BTUUiLCJMSU5LX1NUQVRVUyIsIlZFUlRFWF9TSEFERVJfVFlQRSIsIlZFUlRFWF9TSEFERVIiLCJBUlJBWV9CVUZGRVJfVEFSR0VUIiwiQVJSQVlfQlVGRkVSIiwiVU5TSUdORURfU0hPUlRfVFlQRSIsIlVOU0lHTkVEX1NIT1JUIiwiVFJJQU5HTEVfU1RSSVBfTU9ERSIsIlRSSUFOR0xFX1NUUklQIiwiQ09NUElMRV9TVEFUVVNfUE5BTUUiLCJDT01QSUxFX1NUQVRVUyIsIkZSQUdNRU5UX1NIQURFUl9UWVBFIiwiRlJBR01FTlRfU0hBREVSIiwiQ09MT1JfQlVGRkVSX0JJVF9NQVNLIiwiQ09MT1JfQlVGRkVSX0JJVCIsIkRFUFRIX0JVRkZFUl9CSVRfTUFTSyIsIkRFUFRIX0JVRkZFUl9CSVQiLCJFTEVNRU5UX0FSUkFZX0JVRkZFUl9UQVJHRVQiLCJFTEVNRU5UX0FSUkFZX0JVRkZFUiIsImNsaWVudFdpZHRoIiwiY2xpZW50SGVpZ2h0IiwicHJvZ3JhbSIsIm5hbWUiLCJnZXRVbmlmb3JtTG9jYXRpb24iLCJnZXRBdHRyaWJMb2NhdGlvbiIsInVzZVByb2dyYW0iLCJzaGFkZXJQcm9ncmFtIiwicHJvamVjdGlvbiIsIm1vZGVsVmlldyIsImVsYXBzZWRUaW1lIiwicHJvamVjdGlvbk1hdHJpeCIsImdldE1hdHJpeCIsIm1vZGVsVmlld01hdHJpeCIsInByb2plY3Rpb25NYXRyaXhVbmlmb3JtTG9jYXRpb24iLCJtb2RlbFZpZXdNYXRyaXhVbmlmb3JtTG9jYXRpb24iLCJjbGVhckNvbG91ciIsImNsZWFyRGVwdGgiLCJjbGVhckNvbG91ckJ1ZmZlciIsImNsZWFyRGVwdGhCdWZmZXIiLCJyb3RhdGlvbiIsInJvdGF0ZWRNb2RlbFZpZXdNYXRyaXgiLCJjbG9uZSIsInhBeGlzVmVjdG9yQXJyYXkiLCJ5QXhpc1ZlY3RvckFycmF5Iiwicm90YXRlIiwiYXBwbHlNYXRyaXgiLCJ1bmlmb3JtTG9jYXRpb24iLCJtYXRyaXgiLCJ0cmFuc3Bvc2UiLCJ1bmlmb3JtTWF0cml4NGZ2IiwiY291bnQiLCJvZmZzZXQiLCJtb2RlIiwidHlwZSIsImRyYXdFbGVtZW50cyIsIk9iamVjdCIsImFzc2lnbiIsInByb3RvdHlwZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7QUFFQSxJQUFNQSxPQUFPQyxRQUFRLFNBQVIsQ0FBYixDLENBQWtDOztBQUVsQyxJQUFNQyxlQUFlRCxRQUFRLGlCQUFSLENBQXJCO0FBQUEsSUFDTUUsY0FBY0YsUUFBUSxnQkFBUixDQURwQjtBQUFBLElBRU1HLGNBQWNILFFBQVEsZ0JBQVIsQ0FGcEI7QUFBQSxJQUdNSSxjQUFjSixRQUFRLGdCQUFSLENBSHBCO0FBQUEsSUFJTUssYUFBYUwsUUFBUSxlQUFSLENBSm5COztJQU1RTSxzQixHQUEyQkwsWSxDQUEzQkssc0I7OztBQUVSLElBQU1DLGdCQUFnQixDQUF0Qjs7SUFFTUMsTTtBQUNKLG9CQUFpQztBQUFBLFFBQXJCQyxRQUFxQix1RUFBVixRQUFVOztBQUFBOztBQUMvQixRQUFNQyxhQUFhSix1QkFBdUJHLFFBQXZCLENBQW5CO0FBQUEsUUFDTUUsVUFBVUQsV0FBV0UsVUFBWCxD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QUFjekUsT0FBTzBFLFNBQXJCLEVBQWdDN0UsVUFBaEM7O0FBRUE4RSxPQUFPQyxPQUFQLEdBQWlCNUUsTUFBakIiLCJmaWxlIjoiY2FudmFzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBtYXQ0ID0gcmVxdWlyZSgnZ2wtbWF0NCcpOyAgLy8vXG5cbmNvbnN0IGRvbVV0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL2RvbScpLFxuICAgICAgYnVmZmVyTWl4aW4gPSByZXF1aXJlKCcuL21peGluL2J1ZmZlcicpLFxuICAgICAgc2hhZGVyTWl4aW4gPSByZXF1aXJlKCcuL21peGluL3NoYWRlcicpLFxuICAgICAgY29sb3VyTWl4aW4gPSByZXF1aXJlKCcuL21peGluL2NvbG91cicpLFxuICAgICAgZGVwdGhNaXhpbiA9IHJlcXVpcmUoJy4vbWl4aW4vZGVwdGgnKTtcblxuY29uc3QgeyBkb21FbGVtZW50RnJvbVNlbGVjdG9yIH0gPSBkb21VdGlsaXRpZXM7XG5cbmNvbnN0IGRlZmF1bHRPZmZzZXQgPSAwO1xuXG5jbGFzcyBDYW52YXMge1xuICBjb25zdHJ1Y3RvcihzZWxlY3RvciA9ICdjYW52YXMnKSB7XG4gICAgY29uc3QgZG9tRWxlbWVudCA9IGRvbUVsZW1lbnRGcm9tU2VsZWN0b3Ioc2VsZWN0b3IpLFxuICAgICAgICAgIGNvbnRleHQgPSBkb21FbGVtZW50LmdldENvbnRleHQoJ3dlYmdsJyk7XG5cbiAgICBpZiAoIWNvbnRleHQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIGluaXRpYWxpc2UgdGhlIGNvbnRleHQuYCk7XG4gICAgfVxuXG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcblxuICAgIHRoaXMuZG9tRWxlbWVudCA9IGRvbUVsZW1lbnQ7XG5cbiAgICB0aGlzLkZMT0FUX1RZUEUgPSB0aGlzLmNvbnRleHQuRkxPQVQ7ICAvLy9cbiAgICB0aGlzLlRSSUFOR0xFU19NT0RFID0gdGhpcy5jb250ZXh0LlRSSUFOR0xFUzsgIC8vL1xuICAgIHRoaXMuREVQVEhfVEVTVF9DQVAgPSB0aGlzLmNvbnRleHQuREVQVEhfVEVTVDsgIC8vL1xuICAgIHRoaXMuTEVRVUFMX0ZVTkNUSU9OID0gdGhpcy5jb250ZXh0LkxFUVVBTDsgLy8vXG4gICAgdGhpcy5TVEFUSUNfRFJBV19VU0FHRSA9IHRoaXMuY29udGV4dC5TVEFUSUNfRFJBVzsgLy8vXG4gICAgdGhpcy5MSU5LX1NUQVRVU19QTkFNRSA9IHRoaXMuY29udGV4dC5MSU5LX1NUQVRVUzsgIC8vL1xuICAgIHRoaXMuVkVSVEVYX1NIQURFUl9UWVBFID0gdGhpcy5jb250ZXh0LlZFUlRFWF9TSEFERVI7IC8vL1xuICAgIHRoaXMuQVJSQVlfQlVGRkVSX1RBUkdFVCA9IHRoaXMuY29udGV4dC5BUlJBWV9CVUZGRVI7ICAvLy9cbiAgICB0aGlzLlVOU0lHTkVEX1NIT1JUX1RZUEUgPSB0aGlzLmNvbnRleHQuVU5TSUdORURfU0hPUlQ7ICAvLy9cbiAgICB0aGlzLlRSSUFOR0xFX1NUUklQX01PREUgPSB0aGlzLmNvbnRleHQuVFJJQU5HTEVfU1RSSVA7ICAvLy9cbiAgICB0aGlzLkNPTVBJTEVfU1RBVFVTX1BOQU1FID0gdGhpcy5jb250ZXh0LkNPTVBJTEVfU1RBVFVTOyAgLy8vXG4gICAgdGhpcy5GUkFHTUVOVF9TSEFERVJfVFlQRSA9IHRoaXMuY29udGV4dC5GUkFHTUVOVF9TSEFERVI7IC8vL1xuICAgIHRoaXMuQ09MT1JfQlVGRkVSX0JJVF9NQVNLID0gdGhpcy5jb250ZXh0LkNPTE9SX0JVRkZFUl9CSVQ7IC8vL1xuICAgIHRoaXMuREVQVEhfQlVGRkVSX0JJVF9NQVNLID0gdGhpcy5jb250ZXh0LkRFUFRIX0JVRkZFUl9CSVQ7IC8vL1xuICAgIHRoaXMuRUxFTUVOVF9BUlJBWV9CVUZGRVJfVEFSR0VUID0gdGhpcy5jb250ZXh0LkVMRU1FTlRfQVJSQVlfQlVGRkVSOyAgLy8vXG4gIH1cblxuICBnZXRDb250ZXh0KCkge1xuICAgIHJldHVybiB0aGlzLmNvbnRleHQ7XG4gIH1cblxuICBnZXRDbGllbnRXaWR0aCgpIHsgcmV0dXJuIHRoaXMuZG9tRWxlbWVudC5jbGllbnRXaWR0aDsgfVxuXG4gIGdldENsaWVudEhlaWdodCgpIHsgcmV0dXJuIHRoaXMuZG9tRWxlbWVudC5jbGllbnRIZWlnaHQ7IH1cblxuICBnZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgbmFtZSkgeyByZXR1cm4gdGhpcy5jb250ZXh0LmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCBuYW1lKTsgfVxuXG4gIGdldEF0dHJpYnV0ZUxvY2F0aW9uKHByb2dyYW0sIG5hbWUpIHsgcmV0dXJuIHRoaXMuY29udGV4dC5nZXRBdHRyaWJMb2NhdGlvbihwcm9ncmFtLCBuYW1lKTsgfVxuXG4gIHVzZVByb2dyYW0ocHJvZ3JhbSkgeyB0aGlzLmNvbnRleHQudXNlUHJvZ3JhbShwcm9ncmFtKTsgfVxuXG4gIHJlbmRlcihzaGFkZXJQcm9ncmFtLCBwcm9qZWN0aW9uLCBtb2RlbFZpZXcsIGVsYXBzZWRUaW1lKSB7XG4gICAgY29uc3QgcHJvamVjdGlvbk1hdHJpeCA9IHByb2plY3Rpb24uZ2V0TWF0cml4KCksXG4gICAgICAgICAgbW9kZWxWaWV3TWF0cml4ID0gbW9kZWxWaWV3LmdldE1hdHJpeCgpLFxuICAgICAgICAgIHByb2plY3Rpb25NYXRyaXhVbmlmb3JtTG9jYXRpb24gPSB0aGlzLmdldFVuaWZvcm1Mb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAndVByb2plY3Rpb25NYXRyaXgnKSxcbiAgICAgICAgICBtb2RlbFZpZXdNYXRyaXhVbmlmb3JtTG9jYXRpb24gPSB0aGlzLmdldFVuaWZvcm1Mb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAndU1vZGVsVmlld01hdHJpeCcpO1xuXG4gICAgdGhpcy5jbGVhckNvbG91cigpO1xuICAgIHRoaXMuY2xlYXJEZXB0aCgpO1xuICAgIHRoaXMuY2xlYXJDb2xvdXJCdWZmZXIoKTtcbiAgICB0aGlzLmNsZWFyRGVwdGhCdWZmZXIoKTtcblxuICAgIGNvbnN0IHJvdGF0aW9uID0gZWxhcHNlZFRpbWUgLyAxMDAwO1xuXG4gICAgY29uc3Qgcm90YXRlZE1vZGVsVmlld01hdHJpeCA9IG1hdDQuY2xvbmUobW9kZWxWaWV3TWF0cml4KSxcbiAgICAgICAgICB4QXhpc1ZlY3RvckFycmF5ID0gWzEsIDAsIDBdLFxuICAgICAgICAgIHlBeGlzVmVjdG9yQXJyYXkgPSBbMCwgMSwgMF07XG5cbiAgICBtYXQ0LnJvdGF0ZShyb3RhdGVkTW9kZWxWaWV3TWF0cml4LCByb3RhdGVkTW9kZWxWaWV3TWF0cml4LCByb3RhdGlvbiwgeEF4aXNWZWN0b3JBcnJheSk7XG4gICAgbWF0NC5yb3RhdGUocm90YXRlZE1vZGVsVmlld01hdHJpeCwgcm90YXRlZE1vZGVsVmlld01hdHJpeCwgcm90YXRpb24sIHlBeGlzVmVjdG9yQXJyYXkpO1xuXG4gICAgdGhpcy5hcHBseU1hdHJpeChwcm9qZWN0aW9uTWF0cml4VW5pZm9ybUxvY2F0aW9uLCBwcm9qZWN0aW9uTWF0cml4KTtcbiAgICB0aGlzLmFwcGx5TWF0cml4KG1vZGVsVmlld01hdHJpeFVuaWZvcm1Mb2NhdGlvbiwgcm90YXRlZE1vZGVsVmlld01hdHJpeCk7XG4gIH1cblxuICBhcHBseU1hdHJpeCh1bmlmb3JtTG9jYXRpb24sIG1hdHJpeCkge1xuICAgIGNvbnN0IHRyYW5zcG9zZSA9IGZhbHNlOyAgLy8vXG5cbiAgICB0aGlzLmNvbnRleHQudW5pZm9ybU1hdHJpeDRmdih1bmlmb3JtTG9jYXRpb24sIHRyYW5zcG9zZSwgbWF0cml4KTtcbiAgfVxuICBcbiAgZHJhd0VsZW1lbnRzKGNvdW50LCBvZmZzZXQgPSBkZWZhdWx0T2Zmc2V0KSB7XG4gICAgY29uc3QgbW9kZSA9IHRoaXMuVFJJQU5HTEVTX01PREUsXG4gICAgICAgICAgdHlwZSA9IHRoaXMuVU5TSUdORURfU0hPUlRfVFlQRTtcblxuICAgIHRoaXMuY29udGV4dC5kcmF3RWxlbWVudHMobW9kZSwgY291bnQsIHR5cGUsIG9mZnNldClcbiAgfVxufVxuXG5PYmplY3QuYXNzaWduKENhbnZhcy5wcm90b3R5cGUsIGJ1ZmZlck1peGluKTtcbk9iamVjdC5hc3NpZ24oQ2FudmFzLnByb3RvdHlwZSwgc2hhZGVyTWl4aW4pO1xuT2JqZWN0LmFzc2lnbihDYW52YXMucHJvdG90eXBlLCBjb2xvdXJNaXhpbik7XG5PYmplY3QuYXNzaWduKENhbnZhcy5wcm90b3R5cGUsIGRlcHRoTWl4aW4pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IENhbnZhcztcbiJdfQ==