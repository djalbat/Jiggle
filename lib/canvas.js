'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var mat4 = require('gl-mat4'); ///

var domUtilities = require('./utilities/dom'),
    textureMixin = require('./mixin/texture'),
    bufferMixin = require('./mixin/buffer'),
    shaderMixin = require('./mixin/shader'),
    colourMixin = require('./mixin/colour'),
    matrixMixin = require('./mixin/matrix'),
    depthMixin = require('./mixin/depth');

var domElementFromSelector = domUtilities.domElementFromSelector;


var defaultOffset = 0;

var Canvas = function () {
  function Canvas() {
    var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'canvas';

    _classCallCheck(this, Canvas);

    var domElement = domElementFromSelector(selector),
        context = domElement.getContext('webgl');

    if (!context) {
      throw new Error('Unable to initialise the context.');
    }

    this.context = context;

    this.domElement = domElement;

    this.CLAMP_TO_EDGE_PARAM = this.context.CLAMP_TO_EDGE; ///
    this.LINEAR_PARAM = this.context.LINEAR; ///
    this.RGBA_FORMAT = this.context.RGBA; ///
    this.DEPTH_TEST_CAP = this.context.DEPTH_TEST; ///
    this.LEQUAL_FUNCTION = this.context.LEQUAL; ///
    this.STATIC_DRAW_USAGE = this.context.STATIC_DRAW; ///
    this.LINK_STATUS_PNAME = this.context.LINK_STATUS; ///
    this.COMPILE_STATUS_PNAME = this.context.COMPILE_STATUS; ///
    this.TEXTURE_WRAP_S_PNAME = this.context.TEXTURE_WRAP_S; ///
    this.TEXTURE_WRAP_T_PNAME = this.context.TEXTURE_WRAP_T; ///
    this.TEXTURE_MIN_FILTER_PNAME = this.context.TEXTURE_MIN_FILTER; ///
    this.TRIANGLE_STRIP_MODE = this.context.TRIANGLE_STRIP; ///
    this.TRIANGLES_MODE = this.context.TRIANGLES; ///
    this.FLOAT_TYPE = this.context.FLOAT; ///
    this.UNSIGNED_BYTE_TYPE = this.context.UNSIGNED_BYTE; ///
    this.VERTEX_SHADER_TYPE = this.context.VERTEX_SHADER; ///
    this.UNSIGNED_SHORT_TYPE = this.context.UNSIGNED_SHORT; ///
    this.FRAGMENT_SHADER_TYPE = this.context.FRAGMENT_SHADER; ///
    this.COLOR_BUFFER_BIT_MASK = this.context.COLOR_BUFFER_BIT; ///
    this.DEPTH_BUFFER_BIT_MASK = this.context.DEPTH_BUFFER_BIT; ///
    this.TEXTURE0_TARGET = this.context.TEXTURE0; ///
    this.TEXTURE_2D_TARGET = this.context.TEXTURE_2D; ///
    this.ARRAY_BUFFER_TARGET = this.context.ARRAY_BUFFER; ///
    this.ELEMENT_ARRAY_BUFFER_TARGET = this.context.ELEMENT_ARRAY_BUFFER; ///
  }

  _createClass(Canvas, [{
    key: 'getContext',
    value: function getContext() {
      return this.context;
    }
  }, {
    key: 'getClientWidth',
    value: function getClientWidth() {
      return this.domElement.clientWidth;
    }
  }, {
    key: 'getClientHeight',
    value: function getClientHeight() {
      return this.domElement.clientHeight;
    }
  }, {
    key: 'getUniformLocation',
    value: function getUniformLocation(program, name) {
      return this.context.getUniformLocation(program, name);
    }
  }, {
    key: 'getAttributeLocation',
    value: function getAttributeLocation(program, name) {
      return this.context.getAttribLocation(program, name);
    }
  }, {
    key: 'setUniformLocationIntegerValue',
    value: function setUniformLocationIntegerValue(uniformLocation, integerValue) {
      this.context.uniform1i(uniformLocation, integerValue);
    }
  }, {
    key: 'useProgram',
    value: function useProgram(program) {
      this.context.useProgram(program);
    }
  }, {
    key: 'render',
    value: function render(rotation, position, perspective, shaderProgram) {
      var rotationMatrix = rotation.getMatrix(),
          positionMatrix = position.getMatrix(),
          perspectiveMatrix = perspective.getMatrix(),
          rotationMatrixUniformLocation = this.getUniformLocation(shaderProgram, 'uRotationMatrix'),
          positionMatrixUniformLocation = this.getUniformLocation(shaderProgram, 'uPositionMatrix'),
          perspectiveMatrixUniformLocation = this.getUniformLocation(shaderProgram, 'uPerspectiveMatrix');

      this.clearDepth();
      this.clearColour();
      this.clearDepthBuffer();
      this.clearColourBuffer();

      this.applyMatrix(rotationMatrixUniformLocation, rotationMatrix);
      this.applyMatrix(positionMatrixUniformLocation, positionMatrix);
      this.applyMatrix(perspectiveMatrixUniformLocation, perspectiveMatrix);
    }
  }, {
    key: 'drawElements',
    value: function drawElements(count) {
      var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultOffset;

      var mode = this.TRIANGLES_MODE,
          type = this.UNSIGNED_SHORT_TYPE;

      this.context.drawElements(mode, count, type, offset);
    }
  }]);

  return Canvas;
}();

Object.assign(Canvas.prototype, textureMixin);
Object.assign(Canvas.prototype, bufferMixin);
Object.assign(Canvas.prototype, shaderMixin);
Object.assign(Canvas.prototype, colourMixin);
Object.assign(Canvas.prototype, matrixMixin);
Object.assign(Canvas.prototype, depthMixin);

module.exports = Canvas;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9jYW52YXMuanMiXSwibmFtZXMiOlsibWF0NCIsInJlcXVpcmUiLCJkb21VdGlsaXRpZXMiLCJ0ZXh0dXJlTWl4aW4iLCJidWZmZXJNaXhpbiIsInNoYWRlck1peGluIiwiY29sb3VyTWl4aW4iLCJtYXRyaXhNaXhpbiIsImRlcHRoTWl4aW4iLCJkb21FbGVtZW50RnJvbVNlbGVjdG9yIiwiZGVmYXVsdE9mZnNldCIsIkNhbnZhcyIsInNlbGVjdG9yIiwiZG9tRWxlbWVudCIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwiRXJyb3IiLCJDTEFNUF9UT19FREdFX1BBUkFNIiwiQ0xBTVBfVE9fRURHRSIsIkxJTkVBUl9QQVJBTSIsIkxJTkVBUiIsIlJHQkFfRk9STUFUIiwiUkdCQSIsIkRFUFRIX1RFU1RfQ0FQIiwiREVQVEhfVEVTVCIsIkxFUVVBTF9GVU5DVElPTiIsIkxFUVVBTCIsIlNUQVRJQ19EUkFXX1VTQUdFIiwiU1RBVElDX0RSQVciLCJMSU5LX1NUQVRVU19QTkFNRSIsIkxJTktfU1RBVFVTIiwiQ09NUElMRV9TVEFUVVNfUE5BTUUiLCJDT01QSUxFX1NUQVRVUyIsIlRFWFRVUkVfV1JBUF9TX1BOQU1FIiwiVEVYVFVSRV9XUkFQX1MiLCJURVhUVVJFX1dSQVBfVF9QTkFNRSIsIlRFWFRVUkVfV1JBUF9UIiwiVEVYVFVSRV9NSU5fRklMVEVSX1BOQU1FIiwiVEVYVFVSRV9NSU5fRklMVEVSIiwiVFJJQU5HTEVfU1RSSVBfTU9ERSIsIlRSSUFOR0xFX1NUUklQIiwiVFJJQU5HTEVTX01PREUiLCJUUklBTkdMRVMiLCJGTE9BVF9UWVBFIiwiRkxPQVQiLCJVTlNJR05FRF9CWVRFX1RZUEUiLCJVTlNJR05FRF9CWVRFIiwiVkVSVEVYX1NIQURFUl9UWVBFIiwiVkVSVEVYX1NIQURFUiIsIlVOU0lHTkVEX1NIT1JUX1RZUEUiLCJVTlNJR05FRF9TSE9SVCIsIkZSQUdNRU5UX1NIQURFUl9UWVBFIiwiRlJBR01FTlRfU0hBREVSIiwiQ09MT1JfQlVGRkVSX0JJVF9NQVNLIiwiQ09MT1JfQlVGRkVSX0JJVCIsIkRFUFRIX0JVRkZFUl9CSVRfTUFTSyIsIkRFUFRIX0JVRkZFUl9CSVQiLCJURVhUVVJFMF9UQVJHRVQiLCJURVhUVVJFMCIsIlRFWFRVUkVfMkRfVEFSR0VUIiwiVEVYVFVSRV8yRCIsIkFSUkFZX0JVRkZFUl9UQVJHRVQiLCJBUlJBWV9CVUZGRVIiLCJFTEVNRU5UX0FSUkFZX0JVRkZFUl9UQVJHRVQiLCJFTEVNRU5UX0FSUkFZX0JVRkZFUiIsImNsaWVudFdpZHRoIiwiY2xpZW50SGVpZ2h0IiwicHJvZ3JhbSIsIm5hbWUiLCJnZXRVbmlmb3JtTG9jYXRpb24iLCJnZXRBdHRyaWJMb2NhdGlvbiIsInVuaWZvcm1Mb2NhdGlvbiIsImludGVnZXJWYWx1ZSIsInVuaWZvcm0xaSIsInVzZVByb2dyYW0iLCJyb3RhdGlvbiIsInBvc2l0aW9uIiwicGVyc3BlY3RpdmUiLCJzaGFkZXJQcm9ncmFtIiwicm90YXRpb25NYXRyaXgiLCJnZXRNYXRyaXgiLCJwb3NpdGlvbk1hdHJpeCIsInBlcnNwZWN0aXZlTWF0cml4Iiwicm90YXRpb25NYXRyaXhVbmlmb3JtTG9jYXRpb24iLCJwb3NpdGlvbk1hdHJpeFVuaWZvcm1Mb2NhdGlvbiIsInBlcnNwZWN0aXZlTWF0cml4VW5pZm9ybUxvY2F0aW9uIiwiY2xlYXJEZXB0aCIsImNsZWFyQ29sb3VyIiwiY2xlYXJEZXB0aEJ1ZmZlciIsImNsZWFyQ29sb3VyQnVmZmVyIiwiYXBwbHlNYXRyaXgiLCJjb3VudCIsIm9mZnNldCIsIm1vZGUiLCJ0eXBlIiwiZHJhd0VsZW1lbnRzIiwiT2JqZWN0IiwiYXNzaWduIiwicHJvdG90eXBlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQUVBLElBQU1BLE9BQU9DLFFBQVEsU0FBUixDQUFiLEMsQ0FBa0M7O0FBRWxDLElBQU1DLGVBQWVELFFBQVEsaUJBQVIsQ0FBckI7QUFBQSxJQUNNRSxlQUFlRixRQUFRLGlCQUFSLENBRHJC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bnN0IG1hdDQgPSByZXF1aXJlKCdnbC1tYXQ0Jyk7ICAvLy9cblxuY29uc3QgZG9tVXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvZG9tJyksXG4gICAgICB0ZXh0dXJlTWl4aW4gPSByZXF1aXJlKCcuL21peGluL3RleHR1cmUnKSxcbiAgICAgIGJ1ZmZlck1peGluID0gcmVxdWlyZSgnLi9taXhpbi9idWZmZXInKSxcbiAgICAgIHNoYWRlck1peGluID0gcmVxdWlyZSgnLi9taXhpbi9zaGFkZXInKSxcbiAgICAgIGNvbG91ck1peGluID0gcmVxdWlyZSgnLi9taXhpbi9jb2xvdXInKSxcbiAgICAgIG1hdHJpeE1peGluID0gcmVxdWlyZSgnLi9taXhpbi9tYXRyaXgnKSxcbiAgICAgIGRlcHRoTWl4aW4gPSByZXF1aXJlKCcuL21peGluL2RlcHRoJyk7XG5cbmNvbnN0IHsgZG9tRWxlbWVudEZyb21TZWxlY3RvciB9ID0gZG9tVXRpbGl0aWVzO1xuXG5jb25zdCBkZWZhdWx0T2Zmc2V0ID0gMDtcblxuY2xhc3MgQ2FudmFzIHtcbiAgY29uc3RydWN0b3Ioc2VsZWN0b3IgPSAnY2FudmFzJykge1xuICAgIGNvbnN0IGRvbUVsZW1lbnQgPSBkb21FbGVtZW50RnJvbVNlbGVjdG9yKHNlbGVjdG9yKSxcbiAgICAgICAgICBjb250ZXh0ID0gZG9tRWxlbWVudC5nZXRDb250ZXh0KCd3ZWJnbCcpO1xuXG4gICAgaWYgKCFjb250ZXh0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byBpbml0aWFsaXNlIHRoZSBjb250ZXh0LmApO1xuICAgIH1cblxuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG5cbiAgICB0aGlzLmRvbUVsZW1lbnQgPSBkb21FbGVtZW50O1xuXG4gICAgdGhpcy5DTEFNUF9UT19FREdFX1BBUkFNID0gdGhpcy5jb250ZXh0LkNMQU1QX1RPX0VER0U7ICAvLy9cbiAgICB0aGlzLkxJTkVBUl9QQVJBTSA9IHRoaXMuY29udGV4dC5MSU5FQVI7ICAvLy9cbiAgICB0aGlzLlJHQkFfRk9STUFUID0gdGhpcy5jb250ZXh0LlJHQkE7ICAvLy9cbiAgICB0aGlzLkRFUFRIX1RFU1RfQ0FQID0gdGhpcy5jb250ZXh0LkRFUFRIX1RFU1Q7ICAvLy9cbiAgICB0aGlzLkxFUVVBTF9GVU5DVElPTiA9IHRoaXMuY29udGV4dC5MRVFVQUw7IC8vL1xuICAgIHRoaXMuU1RBVElDX0RSQVdfVVNBR0UgPSB0aGlzLmNvbnRleHQuU1RBVElDX0RSQVc7IC8vL1xuICAgIHRoaXMuTElOS19TVEFUVVNfUE5BTUUgPSB0aGlzLmNvbnRleHQuTElOS19TVEFUVVM7ICAvLy9cbiAgICB0aGlzLkNPTVBJTEVfU1RBVFVTX1BOQU1FID0gdGhpcy5jb250ZXh0LkNPTVBJTEVfU1RBVFVTOyAgLy8vXG4gICAgdGhpcy5URVhUVVJFX1dSQVBfU19QTkFNRSA9IHRoaXMuY29udGV4dC5URVhUVVJFX1dSQVBfUzsgIC8vL1xuICAgIHRoaXMuVEVYVFVSRV9XUkFQX1RfUE5BTUUgPSB0aGlzLmNvbnRleHQuVEVYVFVSRV9XUkFQX1Q7ICAvLy9cbiAgICB0aGlzLlRFWFRVUkVfTUlOX0ZJTFRFUl9QTkFNRSA9IHRoaXMuY29udGV4dC5URVhUVVJFX01JTl9GSUxURVI7ICAvLy9cbiAgICB0aGlzLlRSSUFOR0xFX1NUUklQX01PREUgPSB0aGlzLmNvbnRleHQuVFJJQU5HTEVfU1RSSVA7ICAvLy9cbiAgICB0aGlzLlRSSUFOR0xFU19NT0RFID0gdGhpcy5jb250ZXh0LlRSSUFOR0xFUzsgIC8vL1xuICAgIHRoaXMuRkxPQVRfVFlQRSA9IHRoaXMuY29udGV4dC5GTE9BVDsgIC8vL1xuICAgIHRoaXMuVU5TSUdORURfQllURV9UWVBFID0gdGhpcy5jb250ZXh0LlVOU0lHTkVEX0JZVEU7IC8vL1xuICAgIHRoaXMuVkVSVEVYX1NIQURFUl9UWVBFID0gdGhpcy5jb250ZXh0LlZFUlRFWF9TSEFERVI7IC8vL1xuICAgIHRoaXMuVU5TSUdORURfU0hPUlRfVFlQRSA9IHRoaXMuY29udGV4dC5VTlNJR05FRF9TSE9SVDsgIC8vL1xuICAgIHRoaXMuRlJBR01FTlRfU0hBREVSX1RZUEUgPSB0aGlzLmNvbnRleHQuRlJBR01FTlRfU0hBREVSOyAvLy9cbiAgICB0aGlzLkNPTE9SX0JVRkZFUl9CSVRfTUFTSyA9IHRoaXMuY29udGV4dC5DT0xPUl9CVUZGRVJfQklUOyAvLy9cbiAgICB0aGlzLkRFUFRIX0JVRkZFUl9CSVRfTUFTSyA9IHRoaXMuY29udGV4dC5ERVBUSF9CVUZGRVJfQklUOyAvLy9cbiAgICB0aGlzLlRFWFRVUkUwX1RBUkdFVCA9IHRoaXMuY29udGV4dC5URVhUVVJFMDsgLy8vXG4gICAgdGhpcy5URVhUVVJFXzJEX1RBUkdFVCA9IHRoaXMuY29udGV4dC5URVhUVVJFXzJEOyAvLy9cbiAgICB0aGlzLkFSUkFZX0JVRkZFUl9UQVJHRVQgPSB0aGlzLmNvbnRleHQuQVJSQVlfQlVGRkVSOyAgLy8vXG4gICAgdGhpcy5FTEVNRU5UX0FSUkFZX0JVRkZFUl9UQVJHRVQgPSB0aGlzLmNvbnRleHQuRUxFTUVOVF9BUlJBWV9CVUZGRVI7ICAvLy9cbiAgfVxuXG4gIGdldENvbnRleHQoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29udGV4dDtcbiAgfVxuXG4gIGdldENsaWVudFdpZHRoKCkgeyByZXR1cm4gdGhpcy5kb21FbGVtZW50LmNsaWVudFdpZHRoOyB9XG5cbiAgZ2V0Q2xpZW50SGVpZ2h0KCkgeyByZXR1cm4gdGhpcy5kb21FbGVtZW50LmNsaWVudEhlaWdodDsgfVxuXG4gIGdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCBuYW1lKSB7IHJldHVybiB0aGlzLmNvbnRleHQuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sIG5hbWUpOyB9XG5cbiAgZ2V0QXR0cmlidXRlTG9jYXRpb24ocHJvZ3JhbSwgbmFtZSkgeyByZXR1cm4gdGhpcy5jb250ZXh0LmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sIG5hbWUpOyB9XG4gIFxuICBzZXRVbmlmb3JtTG9jYXRpb25JbnRlZ2VyVmFsdWUodW5pZm9ybUxvY2F0aW9uLCBpbnRlZ2VyVmFsdWUpIHsgdGhpcy5jb250ZXh0LnVuaWZvcm0xaSh1bmlmb3JtTG9jYXRpb24sIGludGVnZXJWYWx1ZSk7IH1cblxuICB1c2VQcm9ncmFtKHByb2dyYW0pIHsgdGhpcy5jb250ZXh0LnVzZVByb2dyYW0ocHJvZ3JhbSk7IH1cbiAgXG4gIHJlbmRlcihyb3RhdGlvbiwgcG9zaXRpb24sIHBlcnNwZWN0aXZlLCBzaGFkZXJQcm9ncmFtKSB7XG4gICAgY29uc3Qgcm90YXRpb25NYXRyaXggPSByb3RhdGlvbi5nZXRNYXRyaXgoKSxcbiAgICAgICAgICBwb3NpdGlvbk1hdHJpeCA9IHBvc2l0aW9uLmdldE1hdHJpeCgpLFxuICAgICAgICAgIHBlcnNwZWN0aXZlTWF0cml4ID0gcGVyc3BlY3RpdmUuZ2V0TWF0cml4KCksXG4gICAgICAgICAgcm90YXRpb25NYXRyaXhVbmlmb3JtTG9jYXRpb24gPSB0aGlzLmdldFVuaWZvcm1Mb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAndVJvdGF0aW9uTWF0cml4JyksXG4gICAgICAgICAgcG9zaXRpb25NYXRyaXhVbmlmb3JtTG9jYXRpb24gPSB0aGlzLmdldFVuaWZvcm1Mb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAndVBvc2l0aW9uTWF0cml4JyksXG4gICAgICAgICAgcGVyc3BlY3RpdmVNYXRyaXhVbmlmb3JtTG9jYXRpb24gPSB0aGlzLmdldFVuaWZvcm1Mb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAndVBlcnNwZWN0aXZlTWF0cml4Jyk7XG5cbiAgICB0aGlzLmNsZWFyRGVwdGgoKTtcbiAgICB0aGlzLmNsZWFyQ29sb3VyKCk7XG4gICAgdGhpcy5jbGVhckRlcHRoQnVmZmVyKCk7XG4gICAgdGhpcy5jbGVhckNvbG91ckJ1ZmZlcigpO1xuXG4gICAgdGhpcy5hcHBseU1hdHJpeChyb3RhdGlvbk1hdHJpeFVuaWZvcm1Mb2NhdGlvbiwgcm90YXRpb25NYXRyaXgpO1xuICAgIHRoaXMuYXBwbHlNYXRyaXgocG9zaXRpb25NYXRyaXhVbmlmb3JtTG9jYXRpb24sIHBvc2l0aW9uTWF0cml4KTtcbiAgICB0aGlzLmFwcGx5TWF0cml4KHBlcnNwZWN0aXZlTWF0cml4VW5pZm9ybUxvY2F0aW9uLCBwZXJzcGVjdGl2ZU1hdHJpeCk7XG4gIH1cblxuICBkcmF3RWxlbWVudHMoY291bnQsIG9mZnNldCA9IGRlZmF1bHRPZmZzZXQpIHtcbiAgICBjb25zdCBtb2RlID0gdGhpcy5UUklBTkdMRVNfTU9ERSxcbiAgICAgICAgICB0eXBlID0gdGhpcy5VTlNJR05FRF9TSE9SVF9UWVBFO1xuXG4gICAgdGhpcy5jb250ZXh0LmRyYXdFbGVtZW50cyhtb2RlLCBjb3VudCwgdHlwZSwgb2Zmc2V0KVxuICB9XG59XG5cbk9iamVjdC5hc3NpZ24oQ2FudmFzLnByb3RvdHlwZSwgdGV4dHVyZU1peGluKTtcbk9iamVjdC5hc3NpZ24oQ2FudmFzLnByb3RvdHlwZSwgYnVmZmVyTWl4aW4pO1xuT2JqZWN0LmFzc2lnbihDYW52YXMucHJvdG90eXBlLCBzaGFkZXJNaXhpbik7XG5PYmplY3QuYXNzaWduKENhbnZhcy5wcm90b3R5cGUsIGNvbG91ck1peGluKTtcbk9iamVjdC5hc3NpZ24oQ2FudmFzLnByb3RvdHlwZSwgbWF0cml4TWl4aW4pO1xuT2JqZWN0LmFzc2lnbihDYW52YXMucHJvdG90eXBlLCBkZXB0aE1peGluKTtcblxubW9kdWxlLmV4cG9ydHMgPSBDYW52YXM7XG4iXX0=