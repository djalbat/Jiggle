'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var mat4 = require('gl-mat4'); ///

var domUtilities = require('./utilities/dom'),
    textureMixin = require('./mixin/texture'),
    bufferMixin = require('./mixin/buffer'),
    shaderMixin = require('./mixin/shader'),
    colourMixin = require('./mixin/colour'),
    matrixMixin = require('./mixin/matrix'),
    depthMixin = require('./mixin/depth');

var domElementFromSelector = domUtilities.domElementFromSelector;


var defaultOffset = 0;

var Canvas = function () {
  function Canvas() {
    var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'canvas';

    _classCallCheck(this, Canvas);

    var domElement = domElementFromSelector(selector),
        context = domElement.getContext('webgl');

    if (!context) {
      throw new Error('Unable to initialise the context.');
    }

    this.context = context;

    this.domElement = domElement;

    this.CLAMP_TO_EDGE_PARAM = this.context.CLAMP_TO_EDGE; ///
    this.LINEAR_PARAM = this.context.LINEAR; ///
    this.RGBA_FORMAT = this.context.RGBA; ///
    this.DEPTH_TEST_CAP = this.context.DEPTH_TEST; ///
    this.LEQUAL_FUNCTION = this.context.LEQUAL; ///
    this.STATIC_DRAW_USAGE = this.context.STATIC_DRAW; ///
    this.LINK_STATUS_PNAME = this.context.LINK_STATUS; ///
    this.COMPILE_STATUS_PNAME = this.context.COMPILE_STATUS; ///
    this.TEXTURE_WRAP_S_PNAME = this.context.TEXTURE_WRAP_S; ///
    this.TEXTURE_WRAP_T_PNAME = this.context.TEXTURE_WRAP_T; ///
    this.TEXTURE_MIN_FILTER_PNAME = this.context.TEXTURE_MIN_FILTER; ///
    this.TRIANGLE_STRIP_MODE = this.context.TRIANGLE_STRIP; ///
    this.TRIANGLES_MODE = this.context.TRIANGLES; ///
    this.FLOAT_TYPE = this.context.FLOAT; ///
    this.UNSIGNED_BYTE_TYPE = this.context.UNSIGNED_BYTE; ///
    this.VERTEX_SHADER_TYPE = this.context.VERTEX_SHADER; ///
    this.UNSIGNED_SHORT_TYPE = this.context.UNSIGNED_SHORT; ///
    this.FRAGMENT_SHADER_TYPE = this.context.FRAGMENT_SHADER; ///
    this.COLOR_BUFFER_BIT_MASK = this.context.COLOR_BUFFER_BIT; ///
    this.DEPTH_BUFFER_BIT_MASK = this.context.DEPTH_BUFFER_BIT; ///
    this.TEXTURE_2D_TARGET = this.context.TEXTURE_2D; ///
    this.ARRAY_BUFFER_TARGET = this.context.ARRAY_BUFFER; ///
    this.ELEMENT_ARRAY_BUFFER_TARGET = this.context.ELEMENT_ARRAY_BUFFER; ///
  }

  _createClass(Canvas, [{
    key: 'getContext',
    value: function getContext() {
      return this.context;
    }
  }, {
    key: 'getClientWidth',
    value: function getClientWidth() {
      return this.domElement.clientWidth;
    }
  }, {
    key: 'getClientHeight',
    value: function getClientHeight() {
      return this.domElement.clientHeight;
    }
  }, {
    key: 'getUniformLocation',
    value: function getUniformLocation(program, name) {
      return this.context.getUniformLocation(program, name);
    }
  }, {
    key: 'getAttributeLocation',
    value: function getAttributeLocation(program, name) {
      return this.context.getAttribLocation(program, name);
    }
  }, {
    key: 'useProgram',
    value: function useProgram(program) {
      this.context.useProgram(program);
    }
  }, {
    key: 'render',
    value: function render(rotation, position, perspective, shaderProgram) {
      var rotationMatrix = rotation.getMatrix(),
          positionMatrix = position.getMatrix(),
          perspectiveMatrix = perspective.getMatrix(),
          rotationMatrixUniformLocation = this.getUniformLocation(shaderProgram, 'uRotationMatrix'),
          positionMatrixUniformLocation = this.getUniformLocation(shaderProgram, 'uPositionMatrix'),
          perspectiveMatrixUniformLocation = this.getUniformLocation(shaderProgram, 'uPerspectiveMatrix');

      this.clearDepth();
      this.clearColour();
      this.clearDepthBuffer();
      this.clearColourBuffer();

      this.applyMatrix(rotationMatrixUniformLocation, rotationMatrix);
      this.applyMatrix(positionMatrixUniformLocation, positionMatrix);
      this.applyMatrix(perspectiveMatrixUniformLocation, perspectiveMatrix);
    }
  }, {
    key: 'drawElements',
    value: function drawElements(count) {
      var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultOffset;

      var mode = this.TRIANGLES_MODE,
          type = this.UNSIGNED_SHORT_TYPE;

      this.context.drawElements(mode, count, type, offset);
    }
  }]);

  return Canvas;
}();

Object.assign(Canvas.prototype, textureMixin);
Object.assign(Canvas.prototype, bufferMixin);
Object.assign(Canvas.prototype, shaderMixin);
Object.assign(Canvas.prototype, colourMixin);
Object.assign(Canvas.prototype, matrixMixin);
Object.assign(Canvas.prototype, depthMixin);

module.exports = Canvas;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9jYW52YXMuanMiXSwibmFtZXMiOlsibWF0NCIsInJlcXVpcmUiLCJkb21VdGlsaXRpZXMiLCJ0ZXh0dXJlTWl4aW4iLCJidWZmZXJNaXhpbiIsInNoYWRlck1peGluIiwiY29sb3VyTWl4aW4iLCJtYXRyaXhNaXhpbiIsImRlcHRoTWl4aW4iLCJkb21FbGVtZW50RnJvbVNlbGVjdG9yIiwiZGVmYXVsdE9mZnNldCIsIkNhbnZhcyIsInNlbGVjdG9yIiwiZG9tRWxlbWVudCIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwiRXJyb3IiLCJDTEFNUF9UT19FREdFX1BBUkFNIiwiQ0xBTVBfVE9fRURHRSIsIkxJTkVBUl9QQVJBTSIsIkxJTkVBUiIsIlJHQkFfRk9STUFUIiwiUkdCQSIsIkRFUFRIX1RFU1RfQ0FQIiwiREVQVEhfVEVTVCIsIkxFUVVBTF9GVU5DVElPTiIsIkxFUVVBTCIsIlNUQVRJQ19EUkFXX1VTQUdFIiwiU1RBVElDX0RSQVciLCJMSU5LX1NUQVRVU19QTkFNRSIsIkxJTktfU1RBVFVTIiwiQ09NUElMRV9TVEFUVVNfUE5BTUUiLCJDT01QSUxFX1NUQVRVUyIsIlRFWFRVUkVfV1JBUF9TX1BOQU1FIiwiVEVYVFVSRV9XUkFQX1MiLCJURVhUVVJFX1dSQVBfVF9QTkFNRSIsIlRFWFRVUkVfV1JBUF9UIiwiVEVYVFVSRV9NSU5fRklMVEVSX1BOQU1FIiwiVEVYVFVSRV9NSU5fRklMVEVSIiwiVFJJQU5HTEVfU1RSSVBfTU9ERSIsIlRSSUFOR0xFX1NUUklQIiwiVFJJQU5HTEVTX01PREUiLCJUUklBTkdMRVMiLCJGTE9BVF9UWVBFIiwiRkxPQVQiLCJVTlNJR05FRF9CWVRFX1RZUEUiLCJVTlNJR05FRF9CWVRFIiwiVkVSVEVYX1NIQURFUl9UWVBFIiwiVkVSVEVYX1NIQURFUiIsIlVOU0lHTkVEX1NIT1JUX1RZUEUiLCJVTlNJR05FRF9TSE9SVCIsIkZSQUdNRU5UX1NIQURFUl9UWVBFIiwiRlJBR01FTlRfU0hBREVSIiwiQ09MT1JfQlVGRkVSX0JJVF9NQVNLIiwiQ09MT1JfQlVGRkVSX0JJVCIsIkRFUFRIX0JVRkZFUl9CSVRfTUFTSyIsIkRFUFRIX0JVRkZFUl9CSVQiLCJURVhUVVJFXzJEX1RBUkdFVCIsIlRFWFRVUkVfMkQiLCJBUlJBWV9CVUZGRVJfVEFSR0VUIiwiQVJSQVlfQlVGRkVSIiwiRUxFTUVOVF9BUlJBWV9CVUZGRVJfVEFSR0VUIiwiRUxFTUVOVF9BUlJBWV9CVUZGRVIiLCJjbGllbnRXaWR0aCIsImNsaWVudEhlaWdodCIsInByb2dyYW0iLCJuYW1lIiwiZ2V0VW5pZm9ybUxvY2F0aW9uIiwiZ2V0QXR0cmliTG9jYXRpb24iLCJ1c2VQcm9ncmFtIiwicm90YXRpb24iLCJwb3NpdGlvbiIsInBlcnNwZWN0aXZlIiwic2hhZGVyUHJvZ3JhbSIsInJvdGF0aW9uTWF0cml4IiwiZ2V0TWF0cml4IiwicG9zaXRpb25NYXRyaXgiLCJwZXJzcGVjdGl2ZU1hdHJpeCIsInJvdGF0aW9uTWF0cml4VW5pZm9ybUxvY2F0aW9uIiwicG9zaXRpb25NYXRyaXhVbmlmb3JtTG9jYXRpb24iLCJwZXJzcGVjdGl2ZU1hdHJpeFVuaWZvcm1Mb2NhdGlvbiIsImNsZWFyRGVwdGgiLCJjbGVhckNvbG91ciIsImNsZWFyRGVwdGhCdWZmZXIiLCJjbGVhckNvbG91ckJ1ZmZlciIsImFwcGx5TWF0cml4IiwiY291bnQiLCJvZmZzZXQiLCJtb2RlIiwidHlwZSIsImRyYXdFbGVtZW50cyIsIk9iamVjdCIsImFzc2lnbiIsInByb3RvdHlwZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7QUFFQSxJQUFNQSxPQUFPQyxRQUFRLFNBQVIsQ0FBYixDLENBQWtDOztBQUVsQyxJQUFNQyxlQUFlRCxRQUFRLGlCQUFSLENBQXJCO0FBQUEsSUFDTUUsZUFBZUYsUUFBUSxpQkFBUixDQURyQjtBQUFBLElBRU1HLGNBQWNILFFBQVEsZ0JBQVIsQ0FGcEI7QUFBQSxJQUdNSSxjQUFjSixRQUFRLGdCQUFSLENBSHBCO0FBQUEs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Qk4sNkJBQWpCLEVBQWdESCxjQUFoRDtBQUNBLFdBQUtTLFdBQUwsQ0FBaUJMLGdDQUFqQixFQUFtREgsaUJBQW5EO0FBQ0Q7OztpQ0FFWVMsSyxFQUErQjtBQUFBLFVBQXhCQyxNQUF3Qix1RUFBZjdFLGFBQWU7O0FBQzFDLFVBQU04RSxPQUFPLEtBQUsvQyxjQUFsQjtBQUFBLFVBQ01nRCxPQUFPLEtBQUt4QyxtQkFEbEI7O0FBR0EsV0FBS25DLE9BQUwsQ0FBYTRFLFlBQWIsQ0FBMEJGLElBQTFCLEVBQWdDRixLQUFoQyxFQUF1Q0csSUFBdkMsRUFBNkNGLE1BQTdDO0FBQ0Q7Ozs7OztBQUdISSxPQUFPQyxNQUFQLENBQWNqRixPQUFPa0YsU0FBckIsRUFBZ0MxRixZQUFoQztBQUNBd0YsT0FBT0MsTUFBUCxDQUFjakYsT0FBT2tGLFNBQXJCLEVBQWdDekYsV0FBaEM7QUFDQXVGLE9BQU9DLE1BQVAsQ0FBY2pGLE9BQU9rRixTQUFyQixFQUFnQ3hGLFdBQWhDO0FBQ0FzRixPQUFPQyxNQUFQLENBQWNqRixPQUFPa0YsU0FBckIsRUFBZ0N2RixXQUFoQztBQUNBcUYsT0FBT0MsTUFBUCxDQUFjakYsT0FBT2tGLFNBQXJCLEVBQWdDdEYsV0FBaEM7QUFDQW9GLE9BQU9DLE1BQVAsQ0FBY2pGLE9BQU9rRixTQUFyQixFQUFnQ3JGLFVBQWhDOztBQUVBc0YsT0FBT0MsT0FBUCxHQUFpQnBGLE1BQWpCIiwiZmlsZSI6ImNhbnZhcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgbWF0NCA9IHJlcXVpcmUoJ2dsLW1hdDQnKTsgIC8vL1xuXG5jb25zdCBkb21VdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy9kb20nKSxcbiAgICAgIHRleHR1cmVNaXhpbiA9IHJlcXVpcmUoJy4vbWl4aW4vdGV4dHVyZScpLFxuICAgICAgYnVmZmVyTWl4aW4gPSByZXF1aXJlKCcuL21peGluL2J1ZmZlcicpLFxuICAgICAgc2hhZGVyTWl4aW4gPSByZXF1aXJlKCcuL21peGluL3NoYWRlcicpLFxuICAgICAgY29sb3VyTWl4aW4gPSByZXF1aXJlKCcuL21peGluL2NvbG91cicpLFxuICAgICAgbWF0cml4TWl4aW4gPSByZXF1aXJlKCcuL21peGluL21hdHJpeCcpLFxuICAgICAgZGVwdGhNaXhpbiA9IHJlcXVpcmUoJy4vbWl4aW4vZGVwdGgnKTtcblxuY29uc3QgeyBkb21FbGVtZW50RnJvbVNlbGVjdG9yIH0gPSBkb21VdGlsaXRpZXM7XG5cbmNvbnN0IGRlZmF1bHRPZmZzZXQgPSAwO1xuXG5jbGFzcyBDYW52YXMge1xuICBjb25zdHJ1Y3RvcihzZWxlY3RvciA9ICdjYW52YXMnKSB7XG4gICAgY29uc3QgZG9tRWxlbWVudCA9IGRvbUVsZW1lbnRGcm9tU2VsZWN0b3Ioc2VsZWN0b3IpLFxuICAgICAgICAgIGNvbnRleHQgPSBkb21FbGVtZW50LmdldENvbnRleHQoJ3dlYmdsJyk7XG5cbiAgICBpZiAoIWNvbnRleHQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIGluaXRpYWxpc2UgdGhlIGNvbnRleHQuYCk7XG4gICAgfVxuXG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcblxuICAgIHRoaXMuZG9tRWxlbWVudCA9IGRvbUVsZW1lbnQ7XG5cbiAgICB0aGlzLkNMQU1QX1RPX0VER0VfUEFSQU0gPSB0aGlzLmNvbnRleHQuQ0xBTVBfVE9fRURHRTsgIC8vL1xuICAgIHRoaXMuTElORUFSX1BBUkFNID0gdGhpcy5jb250ZXh0LkxJTkVBUjsgIC8vL1xuICAgIHRoaXMuUkdCQV9GT1JNQVQgPSB0aGlzLmNvbnRleHQuUkdCQTsgIC8vL1xuICAgIHRoaXMuREVQVEhfVEVTVF9DQVAgPSB0aGlzLmNvbnRleHQuREVQVEhfVEVTVDsgIC8vL1xuICAgIHRoaXMuTEVRVUFMX0ZVTkNUSU9OID0gdGhpcy5jb250ZXh0LkxFUVVBTDsgLy8vXG4gICAgdGhpcy5TVEFUSUNfRFJBV19VU0FHRSA9IHRoaXMuY29udGV4dC5TVEFUSUNfRFJBVzsgLy8vXG4gICAgdGhpcy5MSU5LX1NUQVRVU19QTkFNRSA9IHRoaXMuY29udGV4dC5MSU5LX1NUQVRVUzsgIC8vL1xuICAgIHRoaXMuQ09NUElMRV9TVEFUVVNfUE5BTUUgPSB0aGlzLmNvbnRleHQuQ09NUElMRV9TVEFUVVM7ICAvLy9cbiAgICB0aGlzLlRFWFRVUkVfV1JBUF9TX1BOQU1FID0gdGhpcy5jb250ZXh0LlRFWFRVUkVfV1JBUF9TOyAgLy8vXG4gICAgdGhpcy5URVhUVVJFX1dSQVBfVF9QTkFNRSA9IHRoaXMuY29udGV4dC5URVhUVVJFX1dSQVBfVDsgIC8vL1xuICAgIHRoaXMuVEVYVFVSRV9NSU5fRklMVEVSX1BOQU1FID0gdGhpcy5jb250ZXh0LlRFWFRVUkVfTUlOX0ZJTFRFUjsgIC8vL1xuICAgIHRoaXMuVFJJQU5HTEVfU1RSSVBfTU9ERSA9IHRoaXMuY29udGV4dC5UUklBTkdMRV9TVFJJUDsgIC8vL1xuICAgIHRoaXMuVFJJQU5HTEVTX01PREUgPSB0aGlzLmNvbnRleHQuVFJJQU5HTEVTOyAgLy8vXG4gICAgdGhpcy5GTE9BVF9UWVBFID0gdGhpcy5jb250ZXh0LkZMT0FUOyAgLy8vXG4gICAgdGhpcy5VTlNJR05FRF9CWVRFX1RZUEUgPSB0aGlzLmNvbnRleHQuVU5TSUdORURfQllURTsgLy8vXG4gICAgdGhpcy5WRVJURVhfU0hBREVSX1RZUEUgPSB0aGlzLmNvbnRleHQuVkVSVEVYX1NIQURFUjsgLy8vXG4gICAgdGhpcy5VTlNJR05FRF9TSE9SVF9UWVBFID0gdGhpcy5jb250ZXh0LlVOU0lHTkVEX1NIT1JUOyAgLy8vXG4gICAgdGhpcy5GUkFHTUVOVF9TSEFERVJfVFlQRSA9IHRoaXMuY29udGV4dC5GUkFHTUVOVF9TSEFERVI7IC8vL1xuICAgIHRoaXMuQ09MT1JfQlVGRkVSX0JJVF9NQVNLID0gdGhpcy5jb250ZXh0LkNPTE9SX0JVRkZFUl9CSVQ7IC8vL1xuICAgIHRoaXMuREVQVEhfQlVGRkVSX0JJVF9NQVNLID0gdGhpcy5jb250ZXh0LkRFUFRIX0JVRkZFUl9CSVQ7IC8vL1xuICAgIHRoaXMuVEVYVFVSRV8yRF9UQVJHRVQgPSB0aGlzLmNvbnRleHQuVEVYVFVSRV8yRDsgLy8vXG4gICAgdGhpcy5BUlJBWV9CVUZGRVJfVEFSR0VUID0gdGhpcy5jb250ZXh0LkFSUkFZX0JVRkZFUjsgIC8vL1xuICAgIHRoaXMuRUxFTUVOVF9BUlJBWV9CVUZGRVJfVEFSR0VUID0gdGhpcy5jb250ZXh0LkVMRU1FTlRfQVJSQVlfQlVGRkVSOyAgLy8vXG4gIH1cblxuICBnZXRDb250ZXh0KCkge1xuICAgIHJldHVybiB0aGlzLmNvbnRleHQ7XG4gIH1cblxuICBnZXRDbGllbnRXaWR0aCgpIHsgcmV0dXJuIHRoaXMuZG9tRWxlbWVudC5jbGllbnRXaWR0aDsgfVxuXG4gIGdldENsaWVudEhlaWdodCgpIHsgcmV0dXJuIHRoaXMuZG9tRWxlbWVudC5jbGllbnRIZWlnaHQ7IH1cblxuICBnZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgbmFtZSkgeyByZXR1cm4gdGhpcy5jb250ZXh0LmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCBuYW1lKTsgfVxuXG4gIGdldEF0dHJpYnV0ZUxvY2F0aW9uKHByb2dyYW0sIG5hbWUpIHsgcmV0dXJuIHRoaXMuY29udGV4dC5nZXRBdHRyaWJMb2NhdGlvbihwcm9ncmFtLCBuYW1lKTsgfVxuXG4gIHVzZVByb2dyYW0ocHJvZ3JhbSkgeyB0aGlzLmNvbnRleHQudXNlUHJvZ3JhbShwcm9ncmFtKTsgfVxuICBcbiAgcmVuZGVyKHJvdGF0aW9uLCBwb3NpdGlvbiwgcGVyc3BlY3RpdmUsIHNoYWRlclByb2dyYW0pIHtcbiAgICBjb25zdCByb3RhdGlvbk1hdHJpeCA9IHJvdGF0aW9uLmdldE1hdHJpeCgpLFxuICAgICAgICAgIHBvc2l0aW9uTWF0cml4ID0gcG9zaXRpb24uZ2V0TWF0cml4KCksXG4gICAgICAgICAgcGVyc3BlY3RpdmVNYXRyaXggPSBwZXJzcGVjdGl2ZS5nZXRNYXRyaXgoKSxcbiAgICAgICAgICByb3RhdGlvbk1hdHJpeFVuaWZvcm1Mb2NhdGlvbiA9IHRoaXMuZ2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICd1Um90YXRpb25NYXRyaXgnKSxcbiAgICAgICAgICBwb3NpdGlvbk1hdHJpeFVuaWZvcm1Mb2NhdGlvbiA9IHRoaXMuZ2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICd1UG9zaXRpb25NYXRyaXgnKSxcbiAgICAgICAgICBwZXJzcGVjdGl2ZU1hdHJpeFVuaWZvcm1Mb2NhdGlvbiA9IHRoaXMuZ2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICd1UGVyc3BlY3RpdmVNYXRyaXgnKTtcblxuICAgIHRoaXMuY2xlYXJEZXB0aCgpO1xuICAgIHRoaXMuY2xlYXJDb2xvdXIoKTtcbiAgICB0aGlzLmNsZWFyRGVwdGhCdWZmZXIoKTtcbiAgICB0aGlzLmNsZWFyQ29sb3VyQnVmZmVyKCk7XG5cbiAgICB0aGlzLmFwcGx5TWF0cml4KHJvdGF0aW9uTWF0cml4VW5pZm9ybUxvY2F0aW9uLCByb3RhdGlvbk1hdHJpeCk7XG4gICAgdGhpcy5hcHBseU1hdHJpeChwb3NpdGlvbk1hdHJpeFVuaWZvcm1Mb2NhdGlvbiwgcG9zaXRpb25NYXRyaXgpO1xuICAgIHRoaXMuYXBwbHlNYXRyaXgocGVyc3BlY3RpdmVNYXRyaXhVbmlmb3JtTG9jYXRpb24sIHBlcnNwZWN0aXZlTWF0cml4KTtcbiAgfVxuXG4gIGRyYXdFbGVtZW50cyhjb3VudCwgb2Zmc2V0ID0gZGVmYXVsdE9mZnNldCkge1xuICAgIGNvbnN0IG1vZGUgPSB0aGlzLlRSSUFOR0xFU19NT0RFLFxuICAgICAgICAgIHR5cGUgPSB0aGlzLlVOU0lHTkVEX1NIT1JUX1RZUEU7XG5cbiAgICB0aGlzLmNvbnRleHQuZHJhd0VsZW1lbnRzKG1vZGUsIGNvdW50LCB0eXBlLCBvZmZzZXQpXG4gIH1cbn1cblxuT2JqZWN0LmFzc2lnbihDYW52YXMucHJvdG90eXBlLCB0ZXh0dXJlTWl4aW4pO1xuT2JqZWN0LmFzc2lnbihDYW52YXMucHJvdG90eXBlLCBidWZmZXJNaXhpbik7XG5PYmplY3QuYXNzaWduKENhbnZhcy5wcm90b3R5cGUsIHNoYWRlck1peGluKTtcbk9iamVjdC5hc3NpZ24oQ2FudmFzLnByb3RvdHlwZSwgY29sb3VyTWl4aW4pO1xuT2JqZWN0LmFzc2lnbihDYW52YXMucHJvdG90eXBlLCBtYXRyaXhNaXhpbik7XG5PYmplY3QuYXNzaWduKENhbnZhcy5wcm90b3R5cGUsIGRlcHRoTWl4aW4pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IENhbnZhcztcbiJdfQ==