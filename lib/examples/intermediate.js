'use strict';

var Canvas = require('../canvas'),
    Rotation = require('../rotation'),
    Position = require('../position'),
    Perspective = require('../perspective');

var intermediate = function intermediate() {
  var canvas = new Canvas(),
      context = canvas.getContext();

  if (!context) {
    return;
  }

  var vertexShaderSource = '\n          attribute vec4 aVertexPosition;\n          attribute vec4 aVertexColour;\n          \n          uniform mat4 uRotationMatrix;\n          uniform mat4 uPositionMatrix;\n          uniform mat4 uPerspectiveMatrix;\n          \n          varying lowp vec4 vColour;\n      \n          void main() {\n            gl_Position = uPerspectiveMatrix* uPositionMatrix * uRotationMatrix * aVertexPosition;\n            vColour = aVertexColour;\n          }\n        ',
      fragmentShaderSource = '\n          varying lowp vec4 vColour;\n\n          void main() {\n            gl_FragColor = vColour;\n          }\n        ',
      shaderProgram = canvas.createShaderProgram(vertexShaderSource, fragmentShaderSource),
      clientWidth = canvas.getClientWidth(),
      clientHeight = canvas.getClientHeight(),
      position = new Position(),
      perspective = new Perspective(clientWidth, clientHeight);

  createAndBindVertexPositionBuffer(canvas, shaderProgram);

  createAndBindVertexColourBuffer(canvas, shaderProgram);

  var count = createVertexIndexElementBuffer(canvas);

  canvas.useProgram(shaderProgram);

  canvas.enableDepthTesting();
  canvas.enableDepthFunction();

  var initialTime = null;

  function render(time) {
    if (initialTime === null) {
      initialTime = time;
    }

    var elapsedTime = time - initialTime,
        xAngle = elapsedTime / 1000,
        yAngle = elapsedTime / 1000,
        rotation = new Rotation(xAngle, yAngle);

    canvas.render(rotation, position, perspective, shaderProgram);

    canvas.drawElements(count);

    requestAnimationFrame(render);
  }

  requestAnimationFrame(render);
};

module.exports = intermediate;

function createAndBindVertexPositionBuffer(canvas, shaderProgram) {
  var vertexPositionData = [+1.0, +1.0, +1.0, -1.0, +1.0, +1.0, +1.0, -1.0, +1.0, -1.0, -1.0, +1.0, +1.0, +1.0, -1.0, -1.0, +1.0, -1.0, +1.0, -1.0, -1.0, -1.0, -1.0, -1.0],
      vertexPositionBuffer = canvas.createBuffer(vertexPositionData),
      vertexPositionAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexPosition'),
      vertexPositionComponents = 3;

  canvas.bindBuffer(vertexPositionBuffer, vertexPositionAttributeLocation, vertexPositionComponents);

  var vertexPositionDataLength = vertexPositionData.length,
      count = vertexPositionDataLength / vertexPositionComponents;

  return count;
}

function createAndBindVertexColourBuffer(canvas, shaderProgram) {
  var vertexColourData = [1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0],
      vertexColourBuffer = canvas.createBuffer(vertexColourData),
      vertexColourAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexColour'),
      vertexColourComponents = 4;

  canvas.bindBuffer(vertexColourBuffer, vertexColourAttributeLocation, vertexColourComponents);
}

function createVertexIndexElementBuffer(canvas) {
  var vertexIndexData = [0, 1, 2, 1, 2, 3, 4, 5, 6, 5, 6, 7],
      vertexIndexElementBuffer = canvas.createElementBuffer(vertexIndexData),
      vertexIndexDataLength = vertexIndexData.length,
      count = vertexIndexDataLength; ///

  canvas.bindElementBuffer(vertexIndexElementBuffer);

  return count;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9leGFtcGxlcy9pbnRlcm1lZGlhdGUuanMiXSwibmFtZXMiOlsiQ2FudmFzIiwicmVxdWlyZSIsIlJvdGF0aW9uIiwiUG9zaXRpb24iLCJQZXJzcGVjdGl2ZSIsImludGVybWVkaWF0ZSIsImNhbnZhcyIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwidmVydGV4U2hhZGVyU291cmNlIiwiZnJhZ21lbnRTaGFkZXJTb3VyY2UiLCJzaGFkZXJQcm9ncmFtIiwiY3JlYXRlU2hhZGVyUHJvZ3JhbSIsImNsaWVudFdpZHRoIiwiZ2V0Q2xpZW50V2lkdGgiLCJjbGllbnRIZWlnaHQiLCJnZXRDbGllbnRIZWlnaHQiLCJwb3NpdGlvbiIsInBlcnNwZWN0aXZlIiwiY3JlYXRlQW5kQmluZFZlcnRleFBvc2l0aW9uQnVmZmVyIiwiY3JlYXRlQW5kQmluZFZlcnRleENvbG91ckJ1ZmZlciIsImNvdW50IiwiY3JlYXRlVmVydGV4SW5kZXhFbGVtZW50QnVmZmVyIiwidXNlUHJvZ3JhbSIsImVuYWJsZURlcHRoVGVzdGluZyIsImVuYWJsZURlcHRoRnVuY3Rpb24iLCJpbml0aWFsVGltZSIsInJlbmRlciIsInRpbWUiLCJlbGFwc2VkVGltZSIsInhBbmdsZSIsInlBbmdsZSIsInJvdGF0aW9uIiwiZHJhd0VsZW1lbnRzIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwibW9kdWxlIiwiZXhwb3J0cyIsInZlcnRleFBvc2l0aW9uRGF0YSIsInZlcnRleFBvc2l0aW9uQnVmZmVyIiwiY3JlYXRlQnVmZmVyIiwidmVydGV4UG9zaXRpb25BdHRyaWJ1dGVMb2NhdGlvbiIsImdldEF0dHJpYnV0ZUxvY2F0aW9uIiwidmVydGV4UG9zaXRpb25Db21wb25lbnRzIiwiYmluZEJ1ZmZlciIsInZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCIsImxlbmd0aCIsInZlcnRleENvbG91ckRhdGEiLCJ2ZXJ0ZXhDb2xvdXJCdWZmZXIiLCJ2ZXJ0ZXhDb2xvdXJBdHRyaWJ1dGVMb2NhdGlvbiIsInZlcnRleENvbG91ckNvbXBvbmVudHMiLCJ2ZXJ0ZXhJbmRleERhdGEiLCJ2ZXJ0ZXhJbmRleEVsZW1lbnRCdWZmZXIiLCJjcmVhdGVFbGVtZW50QnVmZmVyIiwidmVydGV4SW5kZXhEYXRhTGVuZ3RoIiwiYmluZEVsZW1lbnRCdWZmZXIiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQU1BLFNBQVNDLFFBQVEsV0FBUixDQUFmO0FBQUEsSUFDTUMsV0FBV0QsUUFBUSxhQUFSLENBRGpCO0FBQUEsSUFFTUUsV0FBV0YsUUFBUSxhQUFSLENBRmpCO0FBQUEsSUFHTUcsY0FBY0gsUUFBUSxnQkFBUixDQUhwQjs7QUFLQSxJQUFNSSxlQUFlLFNBQWZBLFlBQWUsR0FBTTtBQUN6QixNQUFNQyxTQUFTLElBQUlOLE1BQUosRUFBZjtBQUFBLE1BQ01PLFVBQVVELE9BQU9FLFVBQVAsRUFEaEI7O0FBR0EsTUFBSSxDQUFDRCxPQUFMLEVBQWM7QUFDWjtBQUNEOztBQUVELE1BQU1FLHllQUFOO0FBQUEsTUFlTUMsc0pBZk47QUFBQSxNQXNCTUMsZ0JBQWdCTCxPQUFPTSxtQkFBUCxDQUEyQkgsa0JBQTNCLEVBQStDQyxvQkFBL0MsQ0F0QnRCO0FBQUEsTUF1Qk1HLGNBQWNQLE9BQU9RLGNBQVAsRUF2QnBCO0FBQUEsTUF3Qk1DLGVBQWVULE9BQU9VLGVBQVAsRUF4QnJCO0FBQUEsTUF5Qk1DLFdBQVcsSUFBSWQsUUFBSixFQXpCakI7QUFBQSxNQTBCTWUsY0FBYyxJQUFJZCxXQUFKLENBQWdCUyxXQUFoQixFQUE2QkUsWUFBN0IsQ0ExQnBCOztBQTRCQUksb0NBQWtDYixNQUFsQyxFQUEwQ0ssYUFBMUM7O0FBRUFTLGtDQUFnQ2QsTUFBaEMsRUFBd0NLLGFBQXhDOztBQUVBLE1BQU1VLFFBQVFDLCtCQUErQmhCLE1BQS9CLENBQWQ7O0FBRUFBLFNBQU9pQixVQUFQLENBQWtCWixhQUFsQjs7QUFFQUwsU0FBT2tCLGtCQUFQO0FBQ0FsQixTQUFPbUIsbUJBQVA7O0FBRUEsTUFBSUMsY0FBYyxJQUFs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O0FBRUQsU0FBUzNCLDhCQUFULENBQXdDaEIsTUFBeEMsRUFBZ0Q7QUFDOUMsTUFBTTRDLGtCQUFrQixDQUNoQixDQURnQixFQUNiLENBRGEsRUFDVixDQURVLEVBRWhCLENBRmdCLEVBRWIsQ0FGYSxFQUVWLENBRlUsRUFHaEIsQ0FIZ0IsRUFHYixDQUhhLEVBR1YsQ0FIVSxFQUloQixDQUpnQixFQUliLENBSmEsRUFJVixDQUpVLENBQXhCO0FBQUEsTUFNTUMsMkJBQTJCN0MsT0FBTzhDLG1CQUFQLENBQTJCRixlQUEzQixDQU5qQztBQUFBLE1BT01HLHdCQUF3QkgsZ0JBQWdCTCxNQVA5QztBQUFBLE1BUU14QixRQUFRZ0MscUJBUmQsQ0FEOEMsQ0FTUjs7QUFFdEMvQyxTQUFPZ0QsaUJBQVAsQ0FBeUJILHdCQUF6Qjs7QUFFQSxTQUFPOUIsS0FBUDtBQUNEIiwiZmlsZSI6ImludGVybWVkaWF0ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgQ2FudmFzID0gcmVxdWlyZSgnLi4vY2FudmFzJyksXG4gICAgICBSb3RhdGlvbiA9IHJlcXVpcmUoJy4uL3JvdGF0aW9uJyksXG4gICAgICBQb3NpdGlvbiA9IHJlcXVpcmUoJy4uL3Bvc2l0aW9uJyksXG4gICAgICBQZXJzcGVjdGl2ZSA9IHJlcXVpcmUoJy4uL3BlcnNwZWN0aXZlJyk7XG5cbmNvbnN0IGludGVybWVkaWF0ZSA9ICgpID0+IHtcbiAgY29uc3QgY2FudmFzID0gbmV3IENhbnZhcygpLFxuICAgICAgICBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoKTtcblxuICBpZiAoIWNvbnRleHQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCB2ZXJ0ZXhTaGFkZXJTb3VyY2UgPSBgXG4gICAgICAgICAgYXR0cmlidXRlIHZlYzQgYVZlcnRleFBvc2l0aW9uO1xuICAgICAgICAgIGF0dHJpYnV0ZSB2ZWM0IGFWZXJ0ZXhDb2xvdXI7XG4gICAgICAgICAgXG4gICAgICAgICAgdW5pZm9ybSBtYXQ0IHVSb3RhdGlvbk1hdHJpeDtcbiAgICAgICAgICB1bmlmb3JtIG1hdDQgdVBvc2l0aW9uTWF0cml4O1xuICAgICAgICAgIHVuaWZvcm0gbWF0NCB1UGVyc3BlY3RpdmVNYXRyaXg7XG4gICAgICAgICAgXG4gICAgICAgICAgdmFyeWluZyBsb3dwIHZlYzQgdkNvbG91cjtcbiAgICAgIFxuICAgICAgICAgIHZvaWQgbWFpbigpIHtcbiAgICAgICAgICAgIGdsX1Bvc2l0aW9uID0gdVBlcnNwZWN0aXZlTWF0cml4KiB1UG9zaXRpb25NYXRyaXggKiB1Um90YXRpb25NYXRyaXggKiBhVmVydGV4UG9zaXRpb247XG4gICAgICAgICAgICB2Q29sb3VyID0gYVZlcnRleENvbG91cjtcbiAgICAgICAgICB9XG4gICAgICAgIGAsXG4gICAgICAgIGZyYWdtZW50U2hhZGVyU291cmNlID0gYFxuICAgICAgICAgIHZhcnlpbmcgbG93cCB2ZWM0IHZDb2xvdXI7XG5cbiAgICAgICAgICB2b2lkIG1haW4oKSB7XG4gICAgICAgICAgICBnbF9GcmFnQ29sb3IgPSB2Q29sb3VyO1xuICAgICAgICAgIH1cbiAgICAgICAgYCxcbiAgICAgICAgc2hhZGVyUHJvZ3JhbSA9IGNhbnZhcy5jcmVhdGVTaGFkZXJQcm9ncmFtKHZlcnRleFNoYWRlclNvdXJjZSwgZnJhZ21lbnRTaGFkZXJTb3VyY2UpLFxuICAgICAgICBjbGllbnRXaWR0aCA9IGNhbnZhcy5nZXRDbGllbnRXaWR0aCgpLFxuICAgICAgICBjbGllbnRIZWlnaHQgPSBjYW52YXMuZ2V0Q2xpZW50SGVpZ2h0KCksXG4gICAgICAgIHBvc2l0aW9uID0gbmV3IFBvc2l0aW9uKCksXG4gICAgICAgIHBlcnNwZWN0aXZlID0gbmV3IFBlcnNwZWN0aXZlKGNsaWVudFdpZHRoLCBjbGllbnRIZWlnaHQpO1xuXG4gIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhQb3NpdGlvbkJ1ZmZlcihjYW52YXMsIHNoYWRlclByb2dyYW0pO1xuXG4gIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhDb2xvdXJCdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKTtcblxuICBjb25zdCBjb3VudCA9IGNyZWF0ZVZlcnRleEluZGV4RWxlbWVudEJ1ZmZlcihjYW52YXMpO1xuXG4gIGNhbnZhcy51c2VQcm9ncmFtKHNoYWRlclByb2dyYW0pO1xuXG4gIGNhbnZhcy5lbmFibGVEZXB0aFRlc3RpbmcoKTtcbiAgY2FudmFzLmVuYWJsZURlcHRoRnVuY3Rpb24oKTtcblxuICBsZXQgaW5pdGlhbFRpbWUgPSBudWxsO1xuXG4gIGZ1bmN0aW9uIHJlbmRlcih0aW1lKSB7XG4gICAgaWYgKGluaXRpYWxUaW1lID09PSBudWxsKSB7XG4gICAgICBpbml0aWFsVGltZSA9IHRpbWU7XG4gICAgfVxuXG4gICAgY29uc3QgZWxhcHNlZFRpbWUgPSB0aW1lIC0gaW5pdGlhbFRpbWUsXG4gICAgICAgICAgeEFuZ2xlID0gZWxhcHNlZFRpbWUgLyAxMDAwLFxuICAgICAgICAgIHlBbmdsZSA9IGVsYXBzZWRUaW1lIC8gMTAwMCxcbiAgICAgICAgICByb3RhdGlvbiA9IG5ldyBSb3RhdGlvbih4QW5nbGUsIHlBbmdsZSk7XG5cbiAgICBjYW52YXMucmVuZGVyKHJvdGF0aW9uLCBwb3NpdGlvbiwgcGVyc3BlY3RpdmUsIHNoYWRlclByb2dyYW0pO1xuXG4gICAgY2FudmFzLmRyYXdFbGVtZW50cyhjb3VudCk7XG5cbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVuZGVyKTtcbiAgfVxuXG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBpbnRlcm1lZGlhdGU7XG5cbmZ1bmN0aW9uIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhQb3NpdGlvbkJ1ZmZlcihjYW52YXMsIHNoYWRlclByb2dyYW0pIHtcbiAgY29uc3QgdmVydGV4UG9zaXRpb25EYXRhID0gW1xuICAgICAgICAgICsxLjAsICsxLjAsICsxLjAsXG4gICAgICAgICAgLTEuMCwgKzEuMCwgKzEuMCxcbiAgICAgICAgICArMS4wLCAtMS4wLCArMS4wLFxuICAgICAgICAgIC0xLjAsIC0xLjAsICsxLjAsXG4gICAgICAgICAgKzEuMCwgKzEuMCwgLTEuMCxcbiAgICAgICAgICAtMS4wLCArMS4wLCAtMS4wLFxuICAgICAgICAgICsxLjAsIC0xLjAsIC0xLjAsXG4gICAgICAgICAgLTEuMCwgLTEuMCwgLTEuMFxuICAgICAgICBdLFxuICAgICAgICB2ZXJ0ZXhQb3NpdGlvbkJ1ZmZlciA9IGNhbnZhcy5jcmVhdGVCdWZmZXIodmVydGV4UG9zaXRpb25EYXRhKSxcbiAgICAgICAgdmVydGV4UG9zaXRpb25BdHRyaWJ1dGVMb2NhdGlvbiA9IGNhbnZhcy5nZXRBdHRyaWJ1dGVMb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAnYVZlcnRleFBvc2l0aW9uJyksXG4gICAgICAgIHZlcnRleFBvc2l0aW9uQ29tcG9uZW50cyA9IDM7XG5cbiAgY2FudmFzLmJpbmRCdWZmZXIodmVydGV4UG9zaXRpb25CdWZmZXIsIHZlcnRleFBvc2l0aW9uQXR0cmlidXRlTG9jYXRpb24sIHZlcnRleFBvc2l0aW9uQ29tcG9uZW50cyk7XG5cbiAgY29uc3QgdmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoID0gdmVydGV4UG9zaXRpb25EYXRhLmxlbmd0aCxcbiAgICAgICAgY291bnQgPSB2ZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGggLyB2ZXJ0ZXhQb3NpdGlvbkNvbXBvbmVudHM7XG5cbiAgcmV0dXJuIGNvdW50O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVBbmRCaW5kVmVydGV4Q29sb3VyQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSkge1xuICBjb25zdCB2ZXJ0ZXhDb2xvdXJEYXRhID0gW1xuICAgICAgICAgIDEuMCwgIDAuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAwLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDAuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsICAwLjAsICAxLjBcbiAgICAgICAgXSxcbiAgICAgICAgdmVydGV4Q29sb3VyQnVmZmVyID0gY2FudmFzLmNyZWF0ZUJ1ZmZlcih2ZXJ0ZXhDb2xvdXJEYXRhKSxcbiAgICAgICAgdmVydGV4Q29sb3VyQXR0cmlidXRlTG9jYXRpb24gPSBjYW52YXMuZ2V0QXR0cmlidXRlTG9jYXRpb24oc2hhZGVyUHJvZ3JhbSwgJ2FWZXJ0ZXhDb2xvdXInKSxcbiAgICAgICAgdmVydGV4Q29sb3VyQ29tcG9uZW50cyA9IDQ7XG5cbiAgY2FudmFzLmJpbmRCdWZmZXIodmVydGV4Q29sb3VyQnVmZmVyLCB2ZXJ0ZXhDb2xvdXJBdHRyaWJ1dGVMb2NhdGlvbiwgdmVydGV4Q29sb3VyQ29tcG9uZW50cyk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVZlcnRleEluZGV4RWxlbWVudEJ1ZmZlcihjYW52YXMpIHtcbiAgY29uc3QgdmVydGV4SW5kZXhEYXRhID0gW1xuICAgICAgICAgIDAsIDEsIDIsXG4gICAgICAgICAgMSwgMiwgMyxcbiAgICAgICAgICA0LCA1LCA2LFxuICAgICAgICAgIDUsIDYsIDdcbiAgICAgICAgXSxcbiAgICAgICAgdmVydGV4SW5kZXhFbGVtZW50QnVmZmVyID0gY2FudmFzLmNyZWF0ZUVsZW1lbnRCdWZmZXIodmVydGV4SW5kZXhEYXRhKSxcbiAgICAgICAgdmVydGV4SW5kZXhEYXRhTGVuZ3RoID0gdmVydGV4SW5kZXhEYXRhLmxlbmd0aCxcbiAgICAgICAgY291bnQgPSB2ZXJ0ZXhJbmRleERhdGFMZW5ndGg7ICAvLy9cblxuICBjYW52YXMuYmluZEVsZW1lbnRCdWZmZXIodmVydGV4SW5kZXhFbGVtZW50QnVmZmVyKTtcblxuICByZXR1cm4gY291bnQ7XG59Il19