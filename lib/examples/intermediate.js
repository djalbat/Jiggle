'use strict';

var Canvas = require('../canvas'),
    Shader = require('../shader'),
    Normal = require('../normal'),
    Rotation = require('../rotation'),
    Position = require('../position'),
    Perspective = require('../perspective');

var intermediate = function intermediate() {
  var canvas = new Canvas(),
      context = canvas.getContext();

  if (!context) {
    return;
  }

  var shaderProgram = Shader.createShaderProgram(context),
      clientWidth = canvas.getClientWidth(),
      clientHeight = canvas.getClientHeight(),
      zCoordinate = -5,
      ///
  position = Position.fromZCoordinate(zCoordinate),
      perspective = Perspective.fromClientWidthAndClientHeight(clientWidth, clientHeight);

  createAndBindVertexPositionBuffer(canvas, shaderProgram);

  // createAndBindVertexColourBuffer(canvas, shaderProgram);

  createAndBindTextureCoordinateBuffer(canvas, shaderProgram);

  createAndBindVertexNormalBuffer(canvas, shaderProgram);

  var count = createVertexIndexElementBuffer(canvas);

  canvas.useProgram(shaderProgram);

  canvas.enableDepthTesting();
  canvas.enableDepthFunction();

  var initialTime = null;

  var image = new Image();

  image.onload = function () {
    var context = canvas.getContext(),
        TEXTURE0 = context.TEXTURE0,
        target = TEXTURE0,
        uSamplerUniformLocationIntegerValue = 0,
        uSamplerUniformLocation = canvas.getUniformLocation(shaderProgram, 'uSampler');


    canvas.createTexture(image);

    canvas.activateTexture(target);

    canvas.setUniformLocationIntegerValue(uSamplerUniformLocation, uSamplerUniformLocationIntegerValue);

    requestAnimationFrame(render);
  };

  image.src = 'texture/bricks.jpg';

  function render(time) {
    if (initialTime === null) {
      initialTime = time;
    }

    var elapsedTime = time - initialTime,
        xAngle = elapsedTime / 1000,
        yAngle = elapsedTime / 1000,
        rotation = Rotation.fromXAngleAndYAngle(xAngle, yAngle),
        normal = Normal.fromRotation(rotation);

    canvas.render(normal, rotation, position, perspective, shaderProgram);

    canvas.drawElements(count);

    requestAnimationFrame(render);
  }
};

module.exports = intermediate;

function createAndBindVertexPositionBuffer(canvas, shaderProgram) {
  var vertexPositionData = [-1.0, -1.0, +1.0, +1.0, -1.0, +1.0, +1.0, +1.0, +1.0, -1.0, +1.0, +1.0, -1.0, -1.0, -1.0, -1.0, +1.0, -1.0, +1.0, +1.0, -1.0, +1.0, -1.0, -1.0, -1.0, +1.0, -1.0, -1.0, +1.0, +1.0, +1.0, +1.0, +1.0, +1.0, +1.0, -1.0, -1.0, -1.0, -1.0, +1.0, -1.0, -1.0, +1.0, -1.0, +1.0, -1.0, -1.0, +1.0, +1.0, -1.0, -1.0, +1.0, +1.0, -1.0, +1.0, +1.0, +1.0, +1.0, -1.0, +1.0, -1.0, -1.0, -1.0, -1.0, -1.0, +1.0, -1.0, +1.0, +1.0, -1.0, +1.0, -1.0],
      vertexPositionBuffer = canvas.createBuffer(vertexPositionData),
      vertexPositionAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexPosition'),
      vertexPositionComponents = 3;

  canvas.bindBuffer(vertexPositionBuffer, vertexPositionAttributeLocation, vertexPositionComponents);

  var vertexPositionDataLength = vertexPositionData.length,
      count = vertexPositionDataLength / vertexPositionComponents;

  return count;
}

function createAndBindVertexColourBuffer(canvas, shaderProgram) {
  var vertexColourData = [1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0],
      vertexColourBuffer = canvas.createBuffer(vertexColourData),
      vertexColourAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexColour'),
      vertexColourComponents = 4;

  canvas.bindBuffer(vertexColourBuffer, vertexColourAttributeLocation, vertexColourComponents);
}

function createAndBindTextureCoordinateBuffer(canvas, shaderProgram) {
  var textureCoordinateData = [0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0],
      textureCoordinateBuffer = canvas.createBuffer(textureCoordinateData),
      textureCoordinateAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aTextureCoordinate'),
      textureCoordinateComponents = 2;

  canvas.bindBuffer(textureCoordinateBuffer, textureCoordinateAttributeLocation, textureCoordinateComponents);
}

function createAndBindVertexNormalBuffer(canvas, shaderProgram) {
  var vertexNormalData = [0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0],
      vertexNormalBuffer = canvas.createBuffer(vertexNormalData),
      vertexNormalAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexNormal'),
      vertexNormalComponents = 3;

  canvas.bindBuffer(vertexNormalBuffer, vertexNormalAttributeLocation, vertexNormalComponents);
}

function createVertexIndexElementBuffer(canvas) {
  var vertexIndexData = [0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19, 20, 21, 22, 20, 22, 23],
      vertexIndexElementBuffer = canvas.createElementBuffer(vertexIndexData),
      vertexIndexDataLength = vertexIndexData.length,
      count = vertexIndexDataLength; ///

  canvas.bindElementBuffer(vertexIndexElementBuffer);

  return count;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9leGFtcGxlcy9pbnRlcm1lZGlhdGUuanMiXSwibmFtZXMiOlsiQ2FudmFzIiwicmVxdWlyZSIsIlNoYWRlciIsIk5vcm1hbCIsIlJvdGF0aW9uIiwiUG9zaXRpb24iLCJQZXJzcGVjdGl2ZSIsImludGVybWVkaWF0ZSIsImNhbnZhcyIsImNvbnRleHQiLCJnZXRDb250ZXh0Iiwic2hhZGVyUHJvZ3JhbSIsImNyZWF0ZVNoYWRlclByb2dyYW0iLCJjbGllbnRXaWR0aCIsImdldENsaWVudFdpZHRoIiwiY2xpZW50SGVpZ2h0IiwiZ2V0Q2xpZW50SGVpZ2h0IiwiekNvb3JkaW5hdGUiLCJwb3NpdGlvbiIsImZyb21aQ29vcmRpbmF0ZSIsInBlcnNwZWN0aXZlIiwiZnJvbUNsaWVudFdpZHRoQW5kQ2xpZW50SGVpZ2h0IiwiY3JlYXRlQW5kQmluZFZlcnRleFBvc2l0aW9uQnVmZmVyIiwiY3JlYXRlQW5kQmluZFRleHR1cmVDb29yZGluYXRlQnVmZmVyIiwiY3JlYXRlQW5kQmluZFZlcnRleE5vcm1hbEJ1ZmZlciIsImNvdW50IiwiY3JlYXRlVmVydGV4SW5kZXhFbGVtZW50QnVmZmVyIiwidXNlUHJvZ3JhbSIsImVuYWJsZURlcHRoVGVzdGluZyIsImVuYWJsZURlcHRoRnVuY3Rpb24iLCJpbml0aWFsVGltZSIsImltYWdlIiwiSW1hZ2UiLCJvbmxvYWQiLCJURVhUVVJFMCIsInRhcmdldCIsInVTYW1wbGVyVW5pZm9ybUxvY2F0aW9uSW50ZWdlclZhbHVlIiwidVNhbXBsZXJVbmlmb3JtTG9jYXRpb24iLCJnZXRVbmlmb3JtTG9jYXRpb24iLCJjcmVhdGVUZXh0dXJlIiwiYWN0aXZhdGVUZXh0dXJlIiwic2V0VW5pZm9ybUxvY2F0aW9uSW50ZWdlclZhbHVlIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwicmVuZGVyIiwic3JjIiwidGltZSIsImVsYXBzZWRUaW1lIiwieEFuZ2xlIiwieUFuZ2xlIiwicm90YXRpb24iLCJmcm9tWEFuZ2xlQW5kWUFuZ2xlIiwibm9ybWFsIiwiZnJvbVJvdGF0aW9uIiwiZHJhd0VsZW1lbnRzIiwibW9kdWxlIiwiZXhwb3J0cyIsInZlcnRleFBvc2l0aW9uRGF0YSIsInZlcnRleFBvc2l0aW9uQnVmZmVyIiwiY3JlYXRlQnVmZmVyIiwidmVydGV4UG9zaXRpb25BdHRyaWJ1dGVMb2NhdGlvbiIsImdldEF0dHJpYnV0ZUxvY2F0aW9uIiwidmVydGV4UG9zaXRpb25Db21wb25lbnRzIiwiYmluZEJ1ZmZlciIsInZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCIsImxlbmd0aCIsImNyZWF0ZUFuZEJpbmRWZXJ0ZXhDb2xvdXJCdWZmZXIiLCJ2ZXJ0ZXhDb2xvdXJEYXRhIiwidmVydGV4Q29sb3VyQnVmZmVyIiwidmVydGV4Q29sb3VyQXR0cmlidXRlTG9jYXRpb24iLCJ2ZXJ0ZXhDb2xvdXJDb21wb25lbnRzIiwidGV4dHVyZUNvb3JkaW5hdGVEYXRhIiwidGV4dHVyZUNvb3JkaW5hdGVCdWZmZXIiLCJ0ZXh0dXJlQ29vcmRpbmF0ZUF0dHJpYnV0ZUxvY2F0aW9uIiwidGV4dHVyZUNvb3JkaW5hdGVDb21wb25lbnRzIiwidmVydGV4Tm9ybWFsRGF0YSIsInZlcnRleE5vcm1hbEJ1ZmZlciIsInZlcnRleE5vcm1hbEF0dHJpYnV0ZUxvY2F0aW9uIiwidmVydGV4Tm9ybWFsQ29tcG9uZW50cyIsInZlcnRleEluZGV4RGF0YSIsInZlcnRleEluZGV4RWxlbWVudEJ1ZmZlciIsImNyZWF0ZUVsZW1lbnRCdWZmZXIiLCJ2ZXJ0ZXhJbmRleERhdGFMZW5ndGgiLCJiaW5kRWxlbWVudEJ1ZmZlciJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsU0FBU0MsUUFBUSxXQUFSLENBQWY7QUFBQSxJQUNNQyxTQUFTRCxRQUFRLFdBQVIsQ0FEZjtBQUFBLElBRU1FLFNBQVNGLFFBQVEsV0FBUixDQUZmO0FBQUEsSUFHTUcsV0FBV0gsUUFBUSxhQUFSLENBSGpCO0FBQUEsSUFJTUksV0FBV0osUUFBUSxhQUFSLENBSmpCO0FBQUEsSUFLTUssY0FBY0wsUUFBUSxnQkFBUixDQUxwQjs7QUFPQSxJQUFNTSxlQUFlLFNBQWZBLFlBQWUsR0FBTTtBQUN6QixNQUFNQyxTQUFTLElBQUlSLE1BQUosRUFBZjtBQUFBLE1BQ01TLFVBQVVELE9BQU9FLFVBQVAsRUFEaEI7O0FBR0EsTUFBSSxDQUFDRCxPQUFMLEVBQWM7QUFDWjtBQUNEOztBQUVELE1BQU1FLGdCQUFnQlQsT0FBT1UsbUJBQVAsQ0FBMkJILE9BQTNCLENBQXRCO0FBQUEsTUFDTUksY0FBY0wsT0FBT00sY0FBUCxFQURwQjtBQUFBLE1BRU1DLGVBQWVQLE9BQU9RLGVBQVAsRUFGckI7QUFBQSxNQUdNQyxjQUFjLENBQUMsQ0FIckI7QUFBQSxNQUd3QjtBQUNsQkMsYUFBV2IsU0FBU2MsZUFBVCxDQUF5QkYsV0FBekIsQ0FKakI7QUFBQSxNQUtNRyxjQUFjZCxZQUFZZSw4QkFBWixDQUEyQ1IsV0FBM0MsRUFBd0RFLFlBQXhELENBTHBCOztBQU9BTyxvQ0FBa0NkLE1BQWxDLEVBQTBDRyxhQUExQzs7QUFFQTs7QUFFQVksdUNBQXFDZixNQUFyQyxFQUE2Q0csYUFBN0M7O0FBRUFhLGtDQUFnQ2hCLE1BQWhDLEVBQXdDRyxhQUF4Qzs7QUFFQSxNQUFNYyxRQUFRQywrQkFBK0JsQixNQUEvQixDQUFkOztBQUVBQSxTQUFPbUIsVUFBUCxDQUFrQmhCLGFBQWxCOztBQUVBSCxTQUFPb0Isa0JBQVA7QUFDQXBCLFNBQU9xQixtQkFBUDs7QUFFQSxNQUFJQyxjQUFjLElBQWxCOztBQUVBLE1BQU1DLFFBQVEsSUFBSUMsS0FBSixFQUFkOztBQUVBRCxRQUFNRSxNQUFOLEdBQWUsWUFBVztBQUNsQixrQkFBVXpCLE9BQU9FLFVBQVAsRUFBVjtBQUFBLFFBQ0V3QixRQURGLEdBQ2V6QixPQURmLENBQ0V5QixRQURGO0FBQUEsUUFFQUMsTUFGQSxHQUVTRCxRQUZUO0FBQUEsUUFHQUUsbUNBSEEsR0FHc0MsQ0FIdEM7QUFBQSxRQUlBQyx1QkFKQSxHQUkwQjdCLE9BQU84QixrQkFBUCxDQUEwQjNCLGFBQTFCLEVBQXlDLFVBQXpDLENBSjFCOzs7QUFNTkgsV0FBTytCLGFBQVAsQ0FBcUJSLEtBQXJCOztBQUVBdkIsV0FBT2dDLGVBQVAsQ0FBdUJMLE1BQXZCOztBQUVBM0IsV0FBT2lDLDhCQUFQLENBQXNDSix1QkFBdEMsRUFBK0RELG1DQUEvRDs7QUFFQU0sMEJBQXNCQyxNQUF0QjtBQUNELEdBZEQ7O0FBZ0JBWixRQUFNYSxHQUFOLEdBQVksb0JBQVo7O0FBRUEsV0FBU0QsTUFBVCxDQUFnQkUsSUFBaEIsRUFBc0I7QUFDcEIsUUFBSWYsZ0JBQWdCLElBQXBCLEVBQTBCO0FBQ3hCQSxvQkFBY2UsSUFBZDtBQUNEOztBQUVELFFBQU1DLGNBQWNELE9BQU9mLFdBQTNCO0FBQUEsUUFDTWlCLFNBQVNELGNBQWMsSUFEN0I7QUFBQSxRQUVNRSxTQUFTRixjQUFjLElBRjdCO0FBQUEsUUFHTUcsV0FBVzdDLFNBQVM4QyxtQkFBVCxDQUE2QkgsTUFBN0IsRUFBcUNDLE1BQXJDLENBSGpCO0FBQUEsUUFJTUcsU0FBU2hELE9BQU9pRCxZQUFQLENBQW9CSCxRQUFwQixDQUpmOztBQU1BekMsV0FBT21DLE1BQVAsQ0FBY1EsTUFBZCxFQUFzQkYsUUFBdEIsRUFBZ0MvQixRQUFoQyxFQUEwQ0UsV0FBMUMsRUFBdURULGFBQXZEOztBQUVBSCxXQUFPNkMsWUFBUCxDQUFvQjVCLEtBQXBCOztBQUVBaUIsMEJBQXNCQyxNQUF0QjtBQUNEO0FBQ0YsQ0FyRUQ7O0FBdUVBVyxPQUFPQyxPQUFQLEdBQWlCaEQsWUFBakI7O0FBRUEsU0FBU2UsaUNBQVQsQ0FBMkNkLE1BQTNDLEVBQW1ERyxhQUFuRCxFQUFrRTtBQUNoRSxNQUFNNkMscUJBQXFCLENBQ25CLENBQUMsR0FEa0IsRUFDYixDQUFDLEdBRFksRUFDUCxDQUFDLEdBRE0sRUFFbkIsQ0FBQyxHQUZrQixFQUViLENBQUMsR0FGWSxFQUVQLENBQUMsR0FGTSxFQUduQixDQUFDLEdBSGtCLEVBR2IsQ0FBQyxHQUhZLEVBR1AsQ0FBQyxHQUhNLEVBSW5CLENBQUMsR0FKa0IsRUFJYixDQUFDLEdBSlksRUFJUCxDQUFDLEdBSk0sRUFNbkIsQ0FBQyxHQU5rQixFQU1iLENBQUMsR0FOWSxFQU1QLENBQUMsR0FOTSxFQU9uQixDQUFDLEdBUGtCLEVBT2IsQ0FBQyxHQVBZLEVBT1AsQ0FBQyxHQVBNLEVBUW5CLENBQUMsR0FSa0IsRUFRYixDQUFDLEdBUlksRUFRUCxDQUFDLEdBUk0sRUFTbkIsQ0FBQyxHQVRrQixFQVNiLENBQUMsR0FUWSxFQVNQLENBQUMsR0FUTSxFQVduQixDQUFDLEdBWGtCLEVBV2IsQ0FBQyxHQVhZLEVBV1AsQ0FBQyxHQVhNLEVBWW5CLENBQUMsR0Faa0IsRUFZYixDQUFDLEdBWlksRUFZUCxDQUFDLEdBWk0sRUFhbkIsQ0FBQyxHQWJrQixFQWFiLENBQUMsR0FiWSxFQWFQLENBQUMsR0FiTSxFQWNuQixDQUFDLEdBZGtCLEVBY2IsQ0FBQyxHQWRZLEVBY1AsQ0FBQyxHQWRNLEVBZ0JuQixDQUFDLEdBaEJrQixFQWdCYixDQUFDLEdBaEJZLEVBZ0JQLENBQUMsR0FoQk0sRUFpQm5CLENBQUMsR0FqQmtCLEVBaUJiLENBQUMsR0FqQlksRUFpQlAsQ0FBQyxHQWpCTSxFQWtCbkIsQ0FBQyxHQWxCa0IsRUFrQmIsQ0FBQyxHQWxCWSxFQWtCUCxDQUFDLEdBbEJNLEVBbUJuQixDQUFDLEdBbkJrQixFQW1CYixDQUFDLEdBbkJZLEVBbUJQLENBQUMsR0FuQk0sRUFxQm5CLENBQUMsR0FyQmtCLEVBcUJiLENBQUMsR0FyQlksRUFxQlAsQ0FBQyxHQXJCTSxFQXNCbkIsQ0FBQyxHQXRCa0IsRUFzQmIsQ0FBQyxHQXRCWSxFQXNCUCxDQUFDLEdBdEJNLEVBdUJuQixDQUFDLEdBdkJrQixFQXVCYixDQUFDLEdBdkJZLEVBdUJQLENBQUMsR0F2Qk0sRUF3Qm5CLENBQUMsR0F4QmtCLEVBd0JiLENBQUMsR0F4QlksRUF3QlAsQ0FBQyxHQXhCTSxFQTBCbkIsQ0FBQyxHQTFCa0IsRUEwQmIsQ0FBQyxHQTFCWSxFQTBCUCxDQUFDLEdBMUJNLEVBMkJuQixDQUFDLEdBM0JrQixFQTJCYixDQUFDLEdBM0JZLEVBMkJQLENBQUMsR0EzQk0sRUE0Qm5CLENBQUMsR0E1QmtCLEVBNEJiLENBQUMsR0E1QlksRUE0QlAsQ0FBQyxHQTVCTSxFQTZCbkIsQ0FBQyxHQTdCa0IsRUE2QmIsQ0FBQyxHQTdCWSxFQTZCUCxDQUFDLEdBN0JNLENBQTNCO0FBQUEsTUErQk1DLHVCQUF1QmpELE9BQU9rRCxZQUFQLENBQW9CRixrQkFBcEIsQ0EvQjdCO0FBQUEsTUFnQ01HLGtDQUFrQ25ELE9BQU9vRCxvQkFBUCxDQUE0QmpELGFBQTVCLEVBQTJDLGlCQUEzQyxDQWhDeEM7QUFBQSxNQWlDTWtELDJCQUEyQixDQWpDakM7O0FBbUNBckQsU0FBT3NELFVBQVAsQ0FBa0JMLG9CQUFsQixFQUF3Q0UsK0JBQXhDLEVBQXlFRSx3QkFBekU7O0FBRUEsTUFBTUUsMkJBQTJCUCxtQkFBbUJRLE1BQXBEO0FBQUEsTUFDTXZDLFFBQVFzQywyQkFBMkJGLHdCQUR6Qzs7QUFHQSxTQUFPcEMsS0FBUDtBQUNEOztBQUVELFNBQVN3QywrQkFBVCxDQUF5Q3pELE1BQXpDLEVBQWlERyxhQUFqRCxFQUFnRTtBQUM5RCxNQUFNdUQsbUJBQW1CLENBQ2pCLEdBRGlCLEVBQ1gsR0FEVyxFQUNMLEdBREssRUFDQyxHQURELEVBRWpCLEdBRmlCLEVBRVgsR0FGVyxFQUVMLEdBRkssRUFFQyxHQUZELEVBR2pCLEdBSGlCLEVBR1gsR0FIVyxFQUdMLEdBSEssRUFHQyxHQUhELEVBSWpCLEdBSmlCLEVBSVgsR0FKVyxFQUlMLEdBSkssRUFJQyxHQUpELEVBTWpCLEdBTmlCLEVBTVgsR0FOVyxFQU1MLEdBTkssRUFNQyxHQU5ELEVBT2pCLEdBUGlCLEVBT1gsR0FQVyxFQU9MLEdBUEssRUFPQyxHQVBELEVBUWpCLEdBUmlCLEVBUVgsR0FSVyxFQVFMLEdBUkssRUFRQyxHQVJELEVBU2pCLEdBVGlCLEVBU1gsR0FUVyxFQVNMLEdBVEssRUFTQyxHQVRELEVBV2pCLEdBWGlCLEVBV1gsR0FYVyxFQVdMLEdBWEssRUFXQyxHQVhELEVBWWpCLEdBWmlCLEVBWVgsR0FaVyxFQVlMLEdBWkssRUFZQyxHQVpELEVBYWpCLEdBYmlCLEVBYVgsR0FiVyxFQWFMLEdBYkssRUFhQyxHQWJELEVBY2pCLEdBZGlCLEVBY1gsR0FkVyxFQWNMLEdBZEssRUFjQyxHQWRELEVBZ0JqQixHQWhCaUIsRUFnQlgsR0FoQlcsRUFnQkwsR0FoQkssRUFnQkMsR0FoQkQsRUFpQmpCLEdBakJpQixFQWlCWCxHQWpCVyxFQWlCTCxHQWpCSyxFQWlCQyxHQWpCRCxFQWtCakIsR0FsQmlCLEVBa0JYLEdBbEJXLEVBa0JMLEdBbEJLLEVBa0JDLEdBbEJELEVBbUJqQixHQW5CaUIsRUFtQlgsR0FuQlcsRUFtQkwsR0FuQkssRUFtQkMsR0FuQkQsRUFxQmpCLEdBckJpQixFQXFCWCxHQXJCVyxFQXFCTCxHQXJCSyxFQXFCQyxHQXJCRCxFQXNCakIsR0F0QmlCLEVBc0JYLEdBdEJXLEVBc0JMLEdBdEJLLEVBc0JDLEdBdEJELEVBdUJqQixHQXZCaUIsRUF1QlgsR0F2QlcsRUF1QkwsR0F2QkssRUF1QkMsR0F2QkQsRUF3QmpCLEdBeEJpQixFQXdCWCxHQXhCVyxFQXdCTCxHQXhCSyxFQXdCQyxHQXhCRCxFQTBCakIsR0ExQmlCLEVBMEJYLEdBMUJXLEVBMEJMLEdBMUJLLEVBMEJDLEdBMUJELEVBMkJqQixHQTNCaUIsRUEyQlgsR0EzQlcsRUEyQkwsR0EzQkssRUEyQkMsR0EzQkQsRUE0QmpCLEdBNUJpQixFQTRCWCxHQTVCVyxFQTRCTCxHQTVCSyxFQTRCQyxHQTVCRCxFQTZCakIsR0E3QmlCLEVBNkJYLEdBN0JXLEVBNkJMLEdBN0JLLEVBNkJDLEdBN0JELENBQXpCO0FBQUEsTUErQk1DLHFCQUFxQjNELE9BQU9rRCxZQUFQLENBQW9CUSxnQkFBcEIsQ0EvQjNCO0FBQUEsTUFnQ01FLGdDQUFnQzVELE9BQU9vRCxvQkFBUCxDQUE0QmpELGFBQTVCLEVBQTJDLGVBQTNDLENBaEN0QztBQUFBLE1BaUNNMEQseUJBQXlCLENBakMvQjs7QUFtQ0E3RCxTQUFPc0QsVUFBUCxDQUFrQkssa0JBQWxCLEVBQXNDQyw2QkFBdEMsRUFBcUVDLHNCQUFyRTtBQUNEOztBQUVELFNBQVM5QyxvQ0FBVCxDQUE4Q2YsTUFBOUMsRUFBc0RHLGFBQXRELEVBQXFFO0FBQ25FLE1BQU0yRCx3QkFBd0IsQ0FDdEIsR0FEc0IsRUFDaEIsR0FEZ0IsRUFFdEIsR0FGc0IsRUFFaEIsR0FGZ0IsRUFHdEIsR0FIc0IsRUFHaEIsR0FIZ0IsRUFJdEIsR0FKc0IsRUFJaEIsR0FKZ0IsRUFNdEIsR0FOc0IsRUFNaEIsR0FOZ0IsRUFPdEIsR0FQc0IsRUFPaEIsR0FQZ0IsRUFRdEIsR0FSc0IsRUFRaEIsR0FSZ0IsRUFTdEIsR0FUc0IsRUFTaEIsR0FUZ0IsRUFXdEIsR0FYc0IsRUFXaEIsR0FYZ0IsRUFZdEIsR0Fac0IsRUFZaEIsR0FaZ0IsRUFhdEIsR0Fic0IsRUFhaEIsR0FiZ0IsRUFjdEIsR0Fkc0IsRUFjaEIsR0FkZ0IsRUFnQnRCLEdBaEJzQixFQWdCaEIsR0FoQmdCLEVBaUJ0QixHQWpCc0IsRUFpQmhCLEdBakJnQixFQWtCdEIsR0FsQnNCLEVBa0JoQixHQWxCZ0IsRUFtQnRCLEdBbkJzQixFQW1CaEIsR0FuQmdCLEVBcUJ0QixHQXJCc0IsRUFxQmhCLEdBckJnQixFQXNCdEIsR0F0QnNCLEVBc0JoQixHQXRCZ0IsRUF1QnRCLEdBdkJzQixFQXVCaEIsR0F2QmdCLEVBd0J0QixHQXhCc0IsRUF3QmhCLEdBeEJnQixFQTBCdEIsR0ExQnNCLEVBMEJoQixHQTFCZ0IsRUEyQnRCLEdBM0JzQixFQTJCaEIsR0EzQmdCLEVBNEJ0QixHQTVCc0IsRUE0QmhCLEdBNUJnQixFQTZCdEIsR0E3QnNCLEVBNkJoQixHQTdCZ0IsQ0FBOUI7QUFBQSxNQStCTUMsMEJBQTBCL0QsT0FBT2tELFlBQVAsQ0FBb0JZLHFCQUFwQixDQS9CaEM7QUFBQSxNQWdDTUUscUNBQXFDaEUsT0FBT29ELG9CQUFQLENBQTRCakQsYUFBNUIsRUFBMkMsb0JBQTNDLENBaEMzQztBQUFBLE1BaUNNOEQsOEJBQThCLENBakNwQzs7QUFtQ0FqRSxTQUFPc0QsVUFBUCxDQUFrQlMsdUJBQWxCLEVBQTJDQyxrQ0FBM0MsRUFBK0VDLDJCQUEvRTtBQUNEOztBQUVELFNBQVNqRCwrQkFBVCxDQUF5Q2hCLE1BQXpDLEVBQWlERyxhQUFqRCxFQUFnRTtBQUM5RCxNQUFNK0QsbUJBQW1CLENBQ2hCLEdBRGdCLEVBQ1YsR0FEVSxFQUNMLENBQUMsR0FESSxFQUVoQixHQUZnQixFQUVWLEdBRlUsRUFFTCxDQUFDLEdBRkksRUFHaEIsR0FIZ0IsRUFHVixHQUhVLEVBR0wsQ0FBQyxHQUhJLEVBSWhCLEdBSmdCLEVBSVYsR0FKVSxFQUlMLENBQUMsR0FKSSxFQU1oQixHQU5nQixFQU1WLEdBTlUsRUFNTCxDQUFDLEdBTkksRUFPaEIsR0FQZ0IsRUFPVixHQVBVLEVBT0wsQ0FBQyxHQVBJLEVBUWhCLEdBUmdCLEVBUVYsR0FSVSxFQVFMLENBQUMsR0FSSSxFQVNoQixHQVRnQixFQVNWLEdBVFUsRUFTTCxDQUFDLEdBVEksRUFXaEIsR0FYZ0IsRUFXWCxDQUFDLEdBWFUsRUFXSixHQVhJLEVBWWhCLEdBWmdCLEVBWVgsQ0FBQyxHQVpVLEVBWUosR0FaSSxFQWFoQixHQWJnQixFQWFYLENBQUMsR0FiVSxFQWFKLEdBYkksRUFjaEIsR0FkZ0IsRUFjWCxDQUFDLEdBZFUsRUFjSixHQWRJLEVBZ0JoQixHQWhCZ0IsRUFnQlgsQ0FBQyxHQWhCVSxFQWdCSixHQWhCSSxFQWlCaEIsR0FqQmdCLEVBaUJYLENBQUMsR0FqQlUsRUFpQkosR0FqQkksRUFrQmhCLEdBbEJnQixFQWtCWCxDQUFDLEdBbEJVLEVBa0JKLEdBbEJJLEVBbUJoQixHQW5CZ0IsRUFtQlgsQ0FBQyxHQW5CVSxFQW1CSixHQW5CSSxFQXFCakIsQ0FBQyxHQXJCZ0IsRUFxQlYsR0FyQlUsRUFxQkosR0FyQkksRUFzQmpCLENBQUMsR0F0QmdCLEVBc0JWLEdBdEJVLEVBc0JKLEdBdEJJLEVBdUJqQixDQUFDLEdBdkJnQixFQXVCVixHQXZCVSxFQXVCSixHQXZCSSxFQXdCakIsQ0FBQyxHQXhCZ0IsRUF3QlYsR0F4QlUsRUF3QkosR0F4QkksRUEwQmpCLENBQUMsR0ExQmdCLEVBMEJWLEdBMUJVLEVBMEJKLEdBMUJJLEVBMkJqQixDQUFDLEdBM0JnQixFQTJCVixHQTNCVSxFQTJCSixHQTNCSSxFQTRCakIsQ0FBQyxHQTVCZ0IsRUE0QlYsR0E1QlUsRUE0QkosR0E1QkksRUE2QmpCLENBQUMsR0E3QmdCLEVBNkJWLEdBN0JVLEVBNkJKLEdBN0JJLENBQXpCO0FBQUEsTUErQk1DLHFCQUFxQm5FLE9BQU9rRCxZQUFQLENBQW9CZ0IsZ0JBQXBCLENBL0IzQjtBQUFBLE1BZ0NNRSxnQ0FBZ0NwRSxPQUFPb0Qsb0JBQVAsQ0FBNEJqRCxhQUE1QixFQUEyQyxlQUEzQyxDQWhDdEM7QUFBQSxNQWlDTWtFLHlCQUF5QixDQWpDL0I7O0FBbUNBckUsU0FBT3NELFVBQVAsQ0FBa0JhLGtCQUFsQixFQUFzQ0MsNkJBQXRDLEVBQXFFQyxzQkFBckU7QUFDRDs7QUFFRCxTQUFTbkQsOEJBQVQsQ0FBd0NsQixNQUF4QyxFQUFnRDtBQUM5QyxNQUFNc0Usa0JBQWtCLENBQ2YsQ0FEZSxFQUNYLENBRFcsRUFDUCxDQURPLEVBRWYsQ0FGZSxFQUVYLENBRlcsRUFFUCxDQUZPLEVBSWYsQ0FKZSxFQUlYLENBSlcsRUFJUCxDQUpPLEVBS2YsQ0FMZSxFQUtYLENBTFcsRUFLUCxDQUxPLEVBT2YsQ0FQZSxFQU9YLENBUFcsRUFPUixFQVBRLEVBUWYsQ0FSZSxFQVFaLEVBUlksRUFRUixFQVJRLEVBVWhCLEVBVmdCLEVBVVosRUFWWSxFQVVSLEVBVlEsRUFXaEIsRUFYZ0IsRUFXWixFQVhZLEVBV1IsRUFYUSxFQWFoQixFQWJnQixFQWFaLEVBYlksRUFhUixFQWJRLEVBY2hCLEVBZGdCLEVBY1osRUFkWSxFQWNSLEVBZFEsRUFnQmhCLEVBaEJnQixFQWdCWixFQWhCWSxFQWdCUixFQWhCUSxFQWlCaEIsRUFqQmdCLEVBaUJaLEVBakJZLEVBaUJSLEVBakJRLENBQXhCO0FBQUEsTUFtQk1DLDJCQUEyQnZFLE9BQU93RSxtQkFBUCxDQUEyQkYsZUFBM0IsQ0FuQmpDO0FBQUEsTUFvQk1HLHdCQUF3QkgsZ0JBQWdCZCxNQXBCOUM7QUFBQSxNQXFCTXZDLFFBQVF3RCxxQkFyQmQsQ0FEOEMsQ0FzQlI7O0FBRXRDekUsU0FBTzBFLGlCQUFQLENBQXlCSCx3QkFBekI7O0FBRUEsU0FBT3RELEtBQVA7QUFDRCIsImZpbGUiOiJpbnRlcm1lZGlhdGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IENhbnZhcyA9IHJlcXVpcmUoJy4uL2NhbnZhcycpLFxuICAgICAgU2hhZGVyID0gcmVxdWlyZSgnLi4vc2hhZGVyJyksXG4gICAgICBOb3JtYWwgPSByZXF1aXJlKCcuLi9ub3JtYWwnKSxcbiAgICAgIFJvdGF0aW9uID0gcmVxdWlyZSgnLi4vcm90YXRpb24nKSxcbiAgICAgIFBvc2l0aW9uID0gcmVxdWlyZSgnLi4vcG9zaXRpb24nKSxcbiAgICAgIFBlcnNwZWN0aXZlID0gcmVxdWlyZSgnLi4vcGVyc3BlY3RpdmUnKTtcblxuY29uc3QgaW50ZXJtZWRpYXRlID0gKCkgPT4ge1xuICBjb25zdCBjYW52YXMgPSBuZXcgQ2FudmFzKCksXG4gICAgICAgIGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgpO1xuXG4gIGlmICghY29udGV4dCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHNoYWRlclByb2dyYW0gPSBTaGFkZXIuY3JlYXRlU2hhZGVyUHJvZ3JhbShjb250ZXh0KSxcbiAgICAgICAgY2xpZW50V2lkdGggPSBjYW52YXMuZ2V0Q2xpZW50V2lkdGgoKSxcbiAgICAgICAgY2xpZW50SGVpZ2h0ID0gY2FudmFzLmdldENsaWVudEhlaWdodCgpLFxuICAgICAgICB6Q29vcmRpbmF0ZSA9IC01LCAvLy9cbiAgICAgICAgcG9zaXRpb24gPSBQb3NpdGlvbi5mcm9tWkNvb3JkaW5hdGUoekNvb3JkaW5hdGUpLFxuICAgICAgICBwZXJzcGVjdGl2ZSA9IFBlcnNwZWN0aXZlLmZyb21DbGllbnRXaWR0aEFuZENsaWVudEhlaWdodChjbGllbnRXaWR0aCwgY2xpZW50SGVpZ2h0KTtcblxuICBjcmVhdGVBbmRCaW5kVmVydGV4UG9zaXRpb25CdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKTtcblxuICAvLyBjcmVhdGVBbmRCaW5kVmVydGV4Q29sb3VyQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSk7XG5cbiAgY3JlYXRlQW5kQmluZFRleHR1cmVDb29yZGluYXRlQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSk7XG4gIFxuICBjcmVhdGVBbmRCaW5kVmVydGV4Tm9ybWFsQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSk7XG5cbiAgY29uc3QgY291bnQgPSBjcmVhdGVWZXJ0ZXhJbmRleEVsZW1lbnRCdWZmZXIoY2FudmFzKTtcblxuICBjYW52YXMudXNlUHJvZ3JhbShzaGFkZXJQcm9ncmFtKTtcblxuICBjYW52YXMuZW5hYmxlRGVwdGhUZXN0aW5nKCk7XG4gIGNhbnZhcy5lbmFibGVEZXB0aEZ1bmN0aW9uKCk7XG5cbiAgbGV0IGluaXRpYWxUaW1lID0gbnVsbDtcblxuICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuXG4gIGltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgpLFxuICAgICAgICAgIHsgVEVYVFVSRTAgfSA9IGNvbnRleHQsXG4gICAgICAgICAgdGFyZ2V0ID0gVEVYVFVSRTAsXG4gICAgICAgICAgdVNhbXBsZXJVbmlmb3JtTG9jYXRpb25JbnRlZ2VyVmFsdWUgPSAwLFxuICAgICAgICAgIHVTYW1wbGVyVW5pZm9ybUxvY2F0aW9uID0gY2FudmFzLmdldFVuaWZvcm1Mb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAndVNhbXBsZXInKTtcblxuICAgIGNhbnZhcy5jcmVhdGVUZXh0dXJlKGltYWdlKTtcblxuICAgIGNhbnZhcy5hY3RpdmF0ZVRleHR1cmUodGFyZ2V0KTtcblxuICAgIGNhbnZhcy5zZXRVbmlmb3JtTG9jYXRpb25JbnRlZ2VyVmFsdWUodVNhbXBsZXJVbmlmb3JtTG9jYXRpb24sIHVTYW1wbGVyVW5pZm9ybUxvY2F0aW9uSW50ZWdlclZhbHVlKTtcblxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpO1xuICB9O1xuXG4gIGltYWdlLnNyYyA9ICd0ZXh0dXJlL2JyaWNrcy5qcGcnO1xuXG4gIGZ1bmN0aW9uIHJlbmRlcih0aW1lKSB7XG4gICAgaWYgKGluaXRpYWxUaW1lID09PSBudWxsKSB7XG4gICAgICBpbml0aWFsVGltZSA9IHRpbWU7XG4gICAgfVxuXG4gICAgY29uc3QgZWxhcHNlZFRpbWUgPSB0aW1lIC0gaW5pdGlhbFRpbWUsXG4gICAgICAgICAgeEFuZ2xlID0gZWxhcHNlZFRpbWUgLyAxMDAwLFxuICAgICAgICAgIHlBbmdsZSA9IGVsYXBzZWRUaW1lIC8gMTAwMCxcbiAgICAgICAgICByb3RhdGlvbiA9IFJvdGF0aW9uLmZyb21YQW5nbGVBbmRZQW5nbGUoeEFuZ2xlLCB5QW5nbGUpLFxuICAgICAgICAgIG5vcm1hbCA9IE5vcm1hbC5mcm9tUm90YXRpb24ocm90YXRpb24pO1xuXG4gICAgY2FudmFzLnJlbmRlcihub3JtYWwsIHJvdGF0aW9uLCBwb3NpdGlvbiwgcGVyc3BlY3RpdmUsIHNoYWRlclByb2dyYW0pO1xuXG4gICAgY2FudmFzLmRyYXdFbGVtZW50cyhjb3VudCk7XG5cbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVuZGVyKTtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBpbnRlcm1lZGlhdGU7XG5cbmZ1bmN0aW9uIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhQb3NpdGlvbkJ1ZmZlcihjYW52YXMsIHNoYWRlclByb2dyYW0pIHtcbiAgY29uc3QgdmVydGV4UG9zaXRpb25EYXRhID0gW1xuICAgICAgICAgIC0xLjAsIC0xLjAsICsxLjAsXG4gICAgICAgICAgKzEuMCwgLTEuMCwgKzEuMCxcbiAgICAgICAgICArMS4wLCArMS4wLCArMS4wLFxuICAgICAgICAgIC0xLjAsICsxLjAsICsxLjAsXG5cbiAgICAgICAgICAtMS4wLCAtMS4wLCAtMS4wLFxuICAgICAgICAgIC0xLjAsICsxLjAsIC0xLjAsXG4gICAgICAgICAgKzEuMCwgKzEuMCwgLTEuMCxcbiAgICAgICAgICArMS4wLCAtMS4wLCAtMS4wLFxuXG4gICAgICAgICAgLTEuMCwgKzEuMCwgLTEuMCxcbiAgICAgICAgICAtMS4wLCArMS4wLCArMS4wLFxuICAgICAgICAgICsxLjAsICsxLjAsICsxLjAsXG4gICAgICAgICAgKzEuMCwgKzEuMCwgLTEuMCxcblxuICAgICAgICAgIC0xLjAsIC0xLjAsIC0xLjAsXG4gICAgICAgICAgKzEuMCwgLTEuMCwgLTEuMCxcbiAgICAgICAgICArMS4wLCAtMS4wLCArMS4wLFxuICAgICAgICAgIC0xLjAsIC0xLjAsICsxLjAsXG5cbiAgICAgICAgICArMS4wLCAtMS4wLCAtMS4wLFxuICAgICAgICAgICsxLjAsICsxLjAsIC0xLjAsXG4gICAgICAgICAgKzEuMCwgKzEuMCwgKzEuMCxcbiAgICAgICAgICArMS4wLCAtMS4wLCArMS4wLFxuXG4gICAgICAgICAgLTEuMCwgLTEuMCwgLTEuMCxcbiAgICAgICAgICAtMS4wLCAtMS4wLCArMS4wLFxuICAgICAgICAgIC0xLjAsICsxLjAsICsxLjAsXG4gICAgICAgICAgLTEuMCwgKzEuMCwgLTEuMFxuICAgICAgICBdLFxuICAgICAgICB2ZXJ0ZXhQb3NpdGlvbkJ1ZmZlciA9IGNhbnZhcy5jcmVhdGVCdWZmZXIodmVydGV4UG9zaXRpb25EYXRhKSxcbiAgICAgICAgdmVydGV4UG9zaXRpb25BdHRyaWJ1dGVMb2NhdGlvbiA9IGNhbnZhcy5nZXRBdHRyaWJ1dGVMb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAnYVZlcnRleFBvc2l0aW9uJyksXG4gICAgICAgIHZlcnRleFBvc2l0aW9uQ29tcG9uZW50cyA9IDM7XG5cbiAgY2FudmFzLmJpbmRCdWZmZXIodmVydGV4UG9zaXRpb25CdWZmZXIsIHZlcnRleFBvc2l0aW9uQXR0cmlidXRlTG9jYXRpb24sIHZlcnRleFBvc2l0aW9uQ29tcG9uZW50cyk7XG5cbiAgY29uc3QgdmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoID0gdmVydGV4UG9zaXRpb25EYXRhLmxlbmd0aCxcbiAgICAgICAgY291bnQgPSB2ZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGggLyB2ZXJ0ZXhQb3NpdGlvbkNvbXBvbmVudHM7XG5cbiAgcmV0dXJuIGNvdW50O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVBbmRCaW5kVmVydGV4Q29sb3VyQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSkge1xuICBjb25zdCB2ZXJ0ZXhDb2xvdXJEYXRhID0gW1xuICAgICAgICAgIDEuMCwgIDAuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAwLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDAuMCwgIDAuMCwgIDEuMCxcblxuICAgICAgICAgIDAuMCwgIDEuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCwgIDEuMCwgIDEuMCxcblxuICAgICAgICAgIDAuMCwgIDEuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCwgIDAuMCwgIDEuMCxcblxuICAgICAgICAgIDEuMCwgIDAuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAwLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDAuMCwgIDEuMCwgIDEuMCxcblxuICAgICAgICAgIDAuMCwgIDAuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAwLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMC4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDAuMCwgIDEuMCwgIDEuMCxcblxuICAgICAgICAgIDEuMCwgIDEuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAxLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMS4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDEuMCwgIDAuMCwgIDEuMFxuICAgICAgICBdLFxuICAgICAgICB2ZXJ0ZXhDb2xvdXJCdWZmZXIgPSBjYW52YXMuY3JlYXRlQnVmZmVyKHZlcnRleENvbG91ckRhdGEpLFxuICAgICAgICB2ZXJ0ZXhDb2xvdXJBdHRyaWJ1dGVMb2NhdGlvbiA9IGNhbnZhcy5nZXRBdHRyaWJ1dGVMb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAnYVZlcnRleENvbG91cicpLFxuICAgICAgICB2ZXJ0ZXhDb2xvdXJDb21wb25lbnRzID0gNDtcblxuICBjYW52YXMuYmluZEJ1ZmZlcih2ZXJ0ZXhDb2xvdXJCdWZmZXIsIHZlcnRleENvbG91ckF0dHJpYnV0ZUxvY2F0aW9uLCB2ZXJ0ZXhDb2xvdXJDb21wb25lbnRzKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQW5kQmluZFRleHR1cmVDb29yZGluYXRlQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSkge1xuICBjb25zdCB0ZXh0dXJlQ29vcmRpbmF0ZURhdGEgPSBbXG4gICAgICAgICAgMC4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wXG4gICAgICAgIF0sXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlQnVmZmVyID0gY2FudmFzLmNyZWF0ZUJ1ZmZlcih0ZXh0dXJlQ29vcmRpbmF0ZURhdGEpLFxuICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZUF0dHJpYnV0ZUxvY2F0aW9uID0gY2FudmFzLmdldEF0dHJpYnV0ZUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICdhVGV4dHVyZUNvb3JkaW5hdGUnKSxcbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVDb21wb25lbnRzID0gMjtcblxuICBjYW52YXMuYmluZEJ1ZmZlcih0ZXh0dXJlQ29vcmRpbmF0ZUJ1ZmZlciwgdGV4dHVyZUNvb3JkaW5hdGVBdHRyaWJ1dGVMb2NhdGlvbiwgdGV4dHVyZUNvb3JkaW5hdGVDb21wb25lbnRzKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQW5kQmluZFZlcnRleE5vcm1hbEJ1ZmZlcihjYW52YXMsIHNoYWRlclByb2dyYW0pIHtcbiAgY29uc3QgdmVydGV4Tm9ybWFsRGF0YSA9IFtcbiAgICAgICAgICAgMC4wLCAgMC4wLCArMS4wLFxuICAgICAgICAgICAwLjAsICAwLjAsICsxLjAsXG4gICAgICAgICAgIDAuMCwgIDAuMCwgKzEuMCxcbiAgICAgICAgICAgMC4wLCAgMC4wLCArMS4wLFxuXG4gICAgICAgICAgIDAuMCwgIDAuMCwgLTEuMCxcbiAgICAgICAgICAgMC4wLCAgMC4wLCAtMS4wLFxuICAgICAgICAgICAwLjAsICAwLjAsIC0xLjAsXG4gICAgICAgICAgIDAuMCwgIDAuMCwgLTEuMCxcblxuICAgICAgICAgICAwLjAsICsxLjAsICAwLjAsXG4gICAgICAgICAgIDAuMCwgKzEuMCwgIDAuMCxcbiAgICAgICAgICAgMC4wLCArMS4wLCAgMC4wLFxuICAgICAgICAgICAwLjAsICsxLjAsICAwLjAsXG5cbiAgICAgICAgICAgMC4wLCAtMS4wLCAgMC4wLFxuICAgICAgICAgICAwLjAsIC0xLjAsICAwLjAsXG4gICAgICAgICAgIDAuMCwgLTEuMCwgIDAuMCxcbiAgICAgICAgICAgMC4wLCAtMS4wLCAgMC4wLFxuXG4gICAgICAgICAgKzEuMCwgIDAuMCwgIDAuMCxcbiAgICAgICAgICArMS4wLCAgMC4wLCAgMC4wLFxuICAgICAgICAgICsxLjAsICAwLjAsICAwLjAsXG4gICAgICAgICAgKzEuMCwgIDAuMCwgIDAuMCxcblxuICAgICAgICAgIC0xLjAsICAwLjAsICAwLjAsXG4gICAgICAgICAgLTEuMCwgIDAuMCwgIDAuMCxcbiAgICAgICAgICAtMS4wLCAgMC4wLCAgMC4wLFxuICAgICAgICAgIC0xLjAsICAwLjAsICAwLjBcbiAgICAgICAgXSxcbiAgICAgICAgdmVydGV4Tm9ybWFsQnVmZmVyID0gY2FudmFzLmNyZWF0ZUJ1ZmZlcih2ZXJ0ZXhOb3JtYWxEYXRhKSxcbiAgICAgICAgdmVydGV4Tm9ybWFsQXR0cmlidXRlTG9jYXRpb24gPSBjYW52YXMuZ2V0QXR0cmlidXRlTG9jYXRpb24oc2hhZGVyUHJvZ3JhbSwgJ2FWZXJ0ZXhOb3JtYWwnKSxcbiAgICAgICAgdmVydGV4Tm9ybWFsQ29tcG9uZW50cyA9IDM7XG5cbiAgY2FudmFzLmJpbmRCdWZmZXIodmVydGV4Tm9ybWFsQnVmZmVyLCB2ZXJ0ZXhOb3JtYWxBdHRyaWJ1dGVMb2NhdGlvbiwgdmVydGV4Tm9ybWFsQ29tcG9uZW50cyk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVZlcnRleEluZGV4RWxlbWVudEJ1ZmZlcihjYW52YXMpIHtcbiAgY29uc3QgdmVydGV4SW5kZXhEYXRhID0gW1xuICAgICAgICAgICAwLCAgMSwgIDIsXG4gICAgICAgICAgIDAsICAyLCAgMyxcblxuICAgICAgICAgICA0LCAgNSwgIDYsXG4gICAgICAgICAgIDQsICA2LCAgNyxcblxuICAgICAgICAgICA4LCAgOSwgMTAsXG4gICAgICAgICAgIDgsIDEwLCAxMSxcblxuICAgICAgICAgIDEyLCAxMywgMTQsXG4gICAgICAgICAgMTIsIDE0LCAxNSxcblxuICAgICAgICAgIDE2LCAxNywgMTgsXG4gICAgICAgICAgMTYsIDE4LCAxOSxcblxuICAgICAgICAgIDIwLCAyMSwgMjIsXG4gICAgICAgICAgMjAsIDIyLCAyM1xuICAgICAgICBdLFxuICAgICAgICB2ZXJ0ZXhJbmRleEVsZW1lbnRCdWZmZXIgPSBjYW52YXMuY3JlYXRlRWxlbWVudEJ1ZmZlcih2ZXJ0ZXhJbmRleERhdGEpLFxuICAgICAgICB2ZXJ0ZXhJbmRleERhdGFMZW5ndGggPSB2ZXJ0ZXhJbmRleERhdGEubGVuZ3RoLFxuICAgICAgICBjb3VudCA9IHZlcnRleEluZGV4RGF0YUxlbmd0aDsgIC8vL1xuXG4gIGNhbnZhcy5iaW5kRWxlbWVudEJ1ZmZlcih2ZXJ0ZXhJbmRleEVsZW1lbnRCdWZmZXIpO1xuXG4gIHJldHVybiBjb3VudDtcbn1cbiJdfQ==