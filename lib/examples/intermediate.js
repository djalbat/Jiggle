'use strict';

var Canvas = require('../canvas'),
    Normal = require('../normal'),
    Rotation = require('../rotation'),
    Position = require('../position'),
    Perspective = require('../perspective'),
    ColourShader = require('../shader/colour'),
    TextureShader = require('../shader/texture');

var intermediate = function intermediate() {
  var canvas = new Canvas(),
      context = canvas.getContext();

  if (!context) {
    return;
  }

  var /*textureShader = TextureShader.fromNothing(context),*/
  colourShader = ColourShader.fromNothing(context),
      shader = colourShader,
      ///
  shaderProgram = shader.getProgram(),
      clientWidth = canvas.getClientWidth(),
      clientHeight = canvas.getClientHeight(),
      zCoordinate = -5,
      ///
  position = Position.fromZCoordinate(zCoordinate),
      perspective = Perspective.fromClientWidthAndClientHeight(clientWidth, clientHeight);

  createAndBindVertexPositionBuffer(canvas, shaderProgram);

  createAndBindVertexColourBuffer(canvas, shaderProgram);

  createAndBindTextureCoordinateBuffer(canvas, shaderProgram);

  createAndBindVertexNormalBuffer(canvas, shaderProgram);

  var count = createVertexIndexElementBuffer(canvas);

  canvas.useProgram(shaderProgram);

  canvas.enableDepthTesting();
  canvas.enableDepthFunction();

  var initialTime = null;

  var image = new Image();

  image.onload = function () {
    var context = canvas.getContext(),
        TEXTURE0 = context.TEXTURE0,
        target = TEXTURE0,
        uSamplerUniformLocationIntegerValue = 0,
        uSamplerUniformLocation = canvas.getUniformLocation(shaderProgram, 'uSampler');


    canvas.createTexture(image);

    canvas.activateTexture(target);

    canvas.setUniformLocationIntegerValue(uSamplerUniformLocation, uSamplerUniformLocationIntegerValue);

    requestAnimationFrame(render);
  };

  image.src = 'texture/bricks.jpg';

  function render(time) {
    if (initialTime === null) {
      initialTime = time;
    }

    var elapsedTime = time - initialTime,
        xAngle = elapsedTime / 1000,
        yAngle = elapsedTime / 1000,
        rotation = Rotation.fromXAngleAndYAngle(xAngle, yAngle),
        normal = Normal.fromRotation(rotation);

    canvas.render(normal, rotation, position, perspective, shader);

    canvas.drawElements(count);

    requestAnimationFrame(render);
  }
};

module.exports = intermediate;

function createAndBindVertexPositionBuffer(canvas, shaderProgram) {
  var vertexPositionData = [-1.0, -1.0, +1.0, +1.0, -1.0, +1.0, +1.0, +1.0, +1.0, -1.0, +1.0, +1.0, -1.0, -1.0, -1.0, -1.0, +1.0, -1.0, +1.0, +1.0, -1.0, +1.0, -1.0, -1.0, -1.0, +1.0, -1.0, -1.0, +1.0, +1.0, +1.0, +1.0, +1.0, +1.0, +1.0, -1.0, -1.0, -1.0, -1.0, +1.0, -1.0, -1.0, +1.0, -1.0, +1.0, -1.0, -1.0, +1.0, +1.0, -1.0, -1.0, +1.0, +1.0, -1.0, +1.0, +1.0, +1.0, +1.0, -1.0, +1.0, -1.0, -1.0, -1.0, -1.0, -1.0, +1.0, -1.0, +1.0, +1.0, -1.0, +1.0, -1.0],
      vertexPositionBuffer = canvas.createBuffer(vertexPositionData),
      vertexPositionAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexPosition'),
      vertexPositionComponents = 3;

  canvas.bindBuffer(vertexPositionBuffer, vertexPositionAttributeLocation, vertexPositionComponents);

  var vertexPositionDataLength = vertexPositionData.length,
      count = vertexPositionDataLength / vertexPositionComponents;

  return count;
}

function createAndBindVertexColourBuffer(canvas, shaderProgram) {
  var vertexColourData = [1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0],
      vertexColourBuffer = canvas.createBuffer(vertexColourData),
      vertexColourAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexColour'),
      vertexColourComponents = 4;

  canvas.bindBuffer(vertexColourBuffer, vertexColourAttributeLocation, vertexColourComponents);
}

function createAndBindTextureCoordinateBuffer(canvas, shaderProgram) {
  var textureCoordinateData = [0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0],
      textureCoordinateBuffer = canvas.createBuffer(textureCoordinateData),
      textureCoordinateAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aTextureCoordinate'),
      textureCoordinateComponents = 2;

  canvas.bindBuffer(textureCoordinateBuffer, textureCoordinateAttributeLocation, textureCoordinateComponents);
}

function createAndBindVertexNormalBuffer(canvas, shaderProgram) {
  var vertexNormalData = [0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0],
      vertexNormalBuffer = canvas.createBuffer(vertexNormalData),
      vertexNormalAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexNormal'),
      vertexNormalComponents = 3;

  canvas.bindBuffer(vertexNormalBuffer, vertexNormalAttributeLocation, vertexNormalComponents);
}

function createVertexIndexElementBuffer(canvas) {
  var vertexIndexData = [0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19, 20, 21, 22, 20, 22, 23],
      vertexIndexElementBuffer = canvas.createElementBuffer(vertexIndexData),
      vertexIndexDataLength = vertexIndexData.length,
      count = vertexIndexDataLength; ///

  canvas.bindElementBuffer(vertexIndexElementBuffer);

  return count;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9leGFtcGxlcy9pbnRlcm1lZGlhdGUuanMiXSwibmFtZXMiOlsiQ2FudmFzIiwicmVxdWlyZSIsIk5vcm1hbCIsIlJvdGF0aW9uIiwiUG9zaXRpb24iLCJQZXJzcGVjdGl2ZSIsIkNvbG91clNoYWRlciIsIlRleHR1cmVTaGFkZXIiLCJpbnRlcm1lZGlhdGUiLCJjYW52YXMiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsImNvbG91clNoYWRlciIsImZyb21Ob3RoaW5nIiwic2hhZGVyIiwic2hhZGVyUHJvZ3JhbSIsImdldFByb2dyYW0iLCJjbGllbnRXaWR0aCIsImdldENsaWVudFdpZHRoIiwiY2xpZW50SGVpZ2h0IiwiZ2V0Q2xpZW50SGVpZ2h0IiwiekNvb3JkaW5hdGUiLCJwb3NpdGlvbiIsImZyb21aQ29vcmRpbmF0ZSIsInBlcnNwZWN0aXZlIiwiZnJvbUNsaWVudFdpZHRoQW5kQ2xpZW50SGVpZ2h0IiwiY3JlYXRlQW5kQmluZFZlcnRleFBvc2l0aW9uQnVmZmVyIiwiY3JlYXRlQW5kQmluZFZlcnRleENvbG91ckJ1ZmZlciIsImNyZWF0ZUFuZEJpbmRUZXh0dXJlQ29vcmRpbmF0ZUJ1ZmZlciIsImNyZWF0ZUFuZEJpbmRWZXJ0ZXhOb3JtYWxCdWZmZXIiLCJjb3VudCIsImNyZWF0ZVZlcnRleEluZGV4RWxlbWVudEJ1ZmZlciIsInVzZVByb2dyYW0iLCJlbmFibGVEZXB0aFRlc3RpbmciLCJlbmFibGVEZXB0aEZ1bmN0aW9uIiwiaW5pdGlhbFRpbWUiLCJpbWFnZSIsIkltYWdlIiwib25sb2FkIiwiVEVYVFVSRTAiLCJ0YXJnZXQiLCJ1U2FtcGxlclVuaWZvcm1Mb2NhdGlvbkludGVnZXJWYWx1ZSIsInVTYW1wbGVyVW5pZm9ybUxvY2F0aW9uIiwiZ2V0VW5pZm9ybUxvY2F0aW9uIiwiY3JlYXRlVGV4dHVyZSIsImFjdGl2YXRlVGV4dHVyZSIsInNldFVuaWZvcm1Mb2NhdGlvbkludGVnZXJWYWx1ZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInJlbmRlciIsInNyYyIsInRpbWUiLCJlbGFwc2VkVGltZSIsInhBbmdsZSIsInlBbmdsZSIsInJvdGF0aW9uIiwiZnJvbVhBbmdsZUFuZFlBbmdsZSIsIm5vcm1hbCIsImZyb21Sb3RhdGlvbiIsImRyYXdFbGVtZW50cyIsIm1vZHVsZSIsImV4cG9ydHMiLCJ2ZXJ0ZXhQb3NpdGlvbkRhdGEiLCJ2ZXJ0ZXhQb3NpdGlvbkJ1ZmZlciIsImNyZWF0ZUJ1ZmZlciIsInZlcnRleFBvc2l0aW9uQXR0cmlidXRlTG9jYXRpb24iLCJnZXRBdHRyaWJ1dGVMb2NhdGlvbiIsInZlcnRleFBvc2l0aW9uQ29tcG9uZW50cyIsImJpbmRCdWZmZXIiLCJ2ZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGgiLCJsZW5ndGgiLCJ2ZXJ0ZXhDb2xvdXJEYXRhIiwidmVydGV4Q29sb3VyQnVmZmVyIiwidmVydGV4Q29sb3VyQXR0cmlidXRlTG9jYXRpb24iLCJ2ZXJ0ZXhDb2xvdXJDb21wb25lbnRzIiwidGV4dHVyZUNvb3JkaW5hdGVEYXRhIiwidGV4dHVyZUNvb3JkaW5hdGVCdWZmZXIiLCJ0ZXh0dXJlQ29vcmRpbmF0ZUF0dHJpYnV0ZUxvY2F0aW9uIiwidGV4dHVyZUNvb3JkaW5hdGVDb21wb25lbnRzIiwidmVydGV4Tm9ybWFsRGF0YSIsInZlcnRleE5vcm1hbEJ1ZmZlciIsInZlcnRleE5vcm1hbEF0dHJpYnV0ZUxvY2F0aW9uIiwidmVydGV4Tm9ybWFsQ29tcG9uZW50cyIsInZlcnRleEluZGV4RGF0YSIsInZlcnRleEluZGV4RWxlbWVudEJ1ZmZlciIsImNyZWF0ZUVsZW1lbnRCdWZmZXIiLCJ2ZXJ0ZXhJbmRleERhdGFMZW5ndGgiLCJiaW5kRWxlbWVudEJ1ZmZlciJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsU0FBU0MsUUFBUSxXQUFSLENBQWY7QUFBQSxJQUNNQyxTQUFTRCxRQUFRLFdBQVIsQ0FEZjtBQUFBLElBRU1FLFdBQVdGLFFBQVEsYUFBUixDQUZqQjtBQUFBLElBR01HLFdBQVdI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V2hCLEVBWGdCLEVBV1osRUFYWSxFQVdSLEVBWFEsRUFhaEIsRUFiZ0IsRUFhWixFQWJZLEVBYVIsRUFiUSxFQWNoQixFQWRnQixFQWNaLEVBZFksRUFjUixFQWRRLEVBZ0JoQixFQWhCZ0IsRUFnQlosRUFoQlksRUFnQlIsRUFoQlEsRUFpQmhCLEVBakJnQixFQWlCWixFQWpCWSxFQWlCUixFQWpCUSxDQUF4QjtBQUFBLE1BbUJNQywyQkFBMkIxRSxPQUFPMkUsbUJBQVAsQ0FBMkJGLGVBQTNCLENBbkJqQztBQUFBLE1Bb0JNRyx3QkFBd0JILGdCQUFnQmIsTUFwQjlDO0FBQUEsTUFxQk12QyxRQUFRdUQscUJBckJkLENBRDhDLENBc0JSOztBQUV0QzVFLFNBQU82RSxpQkFBUCxDQUF5Qkgsd0JBQXpCOztBQUVBLFNBQU9yRCxLQUFQO0FBQ0QiLCJmaWxlIjoiaW50ZXJtZWRpYXRlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBDYW52YXMgPSByZXF1aXJlKCcuLi9jYW52YXMnKSxcbiAgICAgIE5vcm1hbCA9IHJlcXVpcmUoJy4uL25vcm1hbCcpLFxuICAgICAgUm90YXRpb24gPSByZXF1aXJlKCcuLi9yb3RhdGlvbicpLFxuICAgICAgUG9zaXRpb24gPSByZXF1aXJlKCcuLi9wb3NpdGlvbicpLFxuICAgICAgUGVyc3BlY3RpdmUgPSByZXF1aXJlKCcuLi9wZXJzcGVjdGl2ZScpLFxuICAgICAgQ29sb3VyU2hhZGVyID0gcmVxdWlyZSgnLi4vc2hhZGVyL2NvbG91cicpLFxuICAgICAgVGV4dHVyZVNoYWRlciA9IHJlcXVpcmUoJy4uL3NoYWRlci90ZXh0dXJlJyk7XG5cbmNvbnN0IGludGVybWVkaWF0ZSA9ICgpID0+IHtcbiAgY29uc3QgY2FudmFzID0gbmV3IENhbnZhcygpLFxuICAgICAgICBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoKTtcblxuICBpZiAoIWNvbnRleHQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCAvKnRleHR1cmVTaGFkZXIgPSBUZXh0dXJlU2hhZGVyLmZyb21Ob3RoaW5nKGNvbnRleHQpLCovXG4gICAgICAgIGNvbG91clNoYWRlciA9IENvbG91clNoYWRlci5mcm9tTm90aGluZyhjb250ZXh0KSxcbiAgICAgICAgc2hhZGVyID0gY29sb3VyU2hhZGVyLCAgLy8vXG4gICAgICAgIHNoYWRlclByb2dyYW0gPSBzaGFkZXIuZ2V0UHJvZ3JhbSgpLFxuICAgICAgICBjbGllbnRXaWR0aCA9IGNhbnZhcy5nZXRDbGllbnRXaWR0aCgpLFxuICAgICAgICBjbGllbnRIZWlnaHQgPSBjYW52YXMuZ2V0Q2xpZW50SGVpZ2h0KCksXG4gICAgICAgIHpDb29yZGluYXRlID0gLTUsIC8vL1xuICAgICAgICBwb3NpdGlvbiA9IFBvc2l0aW9uLmZyb21aQ29vcmRpbmF0ZSh6Q29vcmRpbmF0ZSksXG4gICAgICAgIHBlcnNwZWN0aXZlID0gUGVyc3BlY3RpdmUuZnJvbUNsaWVudFdpZHRoQW5kQ2xpZW50SGVpZ2h0KGNsaWVudFdpZHRoLCBjbGllbnRIZWlnaHQpO1xuXG4gIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhQb3NpdGlvbkJ1ZmZlcihjYW52YXMsIHNoYWRlclByb2dyYW0pO1xuXG4gIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhDb2xvdXJCdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKTtcblxuICBjcmVhdGVBbmRCaW5kVGV4dHVyZUNvb3JkaW5hdGVCdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKTtcbiAgXG4gIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhOb3JtYWxCdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKTtcblxuICBjb25zdCBjb3VudCA9IGNyZWF0ZVZlcnRleEluZGV4RWxlbWVudEJ1ZmZlcihjYW52YXMpO1xuXG4gIGNhbnZhcy51c2VQcm9ncmFtKHNoYWRlclByb2dyYW0pO1xuXG4gIGNhbnZhcy5lbmFibGVEZXB0aFRlc3RpbmcoKTtcbiAgY2FudmFzLmVuYWJsZURlcHRoRnVuY3Rpb24oKTtcblxuICBsZXQgaW5pdGlhbFRpbWUgPSBudWxsO1xuXG4gIGNvbnN0IGltYWdlID0gbmV3IEltYWdlKCk7XG5cbiAgaW1hZ2Uub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCksXG4gICAgICAgICAgeyBURVhUVVJFMCB9ID0gY29udGV4dCxcbiAgICAgICAgICB0YXJnZXQgPSBURVhUVVJFMCxcbiAgICAgICAgICB1U2FtcGxlclVuaWZvcm1Mb2NhdGlvbkludGVnZXJWYWx1ZSA9IDAsXG4gICAgICAgICAgdVNhbXBsZXJVbmlmb3JtTG9jYXRpb24gPSBjYW52YXMuZ2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICd1U2FtcGxlcicpO1xuXG4gICAgY2FudmFzLmNyZWF0ZVRleHR1cmUoaW1hZ2UpO1xuXG4gICAgY2FudmFzLmFjdGl2YXRlVGV4dHVyZSh0YXJnZXQpO1xuXG4gICAgY2FudmFzLnNldFVuaWZvcm1Mb2NhdGlvbkludGVnZXJWYWx1ZSh1U2FtcGxlclVuaWZvcm1Mb2NhdGlvbiwgdVNhbXBsZXJVbmlmb3JtTG9jYXRpb25JbnRlZ2VyVmFsdWUpO1xuXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlbmRlcik7XG4gIH07XG5cbiAgaW1hZ2Uuc3JjID0gJ3RleHR1cmUvYnJpY2tzLmpwZyc7XG5cbiAgZnVuY3Rpb24gcmVuZGVyKHRpbWUpIHtcbiAgICBpZiAoaW5pdGlhbFRpbWUgPT09IG51bGwpIHtcbiAgICAgIGluaXRpYWxUaW1lID0gdGltZTtcbiAgICB9XG5cbiAgICBjb25zdCBlbGFwc2VkVGltZSA9IHRpbWUgLSBpbml0aWFsVGltZSxcbiAgICAgICAgICB4QW5nbGUgPSBlbGFwc2VkVGltZSAvIDEwMDAsXG4gICAgICAgICAgeUFuZ2xlID0gZWxhcHNlZFRpbWUgLyAxMDAwLFxuICAgICAgICAgIHJvdGF0aW9uID0gUm90YXRpb24uZnJvbVhBbmdsZUFuZFlBbmdsZSh4QW5nbGUsIHlBbmdsZSksXG4gICAgICAgICAgbm9ybWFsID0gTm9ybWFsLmZyb21Sb3RhdGlvbihyb3RhdGlvbik7XG5cbiAgICBjYW52YXMucmVuZGVyKG5vcm1hbCwgcm90YXRpb24sIHBvc2l0aW9uLCBwZXJzcGVjdGl2ZSwgc2hhZGVyKTtcblxuICAgIGNhbnZhcy5kcmF3RWxlbWVudHMoY291bnQpO1xuXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlbmRlcik7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gaW50ZXJtZWRpYXRlO1xuXG5mdW5jdGlvbiBjcmVhdGVBbmRCaW5kVmVydGV4UG9zaXRpb25CdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKSB7XG4gIGNvbnN0IHZlcnRleFBvc2l0aW9uRGF0YSA9IFtcbiAgICAgICAgICAtMS4wLCAtMS4wLCArMS4wLFxuICAgICAgICAgICsxLjAsIC0xLjAsICsxLjAsXG4gICAgICAgICAgKzEuMCwgKzEuMCwgKzEuMCxcbiAgICAgICAgICAtMS4wLCArMS4wLCArMS4wLFxuXG4gICAgICAgICAgLTEuMCwgLTEuMCwgLTEuMCxcbiAgICAgICAgICAtMS4wLCArMS4wLCAtMS4wLFxuICAgICAgICAgICsxLjAsICsxLjAsIC0xLjAsXG4gICAgICAgICAgKzEuMCwgLTEuMCwgLTEuMCxcblxuICAgICAgICAgIC0xLjAsICsxLjAsIC0xLjAsXG4gICAgICAgICAgLTEuMCwgKzEuMCwgKzEuMCxcbiAgICAgICAgICArMS4wLCArMS4wLCArMS4wLFxuICAgICAgICAgICsxLjAsICsxLjAsIC0xLjAsXG5cbiAgICAgICAgICAtMS4wLCAtMS4wLCAtMS4wLFxuICAgICAgICAgICsxLjAsIC0xLjAsIC0xLjAsXG4gICAgICAgICAgKzEuMCwgLTEuMCwgKzEuMCxcbiAgICAgICAgICAtMS4wLCAtMS4wLCArMS4wLFxuXG4gICAgICAgICAgKzEuMCwgLTEuMCwgLTEuMCxcbiAgICAgICAgICArMS4wLCArMS4wLCAtMS4wLFxuICAgICAgICAgICsxLjAsICsxLjAsICsxLjAsXG4gICAgICAgICAgKzEuMCwgLTEuMCwgKzEuMCxcblxuICAgICAgICAgIC0xLjAsIC0xLjAsIC0xLjAsXG4gICAgICAgICAgLTEuMCwgLTEuMCwgKzEuMCxcbiAgICAgICAgICAtMS4wLCArMS4wLCArMS4wLFxuICAgICAgICAgIC0xLjAsICsxLjAsIC0xLjBcbiAgICAgICAgXSxcbiAgICAgICAgdmVydGV4UG9zaXRpb25CdWZmZXIgPSBjYW52YXMuY3JlYXRlQnVmZmVyKHZlcnRleFBvc2l0aW9uRGF0YSksXG4gICAgICAgIHZlcnRleFBvc2l0aW9uQXR0cmlidXRlTG9jYXRpb24gPSBjYW52YXMuZ2V0QXR0cmlidXRlTG9jYXRpb24oc2hhZGVyUHJvZ3JhbSwgJ2FWZXJ0ZXhQb3NpdGlvbicpLFxuICAgICAgICB2ZXJ0ZXhQb3NpdGlvbkNvbXBvbmVudHMgPSAzO1xuXG4gIGNhbnZhcy5iaW5kQnVmZmVyKHZlcnRleFBvc2l0aW9uQnVmZmVyLCB2ZXJ0ZXhQb3NpdGlvbkF0dHJpYnV0ZUxvY2F0aW9uLCB2ZXJ0ZXhQb3NpdGlvbkNvbXBvbmVudHMpO1xuXG4gIGNvbnN0IHZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCA9IHZlcnRleFBvc2l0aW9uRGF0YS5sZW5ndGgsXG4gICAgICAgIGNvdW50ID0gdmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoIC8gdmVydGV4UG9zaXRpb25Db21wb25lbnRzO1xuXG4gIHJldHVybiBjb3VudDtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQW5kQmluZFZlcnRleENvbG91ckJ1ZmZlcihjYW52YXMsIHNoYWRlclByb2dyYW0pIHtcbiAgY29uc3QgdmVydGV4Q29sb3VyRGF0YSA9IFtcbiAgICAgICAgICAxLjAsICAwLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDAuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAwLjAsICAwLjAsICAxLjAsXG5cbiAgICAgICAgICAwLjAsICAxLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsICAxLjAsICAxLjAsXG5cbiAgICAgICAgICAwLjAsICAxLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsICAwLjAsICAxLjAsXG5cbiAgICAgICAgICAxLjAsICAwLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDAuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAwLjAsICAxLjAsICAxLjAsXG5cbiAgICAgICAgICAwLjAsICAwLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMC4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDAuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAwLjAsICAxLjAsICAxLjAsXG5cbiAgICAgICAgICAxLjAsICAxLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMS4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDEuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAxLjAsICAwLjAsICAxLjBcbiAgICAgICAgXSxcbiAgICAgICAgdmVydGV4Q29sb3VyQnVmZmVyID0gY2FudmFzLmNyZWF0ZUJ1ZmZlcih2ZXJ0ZXhDb2xvdXJEYXRhKSxcbiAgICAgICAgdmVydGV4Q29sb3VyQXR0cmlidXRlTG9jYXRpb24gPSBjYW52YXMuZ2V0QXR0cmlidXRlTG9jYXRpb24oc2hhZGVyUHJvZ3JhbSwgJ2FWZXJ0ZXhDb2xvdXInKSxcbiAgICAgICAgdmVydGV4Q29sb3VyQ29tcG9uZW50cyA9IDQ7XG5cbiAgY2FudmFzLmJpbmRCdWZmZXIodmVydGV4Q29sb3VyQnVmZmVyLCB2ZXJ0ZXhDb2xvdXJBdHRyaWJ1dGVMb2NhdGlvbiwgdmVydGV4Q29sb3VyQ29tcG9uZW50cyk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUFuZEJpbmRUZXh0dXJlQ29vcmRpbmF0ZUJ1ZmZlcihjYW52YXMsIHNoYWRlclByb2dyYW0pIHtcbiAgY29uc3QgdGV4dHVyZUNvb3JkaW5hdGVEYXRhID0gW1xuICAgICAgICAgIDAuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCxcblxuICAgICAgICAgIDAuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCxcblxuICAgICAgICAgIDAuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCxcblxuICAgICAgICAgIDAuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCxcblxuICAgICAgICAgIDAuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCxcblxuICAgICAgICAgIDAuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMFxuICAgICAgICBdLFxuICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZUJ1ZmZlciA9IGNhbnZhcy5jcmVhdGVCdWZmZXIodGV4dHVyZUNvb3JkaW5hdGVEYXRhKSxcbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVBdHRyaWJ1dGVMb2NhdGlvbiA9IGNhbnZhcy5nZXRBdHRyaWJ1dGVMb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAnYVRleHR1cmVDb29yZGluYXRlJyksXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlQ29tcG9uZW50cyA9IDI7XG5cbiAgY2FudmFzLmJpbmRCdWZmZXIodGV4dHVyZUNvb3JkaW5hdGVCdWZmZXIsIHRleHR1cmVDb29yZGluYXRlQXR0cmlidXRlTG9jYXRpb24sIHRleHR1cmVDb29yZGluYXRlQ29tcG9uZW50cyk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhOb3JtYWxCdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKSB7XG4gIGNvbnN0IHZlcnRleE5vcm1hbERhdGEgPSBbXG4gICAgICAgICAgIDAuMCwgIDAuMCwgKzEuMCxcbiAgICAgICAgICAgMC4wLCAgMC4wLCArMS4wLFxuICAgICAgICAgICAwLjAsICAwLjAsICsxLjAsXG4gICAgICAgICAgIDAuMCwgIDAuMCwgKzEuMCxcblxuICAgICAgICAgICAwLjAsICAwLjAsIC0xLjAsXG4gICAgICAgICAgIDAuMCwgIDAuMCwgLTEuMCxcbiAgICAgICAgICAgMC4wLCAgMC4wLCAtMS4wLFxuICAgICAgICAgICAwLjAsICAwLjAsIC0xLjAsXG5cbiAgICAgICAgICAgMC4wLCArMS4wLCAgMC4wLFxuICAgICAgICAgICAwLjAsICsxLjAsICAwLjAsXG4gICAgICAgICAgIDAuMCwgKzEuMCwgIDAuMCxcbiAgICAgICAgICAgMC4wLCArMS4wLCAgMC4wLFxuXG4gICAgICAgICAgIDAuMCwgLTEuMCwgIDAuMCxcbiAgICAgICAgICAgMC4wLCAtMS4wLCAgMC4wLFxuICAgICAgICAgICAwLjAsIC0xLjAsICAwLjAsXG4gICAgICAgICAgIDAuMCwgLTEuMCwgIDAuMCxcblxuICAgICAgICAgICsxLjAsICAwLjAsICAwLjAsXG4gICAgICAgICAgKzEuMCwgIDAuMCwgIDAuMCxcbiAgICAgICAgICArMS4wLCAgMC4wLCAgMC4wLFxuICAgICAgICAgICsxLjAsICAwLjAsICAwLjAsXG5cbiAgICAgICAgICAtMS4wLCAgMC4wLCAgMC4wLFxuICAgICAgICAgIC0xLjAsICAwLjAsICAwLjAsXG4gICAgICAgICAgLTEuMCwgIDAuMCwgIDAuMCxcbiAgICAgICAgICAtMS4wLCAgMC4wLCAgMC4wXG4gICAgICAgIF0sXG4gICAgICAgIHZlcnRleE5vcm1hbEJ1ZmZlciA9IGNhbnZhcy5jcmVhdGVCdWZmZXIodmVydGV4Tm9ybWFsRGF0YSksXG4gICAgICAgIHZlcnRleE5vcm1hbEF0dHJpYnV0ZUxvY2F0aW9uID0gY2FudmFzLmdldEF0dHJpYnV0ZUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICdhVmVydGV4Tm9ybWFsJyksXG4gICAgICAgIHZlcnRleE5vcm1hbENvbXBvbmVudHMgPSAzO1xuXG4gIGNhbnZhcy5iaW5kQnVmZmVyKHZlcnRleE5vcm1hbEJ1ZmZlciwgdmVydGV4Tm9ybWFsQXR0cmlidXRlTG9jYXRpb24sIHZlcnRleE5vcm1hbENvbXBvbmVudHMpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVWZXJ0ZXhJbmRleEVsZW1lbnRCdWZmZXIoY2FudmFzKSB7XG4gIGNvbnN0IHZlcnRleEluZGV4RGF0YSA9IFtcbiAgICAgICAgICAgMCwgIDEsICAyLFxuICAgICAgICAgICAwLCAgMiwgIDMsXG5cbiAgICAgICAgICAgNCwgIDUsICA2LFxuICAgICAgICAgICA0LCAgNiwgIDcsXG5cbiAgICAgICAgICAgOCwgIDksIDEwLFxuICAgICAgICAgICA4LCAxMCwgMTEsXG5cbiAgICAgICAgICAxMiwgMTMsIDE0LFxuICAgICAgICAgIDEyLCAxNCwgMTUsXG5cbiAgICAgICAgICAxNiwgMTcsIDE4LFxuICAgICAgICAgIDE2LCAxOCwgMTksXG5cbiAgICAgICAgICAyMCwgMjEsIDIyLFxuICAgICAgICAgIDIwLCAyMiwgMjNcbiAgICAgICAgXSxcbiAgICAgICAgdmVydGV4SW5kZXhFbGVtZW50QnVmZmVyID0gY2FudmFzLmNyZWF0ZUVsZW1lbnRCdWZmZXIodmVydGV4SW5kZXhEYXRhKSxcbiAgICAgICAgdmVydGV4SW5kZXhEYXRhTGVuZ3RoID0gdmVydGV4SW5kZXhEYXRhLmxlbmd0aCxcbiAgICAgICAgY291bnQgPSB2ZXJ0ZXhJbmRleERhdGFMZW5ndGg7ICAvLy9cblxuICBjYW52YXMuYmluZEVsZW1lbnRCdWZmZXIodmVydGV4SW5kZXhFbGVtZW50QnVmZmVyKTtcblxuICByZXR1cm4gY291bnQ7XG59XG4iXX0=