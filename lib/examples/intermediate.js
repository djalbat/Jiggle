'use strict';

var Canvas = require('../canvas'),
    Rotation = require('../rotation'),
    Position = require('../position'),
    Perspective = require('../perspective');

var intermediate = function intermediate() {
  var canvas = new Canvas(),
      context = canvas.getContext();

  if (!context) {
    return;
  }

  // attribute vec4 aVertexColour;
  // varying lowp vec4 vColour;
  // vColour = aVertexColour;

  // varying lowp vec4 vColour;

  var vertexShaderSource = '\n  \n          attribute vec4 aVertexPosition;\n          attribute vec2 aTextureCoordinate;\n          \n          uniform mat4 uRotationMatrix;\n          uniform mat4 uPositionMatrix;\n          uniform mat4 uPerspectiveMatrix;\n          \n          varying highp vec2 vTextureCoordinate;\n      \n          void main() {\n            gl_Position = uPerspectiveMatrix * uPositionMatrix * uRotationMatrix * aVertexPosition;\n            vTextureCoordinate = aTextureCoordinate;\n          }\n          \n        ',
      fragmentShaderSource = '\n        \n          varying highp vec2 vTextureCoordinate;\n          \n          uniform sampler2D uSampler;\n\n          void main() {\n            gl_FragColor = texture2D(uSampler, vTextureCoordinate);\n          }\n          \n        ',
      shaderProgram = canvas.createShaderProgram(vertexShaderSource, fragmentShaderSource),
      clientWidth = canvas.getClientWidth(),
      clientHeight = canvas.getClientHeight(),
      position = new Position(),
      perspective = new Perspective(clientWidth, clientHeight);

  createAndBindVertexPositionBuffer(canvas, shaderProgram);

  // createAndBindVertexColourBuffer(canvas, shaderProgram);

  createAndBindTextureCoordinateBuffer(canvas, shaderProgram);

  var count = createVertexIndexElementBuffer(canvas);

  canvas.useProgram(shaderProgram);

  canvas.enableDepthTesting();
  canvas.enableDepthFunction();

  var initialTime = null;

  var image = new Image();

  image.onload = function () {
    var gl = canvas.getContext();

    var texture = gl.createTexture();

    gl.bindTexture(gl.TEXTURE_2D, texture);

    var internalFormat = gl.RGBA;
    var level = 0;
    var srcFormat = gl.RGBA;
    var srcType = gl.UNSIGNED_BYTE;

    gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, srcFormat, srcType, image);

    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);

    gl.activeTexture(gl.TEXTURE0);

    gl.bindTexture(gl.TEXTURE_2D, texture);

    gl.uniform1i(canvas.getUniformLocation(shaderProgram, 'uSampler'), 0);

    requestAnimationFrame(render);
  };

  image.src = 'texture/cubetexture.png';

  function render(time) {
    if (initialTime === null) {
      initialTime = time;
    }

    var elapsedTime = time - initialTime,
        xAngle = elapsedTime / 1000,
        yAngle = elapsedTime / 1000,
        rotation = new Rotation(xAngle, yAngle);

    canvas.render(rotation, position, perspective, shaderProgram);

    canvas.drawElements(count);

    requestAnimationFrame(render);
  }
};

module.exports = intermediate;

function createAndBindVertexPositionBuffer(canvas, shaderProgram) {
  var vertexPositionData = [+1.0, +1.0, +1.0, -1.0, +1.0, +1.0, +1.0, -1.0, +1.0, -1.0, -1.0, +1.0, +1.0, +1.0, -1.0, -1.0, +1.0, -1.0, +1.0, -1.0, -1.0, -1.0, -1.0, -1.0, +1.0, +1.0, +1.0, +1.0, -1.0, +1.0, +1.0, +1.0, -1.0, +1.0, -1.0, -1.0, -1.0, +1.0, +1.0, -1.0, -1.0, +1.0, -1.0, +1.0, -1.0, -1.0, -1.0, -1.0, +1.0, +1.0, +1.0, -1.0, +1.0, +1.0, +1.0, +1.0, -1.0, -1.0, +1.0, -1.0, +1.0, -1.0, +1.0, -1.0, -1.0, +1.0, +1.0, -1.0, -1.0, -1.0, -1.0, -1.0],
      vertexPositionBuffer = canvas.createBuffer(vertexPositionData),
      vertexPositionAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexPosition'),
      vertexPositionComponents = 3;

  canvas.bindBuffer(vertexPositionBuffer, vertexPositionAttributeLocation, vertexPositionComponents);

  var vertexPositionDataLength = vertexPositionData.length,
      count = vertexPositionDataLength / vertexPositionComponents;

  return count;
}

function createAndBindVertexColourBuffer(canvas, shaderProgram) {
  var vertexColourData = [1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0],
      vertexColourBuffer = canvas.createBuffer(vertexColourData),
      vertexColourAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexColour'),
      vertexColourComponents = 4;

  canvas.bindBuffer(vertexColourBuffer, vertexColourAttributeLocation, vertexColourComponents);
}

function createAndBindTextureCoordinateBuffer(canvas, shaderProgram) {
  var textureCoordinateData = [0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0],
      textureCoordinateBuffer = canvas.createBuffer(textureCoordinateData),
      textureCoordinateAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aTextureCoordinate'),
      textureCoordinateComponents = 2;

  canvas.bindBuffer(textureCoordinateBuffer, textureCoordinateAttributeLocation, textureCoordinateComponents);
}

function createVertexIndexElementBuffer(canvas) {
  var vertexIndexData = [0, 1, 2, 1, 2, 3, 4, 5, 6, 5, 6, 7, 8, 9, 10, 9, 10, 11, 12, 13, 14, 13, 14, 15, 16, 17, 18, 17, 18, 19, 20, 21, 22, 21, 22, 23],
      vertexIndexElementBuffer = canvas.createElementBuffer(vertexIndexData),
      vertexIndexDataLength = vertexIndexData.length,
      count = vertexIndexDataLength; ///

  canvas.bindElementBuffer(vertexIndexElementBuffer);

  return count;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9leGFtcGxlcy9pbnRlcm1lZGlhdGUuanMiXSwibmFtZXMiOlsiQ2FudmFzIiwicmVxdWlyZSIsIlJvdGF0aW9uIiwiUG9zaXRpb24iLCJQZXJzcGVjdGl2ZSIsImludGVybWVkaWF0ZSIsImNhbnZhcyIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwidmVydGV4U2hhZGVyU291cmNlIiwiZnJhZ21lbnRTaGFkZXJTb3VyY2UiLCJzaGFkZXJQcm9ncmFtIiwiY3JlYXRlU2hhZGVyUHJvZ3JhbSIsImNsaWVudFdpZHRoIiwiZ2V0Q2xpZW50V2lkdGgiLCJjbGllbnRIZWlnaHQiLCJnZXRDbGllbnRIZWlnaHQiLCJwb3NpdGlvbiIsInBlcnNwZWN0aXZlIiwiY3JlYXRlQW5kQmluZFZlcnRleFBvc2l0aW9uQnVmZmVyIiwiY3JlYXRlQW5kQmluZFRleHR1cmVDb29yZGluYXRlQnVmZmVyIiwiY291bnQiLCJjcmVhdGVWZXJ0ZXhJbmRleEVsZW1lbnRCdWZmZXIiLCJ1c2VQcm9ncmFtIiwiZW5hYmxlRGVwdGhUZXN0aW5nIiwiZW5hYmxlRGVwdGhGdW5jdGlvbiIsImluaXRpYWxUaW1lIiwiaW1hZ2UiLCJJbWFnZSIsIm9ubG9hZCIsImdsIiwidGV4dHVyZSIsImNyZWF0ZVRleHR1cmUiLCJiaW5kVGV4dHVyZSIsIlRFWFRVUkVfMkQiLCJpbnRlcm5hbEZvcm1hdCIsIlJHQkEiLCJsZXZlbCIsInNyY0Zvcm1hdCIsInNyY1R5cGUiLCJVTlNJR05FRF9CWVRFIiwidGV4SW1hZ2UyRCIsInRleFBhcmFtZXRlcmkiLCJURVhUVVJFX1dSQVBfUyIsIkNMQU1QX1RPX0VER0UiLCJURVhUVVJFX1dSQVBfVCIsIlRFWFRVUkVfTUlOX0ZJTFRFUiIsIkxJTkVBUiIsImFjdGl2ZVRleHR1cmUiLCJURVhUVVJFMCIsInVuaWZvcm0xaSIsImdldFVuaWZvcm1Mb2NhdGlvbiIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInJlbmRlciIsInNyYyIsInRpbWUiLCJlbGFwc2VkVGltZSIsInhBbmdsZSIsInlBbmdsZSIsInJvdGF0aW9uIiwiZHJhd0VsZW1lbnRzIiwibW9kdWxlIiwiZXhwb3J0cyIsInZlcnRleFBvc2l0aW9uRGF0YSIsInZlcnRleFBvc2l0aW9uQnVmZmVyIiwiY3JlYXRlQnVmZmVyIiwidmVydGV4UG9zaXRpb25BdHRyaWJ1dGVMb2NhdGlvbiIsImdldEF0dHJpYnV0ZUxvY2F0aW9uIiwidmVydGV4UG9zaXRpb25Db21wb25lbnRzIiwiYmluZEJ1ZmZlciIsInZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCIsImxlbmd0aCIsImNyZWF0ZUFuZEJpbmRWZXJ0ZXhDb2xvdXJCdWZmZXIiLCJ2ZXJ0ZXhDb2xvdXJEYXRhIiwidmVydGV4Q29sb3VyQnVmZmVyIiwidmVydGV4Q29sb3VyQXR0cmlidXRlTG9jYXRpb24iLCJ2ZXJ0ZXhDb2xvdXJDb21wb25lbnRzIiwidGV4dHVyZUNvb3JkaW5hdGVEYXRhIiwidGV4dHVyZUNvb3JkaW5hdGVCdWZmZXIiLCJ0ZXh0dXJlQ29vcmRpbmF0ZUF0dHJpYnV0ZUxvY2F0aW9uIiwidGV4dHVyZUNvb3JkaW5hdGVDb21wb25lbnRzIiwidmVydGV4SW5kZXhEYXRhIiwidmVydGV4SW5kZXhFbGVtZW50QnVmZmVyIiwiY3JlYXRlRWxlbWVudEJ1ZmZlciIsInZlcnRleEluZGV4RGF0YUxlbmd0aCIsImJpbmRFbGVtZW50QnVmZmVyIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxTQUFTQyxRQUFRLFdBQVIsQ0FBZjtBQUFBLElBQ01DLFdBQVdELFFBQVEsYUFBUixDQURqQjtBQUFBLElBRU1FLFdBQVdGLFFBQVEsYUFBUixDQUZqQjtBQUFBLElBR01HLGNBQWNILFFBQVEsZ0JBQVIsQ0FIcEI7O0FBS0EsSUFBTUksZUFBZSxTQUFmQSxZQUFlLEdBQU07QUFDekIsTUFBTUMsU0FBUyxJQUFJTixNQUFKLEVBQWY7QUFBQSxNQUNNTyxVQUFVRCxPQUFPRSxVQUFQLEVBRGhCOztBQUdBLE1BQUksQ0FBQ0QsT0FBTCxF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U0FBTzdELEtBQVA7QUFDRCIsImZpbGUiOiJpbnRlcm1lZGlhdGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IENhbnZhcyA9IHJlcXVpcmUoJy4uL2NhbnZhcycpLFxuICAgICAgUm90YXRpb24gPSByZXF1aXJlKCcuLi9yb3RhdGlvbicpLFxuICAgICAgUG9zaXRpb24gPSByZXF1aXJlKCcuLi9wb3NpdGlvbicpLFxuICAgICAgUGVyc3BlY3RpdmUgPSByZXF1aXJlKCcuLi9wZXJzcGVjdGl2ZScpO1xuXG5jb25zdCBpbnRlcm1lZGlhdGUgPSAoKSA9PiB7XG4gIGNvbnN0IGNhbnZhcyA9IG5ldyBDYW52YXMoKSxcbiAgICAgICAgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCk7XG5cbiAgaWYgKCFjb250ZXh0KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gYXR0cmlidXRlIHZlYzQgYVZlcnRleENvbG91cjtcbiAgLy8gdmFyeWluZyBsb3dwIHZlYzQgdkNvbG91cjtcbiAgLy8gdkNvbG91ciA9IGFWZXJ0ZXhDb2xvdXI7XG5cbiAgLy8gdmFyeWluZyBsb3dwIHZlYzQgdkNvbG91cjtcblxuICBjb25zdCB2ZXJ0ZXhTaGFkZXJTb3VyY2UgPSBgXG4gIFxuICAgICAgICAgIGF0dHJpYnV0ZSB2ZWM0IGFWZXJ0ZXhQb3NpdGlvbjtcbiAgICAgICAgICBhdHRyaWJ1dGUgdmVjMiBhVGV4dHVyZUNvb3JkaW5hdGU7XG4gICAgICAgICAgXG4gICAgICAgICAgdW5pZm9ybSBtYXQ0IHVSb3RhdGlvbk1hdHJpeDtcbiAgICAgICAgICB1bmlmb3JtIG1hdDQgdVBvc2l0aW9uTWF0cml4O1xuICAgICAgICAgIHVuaWZvcm0gbWF0NCB1UGVyc3BlY3RpdmVNYXRyaXg7XG4gICAgICAgICAgXG4gICAgICAgICAgdmFyeWluZyBoaWdocCB2ZWMyIHZUZXh0dXJlQ29vcmRpbmF0ZTtcbiAgICAgIFxuICAgICAgICAgIHZvaWQgbWFpbigpIHtcbiAgICAgICAgICAgIGdsX1Bvc2l0aW9uID0gdVBlcnNwZWN0aXZlTWF0cml4ICogdVBvc2l0aW9uTWF0cml4ICogdVJvdGF0aW9uTWF0cml4ICogYVZlcnRleFBvc2l0aW9uO1xuICAgICAgICAgICAgdlRleHR1cmVDb29yZGluYXRlID0gYVRleHR1cmVDb29yZGluYXRlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgYCxcbiAgICAgICAgZnJhZ21lbnRTaGFkZXJTb3VyY2UgPSBgXG4gICAgICAgIFxuICAgICAgICAgIHZhcnlpbmcgaGlnaHAgdmVjMiB2VGV4dHVyZUNvb3JkaW5hdGU7XG4gICAgICAgICAgXG4gICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdVNhbXBsZXI7XG5cbiAgICAgICAgICB2b2lkIG1haW4oKSB7XG4gICAgICAgICAgICBnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlMkQodVNhbXBsZXIsIHZUZXh0dXJlQ29vcmRpbmF0ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICBgLFxuICAgICAgICBzaGFkZXJQcm9ncmFtID0gY2FudmFzLmNyZWF0ZVNoYWRlclByb2dyYW0odmVydGV4U2hhZGVyU291cmNlLCBmcmFnbWVudFNoYWRlclNvdXJjZSksXG4gICAgICAgIGNsaWVudFdpZHRoID0gY2FudmFzLmdldENsaWVudFdpZHRoKCksXG4gICAgICAgIGNsaWVudEhlaWdodCA9IGNhbnZhcy5nZXRDbGllbnRIZWlnaHQoKSxcbiAgICAgICAgcG9zaXRpb24gPSBuZXcgUG9zaXRpb24oKSxcbiAgICAgICAgcGVyc3BlY3RpdmUgPSBuZXcgUGVyc3BlY3RpdmUoY2xpZW50V2lkdGgsIGNsaWVudEhlaWdodCk7XG5cbiAgY3JlYXRlQW5kQmluZFZlcnRleFBvc2l0aW9uQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSk7XG5cbiAgLy8gY3JlYXRlQW5kQmluZFZlcnRleENvbG91ckJ1ZmZlcihjYW52YXMsIHNoYWRlclByb2dyYW0pO1xuXG4gIGNyZWF0ZUFuZEJpbmRUZXh0dXJlQ29vcmRpbmF0ZUJ1ZmZlcihjYW52YXMsIHNoYWRlclByb2dyYW0pO1xuXG4gIGNvbnN0IGNvdW50ID0gY3JlYXRlVmVydGV4SW5kZXhFbGVtZW50QnVmZmVyKGNhbnZhcyk7XG5cbiAgY2FudmFzLnVzZVByb2dyYW0oc2hhZGVyUHJvZ3JhbSk7XG5cbiAgY2FudmFzLmVuYWJsZURlcHRoVGVzdGluZygpO1xuICBjYW52YXMuZW5hYmxlRGVwdGhGdW5jdGlvbigpO1xuXG4gIGxldCBpbml0aWFsVGltZSA9IG51bGw7XG5cbiAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcblxuICBpbWFnZS5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICBjb25zdCBnbCA9IGNhbnZhcy5nZXRDb250ZXh0KCk7XG5cbiAgICBjb25zdCB0ZXh0dXJlID0gZ2wuY3JlYXRlVGV4dHVyZSgpO1xuXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdGV4dHVyZSk7XG5cbiAgICBjb25zdCBpbnRlcm5hbEZvcm1hdCA9IGdsLlJHQkE7XG4gICAgY29uc3QgbGV2ZWwgPSAwO1xuICAgIGNvbnN0IHNyY0Zvcm1hdCA9IGdsLlJHQkE7XG4gICAgY29uc3Qgc3JjVHlwZSA9IGdsLlVOU0lHTkVEX0JZVEU7XG5cbiAgICBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIGxldmVsLCBpbnRlcm5hbEZvcm1hdCwgc3JjRm9ybWF0LCBzcmNUeXBlLCBpbWFnZSk7XG5cbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9TLCBnbC5DTEFNUF9UT19FREdFKTtcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9ULCBnbC5DTEFNUF9UT19FREdFKTtcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfTUlOX0ZJTFRFUiwgZ2wuTElORUFSKTtcblxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTApO1xuXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdGV4dHVyZSk7XG5cbiAgICBnbC51bmlmb3JtMWkoY2FudmFzLmdldFVuaWZvcm1Mb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAndVNhbXBsZXInKSwgMCk7XG5cbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVuZGVyKTtcblxuICB9O1xuXG4gIGltYWdlLnNyYyA9ICd0ZXh0dXJlL2N1YmV0ZXh0dXJlLnBuZyc7XG5cbiAgZnVuY3Rpb24gcmVuZGVyKHRpbWUpIHtcbiAgICBpZiAoaW5pdGlhbFRpbWUgPT09IG51bGwpIHtcbiAgICAgIGluaXRpYWxUaW1lID0gdGltZTtcbiAgICB9XG5cbiAgICBjb25zdCBlbGFwc2VkVGltZSA9IHRpbWUgLSBpbml0aWFsVGltZSxcbiAgICAgICAgICB4QW5nbGUgPSBlbGFwc2VkVGltZSAvIDEwMDAsXG4gICAgICAgICAgeUFuZ2xlID0gZWxhcHNlZFRpbWUgLyAxMDAwLFxuICAgICAgICAgIHJvdGF0aW9uID0gbmV3IFJvdGF0aW9uKHhBbmdsZSwgeUFuZ2xlKTtcblxuICAgIGNhbnZhcy5yZW5kZXIocm90YXRpb24sIHBvc2l0aW9uLCBwZXJzcGVjdGl2ZSwgc2hhZGVyUHJvZ3JhbSk7XG5cbiAgICBjYW52YXMuZHJhd0VsZW1lbnRzKGNvdW50KTtcblxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpO1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGludGVybWVkaWF0ZTtcblxuZnVuY3Rpb24gY3JlYXRlQW5kQmluZFZlcnRleFBvc2l0aW9uQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSkge1xuICBjb25zdCB2ZXJ0ZXhQb3NpdGlvbkRhdGEgPSBbXG4gICAgICAgICAgKzEuMCwgKzEuMCwgKzEuMCxcbiAgICAgICAgICAtMS4wLCArMS4wLCArMS4wLFxuICAgICAgICAgICsxLjAsIC0xLjAsICsxLjAsXG4gICAgICAgICAgLTEuMCwgLTEuMCwgKzEuMCxcblxuICAgICAgICAgICsxLjAsICsxLjAsIC0xLjAsXG4gICAgICAgICAgLTEuMCwgKzEuMCwgLTEuMCxcbiAgICAgICAgICArMS4wLCAtMS4wLCAtMS4wLFxuICAgICAgICAgIC0xLjAsIC0xLjAsIC0xLjAsXG5cbiAgICAgICAgICArMS4wLCArMS4wLCArMS4wLFxuICAgICAgICAgICsxLjAsIC0xLjAsICsxLjAsXG4gICAgICAgICAgKzEuMCwgKzEuMCwgLTEuMCxcbiAgICAgICAgICArMS4wLCAtMS4wLCAtMS4wLFxuXG4gICAgICAgICAgLTEuMCwgKzEuMCwgKzEuMCxcbiAgICAgICAgICAtMS4wLCAtMS4wLCArMS4wLFxuICAgICAgICAgIC0xLjAsICsxLjAsIC0xLjAsXG4gICAgICAgICAgLTEuMCwgLTEuMCwgLTEuMCxcblxuICAgICAgICAgICsxLjAsICsxLjAsICsxLjAsXG4gICAgICAgICAgLTEuMCwgKzEuMCwgKzEuMCxcbiAgICAgICAgICArMS4wLCArMS4wLCAtMS4wLFxuICAgICAgICAgIC0xLjAsICsxLjAsIC0xLjAsXG5cbiAgICAgICAgICArMS4wLCAtMS4wLCArMS4wLFxuICAgICAgICAgIC0xLjAsIC0xLjAsICsxLjAsXG4gICAgICAgICAgKzEuMCwgLTEuMCwgLTEuMCxcbiAgICAgICAgICAtMS4wLCAtMS4wLCAtMS4wXG4gICAgICAgIF0sXG4gICAgICAgIHZlcnRleFBvc2l0aW9uQnVmZmVyID0gY2FudmFzLmNyZWF0ZUJ1ZmZlcih2ZXJ0ZXhQb3NpdGlvbkRhdGEpLFxuICAgICAgICB2ZXJ0ZXhQb3NpdGlvbkF0dHJpYnV0ZUxvY2F0aW9uID0gY2FudmFzLmdldEF0dHJpYnV0ZUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICdhVmVydGV4UG9zaXRpb24nKSxcbiAgICAgICAgdmVydGV4UG9zaXRpb25Db21wb25lbnRzID0gMztcblxuICBjYW52YXMuYmluZEJ1ZmZlcih2ZXJ0ZXhQb3NpdGlvbkJ1ZmZlciwgdmVydGV4UG9zaXRpb25BdHRyaWJ1dGVMb2NhdGlvbiwgdmVydGV4UG9zaXRpb25Db21wb25lbnRzKTtcblxuICBjb25zdCB2ZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGggPSB2ZXJ0ZXhQb3NpdGlvbkRhdGEubGVuZ3RoLFxuICAgICAgICBjb3VudCA9IHZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCAvIHZlcnRleFBvc2l0aW9uQ29tcG9uZW50cztcblxuICByZXR1cm4gY291bnQ7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhDb2xvdXJCdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKSB7XG4gIGNvbnN0IHZlcnRleENvbG91ckRhdGEgPSBbXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDAuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAwLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMC4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMS4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMC4wLCAgMS4wLFxuXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDAuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAwLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMS4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMC4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDAuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAwLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMC4wLCAgMS4wLCAgMS4wLFxuXG4gICAgICAgICAgMS4wLCAgMS4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDEuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAxLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMS4wLCAgMC4wLCAgMS4wXG4gICAgICAgIF0sXG4gICAgICAgIHZlcnRleENvbG91ckJ1ZmZlciA9IGNhbnZhcy5jcmVhdGVCdWZmZXIodmVydGV4Q29sb3VyRGF0YSksXG4gICAgICAgIHZlcnRleENvbG91ckF0dHJpYnV0ZUxvY2F0aW9uID0gY2FudmFzLmdldEF0dHJpYnV0ZUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICdhVmVydGV4Q29sb3VyJyksXG4gICAgICAgIHZlcnRleENvbG91ckNvbXBvbmVudHMgPSA0O1xuXG4gIGNhbnZhcy5iaW5kQnVmZmVyKHZlcnRleENvbG91ckJ1ZmZlciwgdmVydGV4Q29sb3VyQXR0cmlidXRlTG9jYXRpb24sIHZlcnRleENvbG91ckNvbXBvbmVudHMpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVBbmRCaW5kVGV4dHVyZUNvb3JkaW5hdGVCdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKSB7XG4gIGNvbnN0IHRleHR1cmVDb29yZGluYXRlRGF0YSA9IFtcbiAgICAgICAgICAwLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsXG5cbiAgICAgICAgICAwLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsXG5cbiAgICAgICAgICAwLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsXG5cbiAgICAgICAgICAwLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsXG5cbiAgICAgICAgICAwLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsXG5cbiAgICAgICAgICAwLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjBcbiAgICAgICAgXSxcbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVCdWZmZXIgPSBjYW52YXMuY3JlYXRlQnVmZmVyKHRleHR1cmVDb29yZGluYXRlRGF0YSksXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlQXR0cmlidXRlTG9jYXRpb24gPSBjYW52YXMuZ2V0QXR0cmlidXRlTG9jYXRpb24oc2hhZGVyUHJvZ3JhbSwgJ2FUZXh0dXJlQ29vcmRpbmF0ZScpLFxuICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZUNvbXBvbmVudHMgPSAyO1xuXG4gIGNhbnZhcy5iaW5kQnVmZmVyKHRleHR1cmVDb29yZGluYXRlQnVmZmVyLCB0ZXh0dXJlQ29vcmRpbmF0ZUF0dHJpYnV0ZUxvY2F0aW9uLCB0ZXh0dXJlQ29vcmRpbmF0ZUNvbXBvbmVudHMpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVWZXJ0ZXhJbmRleEVsZW1lbnRCdWZmZXIoY2FudmFzKSB7XG4gIGNvbnN0IHZlcnRleEluZGV4RGF0YSA9IFtcbiAgICAgICAgICAwLCAgMSwgIDIsXG4gICAgICAgICAgMSwgIDIsICAzLFxuICAgICAgICAgIDQsICA1LCAgNixcbiAgICAgICAgICA1LCAgNiwgIDcsXG4gICAgICAgICAgOCwgIDksIDEwLFxuICAgICAgICAgIDksIDEwLCAxMSxcbiAgICAgICAgICAxMiwgMTMsIDE0LFxuICAgICAgICAgIDEzLCAxNCwgMTUsXG4gICAgICAgICAgMTYsIDE3LCAxOCxcbiAgICAgICAgICAxNywgMTgsIDE5LFxuICAgICAgICAgIDIwLCAyMSwgMjIsXG4gICAgICAgICAgMjEsIDIyLCAyM1xuICAgICAgICBdLFxuICAgICAgICB2ZXJ0ZXhJbmRleEVsZW1lbnRCdWZmZXIgPSBjYW52YXMuY3JlYXRlRWxlbWVudEJ1ZmZlcih2ZXJ0ZXhJbmRleERhdGEpLFxuICAgICAgICB2ZXJ0ZXhJbmRleERhdGFMZW5ndGggPSB2ZXJ0ZXhJbmRleERhdGEubGVuZ3RoLFxuICAgICAgICBjb3VudCA9IHZlcnRleEluZGV4RGF0YUxlbmd0aDsgIC8vL1xuXG4gIGNhbnZhcy5iaW5kRWxlbWVudEJ1ZmZlcih2ZXJ0ZXhJbmRleEVsZW1lbnRCdWZmZXIpO1xuXG4gIHJldHVybiBjb3VudDtcbn1cbiJdfQ==