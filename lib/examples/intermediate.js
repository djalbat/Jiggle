'use strict';

var Canvas = require('../canvas'),
    Normal = require('../normal'),
    Rotation = require('../rotation'),
    Position = require('../position'),
    Perspective = require('../perspective');

var intermediate = function intermediate() {
  var canvas = new Canvas(),
      context = canvas.getContext();

  if (!context) {
    return;
  }

  var vertexShaderSource = '\n  \n          attribute vec4 aVertexPosition;\n          attribute vec4 aVertexColour;\n          attribute vec3 aVertexNormal;\n          attribute vec2 aTextureCoordinate;\n          \n          uniform mat4 uNormalMatrix;\n          uniform mat4 uRotationMatrix;\n          uniform mat4 uPositionMatrix;\n          uniform mat4 uPerspectiveMatrix;\n          \n          varying lowp vec4 vColour;\n          varying highp vec2 vTextureCoordinate;\n          varying highp vec3 vLighting;\n          \n          void main() {\n            gl_Position = uPerspectiveMatrix * uPositionMatrix * uRotationMatrix * aVertexPosition;\n            vColour = aVertexColour;\n            vTextureCoordinate = aTextureCoordinate;\n            \n            highp vec3 ambientLight = vec3(0.3, 0.3, 0.3);\n            highp vec3 directionalLightColour = vec3(1, 1, 1);\n            highp vec3 directionalVector = normalize(vec3(0.85, 0.8, 0.75));\n            \n            highp vec4 transformedNormal = uNormalMatrix * vec4(aVertexNormal, 1.0);            \n            highp float directional = max(dot(transformedNormal.xyz, directionalVector), 0.0);\n            \n            vLighting = ambientLight + (directionalLightColour * directional);\n          }\n          \n        ',
      fragmentShaderSource = '\n        \n          varying lowp vec4 vColour;\n          varying highp vec2 vTextureCoordinate;\n          varying highp vec3 vLighting;\n          \n          uniform sampler2D uSampler;\n\n          void main() {\n            highp vec4 texelColour = texture2D(uSampler, vTextureCoordinate);\n            \n            // gl_FragColor = vColour;\n            // gl_FragColor = texture2D(uSampler, vTextureCoordinate);\n            \n            gl_FragColor = vec4(texelColour.rgb * vLighting, texelColour.a);\n          }\n          \n        ',
      shaderProgram = canvas.createShaderProgram(vertexShaderSource, fragmentShaderSource),
      clientWidth = canvas.getClientWidth(),
      clientHeight = canvas.getClientHeight(),
      zCoordinate = -5,
      ///
  position = Position.fromZCoordinate(zCoordinate),
      perspective = Perspective.fromClientWidthAndClientHeight(clientWidth, clientHeight);

  createAndBindVertexPositionBuffer(canvas, shaderProgram);

  // createAndBindVertexColourBuffer(canvas, shaderProgram);

  createAndBindTextureCoordinateBuffer(canvas, shaderProgram);

  createAndBindVertexNormalBuffer(canvas, shaderProgram);

  var count = createVertexIndexElementBuffer(canvas);

  canvas.useProgram(shaderProgram);

  canvas.enableDepthTesting();
  canvas.enableDepthFunction();

  var initialTime = null;

  var image = new Image();

  image.onload = function () {
    var context = canvas.getContext(),
        TEXTURE0 = context.TEXTURE0,
        target = TEXTURE0,
        uSamplerUniformLocationIntegerValue = 0,
        uSamplerUniformLocation = canvas.getUniformLocation(shaderProgram, 'uSampler');


    canvas.createTexture(image);

    canvas.activateTexture(target);

    canvas.setUniformLocationIntegerValue(uSamplerUniformLocation, uSamplerUniformLocationIntegerValue);

    requestAnimationFrame(render);
  };

  image.src = 'texture/bricks.jpg';

  function render(time) {
    if (initialTime === null) {
      initialTime = time;
    }

    var elapsedTime = time - initialTime,
        xAngle = elapsedTime / 1000,
        yAngle = elapsedTime / 1000,
        rotation = Rotation.fromXAngleAndYAngle(xAngle, yAngle),
        normal = Normal.fromRotation(rotation);

    canvas.render(normal, rotation, position, perspective, shaderProgram);

    canvas.drawElements(count);

    requestAnimationFrame(render);
  }
};

module.exports = intermediate;

function createAndBindVertexPositionBuffer(canvas, shaderProgram) {
  var vertexPositionData = [-1.0, -1.0, +1.0, +1.0, -1.0, +1.0, +1.0, +1.0, +1.0, -1.0, +1.0, +1.0, -1.0, -1.0, -1.0, -1.0, +1.0, -1.0, +1.0, +1.0, -1.0, +1.0, -1.0, -1.0, -1.0, +1.0, -1.0, -1.0, +1.0, +1.0, +1.0, +1.0, +1.0, +1.0, +1.0, -1.0, -1.0, -1.0, -1.0, +1.0, -1.0, -1.0, +1.0, -1.0, +1.0, -1.0, -1.0, +1.0, +1.0, -1.0, -1.0, +1.0, +1.0, -1.0, +1.0, +1.0, +1.0, +1.0, -1.0, +1.0, -1.0, -1.0, -1.0, -1.0, -1.0, +1.0, -1.0, +1.0, +1.0, -1.0, +1.0, -1.0],
      vertexPositionBuffer = canvas.createBuffer(vertexPositionData),
      vertexPositionAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexPosition'),
      vertexPositionComponents = 3;

  canvas.bindBuffer(vertexPositionBuffer, vertexPositionAttributeLocation, vertexPositionComponents);

  var vertexPositionDataLength = vertexPositionData.length,
      count = vertexPositionDataLength / vertexPositionComponents;

  return count;
}

function createAndBindVertexColourBuffer(canvas, shaderProgram) {
  var vertexColourData = [1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0],
      vertexColourBuffer = canvas.createBuffer(vertexColourData),
      vertexColourAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexColour'),
      vertexColourComponents = 4;

  canvas.bindBuffer(vertexColourBuffer, vertexColourAttributeLocation, vertexColourComponents);
}

function createAndBindTextureCoordinateBuffer(canvas, shaderProgram) {
  var textureCoordinateData = [0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0],
      textureCoordinateBuffer = canvas.createBuffer(textureCoordinateData),
      textureCoordinateAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aTextureCoordinate'),
      textureCoordinateComponents = 2;

  canvas.bindBuffer(textureCoordinateBuffer, textureCoordinateAttributeLocation, textureCoordinateComponents);
}

function createAndBindVertexNormalBuffer(canvas, shaderProgram) {
  var vertexNormalData = [0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, +1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0],
      vertexNormalBuffer = canvas.createBuffer(vertexNormalData),
      vertexNormalAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexNormal'),
      vertexNormalComponents = 3;

  canvas.bindBuffer(vertexNormalBuffer, vertexNormalAttributeLocation, vertexNormalComponents);
}

function createVertexIndexElementBuffer(canvas) {
  var vertexIndexData = [0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19, 20, 21, 22, 20, 22, 23],
      vertexIndexElementBuffer = canvas.createElementBuffer(vertexIndexData),
      vertexIndexDataLength = vertexIndexData.length,
      count = vertexIndexDataLength; ///

  canvas.bindElementBuffer(vertexIndexElementBuffer);

  return count;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9leGFtcGxlcy9pbnRlcm1lZGlhdGUuanMiXSwibmFtZXMiOlsiQ2FudmFzIiwicmVxdWlyZSIsIk5vcm1hbCIsIlJvdGF0aW9uIiwiUG9zaXRpb24iLCJQZXJzcGVjdGl2ZSIsImludGVybWVkaWF0ZSIsImNhbnZhcyIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwidmVydGV4U2hhZGVyU291cmNlIiwiZnJhZ21lbnRTaGFkZXJTb3VyY2UiLCJzaGFkZXJQcm9ncmFtIiwiY3JlYXRlU2hhZGVyUHJvZ3JhbSIsImNsaWVudFdpZHRoIiwiZ2V0Q2xpZW50V2lkdGgiLCJjbGllbnRIZWlnaHQiLCJnZXRDbGllbnRIZWlnaHQiLCJ6Q29vcmRpbmF0ZSIsInBvc2l0aW9uIiwiZnJvbVpDb29yZGluYXRlIiwicGVyc3BlY3RpdmUiLCJmcm9tQ2xpZW50V2lkdGhBbmRDbGllbnRIZWlnaHQiLCJjcmVhdGVBbmRCaW5kVmVydGV4UG9zaXRpb25CdWZmZXIiLCJjcmVhdGVBbmRCaW5kVGV4dHVyZUNvb3JkaW5hdGVCdWZmZXIiLCJjcmVhdGVBbmRCaW5kVmVydGV4Tm9ybWFsQnVmZmVyIiwiY291bnQiLCJjcmVhdGVWZXJ0ZXhJbmRleEVsZW1lbnRCdWZmZXIiLCJ1c2VQcm9ncmFtIiwiZW5hYmxlRGVwdGhUZXN0aW5nIiwiZW5hYmxlRGVwdGhGdW5jdGlvbiIsImluaXRpYWxUaW1lIiwiaW1hZ2UiLCJJbWFnZSIsIm9ubG9hZCIsIlRFWFRVUkUwIiwidGFyZ2V0IiwidVNhbXBsZXJVbmlmb3JtTG9jYXRpb25JbnRlZ2VyVmFsdWUiLCJ1U2FtcGxlclVuaWZvcm1Mb2NhdGlvbiIsImdldFVuaWZvcm1Mb2NhdGlvbiIsImNyZWF0ZVRleHR1cmUiLCJhY3RpdmF0ZVRleHR1cmUiLCJzZXRVbmlmb3JtTG9jYXRpb25JbnRlZ2VyVmFsdWUiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJyZW5kZXIiLCJzcmMiLCJ0aW1lIiwiZWxhcHNlZFRpbWUiLCJ4QW5nbGUiLCJ5QW5nbGUiLCJyb3RhdGlvbiIsImZyb21YQW5nbGVBbmRZQW5nbGUiLCJub3JtYWwiLCJmcm9tUm90YXRpb24iLCJkcmF3RWxlbWVudHMiLCJtb2R1bGUiLCJleHBvcnRzIiwidmVydGV4UG9zaXRpb25EYXRhIiwidmVydGV4UG9zaXRpb25CdWZmZXIiLCJjcmVhdGVCdWZmZXIiLCJ2ZXJ0ZXhQb3NpdGlvbkF0dHJpYnV0ZUxvY2F0aW9uIiwiZ2V0QXR0cmlidXRlTG9jYXRpb24iLCJ2ZXJ0ZXhQb3NpdGlvbkNvbXBvbmVudHMiLCJiaW5kQnVmZmVyIiwidmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoIiwibGVuZ3RoIiwiY3JlYXRlQW5kQmluZFZlcnRleENvbG91ckJ1ZmZlciIsInZlcnRleENvbG91ckRhdGEiLCJ2ZXJ0ZXhDb2xvdXJCdWZmZXIiLCJ2ZXJ0ZXhDb2xvdXJBdHRyaWJ1dGVMb2NhdGlvbiIsInZlcnRleENvbG91ckNvbXBvbmVudHMiLCJ0ZXh0dXJlQ29vcmRpbmF0ZURhdGEiLCJ0ZXh0dXJlQ29vcmRpbmF0ZUJ1ZmZlciIsInRleHR1cmVDb29yZGluYXRlQXR0cmlidXRlTG9jYXRpb24iLCJ0ZXh0dXJlQ29vcmRpbmF0ZUNvbXBvbmVudHMiLCJ2ZXJ0ZXhOb3JtYWxEYXRhIiwidmVydGV4Tm9ybWFsQnVmZmVyIiwidmVydGV4Tm9ybWFsQXR0cmlidXRlTG9jYXRpb24iLCJ2ZXJ0ZXhOb3JtYWxDb21wb25lbnRzIiwidmVydGV4SW5kZXhEYXRhIiwidmVydGV4SW5kZXhFbGVtZW50QnVmZmVyIiwiY3JlYXRlRWxlbWVudEJ1ZmZlciIsInZlcnRleEluZGV4RGF0YUxlbmd0aCIsImJpbmRFbGVtZW50QnVmZmVyIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxTQUFTQyxRQUFRLFdBQVIsQ0FBZjtBQUFBLElBQ01DLFNBQVNELFFBQVEsV0FBUixDQURmO0FBQUEsSUFFTUUsV0FBV0YsUUFBUSxhQUFSLENBRmpCO0FBQUEsSUFHTUcsV0FBV0gsUUFBUSxhQUFSLENBSGpC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aEJZLEVBZ0JSLEVBaEJRLEVBaUJoQixFQWpCZ0IsRUFpQlosRUFqQlksRUFpQlIsRUFqQlEsQ0FBeEI7QUFBQSxNQW1CTUMsMkJBQTJCekUsT0FBTzBFLG1CQUFQLENBQTJCRixlQUEzQixDQW5CakM7QUFBQSxNQW9CTUcsd0JBQXdCSCxnQkFBZ0JkLE1BcEI5QztBQUFBLE1BcUJNdkMsUUFBUXdELHFCQXJCZCxDQUQ4QyxDQXNCUjs7QUFFdEMzRSxTQUFPNEUsaUJBQVAsQ0FBeUJILHdCQUF6Qjs7QUFFQSxTQUFPdEQsS0FBUDtBQUNEIiwiZmlsZSI6ImludGVybWVkaWF0ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgQ2FudmFzID0gcmVxdWlyZSgnLi4vY2FudmFzJyksXG4gICAgICBOb3JtYWwgPSByZXF1aXJlKCcuLi9ub3JtYWwnKSxcbiAgICAgIFJvdGF0aW9uID0gcmVxdWlyZSgnLi4vcm90YXRpb24nKSxcbiAgICAgIFBvc2l0aW9uID0gcmVxdWlyZSgnLi4vcG9zaXRpb24nKSxcbiAgICAgIFBlcnNwZWN0aXZlID0gcmVxdWlyZSgnLi4vcGVyc3BlY3RpdmUnKTtcblxuY29uc3QgaW50ZXJtZWRpYXRlID0gKCkgPT4ge1xuICBjb25zdCBjYW52YXMgPSBuZXcgQ2FudmFzKCksXG4gICAgICAgIGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgpO1xuXG4gIGlmICghY29udGV4dCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHZlcnRleFNoYWRlclNvdXJjZSA9IGBcbiAgXG4gICAgICAgICAgYXR0cmlidXRlIHZlYzQgYVZlcnRleFBvc2l0aW9uO1xuICAgICAgICAgIGF0dHJpYnV0ZSB2ZWM0IGFWZXJ0ZXhDb2xvdXI7XG4gICAgICAgICAgYXR0cmlidXRlIHZlYzMgYVZlcnRleE5vcm1hbDtcbiAgICAgICAgICBhdHRyaWJ1dGUgdmVjMiBhVGV4dHVyZUNvb3JkaW5hdGU7XG4gICAgICAgICAgXG4gICAgICAgICAgdW5pZm9ybSBtYXQ0IHVOb3JtYWxNYXRyaXg7XG4gICAgICAgICAgdW5pZm9ybSBtYXQ0IHVSb3RhdGlvbk1hdHJpeDtcbiAgICAgICAgICB1bmlmb3JtIG1hdDQgdVBvc2l0aW9uTWF0cml4O1xuICAgICAgICAgIHVuaWZvcm0gbWF0NCB1UGVyc3BlY3RpdmVNYXRyaXg7XG4gICAgICAgICAgXG4gICAgICAgICAgdmFyeWluZyBsb3dwIHZlYzQgdkNvbG91cjtcbiAgICAgICAgICB2YXJ5aW5nIGhpZ2hwIHZlYzIgdlRleHR1cmVDb29yZGluYXRlO1xuICAgICAgICAgIHZhcnlpbmcgaGlnaHAgdmVjMyB2TGlnaHRpbmc7XG4gICAgICAgICAgXG4gICAgICAgICAgdm9pZCBtYWluKCkge1xuICAgICAgICAgICAgZ2xfUG9zaXRpb24gPSB1UGVyc3BlY3RpdmVNYXRyaXggKiB1UG9zaXRpb25NYXRyaXggKiB1Um90YXRpb25NYXRyaXggKiBhVmVydGV4UG9zaXRpb247XG4gICAgICAgICAgICB2Q29sb3VyID0gYVZlcnRleENvbG91cjtcbiAgICAgICAgICAgIHZUZXh0dXJlQ29vcmRpbmF0ZSA9IGFUZXh0dXJlQ29vcmRpbmF0ZTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaGlnaHAgdmVjMyBhbWJpZW50TGlnaHQgPSB2ZWMzKDAuMywgMC4zLCAwLjMpO1xuICAgICAgICAgICAgaGlnaHAgdmVjMyBkaXJlY3Rpb25hbExpZ2h0Q29sb3VyID0gdmVjMygxLCAxLCAxKTtcbiAgICAgICAgICAgIGhpZ2hwIHZlYzMgZGlyZWN0aW9uYWxWZWN0b3IgPSBub3JtYWxpemUodmVjMygwLjg1LCAwLjgsIDAuNzUpKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaGlnaHAgdmVjNCB0cmFuc2Zvcm1lZE5vcm1hbCA9IHVOb3JtYWxNYXRyaXggKiB2ZWM0KGFWZXJ0ZXhOb3JtYWwsIDEuMCk7ICAgICAgICAgICAgXG4gICAgICAgICAgICBoaWdocCBmbG9hdCBkaXJlY3Rpb25hbCA9IG1heChkb3QodHJhbnNmb3JtZWROb3JtYWwueHl6LCBkaXJlY3Rpb25hbFZlY3RvciksIDAuMCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZMaWdodGluZyA9IGFtYmllbnRMaWdodCArIChkaXJlY3Rpb25hbExpZ2h0Q29sb3VyICogZGlyZWN0aW9uYWwpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgYCxcbiAgICAgICAgZnJhZ21lbnRTaGFkZXJTb3VyY2UgPSBgXG4gICAgICAgIFxuICAgICAgICAgIHZhcnlpbmcgbG93cCB2ZWM0IHZDb2xvdXI7XG4gICAgICAgICAgdmFyeWluZyBoaWdocCB2ZWMyIHZUZXh0dXJlQ29vcmRpbmF0ZTtcbiAgICAgICAgICB2YXJ5aW5nIGhpZ2hwIHZlYzMgdkxpZ2h0aW5nO1xuICAgICAgICAgIFxuICAgICAgICAgIHVuaWZvcm0gc2FtcGxlcjJEIHVTYW1wbGVyO1xuXG4gICAgICAgICAgdm9pZCBtYWluKCkge1xuICAgICAgICAgICAgaGlnaHAgdmVjNCB0ZXhlbENvbG91ciA9IHRleHR1cmUyRCh1U2FtcGxlciwgdlRleHR1cmVDb29yZGluYXRlKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gZ2xfRnJhZ0NvbG9yID0gdkNvbG91cjtcbiAgICAgICAgICAgIC8vIGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRCh1U2FtcGxlciwgdlRleHR1cmVDb29yZGluYXRlKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZ2xfRnJhZ0NvbG9yID0gdmVjNCh0ZXhlbENvbG91ci5yZ2IgKiB2TGlnaHRpbmcsIHRleGVsQ29sb3VyLmEpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgYCxcbiAgICAgICAgc2hhZGVyUHJvZ3JhbSA9IGNhbnZhcy5jcmVhdGVTaGFkZXJQcm9ncmFtKHZlcnRleFNoYWRlclNvdXJjZSwgZnJhZ21lbnRTaGFkZXJTb3VyY2UpLFxuICAgICAgICBjbGllbnRXaWR0aCA9IGNhbnZhcy5nZXRDbGllbnRXaWR0aCgpLFxuICAgICAgICBjbGllbnRIZWlnaHQgPSBjYW52YXMuZ2V0Q2xpZW50SGVpZ2h0KCksXG4gICAgICAgIHpDb29yZGluYXRlID0gLTUsIC8vL1xuICAgICAgICBwb3NpdGlvbiA9IFBvc2l0aW9uLmZyb21aQ29vcmRpbmF0ZSh6Q29vcmRpbmF0ZSksXG4gICAgICAgIHBlcnNwZWN0aXZlID0gUGVyc3BlY3RpdmUuZnJvbUNsaWVudFdpZHRoQW5kQ2xpZW50SGVpZ2h0KGNsaWVudFdpZHRoLCBjbGllbnRIZWlnaHQpO1xuXG4gIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhQb3NpdGlvbkJ1ZmZlcihjYW52YXMsIHNoYWRlclByb2dyYW0pO1xuXG4gIC8vIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhDb2xvdXJCdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKTtcblxuICBjcmVhdGVBbmRCaW5kVGV4dHVyZUNvb3JkaW5hdGVCdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKTtcbiAgXG4gIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhOb3JtYWxCdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKTtcblxuICBjb25zdCBjb3VudCA9IGNyZWF0ZVZlcnRleEluZGV4RWxlbWVudEJ1ZmZlcihjYW52YXMpO1xuXG4gIGNhbnZhcy51c2VQcm9ncmFtKHNoYWRlclByb2dyYW0pO1xuXG4gIGNhbnZhcy5lbmFibGVEZXB0aFRlc3RpbmcoKTtcbiAgY2FudmFzLmVuYWJsZURlcHRoRnVuY3Rpb24oKTtcblxuICBsZXQgaW5pdGlhbFRpbWUgPSBudWxsO1xuXG4gIGNvbnN0IGltYWdlID0gbmV3IEltYWdlKCk7XG5cbiAgaW1hZ2Uub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCksXG4gICAgICAgICAgeyBURVhUVVJFMCB9ID0gY29udGV4dCxcbiAgICAgICAgICB0YXJnZXQgPSBURVhUVVJFMCxcbiAgICAgICAgICB1U2FtcGxlclVuaWZvcm1Mb2NhdGlvbkludGVnZXJWYWx1ZSA9IDAsXG4gICAgICAgICAgdVNhbXBsZXJVbmlmb3JtTG9jYXRpb24gPSBjYW52YXMuZ2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICd1U2FtcGxlcicpO1xuXG4gICAgY2FudmFzLmNyZWF0ZVRleHR1cmUoaW1hZ2UpO1xuXG4gICAgY2FudmFzLmFjdGl2YXRlVGV4dHVyZSh0YXJnZXQpO1xuXG4gICAgY2FudmFzLnNldFVuaWZvcm1Mb2NhdGlvbkludGVnZXJWYWx1ZSh1U2FtcGxlclVuaWZvcm1Mb2NhdGlvbiwgdVNhbXBsZXJVbmlmb3JtTG9jYXRpb25JbnRlZ2VyVmFsdWUpO1xuXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlbmRlcik7XG4gIH07XG5cbiAgaW1hZ2Uuc3JjID0gJ3RleHR1cmUvYnJpY2tzLmpwZyc7XG5cbiAgZnVuY3Rpb24gcmVuZGVyKHRpbWUpIHtcbiAgICBpZiAoaW5pdGlhbFRpbWUgPT09IG51bGwpIHtcbiAgICAgIGluaXRpYWxUaW1lID0gdGltZTtcbiAgICB9XG5cbiAgICBjb25zdCBlbGFwc2VkVGltZSA9IHRpbWUgLSBpbml0aWFsVGltZSxcbiAgICAgICAgICB4QW5nbGUgPSBlbGFwc2VkVGltZSAvIDEwMDAsXG4gICAgICAgICAgeUFuZ2xlID0gZWxhcHNlZFRpbWUgLyAxMDAwLFxuICAgICAgICAgIHJvdGF0aW9uID0gUm90YXRpb24uZnJvbVhBbmdsZUFuZFlBbmdsZSh4QW5nbGUsIHlBbmdsZSksXG4gICAgICAgICAgbm9ybWFsID0gTm9ybWFsLmZyb21Sb3RhdGlvbihyb3RhdGlvbik7XG5cbiAgICBjYW52YXMucmVuZGVyKG5vcm1hbCwgcm90YXRpb24sIHBvc2l0aW9uLCBwZXJzcGVjdGl2ZSwgc2hhZGVyUHJvZ3JhbSk7XG5cbiAgICBjYW52YXMuZHJhd0VsZW1lbnRzKGNvdW50KTtcblxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpO1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGludGVybWVkaWF0ZTtcblxuZnVuY3Rpb24gY3JlYXRlQW5kQmluZFZlcnRleFBvc2l0aW9uQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSkge1xuICBjb25zdCB2ZXJ0ZXhQb3NpdGlvbkRhdGEgPSBbXG4gICAgICAgICAgLTEuMCwgLTEuMCwgKzEuMCxcbiAgICAgICAgICArMS4wLCAtMS4wLCArMS4wLFxuICAgICAgICAgICsxLjAsICsxLjAsICsxLjAsXG4gICAgICAgICAgLTEuMCwgKzEuMCwgKzEuMCxcblxuICAgICAgICAgIC0xLjAsIC0xLjAsIC0xLjAsXG4gICAgICAgICAgLTEuMCwgKzEuMCwgLTEuMCxcbiAgICAgICAgICArMS4wLCArMS4wLCAtMS4wLFxuICAgICAgICAgICsxLjAsIC0xLjAsIC0xLjAsXG5cbiAgICAgICAgICAtMS4wLCArMS4wLCAtMS4wLFxuICAgICAgICAgIC0xLjAsICsxLjAsICsxLjAsXG4gICAgICAgICAgKzEuMCwgKzEuMCwgKzEuMCxcbiAgICAgICAgICArMS4wLCArMS4wLCAtMS4wLFxuXG4gICAgICAgICAgLTEuMCwgLTEuMCwgLTEuMCxcbiAgICAgICAgICArMS4wLCAtMS4wLCAtMS4wLFxuICAgICAgICAgICsxLjAsIC0xLjAsICsxLjAsXG4gICAgICAgICAgLTEuMCwgLTEuMCwgKzEuMCxcblxuICAgICAgICAgICsxLjAsIC0xLjAsIC0xLjAsXG4gICAgICAgICAgKzEuMCwgKzEuMCwgLTEuMCxcbiAgICAgICAgICArMS4wLCArMS4wLCArMS4wLFxuICAgICAgICAgICsxLjAsIC0xLjAsICsxLjAsXG5cbiAgICAgICAgICAtMS4wLCAtMS4wLCAtMS4wLFxuICAgICAgICAgIC0xLjAsIC0xLjAsICsxLjAsXG4gICAgICAgICAgLTEuMCwgKzEuMCwgKzEuMCxcbiAgICAgICAgICAtMS4wLCArMS4wLCAtMS4wXG4gICAgICAgIF0sXG4gICAgICAgIHZlcnRleFBvc2l0aW9uQnVmZmVyID0gY2FudmFzLmNyZWF0ZUJ1ZmZlcih2ZXJ0ZXhQb3NpdGlvbkRhdGEpLFxuICAgICAgICB2ZXJ0ZXhQb3NpdGlvbkF0dHJpYnV0ZUxvY2F0aW9uID0gY2FudmFzLmdldEF0dHJpYnV0ZUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICdhVmVydGV4UG9zaXRpb24nKSxcbiAgICAgICAgdmVydGV4UG9zaXRpb25Db21wb25lbnRzID0gMztcblxuICBjYW52YXMuYmluZEJ1ZmZlcih2ZXJ0ZXhQb3NpdGlvbkJ1ZmZlciwgdmVydGV4UG9zaXRpb25BdHRyaWJ1dGVMb2NhdGlvbiwgdmVydGV4UG9zaXRpb25Db21wb25lbnRzKTtcblxuICBjb25zdCB2ZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGggPSB2ZXJ0ZXhQb3NpdGlvbkRhdGEubGVuZ3RoLFxuICAgICAgICBjb3VudCA9IHZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCAvIHZlcnRleFBvc2l0aW9uQ29tcG9uZW50cztcblxuICByZXR1cm4gY291bnQ7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhDb2xvdXJCdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKSB7XG4gIGNvbnN0IHZlcnRleENvbG91ckRhdGEgPSBbXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDAuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAwLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMC4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMS4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMC4wLCAgMS4wLFxuXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDAuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAwLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMS4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMC4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDAuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAwLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMC4wLCAgMS4wLCAgMS4wLFxuXG4gICAgICAgICAgMS4wLCAgMS4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDEuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAxLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMS4wLCAgMC4wLCAgMS4wXG4gICAgICAgIF0sXG4gICAgICAgIHZlcnRleENvbG91ckJ1ZmZlciA9IGNhbnZhcy5jcmVhdGVCdWZmZXIodmVydGV4Q29sb3VyRGF0YSksXG4gICAgICAgIHZlcnRleENvbG91ckF0dHJpYnV0ZUxvY2F0aW9uID0gY2FudmFzLmdldEF0dHJpYnV0ZUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICdhVmVydGV4Q29sb3VyJyksXG4gICAgICAgIHZlcnRleENvbG91ckNvbXBvbmVudHMgPSA0O1xuXG4gIGNhbnZhcy5iaW5kQnVmZmVyKHZlcnRleENvbG91ckJ1ZmZlciwgdmVydGV4Q29sb3VyQXR0cmlidXRlTG9jYXRpb24sIHZlcnRleENvbG91ckNvbXBvbmVudHMpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVBbmRCaW5kVGV4dHVyZUNvb3JkaW5hdGVCdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKSB7XG4gIGNvbnN0IHRleHR1cmVDb29yZGluYXRlRGF0YSA9IFtcbiAgICAgICAgICAwLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsXG5cbiAgICAgICAgICAwLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsXG5cbiAgICAgICAgICAwLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsXG5cbiAgICAgICAgICAwLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsXG5cbiAgICAgICAgICAwLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsXG5cbiAgICAgICAgICAwLjAsICAwLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjBcbiAgICAgICAgXSxcbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVCdWZmZXIgPSBjYW52YXMuY3JlYXRlQnVmZmVyKHRleHR1cmVDb29yZGluYXRlRGF0YSksXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlQXR0cmlidXRlTG9jYXRpb24gPSBjYW52YXMuZ2V0QXR0cmlidXRlTG9jYXRpb24oc2hhZGVyUHJvZ3JhbSwgJ2FUZXh0dXJlQ29vcmRpbmF0ZScpLFxuICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZUNvbXBvbmVudHMgPSAyO1xuXG4gIGNhbnZhcy5iaW5kQnVmZmVyKHRleHR1cmVDb29yZGluYXRlQnVmZmVyLCB0ZXh0dXJlQ29vcmRpbmF0ZUF0dHJpYnV0ZUxvY2F0aW9uLCB0ZXh0dXJlQ29vcmRpbmF0ZUNvbXBvbmVudHMpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVBbmRCaW5kVmVydGV4Tm9ybWFsQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSkge1xuICBjb25zdCB2ZXJ0ZXhOb3JtYWxEYXRhID0gW1xuICAgICAgICAgICAwLjAsICAwLjAsICsxLjAsXG4gICAgICAgICAgIDAuMCwgIDAuMCwgKzEuMCxcbiAgICAgICAgICAgMC4wLCAgMC4wLCArMS4wLFxuICAgICAgICAgICAwLjAsICAwLjAsICsxLjAsXG5cbiAgICAgICAgICAgMC4wLCAgMC4wLCAtMS4wLFxuICAgICAgICAgICAwLjAsICAwLjAsIC0xLjAsXG4gICAgICAgICAgIDAuMCwgIDAuMCwgLTEuMCxcbiAgICAgICAgICAgMC4wLCAgMC4wLCAtMS4wLFxuXG4gICAgICAgICAgIDAuMCwgKzEuMCwgIDAuMCxcbiAgICAgICAgICAgMC4wLCArMS4wLCAgMC4wLFxuICAgICAgICAgICAwLjAsICsxLjAsICAwLjAsXG4gICAgICAgICAgIDAuMCwgKzEuMCwgIDAuMCxcblxuICAgICAgICAgICAwLjAsIC0xLjAsICAwLjAsXG4gICAgICAgICAgIDAuMCwgLTEuMCwgIDAuMCxcbiAgICAgICAgICAgMC4wLCAtMS4wLCAgMC4wLFxuICAgICAgICAgICAwLjAsIC0xLjAsICAwLjAsXG5cbiAgICAgICAgICArMS4wLCAgMC4wLCAgMC4wLFxuICAgICAgICAgICsxLjAsICAwLjAsICAwLjAsXG4gICAgICAgICAgKzEuMCwgIDAuMCwgIDAuMCxcbiAgICAgICAgICArMS4wLCAgMC4wLCAgMC4wLFxuXG4gICAgICAgICAgLTEuMCwgIDAuMCwgIDAuMCxcbiAgICAgICAgICAtMS4wLCAgMC4wLCAgMC4wLFxuICAgICAgICAgIC0xLjAsICAwLjAsICAwLjAsXG4gICAgICAgICAgLTEuMCwgIDAuMCwgIDAuMFxuICAgICAgICBdLFxuICAgICAgICB2ZXJ0ZXhOb3JtYWxCdWZmZXIgPSBjYW52YXMuY3JlYXRlQnVmZmVyKHZlcnRleE5vcm1hbERhdGEpLFxuICAgICAgICB2ZXJ0ZXhOb3JtYWxBdHRyaWJ1dGVMb2NhdGlvbiA9IGNhbnZhcy5nZXRBdHRyaWJ1dGVMb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAnYVZlcnRleE5vcm1hbCcpLFxuICAgICAgICB2ZXJ0ZXhOb3JtYWxDb21wb25lbnRzID0gMztcblxuICBjYW52YXMuYmluZEJ1ZmZlcih2ZXJ0ZXhOb3JtYWxCdWZmZXIsIHZlcnRleE5vcm1hbEF0dHJpYnV0ZUxvY2F0aW9uLCB2ZXJ0ZXhOb3JtYWxDb21wb25lbnRzKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlVmVydGV4SW5kZXhFbGVtZW50QnVmZmVyKGNhbnZhcykge1xuICBjb25zdCB2ZXJ0ZXhJbmRleERhdGEgPSBbXG4gICAgICAgICAgIDAsICAxLCAgMixcbiAgICAgICAgICAgMCwgIDIsICAzLFxuXG4gICAgICAgICAgIDQsICA1LCAgNixcbiAgICAgICAgICAgNCwgIDYsICA3LFxuXG4gICAgICAgICAgIDgsICA5LCAxMCxcbiAgICAgICAgICAgOCwgMTAsIDExLFxuXG4gICAgICAgICAgMTIsIDEzLCAxNCxcbiAgICAgICAgICAxMiwgMTQsIDE1LFxuXG4gICAgICAgICAgMTYsIDE3LCAxOCxcbiAgICAgICAgICAxNiwgMTgsIDE5LFxuXG4gICAgICAgICAgMjAsIDIxLCAyMixcbiAgICAgICAgICAyMCwgMjIsIDIzXG4gICAgICAgIF0sXG4gICAgICAgIHZlcnRleEluZGV4RWxlbWVudEJ1ZmZlciA9IGNhbnZhcy5jcmVhdGVFbGVtZW50QnVmZmVyKHZlcnRleEluZGV4RGF0YSksXG4gICAgICAgIHZlcnRleEluZGV4RGF0YUxlbmd0aCA9IHZlcnRleEluZGV4RGF0YS5sZW5ndGgsXG4gICAgICAgIGNvdW50ID0gdmVydGV4SW5kZXhEYXRhTGVuZ3RoOyAgLy8vXG5cbiAgY2FudmFzLmJpbmRFbGVtZW50QnVmZmVyKHZlcnRleEluZGV4RWxlbWVudEJ1ZmZlcik7XG5cbiAgcmV0dXJuIGNvdW50O1xufVxuIl19