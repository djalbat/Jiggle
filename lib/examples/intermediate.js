'use strict';

var necessary = require('necessary');

var Canvas = require('../canvas'),
    Normal = require('../normal'),
    Rotation = require('../rotation'),
    Position = require('../position'),
    Perspective = require('../perspective'),
    ColourShader = require('../shader/colour'),
    TextureShader = require('../shader/texture'),
    imagesUtilities = require('../utilities/images'),
    ColourCube = require('./intermediate/cube/colour'),
    TextureCube = require('./intermediate/cube/texture');

var arrayUtilities = necessary.arrayUtilities,
    preload = imagesUtilities.preload,
    first = arrayUtilities.first;


function intermediate() {
  var canvas = new Canvas(),
      colourShader = ColourShader.fromNothing(canvas),
      textureShader = TextureShader.fromNothing(canvas);

  canvas.enableDepthTesting();
  canvas.enableDepthFunction();

  createColourCube(colourShader, canvas, function (colourCube) {
    createTextureCube(textureShader, canvas, function (textureCube) {
      var render = createRender(canvas, colourCube, colourShader, textureCube, textureShader);

      requestAnimationFrame(render);
    });
  });
}

module.exports = intermediate;

function createColourCube(colourShader, canvas, callback) {
  var offsetPosition = [-2, 0, 0],
      colourCube = ColourCube.fromOffsetPosition(offsetPosition, colourShader, canvas);

  callback(colourCube);
}

function createTextureCube(textureShader, canvas, callback) {
  var sources = ['texture/bricks.jpg'];

  preload(sources, function (images) {
    var firstImage = first(images),
        offsetPosition = [+2, 0, 0],
        image = firstImage,
        ///
    textureCube = TextureCube.fromOffsetPositionAndImage(offsetPosition, image, textureShader, canvas);

    callback(textureCube);
  });
}

function createRender(canvas, colourCube, colourShader, textureCube, textureShader) {
  var initialTime = null;

  var clientWidth = canvas.getClientWidth(),
      clientHeight = canvas.getClientHeight(),
      zCoordinate = -10,
      ///
  position = Position.fromZCoordinate(zCoordinate),
      perspective = Perspective.fromClientWidthAndClientHeight(clientWidth, clientHeight),
      colourCubeCount = colourCube.getCount(),
      textureCubeCount = textureCube.getCount();

  var render = function render(time) {
    if (initialTime === null) {
      initialTime = time;
    }

    var elapsedTime = time - initialTime,
        xAngle = elapsedTime / 573,
        yAngle = elapsedTime / 892,
        rotation = Rotation.fromXAngleAndYAngle(xAngle, yAngle),
        normal = Normal.fromRotation(rotation);

    canvas.clear();

    colourCube.bind(colourShader, canvas);

    canvas.useShader(colourShader);

    colourShader.activateTexture(canvas);

    canvas.render(colourShader, normal, rotation, position, perspective);

    canvas.drawElements(colourCubeCount);

    textureCube.bind(textureShader, canvas);

    canvas.useShader(textureShader);

    textureShader.activateTexture(canvas);

    canvas.render(textureShader, normal, rotation, position, perspective);

    canvas.drawElements(textureCubeCount);

    requestAnimationFrame(render);
  };

  return render;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9leGFtcGxlcy9pbnRlcm1lZGlhdGUuanMiXSwibmFtZXMiOlsibmVjZXNzYXJ5IiwicmVxdWlyZSIsIkNhbnZhcyIsIk5vcm1hbCIsIlJvdGF0aW9uIiwiUG9zaXRpb24iLCJQZXJzcGVjdGl2ZSIsIkNvbG91clNoYWRlciIsIlRleHR1cmVTaGFkZXIiLCJpbWFnZXNVdGlsaXRpZXMiLCJDb2xvdXJDdWJlIiwiVGV4dHVyZUN1YmUiLCJhcnJheVV0aWxpdGllcyIsInByZWxvYWQiLCJmaXJzdCIsImludGVybWVkaWF0ZSIsImNhbnZhcyIsImNvbG91clNoYWRlciIsImZyb21Ob3RoaW5nIiwidGV4dHVyZVNoYWRlciIsImVuYWJsZURlcHRoVGVzdGluZyIsImVuYWJsZURlcHRoRnVuY3Rpb24iLCJjcmVhdGVDb2xvdXJDdWJlIiwiY29sb3VyQ3ViZSIsImNyZWF0ZVRleHR1cmVDdWJlIiwidGV4dHVyZUN1YmUiLCJyZW5kZXIiLCJjcmVhdGVSZW5kZXIiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJtb2R1bGUiLCJleHBvcnRzIiwiY2FsbGJhY2siLCJvZmZzZXRQb3NpdGlvbiIsImZyb21PZmZzZXRQb3NpdGlvbiIsInNvdXJjZXMiLCJpbWFnZXMiLCJmaXJzdEltYWdlIiwiaW1hZ2UiLCJmcm9tT2Zmc2V0UG9zaXRpb25BbmRJbWFnZSIsImluaXRpYWxUaW1lIiwiY2xpZW50V2lkdGgiLCJnZXRDbGllbnRXaWR0aCIsImNsaWVudEhlaWdodCIsImdldENsaWVudEhlaWdodCIsInpDb29yZGluYXRlIiwicG9zaXRpb24iLCJmcm9tWkNvb3JkaW5hdGUiLCJwZXJzcGVjdGl2ZSIsImZyb21DbGllbnRXaWR0aEFuZENsaWVudEhlaWdodCIsImNvbG91ckN1YmVDb3VudCIsImdldENvdW50IiwidGV4dHVyZUN1YmVDb3VudCIsInRpbWUiLCJlbGFwc2VkVGltZSIsInhBbmdsZSIsInlBbmdsZSIsInJvdGF0aW9uIiwiZnJvbVhBbmdsZUFuZFlBbmdsZSIsIm5vcm1hbCIsImZyb21Sb3RhdGlvbiIsImNsZWFyIiwiYmluZCIsInVzZVNoYWRlciIsImFjdGl2YXRlVGV4dHVyZSIsImRyYXdFbGVtZW50cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsWUFBWUMsUUFBUSxXQUFSLENBQWxCOztBQUVBLElBQU1DLFNBQVNELFFBQVEsV0FBUixDQUFmO0FBQUEsSUFDTUUsU0FBU0YsUUFBUSxXQUFSLENBRGY7QUFBQSxJQUVNRyxXQUFXSCxRQUFRLGFBQVIsQ0FGakI7QUFBQSxJQUdNSSxXQUFXSixRQUFRLGFBQVIsQ0FIakI7QUFBQSxJQUlNSyxjQUFjTCxRQUFRLGdCQUFSLENBSnBCO0FBQUEsSUFLTU0sZUFBZU4sUUFBUSxrQkFBUixDQUxyQjtBQUFBLElBTU1PLGdCQUFnQlAsUUFBUSxtQkFBUixDQU50QjtBQUFBLElBT01RLGtCQUFrQlIsUUFBUSxxQkFBUixDQVB4QjtBQUFBLElBUU1TLGFBQWFULFFBQVEsNEJBQVIsQ0FSbkI7QUFBQSxJQVNNVSxjQUFjVixRQUFRLDZCQUFSLENBVHBCOztBQVdNLElBQUVXLGNBQUYsR0FBcUJaLFNBQXJCLENBQUVZLGNBQUY7QUFBQSxJQUNFQyxPQURGLEdBQ2NKLGVBRGQsQ0FDRUksT0FERjtBQUFBLElBRUVDLEtBRkYsR0FFWUYsY0FGWixDQUVFRSxLQUZGOzs7QUFJTixTQUFTQyxZQUFULEdBQXdCO0FBQ3RCLE1BQU1DLFNBQVMsSUFBSWQsTUFBSixFQUFmO0FBQUEsTUFDTWUsZUFBZVYsYUFBYVcsV0FBYixDQUF5QkYsTUFBekIsQ0FEckI7QUFBQSxNQUVNRyxnQkFBZ0JYLGNBQWNVLFdBQWQsQ0FBMEJGLE1BQTFCLENBRnRCOztBQUlBQSxTQUFPSSxrQkFBUDtBQUNBSixTQUFPSyxtQkFBUDs7QUFFQUMsbUJBQWlCTCxZQUFqQixFQUErQkQsTUFBL0IsRUFBdUMsVUFBU08sVUFBVCxFQUFxQjtBQUMxREMsc0JBQWtCTCxhQUFsQixFQUFpQ0gsTUFBakMsRUFBeUMsVUFBU1MsV0FBVCxF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QWlCM0MsYUFBakI7O0FBRUFBLGtCQUFjNEMsZUFBZCxDQUE4Qi9DLE1BQTlCOztBQUVBQSxXQUFPVSxNQUFQLENBQWNQLGFBQWQsRUFBNkJ1QyxNQUE3QixFQUFxQ0YsUUFBckMsRUFBK0NYLFFBQS9DLEVBQXlERSxXQUF6RDs7QUFFQS9CLFdBQU9nRCxZQUFQLENBQW9CYixnQkFBcEI7O0FBS0F2QiwwQkFBc0JGLE1BQXRCO0FBQ0QsR0ExQ0Q7O0FBNENBLFNBQU9BLE1BQVA7QUFDRCIsImZpbGUiOiJpbnRlcm1lZGlhdGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IG5lY2Vzc2FyeSA9IHJlcXVpcmUoJ25lY2Vzc2FyeScpO1xuXG5jb25zdCBDYW52YXMgPSByZXF1aXJlKCcuLi9jYW52YXMnKSxcbiAgICAgIE5vcm1hbCA9IHJlcXVpcmUoJy4uL25vcm1hbCcpLFxuICAgICAgUm90YXRpb24gPSByZXF1aXJlKCcuLi9yb3RhdGlvbicpLFxuICAgICAgUG9zaXRpb24gPSByZXF1aXJlKCcuLi9wb3NpdGlvbicpLFxuICAgICAgUGVyc3BlY3RpdmUgPSByZXF1aXJlKCcuLi9wZXJzcGVjdGl2ZScpLFxuICAgICAgQ29sb3VyU2hhZGVyID0gcmVxdWlyZSgnLi4vc2hhZGVyL2NvbG91cicpLFxuICAgICAgVGV4dHVyZVNoYWRlciA9IHJlcXVpcmUoJy4uL3NoYWRlci90ZXh0dXJlJyksXG4gICAgICBpbWFnZXNVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvaW1hZ2VzJyksXG4gICAgICBDb2xvdXJDdWJlID0gcmVxdWlyZSgnLi9pbnRlcm1lZGlhdGUvY3ViZS9jb2xvdXInKSxcbiAgICAgIFRleHR1cmVDdWJlID0gcmVxdWlyZSgnLi9pbnRlcm1lZGlhdGUvY3ViZS90ZXh0dXJlJyk7XG5cbmNvbnN0IHsgYXJyYXlVdGlsaXRpZXMgfSA9IG5lY2Vzc2FyeSxcbiAgICAgIHsgcHJlbG9hZCB9ID0gaW1hZ2VzVXRpbGl0aWVzLFxuICAgICAgeyBmaXJzdCB9ID0gYXJyYXlVdGlsaXRpZXM7XG5cbmZ1bmN0aW9uIGludGVybWVkaWF0ZSgpIHtcbiAgY29uc3QgY2FudmFzID0gbmV3IENhbnZhcygpLFxuICAgICAgICBjb2xvdXJTaGFkZXIgPSBDb2xvdXJTaGFkZXIuZnJvbU5vdGhpbmcoY2FudmFzKSxcbiAgICAgICAgdGV4dHVyZVNoYWRlciA9IFRleHR1cmVTaGFkZXIuZnJvbU5vdGhpbmcoY2FudmFzKTtcblxuICBjYW52YXMuZW5hYmxlRGVwdGhUZXN0aW5nKCk7XG4gIGNhbnZhcy5lbmFibGVEZXB0aEZ1bmN0aW9uKCk7XG5cbiAgY3JlYXRlQ29sb3VyQ3ViZShjb2xvdXJTaGFkZXIsIGNhbnZhcywgZnVuY3Rpb24oY29sb3VyQ3ViZSkge1xuICAgIGNyZWF0ZVRleHR1cmVDdWJlKHRleHR1cmVTaGFkZXIsIGNhbnZhcywgZnVuY3Rpb24odGV4dHVyZUN1YmUpIHtcbiAgICAgIGNvbnN0IHJlbmRlciA9IGNyZWF0ZVJlbmRlcihjYW52YXMsIGNvbG91ckN1YmUsIGNvbG91clNoYWRlciwgdGV4dHVyZUN1YmUsIHRleHR1cmVTaGFkZXIpO1xuXG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVuZGVyKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gaW50ZXJtZWRpYXRlO1xuXG5mdW5jdGlvbiBjcmVhdGVDb2xvdXJDdWJlKGNvbG91clNoYWRlciwgY2FudmFzLCBjYWxsYmFjaykge1xuICBjb25zdCBvZmZzZXRQb3NpdGlvbiA9IFstMiwgMCwgMF0sXG4gICAgICAgIGNvbG91ckN1YmUgPSBDb2xvdXJDdWJlLmZyb21PZmZzZXRQb3NpdGlvbihvZmZzZXRQb3NpdGlvbiwgY29sb3VyU2hhZGVyLCBjYW52YXMpO1xuXG4gIGNhbGxiYWNrKGNvbG91ckN1YmUpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVUZXh0dXJlQ3ViZSh0ZXh0dXJlU2hhZGVyLCBjYW52YXMsIGNhbGxiYWNrKSB7XG4gIGNvbnN0IHNvdXJjZXMgPSBbXG4gICAgICAgICAgJ3RleHR1cmUvYnJpY2tzLmpwZydcbiAgICAgICAgXTtcblxuICBwcmVsb2FkKHNvdXJjZXMsIGZ1bmN0aW9uKGltYWdlcykge1xuICAgIGNvbnN0IGZpcnN0SW1hZ2UgPSBmaXJzdChpbWFnZXMpLFxuICAgICAgICAgIG9mZnNldFBvc2l0aW9uID0gWysyLCAwLCAwXSxcbiAgICAgICAgICBpbWFnZSA9IGZpcnN0SW1hZ2UsIC8vL1xuICAgICAgICAgIHRleHR1cmVDdWJlID0gVGV4dHVyZUN1YmUuZnJvbU9mZnNldFBvc2l0aW9uQW5kSW1hZ2Uob2Zmc2V0UG9zaXRpb24sIGltYWdlLCB0ZXh0dXJlU2hhZGVyLCBjYW52YXMpO1xuXG4gICAgY2FsbGJhY2sodGV4dHVyZUN1YmUpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlUmVuZGVyKGNhbnZhcywgY29sb3VyQ3ViZSwgY29sb3VyU2hhZGVyLCB0ZXh0dXJlQ3ViZSwgdGV4dHVyZVNoYWRlcikge1xuICBsZXQgaW5pdGlhbFRpbWUgPSBudWxsO1xuXG4gIGNvbnN0IGNsaWVudFdpZHRoID0gY2FudmFzLmdldENsaWVudFdpZHRoKCksXG4gICAgICAgIGNsaWVudEhlaWdodCA9IGNhbnZhcy5nZXRDbGllbnRIZWlnaHQoKSxcbiAgICAgICAgekNvb3JkaW5hdGUgPSAtMTAsIC8vL1xuICAgICAgICBwb3NpdGlvbiA9IFBvc2l0aW9uLmZyb21aQ29vcmRpbmF0ZSh6Q29vcmRpbmF0ZSksXG4gICAgICAgIHBlcnNwZWN0aXZlID0gUGVyc3BlY3RpdmUuZnJvbUNsaWVudFdpZHRoQW5kQ2xpZW50SGVpZ2h0KGNsaWVudFdpZHRoLCBjbGllbnRIZWlnaHQpLFxuICAgICAgICBjb2xvdXJDdWJlQ291bnQgPSBjb2xvdXJDdWJlLmdldENvdW50KCksXG4gICAgICAgIHRleHR1cmVDdWJlQ291bnQgPSB0ZXh0dXJlQ3ViZS5nZXRDb3VudCgpO1xuXG4gIGNvbnN0IHJlbmRlciA9ICh0aW1lKSA9PiB7XG4gICAgaWYgKGluaXRpYWxUaW1lID09PSBudWxsKSB7XG4gICAgICBpbml0aWFsVGltZSA9IHRpbWU7XG4gICAgfVxuXG4gICAgY29uc3QgZWxhcHNlZFRpbWUgPSB0aW1lIC0gaW5pdGlhbFRpbWUsXG4gICAgICAgICAgeEFuZ2xlID0gZWxhcHNlZFRpbWUgLyA1NzMsXG4gICAgICAgICAgeUFuZ2xlID0gZWxhcHNlZFRpbWUgLyA4OTIsXG4gICAgICAgICAgcm90YXRpb24gPSBSb3RhdGlvbi5mcm9tWEFuZ2xlQW5kWUFuZ2xlKHhBbmdsZSwgeUFuZ2xlKSxcbiAgICAgICAgICBub3JtYWwgPSBOb3JtYWwuZnJvbVJvdGF0aW9uKHJvdGF0aW9uKTtcblxuICAgIGNhbnZhcy5jbGVhcigpO1xuXG5cblxuICAgIGNvbG91ckN1YmUuYmluZChjb2xvdXJTaGFkZXIsIGNhbnZhcyk7XG5cbiAgICBjYW52YXMudXNlU2hhZGVyKGNvbG91clNoYWRlcik7XG5cbiAgICBjb2xvdXJTaGFkZXIuYWN0aXZhdGVUZXh0dXJlKGNhbnZhcyk7XG5cbiAgICBjYW52YXMucmVuZGVyKGNvbG91clNoYWRlciwgbm9ybWFsLCByb3RhdGlvbiwgcG9zaXRpb24sIHBlcnNwZWN0aXZlKTtcblxuICAgIGNhbnZhcy5kcmF3RWxlbWVudHMoY29sb3VyQ3ViZUNvdW50KTtcblxuXG5cblxuICAgIHRleHR1cmVDdWJlLmJpbmQodGV4dHVyZVNoYWRlciwgY2FudmFzKTtcblxuICAgIGNhbnZhcy51c2VTaGFkZXIodGV4dHVyZVNoYWRlcik7XG5cbiAgICB0ZXh0dXJlU2hhZGVyLmFjdGl2YXRlVGV4dHVyZShjYW52YXMpO1xuXG4gICAgY2FudmFzLnJlbmRlcih0ZXh0dXJlU2hhZGVyLCBub3JtYWwsIHJvdGF0aW9uLCBwb3NpdGlvbiwgcGVyc3BlY3RpdmUpO1xuXG4gICAgY2FudmFzLmRyYXdFbGVtZW50cyh0ZXh0dXJlQ3ViZUNvdW50KTtcblxuXG5cblxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpO1xuICB9O1xuXG4gIHJldHVybiByZW5kZXI7XG59XG4iXX0=