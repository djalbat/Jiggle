'use strict';

var necessary = require('necessary');

var Canvas = require('../canvas'),
    Normal = require('../normal'),
    Rotation = require('../rotation'),
    Position = require('../position'),
    Perspective = require('../perspective'),
    colourCube = require('./intermediate/cube/colour'),
    textureCube = require('./intermediate/cube/texture');

var arrayUtilities = necessary.arrayUtilities,
    asynchronousUtilities = necessary.asynchronousUtilities,
    first = arrayUtilities.first,
    repeatedly = asynchronousUtilities.repeatedly;


function intermediate() {
  var canvas = new Canvas();

  canvas.enableDepthTesting();
  canvas.enableDepthFunction();

  loadImages(function (images) {
    var firstImage = first(images),
        offsetPosition = [+1, 0, 0],
        image = firstImage; ///

    textureCube(offsetPosition, image, canvas, function (count, shader) {
      var render = createRender(canvas, count, shader);

      requestAnimationFrame(render);
    });
  });

  // const offsetPosition = [-1, 0, 0];
  //
  // colourCube(offsetPosition, canvas, function(count, shader) {
  //   const render = createRender(canvas, count, shader);
  //
  //   requestAnimationFrame(render);
  // });
}

module.exports = intermediate;

function loadImages(callback) {
  var imageSources = ['texture/bricks.jpg'],
      images = [],
      context = {
    imageSources: imageSources,
    images: images
  },
      length = imageSources.length; ///

  repeatedly(loadImageCallback, length, function () {
    var images = context.images;


    callback(images);
  }, context);
}

function createRender(canvas, count, shader) {
  var initialTime = null;

  var clientWidth = canvas.getClientWidth(),
      clientHeight = canvas.getClientHeight(),
      zCoordinate = -10,
      ///
  position = Position.fromZCoordinate(zCoordinate),
      perspective = Perspective.fromClientWidthAndClientHeight(clientWidth, clientHeight);

  var render = function render(time) {
    if (initialTime === null) {
      initialTime = time;
    }

    var elapsedTime = time - initialTime,

    // xAngle = elapsedTime / 1000,
    // yAngle = elapsedTime / 1000,
    // rotation = Rotation.fromXAngleAndYAngle(xAngle, yAngle),
    rotation = Rotation.fromNothing(),
        normal = Normal.fromRotation(rotation);

    canvas.render(shader, normal, rotation, position, perspective);

    canvas.drawElements(count);

    requestAnimationFrame(render);
  };

  return render;
}

function loadImageCallback(next, done, context, index) {
  var imageSources = context.imageSources,
      images = context.images,
      imageSource = imageSources[index],
      image = new Image();


  images[index] = image;

  image.onload = next; ///

  image.src = imageSource; ///
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9leGFtcGxlcy9pbnRlcm1lZGlhdGUuanMiXSwibmFtZXMiOlsibmVjZXNzYXJ5IiwicmVxdWlyZSIsIkNhbnZhcyIsIk5vcm1hbCIsIlJvdGF0aW9uIiwiUG9zaXRpb24iLCJQZXJzcGVjdGl2ZSIsImNvbG91ckN1YmUiLCJ0ZXh0dXJlQ3ViZSIsImFycmF5VXRpbGl0aWVzIiwiYXN5bmNocm9ub3VzVXRpbGl0aWVzIiwiZmlyc3QiLCJyZXBlYXRlZGx5IiwiaW50ZXJtZWRpYXRlIiwiY2FudmFzIiwiZW5hYmxlRGVwdGhUZXN0aW5nIiwiZW5hYmxlRGVwdGhGdW5jdGlvbiIsImxvYWRJbWFnZXMiLCJpbWFnZXMiLCJmaXJzdEltYWdlIiwib2Zmc2V0UG9zaXRpb24iLCJpbWFnZSIsImNvdW50Iiwic2hhZGVyIiwicmVuZGVyIiwiY3JlYXRlUmVuZGVyIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwibW9kdWxlIiwiZXhwb3J0cyIsImNhbGxiYWNrIiwiaW1hZ2VTb3VyY2VzIiwiY29udGV4dCIsImxlbmd0aCIsImxvYWRJbWFnZUNhbGxiYWNrIiwiaW5pdGlhbFRpbWUiLCJjbGllbnRXaWR0aCIsImdldENsaWVudFdpZHRoIiwiY2xpZW50SGVpZ2h0IiwiZ2V0Q2xpZW50SGVpZ2h0IiwiekNvb3JkaW5hdGUiLCJwb3NpdGlvbiIsImZyb21aQ29vcmRpbmF0ZSIsInBlcnNwZWN0aXZlIiwiZnJvbUNsaWVudFdpZHRoQW5kQ2xpZW50SGVpZ2h0IiwidGltZSIsImVsYXBzZWRUaW1lIiwicm90YXRpb24iLCJmcm9tTm90aGluZyIsIm5vcm1hbCIsImZyb21Sb3RhdGlvbiIsImRyYXdFbGVtZW50cyIsIm5leHQiLCJkb25lIiwiaW5kZXgiLCJpbWFnZVNvdXJjZSIsIkltYWdlIiwib25sb2FkIiwic3JjIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxZQUFZQyxRQUFRLFdBQVIsQ0FBbEI7O0FBRUEsSUFBTUMsU0FBU0QsUUFBUSxX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QXNCRixNQUF0QjtBQUNELEdBakJEOztBQW1CQSxTQUFPQSxNQUFQO0FBQ0Q7O0FBRUQsU0FBU1MsaUJBQVQsQ0FBMkJrQixJQUEzQixFQUFpQ0MsSUFBakMsRUFBdUNyQixPQUF2QyxFQUFnRHNCLEtBQWhELEVBQXVEO0FBQUEsTUFDN0N2QixZQUQ2QyxHQUNwQkMsT0FEb0IsQ0FDN0NELFlBRDZDO0FBQUEsTUFDL0JaLE1BRCtCLEdBQ3BCYSxPQURvQixDQUMvQmIsTUFEK0I7QUFBQSxNQUUvQ29DLFdBRitDLEdBRWpDeEIsYUFBYXVCLEtBQWIsQ0FGaUM7QUFBQSxNQUcvQ2hDLEtBSCtDLEdBR3ZDLElBQUlrQyxLQUFKLEVBSHVDOzs7QUFLckRyQyxTQUFPbUMsS0FBUCxJQUFnQmhDLEtBQWhCOztBQUVBQSxRQUFNbUMsTUFBTixHQUFlTCxJQUFmLENBUHFELENBTy9COztBQUV0QjlCLFFBQU1vQyxHQUFOLEdBQVlILFdBQVosQ0FUcUQsQ0FTM0I7QUFDM0IiLCJmaWxlIjoiaW50ZXJtZWRpYXRlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBuZWNlc3NhcnkgPSByZXF1aXJlKCduZWNlc3NhcnknKTtcblxuY29uc3QgQ2FudmFzID0gcmVxdWlyZSgnLi4vY2FudmFzJyksXG4gICAgICBOb3JtYWwgPSByZXF1aXJlKCcuLi9ub3JtYWwnKSxcbiAgICAgIFJvdGF0aW9uID0gcmVxdWlyZSgnLi4vcm90YXRpb24nKSxcbiAgICAgIFBvc2l0aW9uID0gcmVxdWlyZSgnLi4vcG9zaXRpb24nKSxcbiAgICAgIFBlcnNwZWN0aXZlID0gcmVxdWlyZSgnLi4vcGVyc3BlY3RpdmUnKSxcbiAgICAgIGNvbG91ckN1YmUgPSByZXF1aXJlKCcuL2ludGVybWVkaWF0ZS9jdWJlL2NvbG91cicpLFxuICAgICAgdGV4dHVyZUN1YmUgPSByZXF1aXJlKCcuL2ludGVybWVkaWF0ZS9jdWJlL3RleHR1cmUnKTtcblxuY29uc3QgeyBhcnJheVV0aWxpdGllcywgYXN5bmNocm9ub3VzVXRpbGl0aWVzIH0gPSBuZWNlc3NhcnksXG4gICAgICB7IGZpcnN0IH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgcmVwZWF0ZWRseSB9ID0gYXN5bmNocm9ub3VzVXRpbGl0aWVzO1xuXG5mdW5jdGlvbiBpbnRlcm1lZGlhdGUoKSB7XG4gIGNvbnN0IGNhbnZhcyA9IG5ldyBDYW52YXMoKTtcblxuICBjYW52YXMuZW5hYmxlRGVwdGhUZXN0aW5nKCk7XG4gIGNhbnZhcy5lbmFibGVEZXB0aEZ1bmN0aW9uKCk7XG5cbiAgbG9hZEltYWdlcyhmdW5jdGlvbihpbWFnZXMpIHtcbiAgICBjb25zdCBmaXJzdEltYWdlID0gZmlyc3QoaW1hZ2VzKSxcbiAgICAgICAgICBvZmZzZXRQb3NpdGlvbiA9IFsrMSwgMCwgMF0sXG4gICAgICAgICAgaW1hZ2UgPSBmaXJzdEltYWdlOyAvLy9cblxuICAgIHRleHR1cmVDdWJlKG9mZnNldFBvc2l0aW9uLCBpbWFnZSwgY2FudmFzLCBmdW5jdGlvbihjb3VudCwgc2hhZGVyKSB7XG4gICAgICBjb25zdCByZW5kZXIgPSBjcmVhdGVSZW5kZXIoY2FudmFzLCBjb3VudCwgc2hhZGVyKTtcblxuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlbmRlcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIGNvbnN0IG9mZnNldFBvc2l0aW9uID0gWy0xLCAwLCAwXTtcbiAgLy9cbiAgLy8gY29sb3VyQ3ViZShvZmZzZXRQb3NpdGlvbiwgY2FudmFzLCBmdW5jdGlvbihjb3VudCwgc2hhZGVyKSB7XG4gIC8vICAgY29uc3QgcmVuZGVyID0gY3JlYXRlUmVuZGVyKGNhbnZhcywgY291bnQsIHNoYWRlcik7XG4gIC8vXG4gIC8vICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlbmRlcik7XG4gIC8vIH0pO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGludGVybWVkaWF0ZTtcblxuZnVuY3Rpb24gbG9hZEltYWdlcyhjYWxsYmFjaykge1xuICBjb25zdCBpbWFnZVNvdXJjZXMgPSBbXG4gICAgICAgICAgJ3RleHR1cmUvYnJpY2tzLmpwZydcbiAgICAgICAgXSxcbiAgICAgICAgaW1hZ2VzID0gW10sXG4gICAgICAgIGNvbnRleHQgPSB7XG4gICAgICAgICAgaW1hZ2VTb3VyY2VzOiBpbWFnZVNvdXJjZXMsXG4gICAgICAgICAgaW1hZ2VzOiBpbWFnZXNcbiAgICAgICAgfSxcbiAgICAgICAgbGVuZ3RoID0gaW1hZ2VTb3VyY2VzLmxlbmd0aDsgLy8vXG5cbiAgcmVwZWF0ZWRseShsb2FkSW1hZ2VDYWxsYmFjaywgbGVuZ3RoLCBmdW5jdGlvbigpIHtcbiAgICBjb25zdCB7IGltYWdlcyB9ID0gY29udGV4dDtcblxuICAgIGNhbGxiYWNrKGltYWdlcylcbiAgfSwgY29udGV4dCk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVJlbmRlcihjYW52YXMsIGNvdW50LCBzaGFkZXIpIHtcbiAgbGV0IGluaXRpYWxUaW1lID0gbnVsbDtcblxuICBjb25zdCBjbGllbnRXaWR0aCA9IGNhbnZhcy5nZXRDbGllbnRXaWR0aCgpLFxuICAgICAgICBjbGllbnRIZWlnaHQgPSBjYW52YXMuZ2V0Q2xpZW50SGVpZ2h0KCksXG4gICAgICAgIHpDb29yZGluYXRlID0gLTEwLCAvLy9cbiAgICAgICAgcG9zaXRpb24gPSBQb3NpdGlvbi5mcm9tWkNvb3JkaW5hdGUoekNvb3JkaW5hdGUpLFxuICAgICAgICBwZXJzcGVjdGl2ZSA9IFBlcnNwZWN0aXZlLmZyb21DbGllbnRXaWR0aEFuZENsaWVudEhlaWdodChjbGllbnRXaWR0aCwgY2xpZW50SGVpZ2h0KTtcblxuICBjb25zdCByZW5kZXIgPSAodGltZSkgPT4ge1xuICAgIGlmIChpbml0aWFsVGltZSA9PT0gbnVsbCkge1xuICAgICAgaW5pdGlhbFRpbWUgPSB0aW1lO1xuICAgIH1cblxuICAgIGNvbnN0IGVsYXBzZWRUaW1lID0gdGltZSAtIGluaXRpYWxUaW1lLFxuICAgICAgICAgIC8vIHhBbmdsZSA9IGVsYXBzZWRUaW1lIC8gMTAwMCxcbiAgICAgICAgICAvLyB5QW5nbGUgPSBlbGFwc2VkVGltZSAvIDEwMDAsXG4gICAgICAgICAgLy8gcm90YXRpb24gPSBSb3RhdGlvbi5mcm9tWEFuZ2xlQW5kWUFuZ2xlKHhBbmdsZSwgeUFuZ2xlKSxcbiAgICAgICAgICByb3RhdGlvbiA9IFJvdGF0aW9uLmZyb21Ob3RoaW5nKCksXG4gICAgICAgICAgbm9ybWFsID0gTm9ybWFsLmZyb21Sb3RhdGlvbihyb3RhdGlvbik7XG5cbiAgICBjYW52YXMucmVuZGVyKHNoYWRlciwgbm9ybWFsLCByb3RhdGlvbiwgcG9zaXRpb24sIHBlcnNwZWN0aXZlKTtcblxuICAgIGNhbnZhcy5kcmF3RWxlbWVudHMoY291bnQpO1xuXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlbmRlcik7XG4gIH07XG5cbiAgcmV0dXJuIHJlbmRlcjtcbn1cblxuZnVuY3Rpb24gbG9hZEltYWdlQ2FsbGJhY2sobmV4dCwgZG9uZSwgY29udGV4dCwgaW5kZXgpIHtcbiAgY29uc3QgeyBpbWFnZVNvdXJjZXMsIGltYWdlcyB9ID0gY29udGV4dCxcbiAgICAgICAgaW1hZ2VTb3VyY2UgPSBpbWFnZVNvdXJjZXNbaW5kZXhdLFxuICAgICAgICBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuXG4gIGltYWdlc1tpbmRleF0gPSBpbWFnZTtcblxuICBpbWFnZS5vbmxvYWQgPSBuZXh0OyAgLy8vXG5cbiAgaW1hZ2Uuc3JjID0gaW1hZ2VTb3VyY2U7ICAvLy9cbn1cbiJdfQ==