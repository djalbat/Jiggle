'use strict';

var Canvas = require('../canvas'),
    ModelView = require('../modelView'),
    Projection = require('../projection');

var intermediate = function intermediate() {
  var canvas = new Canvas(),
      context = canvas.getContext();

  if (!context) {
    return;
  }

  var vertexShaderSource = '\n          attribute vec4 aVertexPosition;\n          attribute vec4 aVertexColour;\n          \n          uniform mat4 uModelViewMatrix;\n          uniform mat4 uProjectionMatrix;\n          \n          varying lowp vec4 vColour;\n      \n          void main() {\n            gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;\n            vColour = aVertexColour;\n          }\n        ',
      fragmentShaderSource = '\n          varying lowp vec4 vColour;\n\n          void main() {\n            gl_FragColor = vColour;\n          }\n        ',
      shaderProgram = canvas.createShaderProgram(vertexShaderSource, fragmentShaderSource),
      clientWidth = canvas.getClientWidth(),
      clientHeight = canvas.getClientHeight(),
      projection = new Projection(clientWidth, clientHeight),
      modelView = new ModelView();

  var count = createAndBindVertexPositionBuffer(canvas, shaderProgram);

  createAndBindVertexColourBuffer(canvas, shaderProgram);

  createVertexIndexElementBuffer(canvas);

  canvas.useProgram(shaderProgram);

  var initialTime = null;

  function render(time) {
    if (initialTime === null) {
      initialTime = time;
    }

    var elapsedTime = time - initialTime;

    canvas.render(shaderProgram, projection, modelView, elapsedTime);

    canvas.draw(count);

    ///    requestAnimationFrame(render);
  }

  requestAnimationFrame(render);
};

module.exports = intermediate;

function createAndBindVertexPositionBuffer(canvas, shaderProgram) {
  var vertexPositionData = [+1.0, +1.0, +1.0, -1.0, +1.0, +1.0, +1.0, -1.0, +1.0],
      vertexPositionBuffer = canvas.createBuffer(vertexPositionData),
      vertexPositionAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexPosition'),
      vertexPositionComponents = 3;

  canvas.bindBuffer(vertexPositionBuffer, vertexPositionAttributeLocation, vertexPositionComponents);

  var vertexPositionDataLength = vertexPositionData.length,
      count = vertexPositionDataLength / vertexPositionComponents;

  return count;
}

function createAndBindVertexColourBuffer(canvas, shaderProgram) {
  var vertexColourData = [1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0],
      vertexColourBuffer = canvas.createBuffer(vertexColourData),
      vertexColourAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexColour'),
      vertexColourComponents = 4;

  canvas.bindBuffer(vertexColourBuffer, vertexColourAttributeLocation, vertexColourComponents);
}

function createVertexIndexElementBuffer(canvas) {
  var vertexIndexData = [0, 1, 2],
      vertexIndexElementBuffer = canvas.createElementBuffer(vertexIndexData);

  canvas.bindElementBuffer(vertexIndexElementBuffer);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9leGFtcGxlcy9pbnRlcm1lZGlhdGUuanMiXSwibmFtZXMiOlsiQ2FudmFzIiwicmVxdWlyZSIsIk1vZGVsVmlldyIsIlByb2plY3Rpb24iLCJpbnRlcm1lZGlhdGUiLCJjYW52YXMiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsInZlcnRleFNoYWRlclNvdXJjZSIsImZyYWdtZW50U2hhZGVyU291cmNlIiwic2hhZGVyUHJvZ3JhbSIsImNyZWF0ZVNoYWRlclByb2dyYW0iLCJjbGllbnRXaWR0aCIsImdldENsaWVudFdpZHRoIiwiY2xpZW50SGVpZ2h0IiwiZ2V0Q2xpZW50SGVpZ2h0IiwicHJvamVjdGlvbiIsIm1vZGVsVmlldyIsImNvdW50IiwiY3JlYXRlQW5kQmluZFZlcnRleFBvc2l0aW9uQnVmZmVyIiwiY3JlYXRlQW5kQmluZFZlcnRleENvbG91ckJ1ZmZlciIsImNyZWF0ZVZlcnRleEluZGV4RWxlbWVudEJ1ZmZlciIsInVzZVByb2dyYW0iLCJpbml0aWFsVGltZSIsInJlbmRlciIsInRpbWUiLCJlbGFwc2VkVGltZSIsImRyYXciLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJtb2R1bGUiLCJleHBvcnRzIiwidmVydGV4UG9zaXRpb25EYXRhIiwidmVydGV4UG9zaXRpb25CdWZmZXIiLCJjcmVhdGVCdWZmZXIiLCJ2ZXJ0ZXhQb3NpdGlvbkF0dHJpYnV0ZUxvY2F0aW9uIiwiZ2V0QXR0cmlidXRlTG9jYXRpb24iLCJ2ZXJ0ZXhQb3NpdGlvbkNvbXBvbmVudHMiLCJiaW5kQnVmZmVyIiwidmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoIiwibGVuZ3RoIiwidmVydGV4Q29sb3VyRGF0YSIsInZlcnRleENvbG91ckJ1ZmZlciIsInZlcnRleENvbG91ckF0dHJpYnV0ZUxvY2F0aW9uIiwidmVydGV4Q29sb3VyQ29tcG9uZW50cyIsInZlcnRleEluZGV4RGF0YSIsInZlcnRleEluZGV4RWxlbWVudEJ1ZmZlciIsImNyZWF0ZUVsZW1lbnRC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TzhCLG9CQUFQLENBQTRCekIsYUFBNUIsRUFBMkMsZUFBM0MsQ0FOdEM7QUFBQSxNQU9NaUMseUJBQXlCLENBUC9COztBQVNBdEMsU0FBT2dDLFVBQVAsQ0FBa0JJLGtCQUFsQixFQUFzQ0MsNkJBQXRDLEVBQXFFQyxzQkFBckU7QUFDRDs7QUFFRCxTQUFTdEIsOEJBQVQsQ0FBd0NoQixNQUF4QyxFQUFnRDtBQUM5QyxNQUFNdUMsa0JBQWtCLENBQ2hCLENBRGdCLEVBQ2IsQ0FEYSxFQUNWLENBRFUsQ0FBeEI7QUFBQSxNQUdNQywyQkFBMkJ4QyxPQUFPeUMsbUJBQVAsQ0FBMkJGLGVBQTNCLENBSGpDOztBQUtBdkMsU0FBTzBDLGlCQUFQLENBQXlCRix3QkFBekI7QUFDRCIsImZpbGUiOiJpbnRlcm1lZGlhdGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IENhbnZhcyA9IHJlcXVpcmUoJy4uL2NhbnZhcycpLFxuICAgICAgTW9kZWxWaWV3ID0gcmVxdWlyZSgnLi4vbW9kZWxWaWV3JyksXG4gICAgICBQcm9qZWN0aW9uID0gcmVxdWlyZSgnLi4vcHJvamVjdGlvbicpO1xuXG5jb25zdCBpbnRlcm1lZGlhdGUgPSAoKSA9PiB7XG4gIGNvbnN0IGNhbnZhcyA9IG5ldyBDYW52YXMoKSxcbiAgICAgICAgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCk7XG5cbiAgaWYgKCFjb250ZXh0KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgdmVydGV4U2hhZGVyU291cmNlID0gYFxuICAgICAgICAgIGF0dHJpYnV0ZSB2ZWM0IGFWZXJ0ZXhQb3NpdGlvbjtcbiAgICAgICAgICBhdHRyaWJ1dGUgdmVjNCBhVmVydGV4Q29sb3VyO1xuICAgICAgICAgIFxuICAgICAgICAgIHVuaWZvcm0gbWF0NCB1TW9kZWxWaWV3TWF0cml4O1xuICAgICAgICAgIHVuaWZvcm0gbWF0NCB1UHJvamVjdGlvbk1hdHJpeDtcbiAgICAgICAgICBcbiAgICAgICAgICB2YXJ5aW5nIGxvd3AgdmVjNCB2Q29sb3VyO1xuICAgICAgXG4gICAgICAgICAgdm9pZCBtYWluKCkge1xuICAgICAgICAgICAgZ2xfUG9zaXRpb24gPSB1UHJvamVjdGlvbk1hdHJpeCAqIHVNb2RlbFZpZXdNYXRyaXggKiBhVmVydGV4UG9zaXRpb247XG4gICAgICAgICAgICB2Q29sb3VyID0gYVZlcnRleENvbG91cjtcbiAgICAgICAgICB9XG4gICAgICAgIGAsXG4gICAgICAgIGZyYWdtZW50U2hhZGVyU291cmNlID0gYFxuICAgICAgICAgIHZhcnlpbmcgbG93cCB2ZWM0IHZDb2xvdXI7XG5cbiAgICAgICAgICB2b2lkIG1haW4oKSB7XG4gICAgICAgICAgICBnbF9GcmFnQ29sb3IgPSB2Q29sb3VyO1xuICAgICAgICAgIH1cbiAgICAgICAgYCxcbiAgICAgICAgc2hhZGVyUHJvZ3JhbSA9IGNhbnZhcy5jcmVhdGVTaGFkZXJQcm9ncmFtKHZlcnRleFNoYWRlclNvdXJjZSwgZnJhZ21lbnRTaGFkZXJTb3VyY2UpLFxuICAgICAgICBjbGllbnRXaWR0aCA9IGNhbnZhcy5nZXRDbGllbnRXaWR0aCgpLFxuICAgICAgICBjbGllbnRIZWlnaHQgPSBjYW52YXMuZ2V0Q2xpZW50SGVpZ2h0KCksXG4gICAgICAgIHByb2plY3Rpb24gPSBuZXcgUHJvamVjdGlvbihjbGllbnRXaWR0aCwgY2xpZW50SGVpZ2h0KSxcbiAgICAgICAgbW9kZWxWaWV3ID0gbmV3IE1vZGVsVmlldygpO1xuXG4gIGNvbnN0IGNvdW50ID0gY3JlYXRlQW5kQmluZFZlcnRleFBvc2l0aW9uQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSk7XG5cbiAgY3JlYXRlQW5kQmluZFZlcnRleENvbG91ckJ1ZmZlcihjYW52YXMsIHNoYWRlclByb2dyYW0pO1xuXG4gIGNyZWF0ZVZlcnRleEluZGV4RWxlbWVudEJ1ZmZlcihjYW52YXMpO1xuXG4gIGNhbnZhcy51c2VQcm9ncmFtKHNoYWRlclByb2dyYW0pO1xuXG4gIGxldCBpbml0aWFsVGltZSA9IG51bGw7XG5cbiAgZnVuY3Rpb24gcmVuZGVyKHRpbWUpIHtcbiAgICBpZiAoaW5pdGlhbFRpbWUgPT09IG51bGwpIHtcbiAgICAgIGluaXRpYWxUaW1lID0gdGltZTtcbiAgICB9XG5cbiAgICBjb25zdCBlbGFwc2VkVGltZSA9IHRpbWUgLSBpbml0aWFsVGltZTtcblxuICAgIGNhbnZhcy5yZW5kZXIoc2hhZGVyUHJvZ3JhbSwgcHJvamVjdGlvbiwgbW9kZWxWaWV3LCBlbGFwc2VkVGltZSk7XG5cbiAgICBjYW52YXMuZHJhdyhjb3VudCk7XG5cbi8vLyAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVuZGVyKTtcbiAgfVxuXG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBpbnRlcm1lZGlhdGU7XG5cbmZ1bmN0aW9uIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhQb3NpdGlvbkJ1ZmZlcihjYW52YXMsIHNoYWRlclByb2dyYW0pIHtcbiAgY29uc3QgdmVydGV4UG9zaXRpb25EYXRhID0gW1xuICAgICAgICAgICsxLjAsICsxLjAsICsxLjAsXG4gICAgICAgICAgLTEuMCwgKzEuMCwgKzEuMCxcbiAgICAgICAgICArMS4wLCAtMS4wLCArMS4wXG4gICAgICAgIF0sXG4gICAgICAgIHZlcnRleFBvc2l0aW9uQnVmZmVyID0gY2FudmFzLmNyZWF0ZUJ1ZmZlcih2ZXJ0ZXhQb3NpdGlvbkRhdGEpLFxuICAgICAgICB2ZXJ0ZXhQb3NpdGlvbkF0dHJpYnV0ZUxvY2F0aW9uID0gY2FudmFzLmdldEF0dHJpYnV0ZUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICdhVmVydGV4UG9zaXRpb24nKSxcbiAgICAgICAgdmVydGV4UG9zaXRpb25Db21wb25lbnRzID0gMztcblxuICBjYW52YXMuYmluZEJ1ZmZlcih2ZXJ0ZXhQb3NpdGlvbkJ1ZmZlciwgdmVydGV4UG9zaXRpb25BdHRyaWJ1dGVMb2NhdGlvbiwgdmVydGV4UG9zaXRpb25Db21wb25lbnRzKTtcblxuICBjb25zdCB2ZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGggPSB2ZXJ0ZXhQb3NpdGlvbkRhdGEubGVuZ3RoLFxuICAgICAgICBjb3VudCA9IHZlcnRleFBvc2l0aW9uRGF0YUxlbmd0aCAvIHZlcnRleFBvc2l0aW9uQ29tcG9uZW50cztcblxuICByZXR1cm4gY291bnQ7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhDb2xvdXJCdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKSB7XG4gIGNvbnN0IHZlcnRleENvbG91ckRhdGEgPSBbXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDAuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAwLjAsICAwLjAsICAxLjBcbiAgICAgICAgXSxcbiAgICAgICAgdmVydGV4Q29sb3VyQnVmZmVyID0gY2FudmFzLmNyZWF0ZUJ1ZmZlcih2ZXJ0ZXhDb2xvdXJEYXRhKSxcbiAgICAgICAgdmVydGV4Q29sb3VyQXR0cmlidXRlTG9jYXRpb24gPSBjYW52YXMuZ2V0QXR0cmlidXRlTG9jYXRpb24oc2hhZGVyUHJvZ3JhbSwgJ2FWZXJ0ZXhDb2xvdXInKSxcbiAgICAgICAgdmVydGV4Q29sb3VyQ29tcG9uZW50cyA9IDQ7XG5cbiAgY2FudmFzLmJpbmRCdWZmZXIodmVydGV4Q29sb3VyQnVmZmVyLCB2ZXJ0ZXhDb2xvdXJBdHRyaWJ1dGVMb2NhdGlvbiwgdmVydGV4Q29sb3VyQ29tcG9uZW50cyk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVZlcnRleEluZGV4RWxlbWVudEJ1ZmZlcihjYW52YXMpIHtcbiAgY29uc3QgdmVydGV4SW5kZXhEYXRhID0gW1xuICAgICAgICAgIDAsIDEsIDJcbiAgICAgICAgXSxcbiAgICAgICAgdmVydGV4SW5kZXhFbGVtZW50QnVmZmVyID0gY2FudmFzLmNyZWF0ZUVsZW1lbnRCdWZmZXIodmVydGV4SW5kZXhEYXRhKTtcblxuICBjYW52YXMuYmluZEVsZW1lbnRCdWZmZXIodmVydGV4SW5kZXhFbGVtZW50QnVmZmVyKTtcbn0iXX0=