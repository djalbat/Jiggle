'use strict';

var Canvas = require('../canvas'),
    Rotation = require('../rotation'),
    Position = require('../position'),
    Perspective = require('../perspective');

var intermediate = function intermediate() {
  var canvas = new Canvas(),
      context = canvas.getContext();

  if (!context) {
    return;
  }

  var vertexShaderSource = '\n  \n          attribute vec4 aVertexPosition;\n          attribute vec4 aVertexColour;\n          attribute vec2 aTextureCoordinate;\n          \n          uniform mat4 uRotationMatrix;\n          uniform mat4 uPositionMatrix;\n          uniform mat4 uPerspectiveMatrix;\n          \n          varying lowp vec4 vColour;\n          varying highp vec2 vTextureCoordinate;\n      \n          void main() {\n            gl_Position = uPerspectiveMatrix * uPositionMatrix * uRotationMatrix * aVertexPosition;\n            vColour = aVertexColour;\n            vTextureCoordinate = aTextureCoordinate;\n          }\n          \n        ',
      fragmentShaderSource = '\n        \n          varying lowp vec4 vColour;\n          varying highp vec2 vTextureCoordinate;\n          \n          uniform sampler2D uSampler;\n\n          void main() {\n            // gl_FragColor = vColour;\n            gl_FragColor = texture2D(uSampler, vTextureCoordinate);\n          }\n          \n        ',
      shaderProgram = canvas.createShaderProgram(vertexShaderSource, fragmentShaderSource),
      clientWidth = canvas.getClientWidth(),
      clientHeight = canvas.getClientHeight(),
      position = new Position(),
      perspective = new Perspective(clientWidth, clientHeight);

  createAndBindVertexPositionBuffer(canvas, shaderProgram);

  // createAndBindVertexColourBuffer(canvas, shaderProgram);

  createAndBindTextureCoordinateBuffer(canvas, shaderProgram);

  var count = createVertexIndexElementBuffer(canvas);

  canvas.useProgram(shaderProgram);

  canvas.enableDepthTesting();
  canvas.enableDepthFunction();

  var initialTime = null;

  var image = new Image();

  image.onload = function () {
    var target = canvas.TEXTURE0_TARGET,
        uSamplerUniformLocationIntegerValue = 0,
        uSamplerUniformLocation = canvas.getUniformLocation(shaderProgram, 'uSampler');

    canvas.createTexture(image);

    canvas.activateTexture(target);

    canvas.setUniformLocationIntegerValue(uSamplerUniformLocation, uSamplerUniformLocationIntegerValue);

    requestAnimationFrame(render);
  };

  image.src = 'texture/bricks.jpg';

  function render(time) {
    if (initialTime === null) {
      initialTime = time;
    }

    var elapsedTime = time - initialTime,
        xAngle = elapsedTime / 1000,
        yAngle = elapsedTime / 1000,
        rotation = new Rotation(xAngle, yAngle);

    canvas.render(rotation, position, perspective, shaderProgram);

    canvas.drawElements(count);

    requestAnimationFrame(render);
  }
};

module.exports = intermediate;

function createAndBindVertexPositionBuffer(canvas, shaderProgram) {
  var vertexPositionData = [-1.0, -1.0, +1.0, +1.0, -1.0, +1.0, +1.0, +1.0, +1.0, -1.0, +1.0, +1.0, -1.0, -1.0, -1.0, -1.0, +1.0, -1.0, +1.0, +1.0, -1.0, +1.0, -1.0, -1.0, -1.0, +1.0, -1.0, -1.0, +1.0, +1.0, +1.0, +1.0, +1.0, +1.0, +1.0, -1.0, -1.0, -1.0, -1.0, +1.0, -1.0, -1.0, +1.0, -1.0, +1.0, -1.0, -1.0, +1.0, +1.0, -1.0, -1.0, +1.0, +1.0, -1.0, +1.0, +1.0, +1.0, +1.0, -1.0, +1.0, -1.0, -1.0, -1.0, -1.0, -1.0, +1.0, -1.0, +1.0, +1.0, -1.0, +1.0, -1.0],
      vertexPositionBuffer = canvas.createBuffer(vertexPositionData),
      vertexPositionAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexPosition'),
      vertexPositionComponents = 3;

  canvas.bindBuffer(vertexPositionBuffer, vertexPositionAttributeLocation, vertexPositionComponents);

  var vertexPositionDataLength = vertexPositionData.length,
      count = vertexPositionDataLength / vertexPositionComponents;

  return count;
}

function createAndBindVertexColourBuffer(canvas, shaderProgram) {
  var vertexColourData = [1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0],
      vertexColourBuffer = canvas.createBuffer(vertexColourData),
      vertexColourAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aVertexColour'),
      vertexColourComponents = 4;

  canvas.bindBuffer(vertexColourBuffer, vertexColourAttributeLocation, vertexColourComponents);
}

function createAndBindTextureCoordinateBuffer(canvas, shaderProgram) {
  var textureCoordinateData = [0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0],
      textureCoordinateBuffer = canvas.createBuffer(textureCoordinateData),
      textureCoordinateAttributeLocation = canvas.getAttributeLocation(shaderProgram, 'aTextureCoordinate'),
      textureCoordinateComponents = 2;

  canvas.bindBuffer(textureCoordinateBuffer, textureCoordinateAttributeLocation, textureCoordinateComponents);
}

function createVertexIndexElementBuffer(canvas) {
  var vertexIndexData = [0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19, 20, 21, 22, 20, 22, 23],
      vertexIndexElementBuffer = canvas.createElementBuffer(vertexIndexData),
      vertexIndexDataLength = vertexIndexData.length,
      count = vertexIndexDataLength; ///

  canvas.bindElementBuffer(vertexIndexElementBuffer);

  return count;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9leGFtcGxlcy9pbnRlcm1lZGlhdGUuanMiXSwibmFtZXMiOlsiQ2FudmFzIiwicmVxdWlyZSIsIlJvdGF0aW9uIiwiUG9zaXRpb24iLCJQZXJzcGVjdGl2ZSIsImludGVybWVkaWF0ZSIsImNhbnZhcyIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwidmVydGV4U2hhZGVyU291cmNlIiwiZnJhZ21lbnRTaGFkZXJTb3VyY2UiLCJzaGFkZXJQcm9ncmFtIiwiY3JlYXRlU2hhZGVyUHJvZ3JhbSIsImNsaWVudFdpZHRoIiwiZ2V0Q2xpZW50V2lkdGgiLCJjbGllbnRIZWlnaHQiLCJnZXRDbGllbnRIZWlnaHQiLCJwb3NpdGlvbiIsInBlcnNwZWN0aXZlIiwiY3JlYXRlQW5kQmluZFZlcnRleFBvc2l0aW9uQnVmZmVyIiwiY3JlYXRlQW5kQmluZFRleHR1cmVDb29yZGluYXRlQnVmZmVyIiwiY291bnQiLCJjcmVhdGVWZXJ0ZXhJbmRleEVsZW1lbnRCdWZmZXIiLCJ1c2VQcm9ncmFtIiwiZW5hYmxlRGVwdGhUZXN0aW5nIiwiZW5hYmxlRGVwdGhGdW5jdGlvbiIsImluaXRpYWxUaW1lIiwiaW1hZ2UiLCJJbWFnZSIsIm9ubG9hZCIsInRhcmdldCIsIlRFWFRVUkUwX1RBUkdFVCIsInVTYW1wbGVyVW5pZm9ybUxvY2F0aW9uSW50ZWdlclZhbHVlIiwidVNhbXBsZXJVbmlmb3JtTG9jYXRpb24iLCJnZXRVbmlmb3JtTG9jYXRpb24iLCJjcmVhdGVUZXh0dXJlIiwiYWN0aXZhdGVUZXh0dXJlIiwic2V0VW5pZm9ybUxvY2F0aW9uSW50ZWdlclZhbHVlIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwicmVuZGVyIiwic3JjIiwidGltZSIsImVsYXBzZWRUaW1lIiwieEFuZ2xlIiwieUFuZ2xlIiwicm90YXRpb24iLCJkcmF3RWxlbWVudHMiLCJtb2R1bGUiLCJleHBvcnRzIiwidmVydGV4UG9zaXRpb25EYXRhIiwidmVydGV4UG9zaXRpb25CdWZmZXIiLCJjcmVhdGVCdWZmZXIiLCJ2ZXJ0ZXhQb3NpdGlvbkF0dHJpYnV0ZUxvY2F0aW9uIiwiZ2V0QXR0cmlidXRlTG9jYXRpb24iLCJ2ZXJ0ZXhQb3NpdGlvbkNvbXBvbmVudHMiLCJiaW5kQnVmZmVyIiwidmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoIiwibGVuZ3RoIiwiY3JlYXRlQW5kQmluZFZlcnRleENvbG91ckJ1ZmZlciIsInZlcnRleENvbG91ckRhdGEiLCJ2ZXJ0ZXhDb2xvdXJCdWZmZXIiLCJ2ZXJ0ZXhDb2xvdXJBdHRyaWJ1dGVMb2NhdGlvbiIsInZlcnRleENvbG91ckNvbXBvbmVudHMiLCJ0ZXh0dXJlQ29vcmRpbmF0ZURhdGEiLCJ0ZXh0dXJlQ29vcmRpbmF0ZUJ1ZmZlciIsInRleHR1cmVDb29yZGluYXRlQXR0cmlidXRlTG9jYXRpb24iLCJ0ZXh0dXJlQ29vcmRpbmF0ZUNvbXBvbmVudHMiLCJ2ZXJ0ZXhJbmRleERhdGEiLCJ2ZXJ0ZXhJbmRleEVsZW1lbnRCdWZmZXIiLCJjcmVhdGVFbGVtZW50QnVmZmVyIiwidmVydGV4SW5kZXhEYXRhTGVuZ3RoIiwiYmluZEVsZW1lbnRCdWZmZXIiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQU1BLFNBQVNDLFFBQVEsV0FBUixDQUFmO0FBQUEsSUFDTUMsV0FBV0QsUUFBUSxhQUFSLENBRGpCO0FBQUEsSUFFTUUsV0FBV0YsUUFBUSxhQUFSLENBRmpCO0FBQUEsSUFHTUcsY0FBY0gsUUFBUSxnQkFBUixDQUhwQjs7QUFLQSxJQUFNSSxlQUFlLFNBQWZBLFlBQWUsR0FBTTtBQUN6QixNQUFNQyxTQUFTLElBQUlOLE1BQUosRUFBZjtBQUFBLE1BQ01PLFVBQVVELE9BQU9FLFVBQVAsRUFEaEI7O0FBR0EsTUFBSSxDQUFDRCxPQUFMLEVBQWM7QUFDWjtBQUNEOztBQUVELE1BQU1FLGdwQkFBTjtBQUFBLE1Bb0JNQyx5VkFwQk47QUFBQSxNQWlDTUMsZ0JBQWdCTCxPQUFPTSxtQkFBUCxDQUEyQkgsa0JBQTNCLEVBQStDQyxvQkFBL0MsQ0FqQ3RC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UixFQWRRLEVBZ0JoQixFQWhCZ0IsRUFnQlosRUFoQlksRUFnQlIsRUFoQlEsRUFpQmhCLEVBakJnQixFQWlCWixFQWpCWSxFQWlCUixFQWpCUSxDQUF4QjtBQUFBLE1BbUJNQywyQkFBMkI5RCxPQUFPK0QsbUJBQVAsQ0FBMkJGLGVBQTNCLENBbkJqQztBQUFBLE1Bb0JNRyx3QkFBd0JILGdCQUFnQlYsTUFwQjlDO0FBQUEsTUFxQk1wQyxRQUFRaUQscUJBckJkLENBRDhDLENBc0JSOztBQUV0Q2hFLFNBQU9pRSxpQkFBUCxDQUF5Qkgsd0JBQXpCOztBQUVBLFNBQU8vQyxLQUFQO0FBQ0QiLCJmaWxlIjoiaW50ZXJtZWRpYXRlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBDYW52YXMgPSByZXF1aXJlKCcuLi9jYW52YXMnKSxcbiAgICAgIFJvdGF0aW9uID0gcmVxdWlyZSgnLi4vcm90YXRpb24nKSxcbiAgICAgIFBvc2l0aW9uID0gcmVxdWlyZSgnLi4vcG9zaXRpb24nKSxcbiAgICAgIFBlcnNwZWN0aXZlID0gcmVxdWlyZSgnLi4vcGVyc3BlY3RpdmUnKTtcblxuY29uc3QgaW50ZXJtZWRpYXRlID0gKCkgPT4ge1xuICBjb25zdCBjYW52YXMgPSBuZXcgQ2FudmFzKCksXG4gICAgICAgIGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgpO1xuXG4gIGlmICghY29udGV4dCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHZlcnRleFNoYWRlclNvdXJjZSA9IGBcbiAgXG4gICAgICAgICAgYXR0cmlidXRlIHZlYzQgYVZlcnRleFBvc2l0aW9uO1xuICAgICAgICAgIGF0dHJpYnV0ZSB2ZWM0IGFWZXJ0ZXhDb2xvdXI7XG4gICAgICAgICAgYXR0cmlidXRlIHZlYzIgYVRleHR1cmVDb29yZGluYXRlO1xuICAgICAgICAgIFxuICAgICAgICAgIHVuaWZvcm0gbWF0NCB1Um90YXRpb25NYXRyaXg7XG4gICAgICAgICAgdW5pZm9ybSBtYXQ0IHVQb3NpdGlvbk1hdHJpeDtcbiAgICAgICAgICB1bmlmb3JtIG1hdDQgdVBlcnNwZWN0aXZlTWF0cml4O1xuICAgICAgICAgIFxuICAgICAgICAgIHZhcnlpbmcgbG93cCB2ZWM0IHZDb2xvdXI7XG4gICAgICAgICAgdmFyeWluZyBoaWdocCB2ZWMyIHZUZXh0dXJlQ29vcmRpbmF0ZTtcbiAgICAgIFxuICAgICAgICAgIHZvaWQgbWFpbigpIHtcbiAgICAgICAgICAgIGdsX1Bvc2l0aW9uID0gdVBlcnNwZWN0aXZlTWF0cml4ICogdVBvc2l0aW9uTWF0cml4ICogdVJvdGF0aW9uTWF0cml4ICogYVZlcnRleFBvc2l0aW9uO1xuICAgICAgICAgICAgdkNvbG91ciA9IGFWZXJ0ZXhDb2xvdXI7XG4gICAgICAgICAgICB2VGV4dHVyZUNvb3JkaW5hdGUgPSBhVGV4dHVyZUNvb3JkaW5hdGU7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICBgLFxuICAgICAgICBmcmFnbWVudFNoYWRlclNvdXJjZSA9IGBcbiAgICAgICAgXG4gICAgICAgICAgdmFyeWluZyBsb3dwIHZlYzQgdkNvbG91cjtcbiAgICAgICAgICB2YXJ5aW5nIGhpZ2hwIHZlYzIgdlRleHR1cmVDb29yZGluYXRlO1xuICAgICAgICAgIFxuICAgICAgICAgIHVuaWZvcm0gc2FtcGxlcjJEIHVTYW1wbGVyO1xuXG4gICAgICAgICAgdm9pZCBtYWluKCkge1xuICAgICAgICAgICAgLy8gZ2xfRnJhZ0NvbG9yID0gdkNvbG91cjtcbiAgICAgICAgICAgIGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRCh1U2FtcGxlciwgdlRleHR1cmVDb29yZGluYXRlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgIGAsXG4gICAgICAgIHNoYWRlclByb2dyYW0gPSBjYW52YXMuY3JlYXRlU2hhZGVyUHJvZ3JhbSh2ZXJ0ZXhTaGFkZXJTb3VyY2UsIGZyYWdtZW50U2hhZGVyU291cmNlKSxcbiAgICAgICAgY2xpZW50V2lkdGggPSBjYW52YXMuZ2V0Q2xpZW50V2lkdGgoKSxcbiAgICAgICAgY2xpZW50SGVpZ2h0ID0gY2FudmFzLmdldENsaWVudEhlaWdodCgpLFxuICAgICAgICBwb3NpdGlvbiA9IG5ldyBQb3NpdGlvbigpLFxuICAgICAgICBwZXJzcGVjdGl2ZSA9IG5ldyBQZXJzcGVjdGl2ZShjbGllbnRXaWR0aCwgY2xpZW50SGVpZ2h0KTtcblxuICBjcmVhdGVBbmRCaW5kVmVydGV4UG9zaXRpb25CdWZmZXIoY2FudmFzLCBzaGFkZXJQcm9ncmFtKTtcblxuICAvLyBjcmVhdGVBbmRCaW5kVmVydGV4Q29sb3VyQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSk7XG5cbiAgY3JlYXRlQW5kQmluZFRleHR1cmVDb29yZGluYXRlQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSk7XG5cbiAgY29uc3QgY291bnQgPSBjcmVhdGVWZXJ0ZXhJbmRleEVsZW1lbnRCdWZmZXIoY2FudmFzKTtcblxuICBjYW52YXMudXNlUHJvZ3JhbShzaGFkZXJQcm9ncmFtKTtcblxuICBjYW52YXMuZW5hYmxlRGVwdGhUZXN0aW5nKCk7XG4gIGNhbnZhcy5lbmFibGVEZXB0aEZ1bmN0aW9uKCk7XG5cbiAgbGV0IGluaXRpYWxUaW1lID0gbnVsbDtcblxuICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuXG4gIGltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IHRhcmdldCA9IGNhbnZhcy5URVhUVVJFMF9UQVJHRVQsXG4gICAgICAgICAgdVNhbXBsZXJVbmlmb3JtTG9jYXRpb25JbnRlZ2VyVmFsdWUgPSAwLFxuICAgICAgICAgIHVTYW1wbGVyVW5pZm9ybUxvY2F0aW9uID0gY2FudmFzLmdldFVuaWZvcm1Mb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAndVNhbXBsZXInKTtcblxuICAgIGNhbnZhcy5jcmVhdGVUZXh0dXJlKGltYWdlKTtcblxuICAgIGNhbnZhcy5hY3RpdmF0ZVRleHR1cmUodGFyZ2V0KTtcblxuICAgIGNhbnZhcy5zZXRVbmlmb3JtTG9jYXRpb25JbnRlZ2VyVmFsdWUodVNhbXBsZXJVbmlmb3JtTG9jYXRpb24sIHVTYW1wbGVyVW5pZm9ybUxvY2F0aW9uSW50ZWdlclZhbHVlKTtcblxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpO1xuICB9O1xuXG4gIGltYWdlLnNyYyA9ICd0ZXh0dXJlL2JyaWNrcy5qcGcnO1xuXG4gIGZ1bmN0aW9uIHJlbmRlcih0aW1lKSB7XG4gICAgaWYgKGluaXRpYWxUaW1lID09PSBudWxsKSB7XG4gICAgICBpbml0aWFsVGltZSA9IHRpbWU7XG4gICAgfVxuXG4gICAgY29uc3QgZWxhcHNlZFRpbWUgPSB0aW1lIC0gaW5pdGlhbFRpbWUsXG4gICAgICAgICAgeEFuZ2xlID0gZWxhcHNlZFRpbWUgLyAxMDAwLFxuICAgICAgICAgIHlBbmdsZSA9IGVsYXBzZWRUaW1lIC8gMTAwMCxcbiAgICAgICAgICByb3RhdGlvbiA9IG5ldyBSb3RhdGlvbih4QW5nbGUsIHlBbmdsZSk7XG5cbiAgICBjYW52YXMucmVuZGVyKHJvdGF0aW9uLCBwb3NpdGlvbiwgcGVyc3BlY3RpdmUsIHNoYWRlclByb2dyYW0pO1xuXG4gICAgY2FudmFzLmRyYXdFbGVtZW50cyhjb3VudCk7XG5cbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVuZGVyKTtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBpbnRlcm1lZGlhdGU7XG5cbmZ1bmN0aW9uIGNyZWF0ZUFuZEJpbmRWZXJ0ZXhQb3NpdGlvbkJ1ZmZlcihjYW52YXMsIHNoYWRlclByb2dyYW0pIHtcbiAgY29uc3QgdmVydGV4UG9zaXRpb25EYXRhID0gW1xuICAgICAgICAgIC0xLjAsIC0xLjAsICsxLjAsXG4gICAgICAgICAgKzEuMCwgLTEuMCwgKzEuMCxcbiAgICAgICAgICArMS4wLCArMS4wLCArMS4wLFxuICAgICAgICAgIC0xLjAsICsxLjAsICsxLjAsXG5cbiAgICAgICAgICAtMS4wLCAtMS4wLCAtMS4wLFxuICAgICAgICAgIC0xLjAsICsxLjAsIC0xLjAsXG4gICAgICAgICAgKzEuMCwgKzEuMCwgLTEuMCxcbiAgICAgICAgICArMS4wLCAtMS4wLCAtMS4wLFxuXG4gICAgICAgICAgLTEuMCwgKzEuMCwgLTEuMCxcbiAgICAgICAgICAtMS4wLCArMS4wLCArMS4wLFxuICAgICAgICAgICsxLjAsICsxLjAsICsxLjAsXG4gICAgICAgICAgKzEuMCwgKzEuMCwgLTEuMCxcblxuICAgICAgICAgIC0xLjAsIC0xLjAsIC0xLjAsXG4gICAgICAgICAgKzEuMCwgLTEuMCwgLTEuMCxcbiAgICAgICAgICArMS4wLCAtMS4wLCArMS4wLFxuICAgICAgICAgIC0xLjAsIC0xLjAsICsxLjAsXG5cbiAgICAgICAgICArMS4wLCAtMS4wLCAtMS4wLFxuICAgICAgICAgICsxLjAsICsxLjAsIC0xLjAsXG4gICAgICAgICAgKzEuMCwgKzEuMCwgKzEuMCxcbiAgICAgICAgICArMS4wLCAtMS4wLCArMS4wLFxuXG4gICAgICAgICAgLTEuMCwgLTEuMCwgLTEuMCxcbiAgICAgICAgICAtMS4wLCAtMS4wLCArMS4wLFxuICAgICAgICAgIC0xLjAsICsxLjAsICsxLjAsXG4gICAgICAgICAgLTEuMCwgKzEuMCwgLTEuMFxuICAgICAgICBdLFxuICAgICAgICB2ZXJ0ZXhQb3NpdGlvbkJ1ZmZlciA9IGNhbnZhcy5jcmVhdGVCdWZmZXIodmVydGV4UG9zaXRpb25EYXRhKSxcbiAgICAgICAgdmVydGV4UG9zaXRpb25BdHRyaWJ1dGVMb2NhdGlvbiA9IGNhbnZhcy5nZXRBdHRyaWJ1dGVMb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAnYVZlcnRleFBvc2l0aW9uJyksXG4gICAgICAgIHZlcnRleFBvc2l0aW9uQ29tcG9uZW50cyA9IDM7XG5cbiAgY2FudmFzLmJpbmRCdWZmZXIodmVydGV4UG9zaXRpb25CdWZmZXIsIHZlcnRleFBvc2l0aW9uQXR0cmlidXRlTG9jYXRpb24sIHZlcnRleFBvc2l0aW9uQ29tcG9uZW50cyk7XG5cbiAgY29uc3QgdmVydGV4UG9zaXRpb25EYXRhTGVuZ3RoID0gdmVydGV4UG9zaXRpb25EYXRhLmxlbmd0aCxcbiAgICAgICAgY291bnQgPSB2ZXJ0ZXhQb3NpdGlvbkRhdGFMZW5ndGggLyB2ZXJ0ZXhQb3NpdGlvbkNvbXBvbmVudHM7XG5cbiAgcmV0dXJuIGNvdW50O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVBbmRCaW5kVmVydGV4Q29sb3VyQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSkge1xuICBjb25zdCB2ZXJ0ZXhDb2xvdXJEYXRhID0gW1xuICAgICAgICAgIDEuMCwgIDAuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAwLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDAuMCwgIDAuMCwgIDEuMCxcblxuICAgICAgICAgIDAuMCwgIDEuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCwgIDEuMCwgIDEuMCxcblxuICAgICAgICAgIDAuMCwgIDEuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAxLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDEuMCwgIDAuMCwgIDEuMCxcblxuICAgICAgICAgIDEuMCwgIDAuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAwLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMC4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDAuMCwgIDEuMCwgIDEuMCxcblxuICAgICAgICAgIDAuMCwgIDAuMCwgIDEuMCwgIDEuMCxcbiAgICAgICAgICAwLjAsICAwLjAsICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMC4wLCAgMS4wLCAgMS4wLFxuICAgICAgICAgIDAuMCwgIDAuMCwgIDEuMCwgIDEuMCxcblxuICAgICAgICAgIDEuMCwgIDEuMCwgIDAuMCwgIDEuMCxcbiAgICAgICAgICAxLjAsICAxLjAsICAwLjAsICAxLjAsXG4gICAgICAgICAgMS4wLCAgMS4wLCAgMC4wLCAgMS4wLFxuICAgICAgICAgIDEuMCwgIDEuMCwgIDAuMCwgIDEuMFxuICAgICAgICBdLFxuICAgICAgICB2ZXJ0ZXhDb2xvdXJCdWZmZXIgPSBjYW52YXMuY3JlYXRlQnVmZmVyKHZlcnRleENvbG91ckRhdGEpLFxuICAgICAgICB2ZXJ0ZXhDb2xvdXJBdHRyaWJ1dGVMb2NhdGlvbiA9IGNhbnZhcy5nZXRBdHRyaWJ1dGVMb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAnYVZlcnRleENvbG91cicpLFxuICAgICAgICB2ZXJ0ZXhDb2xvdXJDb21wb25lbnRzID0gNDtcblxuICBjYW52YXMuYmluZEJ1ZmZlcih2ZXJ0ZXhDb2xvdXJCdWZmZXIsIHZlcnRleENvbG91ckF0dHJpYnV0ZUxvY2F0aW9uLCB2ZXJ0ZXhDb2xvdXJDb21wb25lbnRzKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQW5kQmluZFRleHR1cmVDb29yZGluYXRlQnVmZmVyKGNhbnZhcywgc2hhZGVyUHJvZ3JhbSkge1xuICBjb25zdCB0ZXh0dXJlQ29vcmRpbmF0ZURhdGEgPSBbXG4gICAgICAgICAgMC4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wLFxuXG4gICAgICAgICAgMC4wLCAgMC4wLFxuICAgICAgICAgIDEuMCwgIDAuMCxcbiAgICAgICAgICAxLjAsICAxLjAsXG4gICAgICAgICAgMC4wLCAgMS4wXG4gICAgICAgIF0sXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlQnVmZmVyID0gY2FudmFzLmNyZWF0ZUJ1ZmZlcih0ZXh0dXJlQ29vcmRpbmF0ZURhdGEpLFxuICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZUF0dHJpYnV0ZUxvY2F0aW9uID0gY2FudmFzLmdldEF0dHJpYnV0ZUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICdhVGV4dHVyZUNvb3JkaW5hdGUnKSxcbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVDb21wb25lbnRzID0gMjtcblxuICBjYW52YXMuYmluZEJ1ZmZlcih0ZXh0dXJlQ29vcmRpbmF0ZUJ1ZmZlciwgdGV4dHVyZUNvb3JkaW5hdGVBdHRyaWJ1dGVMb2NhdGlvbiwgdGV4dHVyZUNvb3JkaW5hdGVDb21wb25lbnRzKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlVmVydGV4SW5kZXhFbGVtZW50QnVmZmVyKGNhbnZhcykge1xuICBjb25zdCB2ZXJ0ZXhJbmRleERhdGEgPSBbXG4gICAgICAgICAgIDAsICAxLCAgMixcbiAgICAgICAgICAgMCwgIDIsICAzLFxuXG4gICAgICAgICAgIDQsICA1LCAgNixcbiAgICAgICAgICAgNCwgIDYsICA3LFxuXG4gICAgICAgICAgIDgsICA5LCAxMCxcbiAgICAgICAgICAgOCwgMTAsIDExLFxuXG4gICAgICAgICAgMTIsIDEzLCAxNCxcbiAgICAgICAgICAxMiwgMTQsIDE1LFxuXG4gICAgICAgICAgMTYsIDE3LCAxOCxcbiAgICAgICAgICAxNiwgMTgsIDE5LFxuXG4gICAgICAgICAgMjAsIDIxLCAyMixcbiAgICAgICAgICAyMCwgMjIsIDIzXG4gICAgICAgIF0sXG4gICAgICAgIHZlcnRleEluZGV4RWxlbWVudEJ1ZmZlciA9IGNhbnZhcy5jcmVhdGVFbGVtZW50QnVmZmVyKHZlcnRleEluZGV4RGF0YSksXG4gICAgICAgIHZlcnRleEluZGV4RGF0YUxlbmd0aCA9IHZlcnRleEluZGV4RGF0YS5sZW5ndGgsXG4gICAgICAgIGNvdW50ID0gdmVydGV4SW5kZXhEYXRhTGVuZ3RoOyAgLy8vXG5cbiAgY2FudmFzLmJpbmRFbGVtZW50QnVmZmVyKHZlcnRleEluZGV4RWxlbWVudEJ1ZmZlcik7XG5cbiAgcmV0dXJuIGNvdW50O1xufVxuIl19