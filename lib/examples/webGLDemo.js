'use strict';

var mat4 = require('gl-mat4');

var webGLDemo = function webGLDemo() {
  var canvas = document.querySelector('canvas');
  var gl = canvas.getContext('webgl');

  if (!gl) {
    alert('Unable to initialize WebGL. Your browser or machine may not support it.');
    return;
  }

  var vsSource = '\n    attribute vec4 aVertexPosition;\n\n    uniform mat4 uModelViewMatrix;\n    uniform mat4 uProjectionMatrix;\n\n    void main() {\n      gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;\n    }\n  ';

  var fsSource = '\n    void main() {\n      gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n    }\n  ';

  var shaderProgram = initShaderProgram(gl, vsSource, fsSource);

  var programInfo = {
    program: shaderProgram,
    attribLocations: {
      vertexPosition: gl.getAttribLocation(shaderProgram, 'aVertexPosition')
    },
    uniformLocations: {
      projectionMatrix: gl.getUniformLocation(shaderProgram, 'uProjectionMatrix'),
      modelViewMatrix: gl.getUniformLocation(shaderProgram, 'uModelViewMatrix')
    }
  };

  var buffers = initBuffers(gl);

  drawScene(gl, programInfo, buffers);
};

module.exports = webGLDemo;

function drawScene(gl, programInfo, buffers) {
  gl.clearColor(0.0, 0.0, 0.0, 1.0); // Clear to black, fully opaque
  gl.clearDepth(1.0); // Clear everything
  gl.enable(gl.DEPTH_TEST); // Enable depth testing
  gl.depthFunc(gl.LEQUAL); // Near things obscure far things

  // Clear the canvas before we start drawing on it.

  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

  // Create a perspective matrix, a special matrix that is
  // used to simulate the distortion of perspective in a camera.
  // Our field of view is 45 degrees, with a width/height
  // ratio that matches the display size of the canvas
  // and we only want to see objects between 0.1 units
  // and 100 units away from the camera.

  var fieldOfView = 45 * Math.PI / 180; // in radians
  var aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;
  var zNear = 0.1;
  var zFar = 100.0;
  var projectionMatrix = mat4.create();

  // note: glmatrix.js always has the first argument
  // as the destination to receive the result.
  mat4.perspective(projectionMatrix, fieldOfView, aspect, zNear, zFar);

  // Set the drawing position to the "identity" point, which is
  // the center of the scene.
  var modelViewMatrix = mat4.create();

  // Now move the drawing position a bit to where we want to
  // start drawing the square.

  mat4.translate(modelViewMatrix, // destination matrix
  modelViewMatrix, // matrix to translate
  [-0.0, 0.0, -6.0]); // amount to translate

  // Tell WebGL how to pull out the positions from the position
  // buffer into the vertexPosition attribute.
  {
    var numComponents = 2;
    var type = gl.FLOAT;
    var normalize = false;
    var stride = 0;
    var offset = 0;
    gl.bindBuffer(gl.ARRAY_BUFFER, buffers.position);
    gl.vertexAttribPointer(programInfo.attribLocations.vertexPosition, numComponents, type, normalize, stride, offset);
    gl.enableVertexAttribArray(programInfo.attribLocations.vertexPosition);
  }

  // Tell WebGL to use our program when drawing

  gl.useProgram(programInfo.program);

  // Set the shader uniforms

  gl.uniformMatrix4fv(programInfo.uniformLocations.projectionMatrix, false, projectionMatrix);
  gl.uniformMatrix4fv(programInfo.uniformLocations.modelViewMatrix, false, modelViewMatrix);

  {
    var _offset = 0;
    var vertexCount = 4;
    gl.drawArrays(gl.TRIANGLE_STRIP, _offset, vertexCount);
  }
}

function initShaderProgram(gl, vsSource, fsSource) {
  var vertexShader = loadShader(gl, gl.VERTEX_SHADER, vsSource);
  var fragmentShader = loadShader(gl, gl.FRAGMENT_SHADER, fsSource);

  var shaderProgram = gl.createProgram();
  gl.attachShader(shaderProgram, vertexShader);
  gl.attachShader(shaderProgram, fragmentShader);
  gl.linkProgram(shaderProgram);

  if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
    alert('Unable to initialize the shader program: ' + gl.getProgramInfoLog(shaderProgram));
    return null;
  }

  return shaderProgram;
}

function loadShader(gl, type, source) {
  var shader = gl.createShader(type);

  gl.shaderSource(shader, source);

  gl.compileShader(shader);

  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
    alert('An error occurred compiling the shaders: ' + gl.getShaderInfoLog(shader));
    gl.deleteShader(shader);
    return null;
  }

  return shader;
}

function initBuffers(gl) {

  var positionBuffer = gl.createBuffer();

  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);

  var positions = [1.0, 1.0, -1.0, 1.0, 1.0, -1.0, -1.0, -1.0];

  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);

  return {
    position: positionBuffer
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9leGFtcGxlcy93ZWJHTERlbW8uanMiXSwibmFtZXMiOlsibWF0NCIsInJlcXVpcmUiLCJ3ZWJHTERlbW8iLCJjYW52YXMiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJnbCIsImdldENvbnRleHQiLCJhbGVydCIsInZzU291cmNlIiwiZnNTb3VyY2UiLCJzaGFkZXJQcm9ncmFtIiwiaW5pdFNoYWRlclByb2dyYW0iLCJwcm9ncmFtSW5mbyIsInByb2dyYW0iLCJhdHRyaWJMb2NhdGlvbnMiLCJ2ZXJ0ZXhQb3NpdGlvbiIsImdldEF0dHJpYkxvY2F0aW9uIiwidW5pZm9ybUxvY2F0aW9ucyIsInByb2plY3Rpb25NYXRyaXgiLCJnZXRVbmlmb3JtTG9jYXRpb24iLCJtb2RlbFZpZXdNYXRyaXgiLCJidWZmZXJzIiwiaW5pdEJ1ZmZlcnMiLCJkcmF3U2NlbmUiLCJtb2R1bGUiLCJleHBvcnRzIiwiY2xlYXJDb2xvciIsImNsZWFyRGVwdGgiLCJlbmFibGUiLCJERVBUSF9URVNUIiwiZGVwdGhGdW5jIiwiTEVRVUFMIiwiY2xlYXIiLCJDT0xPUl9CVUZGRVJfQklUIiwiREVQVEhfQlVGRkVSX0JJVCIsImZpZWxkT2ZWaWV3IiwiTWF0aCIsIlBJIiwiYXNwZWN0IiwiY2xpZW50V2lkdGgiLCJjbGllbnRIZWlnaHQiLCJ6TmVhciIsInpGYXIiLCJjcmVhdGUiLCJwZXJzcGVjdGl2ZSIsInRyYW5zbGF0ZSIsIm51bUNvbXBvbmVudHMiLCJ0eXBlIiwiRkxPQVQiLCJub3JtYWxpemUiLCJzdHJpZGUiLCJvZmZzZXQiLCJiaW5kQnVmZmVyIiwiQVJSQVlfQlVGRkVSIiwicG9zaXRpb24iLCJ2ZXJ0ZXhBdHRyaWJQb2ludGVyIiwiZW5hYmxlVmVydGV4QXR0cmliQXJyYXkiLCJ1c2VQcm9ncmFtIiwidW5pZm9ybU1hdHJpeDRmdiIsInZlcnRleENvdW50IiwiZHJhd0FycmF5cyIsIlRSSUFOR0xFX1NUUklQIiwidmVydGV4U2hhZGVyIiwibG9hZFNoYWRlciIsIlZFUlRFWF9TSEFERVIiLCJmcmFnbWVudFNoYWRlciIsIkZSQUdNRU5UX1NIQURFUiIsImNyZWF0ZVByb2dyYW0iLCJhdHRhY2hTaGFkZXIiLCJsaW5rUHJvZ3JhbSIsImdldFByb2dyYW1QYXJhbWV0ZXIiLCJMSU5LX1NUQVRVUyIsImdldFByb2dyYW1JbmZvTG9nIiwic291cmNlIiwic2hhZGVyIiwiY3JlYXRlU2hhZGVyIiwic2hhZGVyU291cmNlIiwiY29tcGlsZVNoYWRlciIsImdldFNoYWRlclBhcmFtZXRlciIsIkNPTVBJTEVfU1RBVFVTIiwiZ2V0U2hhZGVySW5mb0xvZyIsImRlbGV0ZVNoYWRlciIsInBvc2l0aW9uQnVmZmVyIiwiY3JlYXRlQnVmZmVyIiwicG9zaXRpb25zIiwiYnVmZmVyRGF0YSIsIkZsb2F0MzJBcnJheSIsIlNUQVRJQ19EUkFXIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxPQUFPQyxRQUFRLFNBQVIsQ0FBYjs7QUFFQSxJQUFNQyxZQUFZLFNBQVpBLFNBQVksR0FBTTtBQUN0QixNQUFNQyxTQUFTQyxTQUFTQyxhQUFULENBQXVCLFFBQXZCLENBQWY7QUFDQSxNQUFNQyxLQUFLSCxPQUFPSSxVQUFQLENBQWtCLE9BQWxCLENBQVg7O0FBRUEsTUFBSSxDQUFDRCxFQUFMLEVBQVM7QUFDUEUsVUFBTSx5RUFBTjtBQUNBO0FBQ0Q7O0FBRUQsTUFBTUMsME9BQU47O0FBV0EsTUFBTUMsMkZBQU47O0FBTUEsTUFBTUMsZ0JBQWdCQyxrQkFBa0JOLEVBQWxCLEVBQXNCRyxRQUF0QixFQUFnQ0MsUUFBaEMsQ0FBdEI7O0FBRUEsTUFBTUcsY0FBYztBQUNsQkMsYUFBU0gsYUFEUztBQUVsQkkscUJBQWlCO0FBQ2ZDLHNCQUFnQlYsR0FBR1csaUJBQUgsQ0FBcUJOLGFBQXJCLEVBQW9DLGlCQUFwQztBQURELEtBRkM7QUFLbEJPLHNCQUFrQjtBQUNoQkMsd0JBQWtCYixHQUFHYyxrQkFBSCxDQUFzQlQsYUFBdEIsRUFBcUMsbUJBQXJDLENBREY7QUFFaEJVLHVCQUFpQmYsR0FBR2Msa0JBQUgsQ0FBc0JULGFBQXRCLEVBQXFDLGtCQUFyQztBQUZEO0FBTEEsR0FBcEI7O0FBV0EsTUFBTVcsVUFBVUMsWUFBWWpCLEVBQVosQ0FBaEI7O0FBRUFrQixZQUFVbEIsRUFBVixFQUFjTyxXQUFkLEVBQTJCUyxPQUEzQjtBQUVELENBM0NEOztBQTZDQUcsT0FBT0MsT0FBUCxHQUFpQnhCLFNBQWpCOztBQUVBLFNBQVNzQixTQUFULENBQW1CbEIsRUFBbkIsRUFBdUJPLFdBQXZCLEVBQW9DUyxPQUFwQyxFQUE2QztBQUMzQ2hCLEtBQUdxQixVQUFILENBQWMsR0FBZCxFQUFtQixHQUFuQixFQUF3QixHQUF4QixFQUE2QixHQUE3QixFQUQyQyxDQUNQO0FBQ3BDckIsS0FBR3NCLFVBQUgsQ0FBYyxHQUFkLEVBRjJDLENBRVA7QUFDcEN0QixLQUFHdUIsTUFBSCxDQUFVdkIsR0FBR3dCLFVBQWIsRUFIMkMsQ0FHUDtBQUNwQ3hCLEtBQUd5QixTQUFILENBQWF6QixHQUFHMEIsTUFBaEIsRUFKMkMsQ0FJUDs7QUFFcEM7O0FBRUExQixLQUFHMkIsS0FBSCxDQUFTM0IsR0FBRzRCLGdCQUFILEdBQXNCNUIsR0FBRzZCLGdCQUFsQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTUMsY0FBYyxLQUFLQyxLQUFLQyxFQUFWLEdBQWUsR0FBbkMsQ0FqQjJDLENBaUJEO0FBQzFDLE1BQU1DLFNBQVNqQyxHQUFHSCxNQUFILENBQVVxQyxXQUFWLEdBQXdCbEMsR0FBR0gsTUFBSCxDQUFVc0MsWUFBakQ7QUFDQSxNQUFNQyxRQUFRLEdBQWQ7QUFDQSxNQUFNQyxPQUFPLEtBQWI7QUFDQSxNQUFNeEIsbUJBQW1CbkIsS0FBSzRDLE1BQUwsRUFBekI7O0FBRUE7QUFDQTtBQUNBNUMsT0FBSzZDLFdBQUwsQ0FBaUIxQixnQkFBakIsRUFDSWlCLFdBREosRUFFSUcsTUFGSixFQUdJRyxLQUhKLEVBSUlDLElBSko7O0FBTUE7QUFDQTtBQUNBLE1BQU10QixrQkFBa0JyQixLQUFLNEMsTUFBTCxFQUF4Qjs7QUFFQTtBQUNBOztBQUVBNUMsT0FBSzhDLFNBQUwsQ0FBZXpCLGVBQWYsRUFBb0M7QUFDaENBLGlCQURKLEVBQ3lCO0FBQ3JCLEdBQUMsQ0FBQyxHQUFGLEVBQU8sR0FBUCxFQUFZLENBQUMsR0FBYixDQUZKLEVBdEMyQyxDQXdDbEI7O0FBRXpCO0FBQ0E7QUFDQTtBQUNFLFFBQU0wQixnQkFBZ0IsQ0FBdEI7QUFDQSxRQUFNQyxPQUFPMUMsR0FBRzJDLEtBQWhCO0FBQ0EsUUFBTUMsWUFBWSxLQUFsQjtBQUNBLFFBQU1DLFNBQVMsQ0FBZjtBQUNBLFFBQU1DLFNBQVMsQ0FBZjtBQUNBOUMsT0FBRytDLFVBQUgsQ0FBYy9DLEdBQUdnRCxZQUFqQixFQUErQmhDLFFBQVFpQyxRQUF2QztBQUNBakQsT0FBR2tELG1CQUFILENBQ0kzQyxZQUFZRSxlQUFaLENBQTRCQyxjQURoQyxFQUVJK0IsYUFGSixFQUdJQyxJQUhKLEVBSUlFLFNBSkosRUFLSUMsTUFMSixFQU1JQyxNQU5KO0FBT0E5QyxPQUFHbUQsdUJBQUgsQ0FDSTVDLFlBQVlFLGVBQVosQ0FBNEJDLGNBRGhDO0FBRUQ7O0FBRUQ7O0FBRUFWLEtBQUdvRCxVQUFILENBQWM3QyxZQUFZQyxPQUExQjs7QUFFQTs7QUFFQVIsS0FBR3FELGdCQUFILENBQ0k5QyxZQUFZSyxnQkFBWixDQUE2QkMsZ0JBRGpDLEVBRUksS0FGSixFQUdJQSxnQkFISjtBQUlBYixLQUFHcUQsZ0JBQUgsQ0FDSTlDLFlBQVlLLGdCQUFaLENBQTZCRyxlQURqQyxFQUVJLEtBRkosRUFHSUEsZUFISjs7QUFLQTtBQUNFLFFBQU0rQixVQUFTLENBQWY7QUFDQSxRQUFNUSxjQUFjLENBQXBCO0FBQ0F0RCxPQUFHdUQsVUFBSCxDQUFjdkQsR0FBR3dELGNBQWpCLEVBQWlDVixPQUFqQyxFQUF5Q1EsV0FBekM7QUFDRDtBQUNGOztBQUVELFNBQVNoRCxpQkFBVCxDQUEyQk4sRUFBM0IsRUFBK0JHLFFBQS9CLEVBQXlDQyxRQUF6QyxFQUFtRDtBQUNqRCxNQUFNcUQsZUFBZUMsV0FBVzFELEVBQVgsRUFBZUEsR0FBRzJELGFBQWxCLEVBQWlDeEQsUUFBakMsQ0FBckI7QUFDQSxNQUFNeUQsaUJBQWlCRixXQUFXMUQsRUFBWCxFQUFlQSxHQUFHNkQsZUFBbEIsRUFBbUN6RCxRQUFuQyxDQUF2Qjs7QUFFQSxNQUFNQyxnQkFBZ0JMLEdBQUc4RCxhQUFILEVBQXRCO0FBQ0E5RCxLQUFHK0QsWUFBSCxDQUFnQjFELGFBQWhCLEVBQStCb0QsWUFBL0I7QUFDQXpELEtBQUcrRCxZQUFILENBQWdCMUQsYUFBaEIsRUFBK0J1RCxjQUEvQjtBQUNBNUQsS0FBR2dFLFdBQUgsQ0FBZTNELGFBQWY7O0FBRUEsTUFBSSxDQUFDTCxHQUFHaUUsbUJBQUgsQ0FBdUI1RCxhQUF2QixFQUFzQ0wsR0FBR2tFLFdBQXpDLENBQUwsRUFBNEQ7QUFDMURoRSxVQUFNLDhDQUE4Q0YsR0FBR21FLGlCQUFILENBQXFCOUQsYUFBckIsQ0FBcEQ7QUFDQSxXQUFPLElBQVA7QUFDRDs7QUFFRCxTQUFPQSxhQUFQO0FBQ0Q7O0FBRUQsU0FBU3FELFVBQVQsQ0FBb0IxRCxFQUFwQixFQUF3QjBDLElBQXhCLEVBQThCMEIsTUFBOUIsRUFBc0M7QUFDcEMsTUFBTUMsU0FBU3JFLEdBQUdzRSxZQUFILENBQWdCNUIsSUFBaEIsQ0FBZjs7QUFFQTFDLEtBQUd1RSxZQUFILENBQWdCRixNQUFoQixFQUF3QkQsTUFBeEI7O0FBRUFwRSxLQUFHd0UsYUFBSCxDQUFpQkgsTUFBakI7O0FBRUEsTUFBSSxDQUFDckUsR0FBR3lFLGtCQUFILENBQXNCSixNQUF0QixFQUE4QnJFLEdBQUcwRSxjQUFqQyxDQUFMLEVBQXVEO0FBQ3JEeEUsVUFBTSw4Q0FBOENGLEdBQUcyRSxnQkFBSCxDQUFvQk4sTUFBcEIsQ0FBcEQ7QUFDQXJFLE9BQUc0RSxZQUFILENBQWdCUCxNQUFoQjtBQUNBLFdBQU8sSUFBUDtBQUNEOztBQUVELFNBQU9BLE1BQVA7QUFDRDs7QUFFRCxTQUFTcEQsV0FBVCxDQUFxQmpCLEVBQXJCLEVBQXlCOztBQUV2QixNQUFNNkUsaUJBQWlCN0UsR0FBRzhFLFlBQUgsRUFBdkI7O0FBRUE5RSxLQUFHK0MsVUFBSCxDQUFjL0MsR0FBR2dELFlBQWpCLEVBQStCNkIsY0FBL0I7O0FBRUEsTUFBTUUsWUFBWSxDQUNoQixHQURnQixFQUNWLEdBRFUsRUFFaEIsQ0FBQyxHQUZlLEVBRVQsR0FGUyxFQUdoQixHQUhnQixFQUdYLENBQUMsR0FIVSxFQUloQixDQUFDLEdBSmUsRUFJVixDQUFDLEdBSlMsQ0FBbEI7O0FBT0EvRSxLQUFHZ0YsVUFBSCxDQUFjaEYsR0FBR2dELFlBQWpCLEVBQ0ksSUFBSWlDLFlBQUosQ0FBaUJGLFNBQWpCLENBREosRUFFSS9FLEdBQUdrRixXQUZQOztBQUlBLFNBQU87QUFDTGpDLGNBQVU0QjtBQURMLEdBQVA7QUFHRCIsImZpbGUiOiJ3ZWJHTERlbW8uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IG1hdDQgPSByZXF1aXJlKCdnbC1tYXQ0Jyk7XG5cbmNvbnN0IHdlYkdMRGVtbyA9ICgpID0+IHtcbiAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignY2FudmFzJyk7XG4gIGNvbnN0IGdsID0gY2FudmFzLmdldENvbnRleHQoJ3dlYmdsJyk7XG5cbiAgaWYgKCFnbCkge1xuICAgIGFsZXJ0KCdVbmFibGUgdG8gaW5pdGlhbGl6ZSBXZWJHTC4gWW91ciBicm93c2VyIG9yIG1hY2hpbmUgbWF5IG5vdCBzdXBwb3J0IGl0LicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHZzU291cmNlID0gYFxuICAgIGF0dHJpYnV0ZSB2ZWM0IGFWZXJ0ZXhQb3NpdGlvbjtcblxuICAgIHVuaWZvcm0gbWF0NCB1TW9kZWxWaWV3TWF0cml4O1xuICAgIHVuaWZvcm0gbWF0NCB1UHJvamVjdGlvbk1hdHJpeDtcblxuICAgIHZvaWQgbWFpbigpIHtcbiAgICAgIGdsX1Bvc2l0aW9uID0gdVByb2plY3Rpb25NYXRyaXggKiB1TW9kZWxWaWV3TWF0cml4ICogYVZlcnRleFBvc2l0aW9uO1xuICAgIH1cbiAgYDtcblxuICBjb25zdCBmc1NvdXJjZSA9IGBcbiAgICB2b2lkIG1haW4oKSB7XG4gICAgICBnbF9GcmFnQ29sb3IgPSB2ZWM0KDEuMCwgMS4wLCAxLjAsIDEuMCk7XG4gICAgfVxuICBgO1xuXG4gIGNvbnN0IHNoYWRlclByb2dyYW0gPSBpbml0U2hhZGVyUHJvZ3JhbShnbCwgdnNTb3VyY2UsIGZzU291cmNlKTtcblxuICBjb25zdCBwcm9ncmFtSW5mbyA9IHtcbiAgICBwcm9ncmFtOiBzaGFkZXJQcm9ncmFtLFxuICAgIGF0dHJpYkxvY2F0aW9uczoge1xuICAgICAgdmVydGV4UG9zaXRpb246IGdsLmdldEF0dHJpYkxvY2F0aW9uKHNoYWRlclByb2dyYW0sICdhVmVydGV4UG9zaXRpb24nKSxcbiAgICB9LFxuICAgIHVuaWZvcm1Mb2NhdGlvbnM6IHtcbiAgICAgIHByb2plY3Rpb25NYXRyaXg6IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAndVByb2plY3Rpb25NYXRyaXgnKSxcbiAgICAgIG1vZGVsVmlld01hdHJpeDogZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICd1TW9kZWxWaWV3TWF0cml4JyksXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCBidWZmZXJzID0gaW5pdEJ1ZmZlcnMoZ2wpO1xuXG4gIGRyYXdTY2VuZShnbCwgcHJvZ3JhbUluZm8sIGJ1ZmZlcnMpO1xuXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHdlYkdMRGVtbztcblxuZnVuY3Rpb24gZHJhd1NjZW5lKGdsLCBwcm9ncmFtSW5mbywgYnVmZmVycykge1xuICBnbC5jbGVhckNvbG9yKDAuMCwgMC4wLCAwLjAsIDEuMCk7ICAvLyBDbGVhciB0byBibGFjaywgZnVsbHkgb3BhcXVlXG4gIGdsLmNsZWFyRGVwdGgoMS4wKTsgICAgICAgICAgICAgICAgIC8vIENsZWFyIGV2ZXJ5dGhpbmdcbiAgZ2wuZW5hYmxlKGdsLkRFUFRIX1RFU1QpOyAgICAgICAgICAgLy8gRW5hYmxlIGRlcHRoIHRlc3RpbmdcbiAgZ2wuZGVwdGhGdW5jKGdsLkxFUVVBTCk7ICAgICAgICAgICAgLy8gTmVhciB0aGluZ3Mgb2JzY3VyZSBmYXIgdGhpbmdzXG5cbiAgLy8gQ2xlYXIgdGhlIGNhbnZhcyBiZWZvcmUgd2Ugc3RhcnQgZHJhd2luZyBvbiBpdC5cblxuICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUIHwgZ2wuREVQVEhfQlVGRkVSX0JJVCk7XG5cbiAgLy8gQ3JlYXRlIGEgcGVyc3BlY3RpdmUgbWF0cml4LCBhIHNwZWNpYWwgbWF0cml4IHRoYXQgaXNcbiAgLy8gdXNlZCB0byBzaW11bGF0ZSB0aGUgZGlzdG9ydGlvbiBvZiBwZXJzcGVjdGl2ZSBpbiBhIGNhbWVyYS5cbiAgLy8gT3VyIGZpZWxkIG9mIHZpZXcgaXMgNDUgZGVncmVlcywgd2l0aCBhIHdpZHRoL2hlaWdodFxuICAvLyByYXRpbyB0aGF0IG1hdGNoZXMgdGhlIGRpc3BsYXkgc2l6ZSBvZiB0aGUgY2FudmFzXG4gIC8vIGFuZCB3ZSBvbmx5IHdhbnQgdG8gc2VlIG9iamVjdHMgYmV0d2VlbiAwLjEgdW5pdHNcbiAgLy8gYW5kIDEwMCB1bml0cyBhd2F5IGZyb20gdGhlIGNhbWVyYS5cblxuICBjb25zdCBmaWVsZE9mVmlldyA9IDQ1ICogTWF0aC5QSSAvIDE4MDsgICAvLyBpbiByYWRpYW5zXG4gIGNvbnN0IGFzcGVjdCA9IGdsLmNhbnZhcy5jbGllbnRXaWR0aCAvIGdsLmNhbnZhcy5jbGllbnRIZWlnaHQ7XG4gIGNvbnN0IHpOZWFyID0gMC4xO1xuICBjb25zdCB6RmFyID0gMTAwLjA7XG4gIGNvbnN0IHByb2plY3Rpb25NYXRyaXggPSBtYXQ0LmNyZWF0ZSgpO1xuXG4gIC8vIG5vdGU6IGdsbWF0cml4LmpzIGFsd2F5cyBoYXMgdGhlIGZpcnN0IGFyZ3VtZW50XG4gIC8vIGFzIHRoZSBkZXN0aW5hdGlvbiB0byByZWNlaXZlIHRoZSByZXN1bHQuXG4gIG1hdDQucGVyc3BlY3RpdmUocHJvamVjdGlvbk1hdHJpeCxcbiAgICAgIGZpZWxkT2ZWaWV3LFxuICAgICAgYXNwZWN0LFxuICAgICAgek5lYXIsXG4gICAgICB6RmFyKTtcblxuICAvLyBTZXQgdGhlIGRyYXdpbmcgcG9zaXRpb24gdG8gdGhlIFwiaWRlbnRpdHlcIiBwb2ludCwgd2hpY2ggaXNcbiAgLy8gdGhlIGNlbnRlciBvZiB0aGUgc2NlbmUuXG4gIGNvbnN0IG1vZGVsVmlld01hdHJpeCA9IG1hdDQuY3JlYXRlKCk7XG5cbiAgLy8gTm93IG1vdmUgdGhlIGRyYXdpbmcgcG9zaXRpb24gYSBiaXQgdG8gd2hlcmUgd2Ugd2FudCB0b1xuICAvLyBzdGFydCBkcmF3aW5nIHRoZSBzcXVhcmUuXG5cbiAgbWF0NC50cmFuc2xhdGUobW9kZWxWaWV3TWF0cml4LCAgICAgLy8gZGVzdGluYXRpb24gbWF0cml4XG4gICAgICBtb2RlbFZpZXdNYXRyaXgsICAgICAvLyBtYXRyaXggdG8gdHJhbnNsYXRlXG4gICAgICBbLTAuMCwgMC4wLCAtNi4wXSk7ICAvLyBhbW91bnQgdG8gdHJhbnNsYXRlXG5cbiAgLy8gVGVsbCBXZWJHTCBob3cgdG8gcHVsbCBvdXQgdGhlIHBvc2l0aW9ucyBmcm9tIHRoZSBwb3NpdGlvblxuICAvLyBidWZmZXIgaW50byB0aGUgdmVydGV4UG9zaXRpb24gYXR0cmlidXRlLlxuICB7XG4gICAgY29uc3QgbnVtQ29tcG9uZW50cyA9IDI7XG4gICAgY29uc3QgdHlwZSA9IGdsLkZMT0FUO1xuICAgIGNvbnN0IG5vcm1hbGl6ZSA9IGZhbHNlO1xuICAgIGNvbnN0IHN0cmlkZSA9IDA7XG4gICAgY29uc3Qgb2Zmc2V0ID0gMDtcbiAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgYnVmZmVycy5wb3NpdGlvbik7XG4gICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihcbiAgICAgICAgcHJvZ3JhbUluZm8uYXR0cmliTG9jYXRpb25zLnZlcnRleFBvc2l0aW9uLFxuICAgICAgICBudW1Db21wb25lbnRzLFxuICAgICAgICB0eXBlLFxuICAgICAgICBub3JtYWxpemUsXG4gICAgICAgIHN0cmlkZSxcbiAgICAgICAgb2Zmc2V0KTtcbiAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShcbiAgICAgICAgcHJvZ3JhbUluZm8uYXR0cmliTG9jYXRpb25zLnZlcnRleFBvc2l0aW9uKTtcbiAgfVxuXG4gIC8vIFRlbGwgV2ViR0wgdG8gdXNlIG91ciBwcm9ncmFtIHdoZW4gZHJhd2luZ1xuXG4gIGdsLnVzZVByb2dyYW0ocHJvZ3JhbUluZm8ucHJvZ3JhbSk7XG5cbiAgLy8gU2V0IHRoZSBzaGFkZXIgdW5pZm9ybXNcblxuICBnbC51bmlmb3JtTWF0cml4NGZ2KFxuICAgICAgcHJvZ3JhbUluZm8udW5pZm9ybUxvY2F0aW9ucy5wcm9qZWN0aW9uTWF0cml4LFxuICAgICAgZmFsc2UsXG4gICAgICBwcm9qZWN0aW9uTWF0cml4KTtcbiAgZ2wudW5pZm9ybU1hdHJpeDRmdihcbiAgICAgIHByb2dyYW1JbmZvLnVuaWZvcm1Mb2NhdGlvbnMubW9kZWxWaWV3TWF0cml4LFxuICAgICAgZmFsc2UsXG4gICAgICBtb2RlbFZpZXdNYXRyaXgpO1xuXG4gIHtcbiAgICBjb25zdCBvZmZzZXQgPSAwO1xuICAgIGNvbnN0IHZlcnRleENvdW50ID0gNDtcbiAgICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFX1NUUklQLCBvZmZzZXQsIHZlcnRleENvdW50KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpbml0U2hhZGVyUHJvZ3JhbShnbCwgdnNTb3VyY2UsIGZzU291cmNlKSB7XG4gIGNvbnN0IHZlcnRleFNoYWRlciA9IGxvYWRTaGFkZXIoZ2wsIGdsLlZFUlRFWF9TSEFERVIsIHZzU291cmNlKTtcbiAgY29uc3QgZnJhZ21lbnRTaGFkZXIgPSBsb2FkU2hhZGVyKGdsLCBnbC5GUkFHTUVOVF9TSEFERVIsIGZzU291cmNlKTtcblxuICBjb25zdCBzaGFkZXJQcm9ncmFtID0gZ2wuY3JlYXRlUHJvZ3JhbSgpO1xuICBnbC5hdHRhY2hTaGFkZXIoc2hhZGVyUHJvZ3JhbSwgdmVydGV4U2hhZGVyKTtcbiAgZ2wuYXR0YWNoU2hhZGVyKHNoYWRlclByb2dyYW0sIGZyYWdtZW50U2hhZGVyKTtcbiAgZ2wubGlua1Byb2dyYW0oc2hhZGVyUHJvZ3JhbSk7XG5cbiAgaWYgKCFnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKHNoYWRlclByb2dyYW0sIGdsLkxJTktfU1RBVFVTKSkge1xuICAgIGFsZXJ0KCdVbmFibGUgdG8gaW5pdGlhbGl6ZSB0aGUgc2hhZGVyIHByb2dyYW06ICcgKyBnbC5nZXRQcm9ncmFtSW5mb0xvZyhzaGFkZXJQcm9ncmFtKSk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICByZXR1cm4gc2hhZGVyUHJvZ3JhbTtcbn1cblxuZnVuY3Rpb24gbG9hZFNoYWRlcihnbCwgdHlwZSwgc291cmNlKSB7XG4gIGNvbnN0IHNoYWRlciA9IGdsLmNyZWF0ZVNoYWRlcih0eXBlKTtcblxuICBnbC5zaGFkZXJTb3VyY2Uoc2hhZGVyLCBzb3VyY2UpO1xuXG4gIGdsLmNvbXBpbGVTaGFkZXIoc2hhZGVyKTtcblxuICBpZiAoIWdsLmdldFNoYWRlclBhcmFtZXRlcihzaGFkZXIsIGdsLkNPTVBJTEVfU1RBVFVTKSkge1xuICAgIGFsZXJ0KCdBbiBlcnJvciBvY2N1cnJlZCBjb21waWxpbmcgdGhlIHNoYWRlcnM6ICcgKyBnbC5nZXRTaGFkZXJJbmZvTG9nKHNoYWRlcikpO1xuICAgIGdsLmRlbGV0ZVNoYWRlcihzaGFkZXIpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcmV0dXJuIHNoYWRlcjtcbn1cblxuZnVuY3Rpb24gaW5pdEJ1ZmZlcnMoZ2wpIHtcblxuICBjb25zdCBwb3NpdGlvbkJ1ZmZlciA9IGdsLmNyZWF0ZUJ1ZmZlcigpO1xuXG4gIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCBwb3NpdGlvbkJ1ZmZlcik7XG5cbiAgY29uc3QgcG9zaXRpb25zID0gW1xuICAgIDEuMCwgIDEuMCxcbiAgICAtMS4wLCAgMS4wLFxuICAgIDEuMCwgLTEuMCxcbiAgICAtMS4wLCAtMS4wLFxuICBdO1xuXG4gIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLFxuICAgICAgbmV3IEZsb2F0MzJBcnJheShwb3NpdGlvbnMpLFxuICAgICAgZ2wuU1RBVElDX0RSQVcpO1xuXG4gIHJldHVybiB7XG4gICAgcG9zaXRpb246IHBvc2l0aW9uQnVmZmVyLFxuICB9O1xufVxuIl19