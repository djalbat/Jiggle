'use strict';

var necessary = require('necessary');

var ColourCube = require('./cube/colour'),
    TextureCube = require('./cube/texture'),
    imageUtilities = require('../../utilities/image');

var asynchronousUtilities = necessary.asynchronousUtilities,
    sequence = asynchronousUtilities.sequence,
    preloadImage = imageUtilities.preloadImage;


function create(colourShader, textureShader, canvas, done) {
  var source = ['imageMap'];

  preloadImage(source, function (image) {
    var callbacks = [createColourCubeCallback, createTextureCubeCallback],
        context = {
      colourShader: colourShader,
      textureShader: textureShader
    };

    textureShader.createTexture(image, canvas);

    sequence(callbacks, done, context);
  });
}

module.exports = {
  create: create
};

function createColourCubeCallback(next, done, context) {
  var colourShader = context.colourShader,
      textureShader = context.textureShader;


  ColourCube.createElement(colourShader, textureShader);

  next();
}

function createTextureCubeCallback(next, done, context) {
  var colourShader = context.colourShader,
      textureShader = context.textureShader;


  TextureCube.createElement(colourShader, textureShader);

  next();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9leGFtcGxlcy9pbnRlcm1lZGlhdGUvY3ViZXMuanMiXSwibmFtZXMiOlsibmVjZXNzYXJ5IiwicmVxdWlyZSIsIkNvbG91ckN1YmUiLCJUZXh0dXJlQ3ViZSIsImltYWdlVXRpbGl0aWVzIiwiYXN5bmNocm9ub3VzVXRpbGl0aWVzIiwic2VxdWVuY2UiLCJwcmVsb2FkSW1hZ2UiLCJjcmVhdGUiLCJjb2xvdXJTaGFkZXIiLCJ0ZXh0dXJlU2hhZGVyIiwiY2FudmFzIiwiZG9uZSIsInNvdXJjZSIsImltYWdlIiwiY2FsbGJhY2tzIiwiY3JlYXRlQ29sb3VyQ3ViZUNhbGxiYWNrIiwiY3JlYXRlVGV4dHVyZUN1YmVDYWxsYmFjayIsImNvbnRleHQiLCJjcmVhdGVUZXh0dXJlIiwibW9kdWxlIiwiZXhwb3J0cyIsIm5leHQiLCJjcmVhdGVFbGVtZW50Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxZQUFZQyxRQUFRLFdBQVIsQ0FBbEI7O0FBRUEsSUFBTUMsYUFBYUQsUUFBUSxlQUFSLENBQW5CO0FBQUEsSUFDTUUsY0FBY0YsUUFBUSxnQkFBUixDQURwQjtBQUFBLElBRU1HLGlCQUFpQkgsUUFBUSx1QkFBUixDQUZ2Qjs7QUFJTSxJQUFFSSxxQkFBRixHQUE0QkwsU0FBNUIsQ0FBRUsscUJBQUY7QUFBQSxJQUNFQyxRQURGLEdBQ2VELHFCQURmLENBQ0VDLFFBREY7QUFBQSxJQUVFQyxZQUZGLEdBRW1CSCxjQUZuQixDQUVFRyxZQUZGOzs7QUFJTixTQUFTQyxNQUFULENBQWdCQyxZQUFoQixFQUE4QkMsYUFBOUIsRUFBNkNDLE1BQTdDLEVBQXFEQyxJQUFyRCxFQUEyRDtBQUN6RCxNQUFNQyxTQUFTLENBQ2IsVUFEYSxDQUFmOztBQUlBTixlQUFhTSxNQUFiLEVBQXFCLFVBQVNDLEtBQVQsRUFBZ0I7QUFDbkMsUUFBTUMsWUFBWSxDQUNWQyx3QkFEVSxFQUVWQyx5QkFGVSxDQUFsQjtBQUFBLFFBSU1DLFVBQVU7QUFDUlQsb0JBQWNBLFlBRE47QUFFUkMscUJBQWVBO0FBRlAsS0FKaEI7O0FBU0FBLGtCQUFjUyxhQUFkLENBQTRCTCxLQUE1QixFQUFtQ0gsTUFBbkM7O0FBRUFMLGFBQVNTLFNBQVQsRUFBb0JILElBQXBCLEVBQTBCTSxPQUExQjtBQUNELEdBYkQ7QUFjRDs7QUFFREUsT0FBT0MsT0FBUCxHQUFpQjtBQUNmYixVQUFRQTtBQURPLENBQWpCOztBQUlBLFNBQVNRLHdCQUFULENBQWtDTSxJQUFsQyxFQUF3Q1YsSUFBeEMsRUFBOENNLE9BQTlDLEVBQXVEO0FBQUEsTUFDN0NULFlBRDZDLEdBQ2JTLE9BRGEsQ0FDN0NULFlBRDZDO0FBQUEsTUFDL0JDLGFBRCtCLEdBQ2JRLE9BRGEsQ0FDL0JSLGFBRCtCOzs7QUFHckRSLGFBQVdxQixhQUFYLENBQXlCZCxZQUF6QixFQUF1Q0MsYUFBdkM7O0FBRUFZO0FBQ0Q7O0FBRUQsU0FBU0wseUJBQVQsQ0FBbUNLLElBQW5DLEVBQXlDVixJQUF6QyxFQUErQ00sT0FBL0MsRUFBd0Q7QUFBQSxNQUM5Q1QsWUFEOEMsR0FDZFMsT0FEYyxDQUM5Q1QsWUFEOEM7QUFBQSxNQUNoQ0MsYUFEZ0MsR0FDZFEsT0FEYyxDQUNoQ1IsYUFEZ0M7OztBQUd0RFAsY0FBWW9CLGFBQVosQ0FBMEJkLFlBQTFCLEVBQXdDQyxhQUF4Qzs7QUFFQVk7QUFDRCIsImZpbGUiOiJjdWJlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgbmVjZXNzYXJ5ID0gcmVxdWlyZSgnbmVjZXNzYXJ5Jyk7XG5cbmNvbnN0IENvbG91ckN1YmUgPSByZXF1aXJlKCcuL2N1YmUvY29sb3VyJyksXG4gICAgICBUZXh0dXJlQ3ViZSA9IHJlcXVpcmUoJy4vY3ViZS90ZXh0dXJlJyksXG4gICAgICBpbWFnZVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uLy4uL3V0aWxpdGllcy9pbWFnZScpO1xuXG5jb25zdCB7IGFzeW5jaHJvbm91c1V0aWxpdGllcyB9ID0gbmVjZXNzYXJ5LFxuICAgICAgeyBzZXF1ZW5jZSB9ID0gYXN5bmNocm9ub3VzVXRpbGl0aWVzLFxuICAgICAgeyBwcmVsb2FkSW1hZ2UgfSA9IGltYWdlVXRpbGl0aWVzO1xuXG5mdW5jdGlvbiBjcmVhdGUoY29sb3VyU2hhZGVyLCB0ZXh0dXJlU2hhZGVyLCBjYW52YXMsIGRvbmUpIHtcbiAgY29uc3Qgc291cmNlID0gW1xuICAgICdpbWFnZU1hcCdcbiAgXTtcblxuICBwcmVsb2FkSW1hZ2Uoc291cmNlLCBmdW5jdGlvbihpbWFnZSkge1xuICAgIGNvbnN0IGNhbGxiYWNrcyA9IFtcbiAgICAgICAgICAgIGNyZWF0ZUNvbG91ckN1YmVDYWxsYmFjayxcbiAgICAgICAgICAgIGNyZWF0ZVRleHR1cmVDdWJlQ2FsbGJhY2tcbiAgICAgICAgICBdLFxuICAgICAgICAgIGNvbnRleHQgPSB7XG4gICAgICAgICAgICBjb2xvdXJTaGFkZXI6IGNvbG91clNoYWRlcixcbiAgICAgICAgICAgIHRleHR1cmVTaGFkZXI6IHRleHR1cmVTaGFkZXJcbiAgICAgICAgICB9O1xuXG4gICAgdGV4dHVyZVNoYWRlci5jcmVhdGVUZXh0dXJlKGltYWdlLCBjYW52YXMpO1xuXG4gICAgc2VxdWVuY2UoY2FsbGJhY2tzLCBkb25lLCBjb250ZXh0KTtcbiAgfSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBjcmVhdGU6IGNyZWF0ZVxufTtcblxuZnVuY3Rpb24gY3JlYXRlQ29sb3VyQ3ViZUNhbGxiYWNrKG5leHQsIGRvbmUsIGNvbnRleHQpIHtcbiAgY29uc3QgeyBjb2xvdXJTaGFkZXIsIHRleHR1cmVTaGFkZXIgfSA9IGNvbnRleHQ7XG5cbiAgQ29sb3VyQ3ViZS5jcmVhdGVFbGVtZW50KGNvbG91clNoYWRlciwgdGV4dHVyZVNoYWRlcik7XG5cbiAgbmV4dCgpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVUZXh0dXJlQ3ViZUNhbGxiYWNrKG5leHQsIGRvbmUsIGNvbnRleHQpIHtcbiAgY29uc3QgeyBjb2xvdXJTaGFkZXIsIHRleHR1cmVTaGFkZXIgfSA9IGNvbnRleHQ7XG5cbiAgVGV4dHVyZUN1YmUuY3JlYXRlRWxlbWVudChjb2xvdXJTaGFkZXIsIHRleHR1cmVTaGFkZXIpO1xuXG4gIG5leHQoKTtcbn1cbiJdfQ==