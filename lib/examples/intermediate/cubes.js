'use strict';

var necessary = require('necessary');

var ColourCube = require('./cube/colour'),
    TextureCube = require('./cube/texture'),
    imagesUtilities = require('../../utilities/images');

var arrayUtilities = necessary.arrayUtilities,
    asynchronousUtilities = necessary.asynchronousUtilities,
    sequence = asynchronousUtilities.sequence,
    preload = imagesUtilities.preload,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third;


function create(colourShader, textureShader, canvas, done) {
      var sources = ['texture/concrete.jpg', 'texture/bricks.jpg', 'texture/grass.jpg'];

      preload(sources, function (images) {
            var callbacks = [createFirstColourCubeCallback, createSecondColourCubeCallback, createTextureCubeCallback],
                context = {
                  colourShader: colourShader,
                  textureShader: textureShader,
                  images: images,
                  canvas: canvas
            };

            sequence(callbacks, done, context);
      });
}

module.exports = {
      create: create
};

function createFirstColourCubeCallback(next, done, context) {
      var colourShader = context.colourShader,
          offsetPosition = [+2, +2, +2];


      var vertexPositionData = ColourCube.getVertexPositionData(offsetPosition),
          vertexNormalData = ColourCube.getVertexNormalData(),
          vertexIndexData = ColourCube.getVertexIndexData(),
          vertexColourData = ColourCube.getVertexColourData();

      colourShader.addVertexPositionData(vertexPositionData);
      colourShader.addVertexNormalData(vertexNormalData);
      colourShader.addVertexIndexData(vertexIndexData);
      colourShader.addVertexColourData(vertexColourData);

      next();
}

function createSecondColourCubeCallback(next, done, context) {
      var colourShader = context.colourShader,
          offsetPosition = [-2, -2, -2];


      var vertexPositionData = ColourCube.getVertexPositionData(offsetPosition),
          vertexNormalData = ColourCube.getVertexNormalData(),
          vertexIndexData = ColourCube.getVertexIndexData(),
          vertexColourData = ColourCube.getVertexColourData();

      colourShader.addVertexPositionData(vertexPositionData);
      colourShader.addVertexNormalData(vertexNormalData);
      colourShader.addVertexIndexData(vertexIndexData);
      colourShader.addVertexColourData(vertexColourData);

      next();
}

function createTextureCubeCallback(next, done, context) {
      var textureShader = context.textureShader,
          images = context.images,
          canvas = context.canvas,
          firstImage = first(images),
          secondImage = second(images),
          thirdImage = third(images),
          offsetPosition = [0, 0, 0],
          image = firstImage; ///

      var vertexPositionData = TextureCube.getVertexPositionData(offsetPosition),
          vertexNormalData = TextureCube.getVertexNormalData(),
          vertexIndexData = TextureCube.getVertexIndexData(),
          textureCoordinateData = TextureCube.getTextureCoordinateData();

      textureShader.addVertexPositionData(vertexPositionData);
      textureShader.addVertexNormalData(vertexNormalData);
      textureShader.addVertexIndexData(vertexIndexData);
      textureShader.addTextureCoordinateData(textureCoordinateData);

      textureShader.createTexture(image, canvas);

      next();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9leGFtcGxlcy9pbnRlcm1lZGlhdGUvY3ViZXMuanMiXSwibmFtZXMiOlsibmVjZXNzYXJ5IiwicmVxdWlyZSIsIkNvbG91ckN1YmUiLCJUZXh0dXJlQ3ViZSIsImltYWdlc1V0aWxpdGllcyIsImFycmF5VXRpbGl0aWVzIiwiYXN5bmNocm9ub3VzVXRpbGl0aWVzIiwic2VxdWVuY2UiLCJwcmVsb2FkIiwiZmlyc3QiLCJzZWNvbmQiLCJ0aGlyZCIsImNyZWF0ZSIsImNvbG91clNoYWRlciIsInRleHR1cmVTaGFkZXIiLCJjYW52YXMiLCJkb25lIiwic291cmNlcyIsImltYWdlcyIsImNhbGxiYWNrcyIsImNyZWF0ZUZpcnN0Q29sb3VyQ3ViZUNhbGxiYWNrIiwiY3JlYXRlU2Vjb25kQ29sb3VyQ3ViZUNhbGxiYWNrIiwiY3JlYXRlVGV4dHVyZUN1YmVDYWxsYmFjayIsImNvbnRleHQiLCJtb2R1bGUiLCJleHBvcnRzIiwibmV4dCIsIm9mZnNldFBvc2l0aW9uIiwidmVydGV4UG9zaXRpb25EYXRhIiwiZ2V0VmVydGV4UG9zaXRpb25EYXRhIiwidmVydGV4Tm9ybWFsRGF0YSIsImdldFZlcnRleE5vcm1hbERhdGEiLCJ2ZXJ0ZXhJbmRleERhdGEiLCJnZXRWZXJ0ZXhJbmRleERhdGEiLCJ2ZXJ0ZXhDb2xvdXJEYXRhIiwiZ2V0VmVydGV4Q29sb3VyRGF0YSIsImFkZFZlcnRleFBvc2l0aW9uRGF0YSIsImFkZFZlcnRleE5vcm1hbERhdGEiLCJhZGRWZXJ0ZXhJbmRleERhdGEiLCJhZGRWZXJ0ZXhDb2xvdXJEYXRhIiwiZmlyc3RJbWFnZSIsInNlY29uZEltYWdlIiwidGhpcmRJbWFnZSIsImltYWdlIiwidGV4dHVyZUNvb3JkaW5hdGVEYXRhIiwiZ2V0VGV4dHVyZUNvb3JkaW5hdGVEYXRhIiwiYWRkVGV4dHVyZUNvb3JkaW5hdGVEYXRhIiwiY3JlYXRlVGV4dHVyZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsWUFBWUMs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QUFBLFVBQzlDVCxhQUQ4QyxHQUNaUyxPQURZLENBQzlDVCxhQUQ4QztBQUFBLFVBQy9CSSxNQUQrQixHQUNaSyxPQURZLENBQy9CTCxNQUQrQjtBQUFBLFVBQ3ZCSCxNQUR1QixHQUNaUSxPQURZLENBQ3ZCUixNQUR1QjtBQUFBLFVBRWhEeUIsVUFGZ0QsR0FFbkMvQixNQUFNUyxNQUFOLENBRm1DO0FBQUEsVUFHaER1QixXQUhnRCxHQUdsQy9CLE9BQU9RLE1BQVAsQ0FIa0M7QUFBQSxVQUloRHdCLFVBSmdELEdBSW5DL0IsTUFBTU8sTUFBTixDQUptQztBQUFBLFVBS2hEUyxjQUxnRCxHQUsvQixDQUFDLENBQUQsRUFBSSxDQUFKLEVBQU8sQ0FBUCxDQUwrQjtBQUFBLFVBTWhEZ0IsS0FOZ0QsR0FNeENILFVBTndDLEVBTTVCOztBQUUxQixVQUFNWixxQkFBcUJ6QixZQUFZMEIscUJBQVosQ0FBa0NGLGNBQWxDLENBQTNCO0FBQUEsVUFDTUcsbUJBQW1CM0IsWUFBWTRCLG1CQUFaLEVBRHpCO0FBQUEsVUFFTUMsa0JBQWtCN0IsWUFBWThCLGtCQUFaLEVBRnhCO0FBQUEsVUFHTVcsd0JBQXdCekMsWUFBWTBDLHdCQUFaLEVBSDlCOztBQUtBL0Isb0JBQWNzQixxQkFBZCxDQUFvQ1Isa0JBQXBDO0FBQ0FkLG9CQUFjdUIsbUJBQWQsQ0FBa0NQLGdCQUFsQztBQUNBaEIsb0JBQWN3QixrQkFBZCxDQUFpQ04sZUFBakM7QUFDQWxCLG9CQUFjZ0Msd0JBQWQsQ0FBdUNGLHFCQUF2Qzs7QUFFQTlCLG9CQUFjaUMsYUFBZCxDQUE0QkosS0FBNUIsRUFBbUM1QixNQUFuQzs7QUFFQVc7QUFDRCIsImZpbGUiOiJjdWJlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgbmVjZXNzYXJ5ID0gcmVxdWlyZSgnbmVjZXNzYXJ5Jyk7XG5cbmNvbnN0IENvbG91ckN1YmUgPSByZXF1aXJlKCcuL2N1YmUvY29sb3VyJyksXG4gICAgICBUZXh0dXJlQ3ViZSA9IHJlcXVpcmUoJy4vY3ViZS90ZXh0dXJlJyksXG4gICAgICBpbWFnZXNVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi8uLi91dGlsaXRpZXMvaW1hZ2VzJyk7XG5cbmNvbnN0IHsgYXJyYXlVdGlsaXRpZXMsIGFzeW5jaHJvbm91c1V0aWxpdGllcyB9ID0gbmVjZXNzYXJ5LFxuICAgICAgeyBzZXF1ZW5jZSB9ID0gYXN5bmNocm9ub3VzVXRpbGl0aWVzLFxuICAgICAgeyBwcmVsb2FkIH0gPSBpbWFnZXNVdGlsaXRpZXMsXG4gICAgICB7IGZpcnN0LCBzZWNvbmQsIHRoaXJkIH0gPSBhcnJheVV0aWxpdGllcztcblxuZnVuY3Rpb24gY3JlYXRlKGNvbG91clNoYWRlciwgdGV4dHVyZVNoYWRlciwgY2FudmFzLCBkb25lKSB7XG4gIGNvbnN0IHNvdXJjZXMgPSBbXG4gICAgJ3RleHR1cmUvY29uY3JldGUuanBnJyxcbiAgICAndGV4dHVyZS9icmlja3MuanBnJyxcbiAgICAndGV4dHVyZS9ncmFzcy5qcGcnXG4gIF07XG5cbiAgcHJlbG9hZChzb3VyY2VzLCBmdW5jdGlvbihpbWFnZXMpIHtcbiAgICBjb25zdCBjYWxsYmFja3MgPSBbXG4gICAgICAgICAgICBjcmVhdGVGaXJzdENvbG91ckN1YmVDYWxsYmFjayxcbiAgICAgICAgICAgIGNyZWF0ZVNlY29uZENvbG91ckN1YmVDYWxsYmFjayxcbiAgICAgICAgICAgIGNyZWF0ZVRleHR1cmVDdWJlQ2FsbGJhY2tcbiAgICAgICAgICBdLFxuICAgICAgICAgIGNvbnRleHQgPSB7XG4gICAgICAgICAgICBjb2xvdXJTaGFkZXI6IGNvbG91clNoYWRlcixcbiAgICAgICAgICAgIHRleHR1cmVTaGFkZXI6IHRleHR1cmVTaGFkZXIsXG4gICAgICAgICAgICBpbWFnZXM6IGltYWdlcyxcbiAgICAgICAgICAgIGNhbnZhczogY2FudmFzXG4gICAgICAgICAgfTtcblxuICAgIHNlcXVlbmNlKGNhbGxiYWNrcywgZG9uZSwgY29udGV4dCk7XG4gIH0pO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgY3JlYXRlOiBjcmVhdGVcbn07XG5cbmZ1bmN0aW9uIGNyZWF0ZUZpcnN0Q29sb3VyQ3ViZUNhbGxiYWNrKG5leHQsIGRvbmUsIGNvbnRleHQpIHtcbiAgY29uc3QgeyBjb2xvdXJTaGFkZXIgfSA9IGNvbnRleHQsXG4gICAgICAgIG9mZnNldFBvc2l0aW9uID0gWysyLCArMiwgKzJdO1xuXG4gIGNvbnN0IHZlcnRleFBvc2l0aW9uRGF0YSA9IENvbG91ckN1YmUuZ2V0VmVydGV4UG9zaXRpb25EYXRhKG9mZnNldFBvc2l0aW9uKSxcbiAgICAgICAgdmVydGV4Tm9ybWFsRGF0YSA9IENvbG91ckN1YmUuZ2V0VmVydGV4Tm9ybWFsRGF0YSgpLFxuICAgICAgICB2ZXJ0ZXhJbmRleERhdGEgPSBDb2xvdXJDdWJlLmdldFZlcnRleEluZGV4RGF0YSgpLFxuICAgICAgICB2ZXJ0ZXhDb2xvdXJEYXRhID0gQ29sb3VyQ3ViZS5nZXRWZXJ0ZXhDb2xvdXJEYXRhKCk7XG5cbiAgY29sb3VyU2hhZGVyLmFkZFZlcnRleFBvc2l0aW9uRGF0YSh2ZXJ0ZXhQb3NpdGlvbkRhdGEpO1xuICBjb2xvdXJTaGFkZXIuYWRkVmVydGV4Tm9ybWFsRGF0YSh2ZXJ0ZXhOb3JtYWxEYXRhKTtcbiAgY29sb3VyU2hhZGVyLmFkZFZlcnRleEluZGV4RGF0YSh2ZXJ0ZXhJbmRleERhdGEpO1xuICBjb2xvdXJTaGFkZXIuYWRkVmVydGV4Q29sb3VyRGF0YSh2ZXJ0ZXhDb2xvdXJEYXRhKTtcblxuICBuZXh0KCk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNlY29uZENvbG91ckN1YmVDYWxsYmFjayhuZXh0LCBkb25lLCBjb250ZXh0KSB7XG4gIGNvbnN0IHsgY29sb3VyU2hhZGVyIH0gPSBjb250ZXh0LFxuICAgICAgICBvZmZzZXRQb3NpdGlvbiA9IFstMiwgLTIsIC0yXTtcblxuICBjb25zdCB2ZXJ0ZXhQb3NpdGlvbkRhdGEgPSBDb2xvdXJDdWJlLmdldFZlcnRleFBvc2l0aW9uRGF0YShvZmZzZXRQb3NpdGlvbiksXG4gICAgICAgIHZlcnRleE5vcm1hbERhdGEgPSBDb2xvdXJDdWJlLmdldFZlcnRleE5vcm1hbERhdGEoKSxcbiAgICAgICAgdmVydGV4SW5kZXhEYXRhID0gQ29sb3VyQ3ViZS5nZXRWZXJ0ZXhJbmRleERhdGEoKSxcbiAgICAgICAgdmVydGV4Q29sb3VyRGF0YSA9IENvbG91ckN1YmUuZ2V0VmVydGV4Q29sb3VyRGF0YSgpO1xuXG4gIGNvbG91clNoYWRlci5hZGRWZXJ0ZXhQb3NpdGlvbkRhdGEodmVydGV4UG9zaXRpb25EYXRhKTtcbiAgY29sb3VyU2hhZGVyLmFkZFZlcnRleE5vcm1hbERhdGEodmVydGV4Tm9ybWFsRGF0YSk7XG4gIGNvbG91clNoYWRlci5hZGRWZXJ0ZXhJbmRleERhdGEodmVydGV4SW5kZXhEYXRhKTtcbiAgY29sb3VyU2hhZGVyLmFkZFZlcnRleENvbG91ckRhdGEodmVydGV4Q29sb3VyRGF0YSk7XG5cbiAgbmV4dCgpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVUZXh0dXJlQ3ViZUNhbGxiYWNrKG5leHQsIGRvbmUsIGNvbnRleHQpIHtcbiAgY29uc3QgeyB0ZXh0dXJlU2hhZGVyLCBpbWFnZXMsIGNhbnZhcyB9ID0gY29udGV4dCxcbiAgICAgICAgZmlyc3RJbWFnZSA9IGZpcnN0KGltYWdlcyksXG4gICAgICAgIHNlY29uZEltYWdlID0gc2Vjb25kKGltYWdlcyksXG4gICAgICAgIHRoaXJkSW1hZ2UgPSB0aGlyZChpbWFnZXMpLFxuICAgICAgICBvZmZzZXRQb3NpdGlvbiA9IFswLCAwLCAwXSxcbiAgICAgICAgaW1hZ2UgPSBmaXJzdEltYWdlOyAvLy9cblxuICBjb25zdCB2ZXJ0ZXhQb3NpdGlvbkRhdGEgPSBUZXh0dXJlQ3ViZS5nZXRWZXJ0ZXhQb3NpdGlvbkRhdGEob2Zmc2V0UG9zaXRpb24pLFxuICAgICAgICB2ZXJ0ZXhOb3JtYWxEYXRhID0gVGV4dHVyZUN1YmUuZ2V0VmVydGV4Tm9ybWFsRGF0YSgpLFxuICAgICAgICB2ZXJ0ZXhJbmRleERhdGEgPSBUZXh0dXJlQ3ViZS5nZXRWZXJ0ZXhJbmRleERhdGEoKSxcbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVEYXRhID0gVGV4dHVyZUN1YmUuZ2V0VGV4dHVyZUNvb3JkaW5hdGVEYXRhKCk7XG5cbiAgdGV4dHVyZVNoYWRlci5hZGRWZXJ0ZXhQb3NpdGlvbkRhdGEodmVydGV4UG9zaXRpb25EYXRhKTtcbiAgdGV4dHVyZVNoYWRlci5hZGRWZXJ0ZXhOb3JtYWxEYXRhKHZlcnRleE5vcm1hbERhdGEpO1xuICB0ZXh0dXJlU2hhZGVyLmFkZFZlcnRleEluZGV4RGF0YSh2ZXJ0ZXhJbmRleERhdGEpO1xuICB0ZXh0dXJlU2hhZGVyLmFkZFRleHR1cmVDb29yZGluYXRlRGF0YSh0ZXh0dXJlQ29vcmRpbmF0ZURhdGEpO1xuXG4gIHRleHR1cmVTaGFkZXIuY3JlYXRlVGV4dHVyZShpbWFnZSwgY2FudmFzKTtcblxuICBuZXh0KCk7XG59XG4iXX0=