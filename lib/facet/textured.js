'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Edge = require('../edge'),
    Facet = require('../facet'),
    Normal = require('../normal'),
    Vertex = require('../vertex'),
    matrixMaths = require('../maths/matrix'),
    vectorMaths = require('../maths/vector'),
    facetUtilities = require('../utilities/facet'),
    arrayUtilities = require('../utilities/array'),
    textureUtilities = require('../utilities/texture'),
    imageMapUtilities = require('../utilities/imageMap'),
    rotationUtilities = require('../utilities/rotation'),
    quaternionUtilities = require('../utilities/quaternion');

var rotateVertices = rotationUtilities.rotateVertices,
    invert2 = matrixMaths.invert2,
    invert3 = matrixMaths.invert3,
    transform2 = vectorMaths.transform2,
    transform3 = vectorMaths.transform3,
    getImageDetails = imageMapUtilities.getImageDetails,
    cloneTextureCoordinates = textureUtilities.cloneTextureCoordinates,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    _permute = arrayUtilities.permute,
    calculateRotationQuaternion = quaternionUtilities.calculateRotationQuaternion,
    cloneEdges = facetUtilities.cloneEdges,
    cloneNormal = facetUtilities.cloneNormal,
    cloneVertices = facetUtilities.cloneVertices,
    calculateEdges = facetUtilities.calculateEdges,
    calculateNormal = facetUtilities.calculateNormal;

var TexturedFacet = function (_Facet) {
  _inherits(TexturedFacet, _Facet);

  function TexturedFacet(vertices, normal, edges, imageName, textureCoordinates) {
    _classCallCheck(this, TexturedFacet);

    var _this = _possibleConstructorReturn(this, (TexturedFacet.__proto__ || Object.getPrototypeOf(TexturedFacet)).call(this, vertices, normal, edges));

    _this.imageName = imageName;
    _this.textureCoordinates = textureCoordinates;
    return _this;
  }

  _createClass(TexturedFacet, [{
    key: 'clone',
    value: function clone() {
      var vertices = this.getVertices(),
          normal = this.getNormal(),
          edges = this.getEdges();

      vertices = cloneVertices(vertices);
      normal = cloneNormal(normal);
      edges = cloneEdges(edges);

      var imageName = this.imageName,
          textureCoordinates = cloneTextureCoordinates(this.textureCoordinates),
          texturedFacet = new TexturedFacet(vertices, normal, edges, imageName, textureCoordinates);

      return texturedFacet;
    }
  }, {
    key: 'getImageName',
    value: function getImageName() {
      return this.imageName;
    }
  }, {
    key: 'getTextureCoordinates',
    value: function getTextureCoordinates() {
      return this.textureCoordinates;
    }
  }, {
    key: 'getVertexTextureCoordinates',
    value: function getVertexTextureCoordinates() {
      var imageDetails = getImageDetails(this.imageName),
          left = imageDetails.left,
          bottom = imageDetails.bottom,
          width = imageDetails.width,
          height = imageDetails.height,
          vertexTextureCoordinates = translateTextureCoordinates(this.textureCoordinates, left, bottom, width, height);


      return vertexTextureCoordinates;
    }
  }, {
    key: 'permute',
    value: function permute(places) {
      _get(TexturedFacet.prototype.__proto__ || Object.getPrototypeOf(TexturedFacet.prototype), 'permute', this).call(this, places);

      this.textureCoordinates = _permute(this.textureCoordinates, places);
    }
  }, {
    key: 'fromVertices',
    value: function fromVertices(vertices) {
      var normal = calculateNormal(vertices, Normal),
          edges = calculateEdges(vertices, Edge),
          imageName = this.imageName,
          parentVertices = this.vertices,
          ///
      textureCoordinates = textureCoordinatesFromVerticesParentVerticesAndTextureCoordinates(vertices, parentVertices, this.textureCoordinates),
          texturedFacet = new TexturedFacet(vertices, normal, edges, imageName, textureCoordinates);

      return texturedFacet;
    }
  }], [{
    key: 'fromVertexCoordinatesImageNameAndTextureCoordinates',
    value: function fromVertexCoordinatesImageNameAndTextureCoordinates(vertexCoordinates, indexes, imageName, textureCoordinates, index) {
      textureCoordinates = textureCoordinatesFromTextureCoordinatesAndIndex(textureCoordinates, index); ///

      var vertices = verticesFromVertexCoordinatesAndIndexes(vertexCoordinates, indexes),
          normal = calculateNormal(vertices, Normal),
          edges = calculateEdges(vertices, Edge),
          texturedFacet = new TexturedFacet(vertices, normal, edges, imageName, textureCoordinates);

      return texturedFacet;
    }
  }]);

  return TexturedFacet;
}(Facet);

module.exports = TexturedFacet;

function verticesFromVertexCoordinatesAndIndexes(vertexCoordinates, indexes) {
  ///
  var vertices = indexes.map(function (index) {
    var coordinates = vertexCoordinates[index],
        ///
    vertex = Vertex.fromCoordinates(coordinates);

    return vertex;
  });

  return vertices;
}

function textureCoordinatesFromVerticesParentVerticesAndTextureCoordinates(vertices, parentVertices, textureCoordinates) {
  var normal = calculateNormal(vertices, Normal),
      rotationQuaternion = calculateRotationQuaternion(normal);

  vertices = rotateVertices(vertices, rotationQuaternion);

  parentVertices = rotateVertices(parentVertices, rotationQuaternion);

  var textureCoordinatesMatrix = calculateTextureCoordinatesMatrix(textureCoordinates),
      textureCoordinatesBasis = calculateTextureCoordinatesBasis(parentVertices, textureCoordinatesMatrix);

  textureCoordinates = calculateTextureCoordinates(vertices, textureCoordinatesBasis);

  return textureCoordinates;
}

function calculateTextureCoordinatesMatrix(textureCoordinates) {
  var firstTextureCoordinate = first(textureCoordinates),
      secondTextureCoordinate = second(textureCoordinates),
      thirdTextureCoordinate = third(textureCoordinates),
      P1u = firstTextureCoordinate[0],
      ///
  P1v = firstTextureCoordinate[1],
      ///
  P2u = secondTextureCoordinate[0],
      ///
  P2v = secondTextureCoordinate[1],
      ///
  P3u = thirdTextureCoordinate[0],
      ///
  P3v = thirdTextureCoordinate[1],
      ///
  textureCoordinatesMatrix = invert3([1, 1, 1, P1u, P2u, P3u, P1v, P2v, P3v]);

  return textureCoordinatesMatrix;
}

function calculateTextureCoordinatesBasis(parentVertices, textureCoordinatesMatrix) {
  var firstParentVertex = first(parentVertices),
      secondParentVertex = second(parentVertices),
      thirdParentVertex = third(parentVertices),
      P1x = firstParentVertex[0],
      ///
  P1y = firstParentVertex[1],
      ///
  P2x = secondParentVertex[0],
      ///
  P2y = secondParentVertex[1],
      ///
  P3x = thirdParentVertex[0],
      ///
  P3y = thirdParentVertex[1],
      ///
  xVector = transform3([P1x, P2x, P3x], textureCoordinatesMatrix),
      yVector = transform3([P1y, P2y, P3y], textureCoordinatesMatrix),
      textureCoordinatesBasis = [].concat(xVector).concat(yVector);

  return textureCoordinatesBasis;
}

function calculateTextureCoordinates(vertices, textureCoordinatesBasis) {
  var firstVertex = first(vertices),
      secondVertex = second(vertices),
      thirdVertex = third(vertices),
      R1x = firstVertex[0],
      ///
  R1y = firstVertex[1],
      ///
  R2x = secondVertex[0],
      ///
  R2y = secondVertex[1],
      ///
  R3x = thirdVertex[0],
      ///
  R3y = thirdVertex[1],
      ///
  Ox = textureCoordinatesBasis[0],
      ///
  Oy = textureCoordinatesBasis[3],
      ///
  Ux = textureCoordinatesBasis[1],
      ///
  Uy = textureCoordinatesBasis[4],
      ///
  Vx = textureCoordinatesBasis[2],
      ///
  Vy = textureCoordinatesBasis[5],
      ///
  matrix = invert2([Ux, Uy, Vx, Vy]),
      firstTextureCoordinates = transform2([R1x - Ox, R1y - Oy], matrix),
      secondTextureCoordinates = transform2([R2x - Ox, R2y - Oy], matrix),
      thirdTextureCoordinates = transform2([R3x - Ox, R3y - Oy], matrix),
      textureCoordinates = [firstTextureCoordinates, secondTextureCoordinates, thirdTextureCoordinates];

  return textureCoordinates;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9mYWNldC90ZXh0dXJlZC5qcyJdLCJuYW1lcyI6WyJFZGdlIiwicmVxdWlyZSIsIkZhY2V0IiwiTm9ybWFsIiwiVmVydGV4IiwibWF0cml4TWF0aHMiLCJ2ZWN0b3JNYXRocyIsImZhY2V0VXRpbGl0aWVzIiwiYXJyYXlVdGlsaXRpZXMiLCJ0ZXh0dXJlVXRpbGl0aWVzIiwiaW1hZ2VNYXBVdGlsaXRpZXMiLCJyb3RhdGlvblV0aWxpdGllcyIsInF1YXRlcm5pb25VdGlsaXRpZXMiLCJyb3RhdGVWZXJ0aWNlcyIsImludmVydDIiLCJpbnZlcnQzIiwidHJhbnNmb3JtMiIsInRyYW5zZm9ybTMiLCJnZXRJbWFnZURldGFpbHMiLCJjbG9uZVRleHR1cmVDb29yZGluYXRlcyIsImZpcnN0Iiwic2Vjb25kIiwidGhpcmQiLCJwZXJtdXRlIiwiY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uIiwiY2xvbmVFZGdlcyIsImNsb25lTm9ybWFsIiwiY2xvbmVWZXJ0aWNlcyIsImNhbGN1bGF0ZUVkZ2VzIiwiY2FsY3VsYXRlTm9ybWFsIiwiVGV4dHVyZWRGYWNldCIsInZlcnRpY2VzIiwibm9ybWFsIiwiZWRnZXMiLCJpbWFnZU5hbWUiLCJ0ZXh0dXJlQ29vcmRpbmF0ZXMiLCJnZXRWZXJ0aWNlcyIsImdldE5vcm1hbCIsImdldEVkZ2VzIiwidGV4dHVyZWRGYWNldCIsImxlZnQiLCJpbWFnZURldGFpbHMiLCJib3R0b20iLCJ3aWR0aCIsImhlaWdodCIsInZlcnRleFRleHR1cmVDb29yZGluYXRlcyIsInRyYW5zbGF0ZVRleHR1cmVDb29yZGluYXRlcyIsInBsYWNlcyIsInBhcmVudFZlcnRpY2VzIiwidGV4dHVyZUNvb3JkaW5hdGVzRnJvbVZlcnRpY2VzUGFyZW50VmVydGljZXNBbmRUZXh0dXJlQ29vcmRpbmF0ZXMiLCJ2ZXJ0ZXhDb29yZGluYXRlcyIsImluZGV4ZXMiLCJpbmRleCIsInRleHR1cmVDb29yZGluYXRlc0Zyb21UZXh0dXJlQ29vcmRpbmF0ZXNBbmRJbmRleCIsInZlcnRpY2VzRnJvbVZlcnRleENvb3JkaW5hdGVzQW5kSW5kZXhlcyIsIm1vZHVsZSIsImV4cG9ydHMiLCJtYXAiLCJjb29yZGluYXRlcyIsInZlcnRleCIsImZyb21Db29yZGluYXRlcyIsInJvdGF0aW9uUXVhdGVybmlvbiIsInRleHR1cmVDb29yZGluYXRlc01hdHJpeCIsImNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc01hdHJpeCIsInRleHR1cmVDb29yZGluYXRlc0Jhc2lzIiwiY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVzQmFzaXMiLCJjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZXMiLCJmaXJzdFRleHR1cmVDb29yZGluYXRlIiwic2Vjb25kVGV4dHVyZUNvb3JkaW5hdGUiLCJ0aGlyZFRleHR1cmVDb29yZGluYXRlIiwiUDF1IiwiUDF2IiwiUDJ1IiwiUDJ2IiwiUDN1IiwiUDN2IiwiZmlyc3RQYXJlbnRWZXJ0ZXgiLCJzZWNvbmRQYXJlbnRWZXJ0ZXgiLCJ0aGlyZFBhcmVudFZlcnRleCIsIlAxeCIsIlAxeSIsIlAyeCIsIlAyeSIsIlAzeCIsIlAzeSIsInhWZWN0b3IiLCJ5VmVjdG9yIiwiY29uY2F0IiwiZmlyc3RWZXJ0ZXgiLCJzZWNvbmRWZXJ0ZXgiLCJ0aGlyZFZlcnRleCIsIlIxeCIsIlIxeSIsIlIyeCIsIlIyeSIsIlIzeCIsIlIzeSIsIk94IiwiT3kiLCJVeCIsIlV5IiwiVngiLCJWeSIsIm1hdHJpeCIsImZpcnN0VGV4dHVyZUNvb3JkaW5hdGVzIiwic2Vjb25kVGV4dHVyZUNvb3JkaW5hdGVzIiwidGhpcmRUZXh0dXJlQ29vcmRpbmF0ZXMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxPQUFPQyxRQUFRLFNBQVIsQ0FBYjtBQUFBLElBQ01DLFFBQVFELFFBQVEsVUFBUixDQURkO0FBQUEsSUFFTUUsU0FBU0YsUUFBUSxXQUFSLENBRmY7QUFBQSxJQUdNRyxTQUFTSCxRQUFRLFdBQVIsQ0FIZjtBQUFBLElB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QixDQVhYO0FBQUEsTUFXd0M7QUFDbENvQyxPQUFLcEMsd0JBQXdCLENBQXhCLENBWlg7QUFBQSxNQVl3QztBQUNsQ3FDLE9BQUtyQyx3QkFBd0IsQ0FBeEIsQ0FiWDtBQUFBLE1BYXdDO0FBQ2xDc0MsT0FBS3RDLHdCQUF3QixDQUF4QixDQWRYO0FBQUEsTUFjd0M7QUFDbEN1QyxXQUFTekYsUUFBUSxDQUFFcUYsRUFBRixFQUFNQyxFQUFOLEVBQVVDLEVBQVYsRUFBY0MsRUFBZCxDQUFSLENBZmY7QUFBQSxNQWdCTUUsMEJBQTBCeEYsV0FBVyxDQUFFMkUsTUFBTU0sRUFBUixFQUFZTCxNQUFNTSxFQUFsQixDQUFYLEVBQW1DSyxNQUFuQyxDQWhCaEM7QUFBQSxNQWlCTUUsMkJBQTJCekYsV0FBVyxDQUFFNkUsTUFBTUksRUFBUixFQUFZSCxNQUFNSSxFQUFsQixDQUFYLEVBQW1DSyxNQUFuQyxDQWpCakM7QUFBQSxNQWtCTUcsMEJBQTBCMUYsV0FBVyxDQUFFK0UsTUFBTUUsRUFBUixFQUFZRCxNQUFNRSxFQUFsQixDQUFYLEVBQW1DSyxNQUFuQyxDQWxCaEM7QUFBQSxNQW1CTXBFLHFCQUFxQixDQUNuQnFFLHVCQURtQixFQUVuQkMsd0JBRm1CLEVBR25CQyx1QkFIbUIsQ0FuQjNCOztBQXlCQSxTQUFPdkUsa0JBQVA7QUFDRCIsImZpbGUiOiJ0ZXh0dXJlZC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgRWRnZSA9IHJlcXVpcmUoJy4uL2VkZ2UnKSxcbiAgICAgIEZhY2V0ID0gcmVxdWlyZSgnLi4vZmFjZXQnKSxcbiAgICAgIE5vcm1hbCA9IHJlcXVpcmUoJy4uL25vcm1hbCcpLFxuICAgICAgVmVydGV4ID0gcmVxdWlyZSgnLi4vdmVydGV4JyksXG4gICAgICBtYXRyaXhNYXRocyA9IHJlcXVpcmUoJy4uL21hdGhzL21hdHJpeCcpLFxuICAgICAgdmVjdG9yTWF0aHMgPSByZXF1aXJlKCcuLi9tYXRocy92ZWN0b3InKSxcbiAgICAgIGZhY2V0VXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2ZhY2V0JyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgdGV4dHVyZVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy90ZXh0dXJlJyksXG4gICAgICBpbWFnZU1hcFV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9pbWFnZU1hcCcpLFxuICAgICAgcm90YXRpb25VdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvcm90YXRpb24nKSxcbiAgICAgIHF1YXRlcm5pb25VdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvcXVhdGVybmlvbicpO1xuXG5jb25zdCB7IHJvdGF0ZVZlcnRpY2VzIH0gPSByb3RhdGlvblV0aWxpdGllcyxcbiAgICAgIHsgaW52ZXJ0MiwgaW52ZXJ0MyB9ID0gbWF0cml4TWF0aHMsXG4gICAgICB7IHRyYW5zZm9ybTIsIHRyYW5zZm9ybTMgfSA9IHZlY3Rvck1hdGhzLFxuICAgICAgeyBnZXRJbWFnZURldGFpbHMgfSA9IGltYWdlTWFwVXRpbGl0aWVzLFxuICAgICAgeyBjbG9uZVRleHR1cmVDb29yZGluYXRlcyB9ID0gdGV4dHVyZVV0aWxpdGllcyxcbiAgICAgIHsgZmlyc3QsIHNlY29uZCwgdGhpcmQsIHBlcm11dGUgfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBjYWxjdWxhdGVSb3RhdGlvblF1YXRlcm5pb24gfSA9IHF1YXRlcm5pb25VdGlsaXRpZXMsXG4gICAgICB7IGNsb25lRWRnZXMsIGNsb25lTm9ybWFsLCBjbG9uZVZlcnRpY2VzLCBjYWxjdWxhdGVFZGdlcywgY2FsY3VsYXRlTm9ybWFsIH0gPSBmYWNldFV0aWxpdGllcztcblxuY2xhc3MgVGV4dHVyZWRGYWNldCBleHRlbmRzIEZhY2V0IHtcbiAgY29uc3RydWN0b3IodmVydGljZXMsIG5vcm1hbCwgZWRnZXMsIGltYWdlTmFtZSwgdGV4dHVyZUNvb3JkaW5hdGVzKSB7XG4gICAgc3VwZXIodmVydGljZXMsIG5vcm1hbCwgZWRnZXMpO1xuXG4gICAgdGhpcy5pbWFnZU5hbWUgPSBpbWFnZU5hbWU7XG4gICAgdGhpcy50ZXh0dXJlQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQ29vcmRpbmF0ZXM7XG4gIH1cblxuICBjbG9uZSgpIHtcbiAgICBsZXQgdmVydGljZXMgPSB0aGlzLmdldFZlcnRpY2VzKCksXG4gICAgICAgIG5vcm1hbCA9IHRoaXMuZ2V0Tm9ybWFsKCksXG4gICAgICAgIGVkZ2VzID0gdGhpcy5nZXRFZGdlcygpO1xuXG4gICAgdmVydGljZXMgPSBjbG9uZVZlcnRpY2VzKHZlcnRpY2VzKTtcbiAgICBub3JtYWwgPSBjbG9uZU5vcm1hbChub3JtYWwpO1xuICAgIGVkZ2VzID0gY2xvbmVFZGdlcyhlZGdlcyk7XG5cbiAgICBjb25zdCBpbWFnZU5hbWUgPSB0aGlzLmltYWdlTmFtZSxcbiAgICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSBjbG9uZVRleHR1cmVDb29yZGluYXRlcyh0aGlzLnRleHR1cmVDb29yZGluYXRlcyksXG4gICAgICAgICAgdGV4dHVyZWRGYWNldCA9IG5ldyBUZXh0dXJlZEZhY2V0KHZlcnRpY2VzLCBub3JtYWwsIGVkZ2VzLCBpbWFnZU5hbWUsIHRleHR1cmVDb29yZGluYXRlcyk7XG5cbiAgICByZXR1cm4gdGV4dHVyZWRGYWNldDtcbiAgfVxuXG4gIGdldEltYWdlTmFtZSgpIHtcbiAgICByZXR1cm4gdGhpcy5pbWFnZU5hbWU7XG4gIH1cblxuICBnZXRUZXh0dXJlQ29vcmRpbmF0ZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMudGV4dHVyZUNvb3JkaW5hdGVzO1xuICB9XG5cbiAgZ2V0VmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzKCkge1xuICAgIGNvbnN0IGltYWdlRGV0YWlscyA9IGdldEltYWdlRGV0YWlscyh0aGlzLmltYWdlTmFtZSksXG4gICAgICAgICAgeyBsZWZ0LCBib3R0b20sIHdpZHRoLCBoZWlnaHQgfSA9IGltYWdlRGV0YWlscyxcbiAgICAgICAgICB2ZXJ0ZXhUZXh0dXJlQ29vcmRpbmF0ZXMgPSB0cmFuc2xhdGVUZXh0dXJlQ29vcmRpbmF0ZXModGhpcy50ZXh0dXJlQ29vcmRpbmF0ZXMsIGxlZnQsIGJvdHRvbSwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICByZXR1cm4gdmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzO1xuICB9XG5cbiAgcGVybXV0ZShwbGFjZXMpIHtcbiAgICBzdXBlci5wZXJtdXRlKHBsYWNlcyk7XG5cbiAgICB0aGlzLnRleHR1cmVDb29yZGluYXRlcyA9IHBlcm11dGUodGhpcy50ZXh0dXJlQ29vcmRpbmF0ZXMsIHBsYWNlcyk7XG4gIH1cblxuICBmcm9tVmVydGljZXModmVydGljZXMpIHtcbiAgICBjb25zdCBub3JtYWwgPSBjYWxjdWxhdGVOb3JtYWwodmVydGljZXMsIE5vcm1hbCksXG4gICAgICAgICAgZWRnZXMgPSBjYWxjdWxhdGVFZGdlcyh2ZXJ0aWNlcywgRWRnZSksXG4gICAgICAgICAgaW1hZ2VOYW1lID0gdGhpcy5pbWFnZU5hbWUsXG4gICAgICAgICAgcGFyZW50VmVydGljZXMgPSB0aGlzLnZlcnRpY2VzLCAvLy9cbiAgICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQ29vcmRpbmF0ZXNGcm9tVmVydGljZXNQYXJlbnRWZXJ0aWNlc0FuZFRleHR1cmVDb29yZGluYXRlcyh2ZXJ0aWNlcywgcGFyZW50VmVydGljZXMsIHRoaXMudGV4dHVyZUNvb3JkaW5hdGVzKSxcbiAgICAgICAgICB0ZXh0dXJlZEZhY2V0ID0gbmV3IFRleHR1cmVkRmFjZXQodmVydGljZXMsIG5vcm1hbCwgZWRnZXMsIGltYWdlTmFtZSwgdGV4dHVyZUNvb3JkaW5hdGVzKTtcblxuICAgIHJldHVybiB0ZXh0dXJlZEZhY2V0O1xuICB9XG5cbiAgc3RhdGljIGZyb21WZXJ0ZXhDb29yZGluYXRlc0ltYWdlTmFtZUFuZFRleHR1cmVDb29yZGluYXRlcyh2ZXJ0ZXhDb29yZGluYXRlcywgaW5kZXhlcywgaW1hZ2VOYW1lLCB0ZXh0dXJlQ29vcmRpbmF0ZXMsIGluZGV4KSB7XG4gICAgdGV4dHVyZUNvb3JkaW5hdGVzID0gdGV4dHVyZUNvb3JkaW5hdGVzRnJvbVRleHR1cmVDb29yZGluYXRlc0FuZEluZGV4KHRleHR1cmVDb29yZGluYXRlcywgaW5kZXgpOyAgLy8vXG5cbiAgICBjb25zdCB2ZXJ0aWNlcyA9IHZlcnRpY2VzRnJvbVZlcnRleENvb3JkaW5hdGVzQW5kSW5kZXhlcyh2ZXJ0ZXhDb29yZGluYXRlcywgaW5kZXhlcyksXG4gICAgICAgICAgbm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHZlcnRpY2VzLCBOb3JtYWwpLFxuICAgICAgICAgIGVkZ2VzID0gY2FsY3VsYXRlRWRnZXModmVydGljZXMsIEVkZ2UpLFxuICAgICAgICAgIHRleHR1cmVkRmFjZXQgPSBuZXcgVGV4dHVyZWRGYWNldCh2ZXJ0aWNlcywgbm9ybWFsLCBlZGdlcywgaW1hZ2VOYW1lLCB0ZXh0dXJlQ29vcmRpbmF0ZXMpO1xuXG4gICAgcmV0dXJuIHRleHR1cmVkRmFjZXQ7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBUZXh0dXJlZEZhY2V0O1xuXG5mdW5jdGlvbiB2ZXJ0aWNlc0Zyb21WZXJ0ZXhDb29yZGluYXRlc0FuZEluZGV4ZXModmVydGV4Q29vcmRpbmF0ZXMsIGluZGV4ZXMpIHsgIC8vL1xuICBjb25zdCB2ZXJ0aWNlcyA9IGluZGV4ZXMubWFwKGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSB2ZXJ0ZXhDb29yZGluYXRlc1tpbmRleF0sIC8vL1xuICAgICAgICAgIHZlcnRleCA9IFZlcnRleC5mcm9tQ29vcmRpbmF0ZXMoY29vcmRpbmF0ZXMpO1xuXG4gICAgcmV0dXJuIHZlcnRleDtcbiAgfSk7XG5cbiAgcmV0dXJuIHZlcnRpY2VzO1xufVxuXG5cbmZ1bmN0aW9uIHRleHR1cmVDb29yZGluYXRlc0Zyb21WZXJ0aWNlc1BhcmVudFZlcnRpY2VzQW5kVGV4dHVyZUNvb3JkaW5hdGVzKHZlcnRpY2VzLCBwYXJlbnRWZXJ0aWNlcywgdGV4dHVyZUNvb3JkaW5hdGVzKSB7XG4gIGNvbnN0IG5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCh2ZXJ0aWNlcywgTm9ybWFsKSxcbiAgICAgICAgcm90YXRpb25RdWF0ZXJuaW9uID0gY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uKG5vcm1hbCk7XG5cbiAgdmVydGljZXMgPSByb3RhdGVWZXJ0aWNlcyh2ZXJ0aWNlcywgcm90YXRpb25RdWF0ZXJuaW9uKTtcblxuICBwYXJlbnRWZXJ0aWNlcyA9IHJvdGF0ZVZlcnRpY2VzKHBhcmVudFZlcnRpY2VzLCByb3RhdGlvblF1YXRlcm5pb24pO1xuXG4gIGNvbnN0IHRleHR1cmVDb29yZGluYXRlc01hdHJpeCA9IGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc01hdHJpeCh0ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcyA9IGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc0Jhc2lzKHBhcmVudFZlcnRpY2VzLCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgpO1xuXG4gIHRleHR1cmVDb29yZGluYXRlcyA9IGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlcyh2ZXJ0aWNlcywgdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXMpO1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXM7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc01hdHJpeCh0ZXh0dXJlQ29vcmRpbmF0ZXMpIHtcbiAgY29uc3QgZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZSA9IGZpcnN0KHRleHR1cmVDb29yZGluYXRlcyksXG4gICAgICAgIHNlY29uZFRleHR1cmVDb29yZGluYXRlID0gc2Vjb25kKHRleHR1cmVDb29yZGluYXRlcyksXG4gICAgICAgIHRoaXJkVGV4dHVyZUNvb3JkaW5hdGUgPSB0aGlyZCh0ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICBQMXUgPSBmaXJzdFRleHR1cmVDb29yZGluYXRlWzBdLCAvLy9cbiAgICAgICAgUDF2ID0gZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZVsxXSwgLy8vXG4gICAgICAgIFAydSA9IHNlY29uZFRleHR1cmVDb29yZGluYXRlWzBdLCAvLy9cbiAgICAgICAgUDJ2ID0gc2Vjb25kVGV4dHVyZUNvb3JkaW5hdGVbMV0sIC8vL1xuICAgICAgICBQM3UgPSB0aGlyZFRleHR1cmVDb29yZGluYXRlWzBdLCAvLy9cbiAgICAgICAgUDN2ID0gdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZVsxXSwgLy8vXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCA9IGludmVydDMoWyAxLCAxLCAxLCBQMXUsIFAydSwgUDN1LCBQMXYsIFAydiwgUDN2IF0pO1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXg7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc0Jhc2lzKHBhcmVudFZlcnRpY2VzLCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgpIHtcbiAgY29uc3QgZmlyc3RQYXJlbnRWZXJ0ZXggPSBmaXJzdChwYXJlbnRWZXJ0aWNlcyksXG4gICAgICAgIHNlY29uZFBhcmVudFZlcnRleCA9IHNlY29uZChwYXJlbnRWZXJ0aWNlcyksXG4gICAgICAgIHRoaXJkUGFyZW50VmVydGV4ID0gdGhpcmQocGFyZW50VmVydGljZXMpLFxuICAgICAgICBQMXggPSBmaXJzdFBhcmVudFZlcnRleFswXSwgLy8vXG4gICAgICAgIFAxeSA9IGZpcnN0UGFyZW50VmVydGV4WzFdLCAvLy9cbiAgICAgICAgUDJ4ID0gc2Vjb25kUGFyZW50VmVydGV4WzBdLCAvLy9cbiAgICAgICAgUDJ5ID0gc2Vjb25kUGFyZW50VmVydGV4WzFdLCAvLy9cbiAgICAgICAgUDN4ID0gdGhpcmRQYXJlbnRWZXJ0ZXhbMF0sIC8vL1xuICAgICAgICBQM3kgPSB0aGlyZFBhcmVudFZlcnRleFsxXSwgLy8vXG4gICAgICAgIHhWZWN0b3IgPSB0cmFuc2Zvcm0zKFsgUDF4LCBQMngsIFAzeCBdLCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgpLFxuICAgICAgICB5VmVjdG9yID0gdHJhbnNmb3JtMyhbIFAxeSwgUDJ5LCBQM3kgXSwgdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4KSxcbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXMgPSBbXS5jb25jYXQoeFZlY3RvcikuY29uY2F0KHlWZWN0b3IpO1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcztcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVzKHZlcnRpY2VzLCB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcykge1xuICBjb25zdCBmaXJzdFZlcnRleCA9IGZpcnN0KHZlcnRpY2VzKSxcbiAgICAgICAgc2Vjb25kVmVydGV4ID0gc2Vjb25kKHZlcnRpY2VzKSxcbiAgICAgICAgdGhpcmRWZXJ0ZXggPSB0aGlyZCh2ZXJ0aWNlcyksXG4gICAgICAgIFIxeCA9IGZpcnN0VmVydGV4WzBdLCAgLy8vXG4gICAgICAgIFIxeSA9IGZpcnN0VmVydGV4WzFdLCAgLy8vXG4gICAgICAgIFIyeCA9IHNlY29uZFZlcnRleFswXSwgLy8vXG4gICAgICAgIFIyeSA9IHNlY29uZFZlcnRleFsxXSwgLy8vXG4gICAgICAgIFIzeCA9IHRoaXJkVmVydGV4WzBdLCAgLy8vXG4gICAgICAgIFIzeSA9IHRoaXJkVmVydGV4WzFdLCAgLy8vXG4gICAgICAgIE94ID0gdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXNbMF0sICAvLy9cbiAgICAgICAgT3kgPSB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpc1szXSwgIC8vL1xuICAgICAgICBVeCA9IHRleHR1cmVDb29yZGluYXRlc0Jhc2lzWzFdLCAgLy8vXG4gICAgICAgIFV5ID0gdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXNbNF0sICAvLy9cbiAgICAgICAgVnggPSB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpc1syXSwgIC8vL1xuICAgICAgICBWeSA9IHRleHR1cmVDb29yZGluYXRlc0Jhc2lzWzVdLCAgLy8vXG4gICAgICAgIG1hdHJpeCA9IGludmVydDIoWyBVeCwgVXksIFZ4LCBWeSBdKSxcbiAgICAgICAgZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZXMgPSB0cmFuc2Zvcm0yKFsgUjF4IC0gT3gsIFIxeSAtIE95IF0sIG1hdHJpeCksXG4gICAgICAgIHNlY29uZFRleHR1cmVDb29yZGluYXRlcyA9IHRyYW5zZm9ybTIoWyBSMnggLSBPeCwgUjJ5IC0gT3kgXSwgbWF0cml4KSxcbiAgICAgICAgdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZXMgPSB0cmFuc2Zvcm0yKFsgUjN4IC0gT3gsIFIzeSAtIE95IF0sIG1hdHJpeCksXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlcyA9IFtcbiAgICAgICAgICBmaXJzdFRleHR1cmVDb29yZGluYXRlcyxcbiAgICAgICAgICBzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZXMsXG4gICAgICAgICAgdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZXMsXG4gICAgICAgIF07XG5cbiAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlcztcbn1cbiJdfQ==