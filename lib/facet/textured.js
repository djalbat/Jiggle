'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Edge = require('../edge'),
    Facet = require('../facet'),
    Vertex = require('../vertex'),
    matrixMaths = require('../maths/matrix'),
    vectorMaths = require('../maths/vector'),
    facetUtilities = require('../utilities/facet'),
    arrayUtilities = require('../utilities/array'),
    imageMapUtilities = require('../utilities/imageMap'),
    rotationUtilities = require('../utilities/rotation'),
    quaternionUtilities = require('../utilities/quaternion');

var rotateVertices = rotationUtilities.rotateVertices,
    invert2 = matrixMaths.invert2,
    invert3 = matrixMaths.invert3,
    getImageDetails = imageMapUtilities.getImageDetails,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    _permute = arrayUtilities.permute,
    calculateRotationQuaternion = quaternionUtilities.calculateRotationQuaternion,
    add2 = vectorMaths.add2,
    multiply2 = vectorMaths.multiply2,
    transform2 = vectorMaths.transform2,
    transform3 = vectorMaths.transform3,
    cloneEdges = facetUtilities.cloneEdges,
    cloneNormal = facetUtilities.cloneNormal,
    cloneVertices = facetUtilities.cloneVertices,
    calculateEdges = facetUtilities.calculateEdges,
    calculateNormal = facetUtilities.calculateNormal;

var TexturedFacet = function (_Facet) {
  _inherits(TexturedFacet, _Facet);

  function TexturedFacet(vertices, normal, edges, imageName, textureCoordinates) {
    _classCallCheck(this, TexturedFacet);

    var _this = _possibleConstructorReturn(this, (TexturedFacet.__proto__ || Object.getPrototypeOf(TexturedFacet)).call(this, vertices, normal, edges));

    _this.imageName = imageName;
    _this.textureCoordinates = textureCoordinates;
    return _this;
  }

  _createClass(TexturedFacet, [{
    key: 'getImageName',
    value: function getImageName() {
      return this.imageName;
    }
  }, {
    key: 'getTextureCoordinates',
    value: function getTextureCoordinates() {
      return this.textureCoordinates;
    }
  }, {
    key: 'getVertexTextureCoordinates',
    value: function getVertexTextureCoordinates() {
      var imageDetails = getImageDetails(this.imageName),
          left = imageDetails.left,
          bottom = imageDetails.bottom,
          width = imageDetails.width,
          height = imageDetails.height,
          vertexTextureCoordinates = translateTextureCoordinates(this.textureCoordinates, left, bottom, width, height);


      return vertexTextureCoordinates;
    }
  }, {
    key: 'permute',
    value: function permute(places) {
      _get(TexturedFacet.prototype.__proto__ || Object.getPrototypeOf(TexturedFacet.prototype), 'permute', this).call(this, places);

      this.textureCoordinates = _permute(this.textureCoordinates, places);
    }
  }, {
    key: 'splitWithTwoNonNullIntersections',
    value: function splitWithTwoNonNullIntersections(intersections, smallerFacets, Facet) {
      _get(TexturedFacet.prototype.__proto__ || Object.getPrototypeOf(TexturedFacet.prototype), 'splitWithTwoNonNullIntersections', this).call(this, intersections, smallerFacets, this);
    } ///

  }, {
    key: 'splitWithOneNonNullIntersection',
    value: function splitWithOneNonNullIntersection(intersections, smallerFacets, Facet) {
      _get(TexturedFacet.prototype.__proto__ || Object.getPrototypeOf(TexturedFacet.prototype), 'splitWithOneNonNullIntersection', this).call(this, intersections, smallerFacets, this);
    } ///

  }, {
    key: 'clone',
    value: function clone() {
      var vertices = this.getVertices(),
          normal = this.getNormal(),
          edges = this.getEdges();

      vertices = cloneVertices(vertices);
      normal = cloneNormal(normal);
      edges = cloneEdges(edges);

      var imageName = this.imageName,
          textureCoordinates = cloneTextureCoordinates(this.textureCoordinates),
          texturedFacet = new TexturedFacet(vertices, normal, edges, imageName, textureCoordinates);

      return texturedFacet;
    }
  }, {
    key: 'fromVertices',
    value: function fromVertices(vertices) {
      var normal = calculateNormal(vertices),
          edges = calculateEdges(vertices, Edge),
          imageName = this.imageName,
          parentVertices = this.vertices,
          ///
      textureCoordinates = textureCoordinatesFromVerticesParentVerticesAndTextureCoordinates(vertices, parentVertices, this.textureCoordinates),
          texturedFacet = new TexturedFacet(vertices, normal, edges, imageName, textureCoordinates);

      return texturedFacet;
    }
  }], [{
    key: 'fromVertexCoordinatesImageNameAndTextureCoordinates',
    value: function fromVertexCoordinatesImageNameAndTextureCoordinates(vertexCoordinates, indexes, imageName, textureCoordinates, index) {
      var vertices = verticesFromVertexCoordinatesAndIndexes(vertexCoordinates, indexes);

      textureCoordinates = textureCoordinatesFromTextureCoordinatesAndIndex(textureCoordinates, index); ///

      var normal = calculateNormal(vertices),
          edges = calculateEdges(vertices, Edge),
          texturedFacet = new TexturedFacet(vertices, normal, edges, imageName, textureCoordinates);

      return texturedFacet;
    }
  }]);

  return TexturedFacet;
}(Facet);

module.exports = TexturedFacet;

function verticesFromVertexCoordinatesAndIndexes(vertexCoordinates, indexes) {
  ///
  var vertices = indexes.map(function (index) {
    var coordinates = vertexCoordinates[index],
        ///
    vertex = Vertex.fromCoordinates(coordinates);

    return vertex;
  });

  return vertices;
}

function textureCoordinatesFromTextureCoordinatesAndIndex(textureCoordinates, index) {
  ///
  textureCoordinates = textureCoordinates.slice(index * 3, index * 3 + 3); ///

  return textureCoordinates;
}

function cloneTextureCoordinates(textureCoordinates) {
  textureCoordinates = textureCoordinates.map(function (textureCoordinates) {
    ///
    textureCoordinates = textureCoordinates.slice();

    return textureCoordinates;
  });

  return textureCoordinates;
}

function translateTextureCoordinates(textureCoordinates, left, bottom, width, height) {
  textureCoordinates = textureCoordinates.map(function (textureCoordinates) {
    ///
    textureCoordinates = add2(multiply2(textureCoordinates, [width, height]), [left, bottom]);

    return textureCoordinates;
  });

  return textureCoordinates;
}

function textureCoordinatesFromVerticesParentVerticesAndTextureCoordinates(vertices, parentVertices, textureCoordinates) {
  var normal = calculateNormal(vertices),
      rotationQuaternion = calculateRotationQuaternion(normal);

  vertices = rotateVertices(vertices, rotationQuaternion);

  parentVertices = rotateVertices(parentVertices, rotationQuaternion);

  var textureCoordinatesMatrix = calculateTextureCoordinatesMatrix(textureCoordinates),
      textureCoordinatesBasis = calculateTextureCoordinatesBasis(parentVertices, textureCoordinatesMatrix);

  textureCoordinates = calculateTextureCoordinates(vertices, textureCoordinatesBasis);

  return textureCoordinates;
}

function calculateTextureCoordinatesMatrix(textureCoordinates) {
  var firstTextureCoordinate = first(textureCoordinates),
      secondTextureCoordinate = second(textureCoordinates),
      thirdTextureCoordinate = third(textureCoordinates),
      P1u = firstTextureCoordinate[0],
      ///
  P1v = firstTextureCoordinate[1],
      ///
  P2u = secondTextureCoordinate[0],
      ///
  P2v = secondTextureCoordinate[1],
      ///
  P3u = thirdTextureCoordinate[0],
      ///
  P3v = thirdTextureCoordinate[1],
      ///
  textureCoordinatesMatrix = invert3([1, 1, 1, P1u, P2u, P3u, P1v, P2v, P3v]);

  return textureCoordinatesMatrix;
}

function calculateTextureCoordinatesBasis(parentVertices, textureCoordinatesMatrix) {
  var firstParentVertex = first(parentVertices),
      secondParentVertex = second(parentVertices),
      thirdParentVertex = third(parentVertices),
      P1x = firstParentVertex[0],
      ///
  P1y = firstParentVertex[1],
      ///
  P2x = secondParentVertex[0],
      ///
  P2y = secondParentVertex[1],
      ///
  P3x = thirdParentVertex[0],
      ///
  P3y = thirdParentVertex[1],
      ///
  xVector = transform3([P1x, P2x, P3x], textureCoordinatesMatrix),
      yVector = transform3([P1y, P2y, P3y], textureCoordinatesMatrix),
      textureCoordinatesBasis = [].concat(xVector).concat(yVector);

  return textureCoordinatesBasis;
}

function calculateTextureCoordinates(vertices, textureCoordinatesBasis) {
  var firstVertex = first(vertices),
      secondVertex = second(vertices),
      thirdVertex = third(vertices),
      R1x = firstVertex[0],
      ///
  R1y = firstVertex[1],
      ///
  R2x = secondVertex[0],
      ///
  R2y = secondVertex[1],
      ///
  R3x = thirdVertex[0],
      ///
  R3y = thirdVertex[1],
      ///
  Ox = textureCoordinatesBasis[0],
      ///
  Oy = textureCoordinatesBasis[3],
      ///
  Ux = textureCoordinatesBasis[1],
      ///
  Uy = textureCoordinatesBasis[4],
      ///
  Vx = textureCoordinatesBasis[2],
      ///
  Vy = textureCoordinatesBasis[5],
      ///
  matrix = invert2([Ux, Uy, Vx, Vy]),
      firstTextureCoordinates = transform2([R1x - Ox, R1y - Oy], matrix),
      secondTextureCoordinates = transform2([R2x - Ox, R2y - Oy], matrix),
      thirdTextureCoordinates = transform2([R3x - Ox, R3y - Oy], matrix),
      textureCoordinates = [firstTextureCoordinates, secondTextureCoordinates, thirdTextureCoordinates];

  return textureCoordinates;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9mYWNldC90ZXh0dXJlZC5qcyJdLCJuYW1lcyI6WyJFZGdlIiwicmVxdWlyZSIsIkZhY2V0IiwiVmVydGV4IiwibWF0cml4TWF0aHMiLCJ2ZWN0b3JNYXRocyIsImZhY2V0VXRpbGl0aWVzIiwiYXJyYXlVdGlsaXRpZXMiLCJpbWFnZU1hcFV0aWxpdGllcyIsInJvdGF0aW9uVXRpbGl0aWVzIiwicXVhdGVybmlvblV0aWxpdGllcyIsInJvdGF0ZVZlcnRpY2VzIiwiaW52ZXJ0MiIsImludmVydDMiLCJnZXRJbWFnZURldGFpbHMiLCJmaXJzdCIsInNlY29uZCIsInRoaXJkIiwicGVybXV0ZSIsImNhbGN1bGF0ZVJvdGF0aW9uUXVhdGVybmlvbiIsImFkZDIiLCJtdWx0aXBseTIiLCJ0cmFuc2Zvcm0yIiwidHJhbnNmb3JtMyIsImNsb25lRWRnZXMiLCJjbG9uZU5vcm1hbCIsImNsb25lVmVydGljZXMiLCJjYWxjdWxhdGVFZGdlcyIsImNhbGN1bGF0ZU5vcm1hbCIsIlRleHR1cmVkRmFjZXQiLCJ2ZXJ0aWNlcyIsIm5vcm1hbCIsImVkZ2VzIiwiaW1hZ2VOYW1lIiwidGV4dHVyZUNvb3JkaW5hdGVzIiwibGVmdCIsImltYWdlRGV0YWlscyIsImJvdHRvbSIsIndpZHRoIiwiaGVpZ2h0IiwidmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzIiwidHJhbnNsYXRlVGV4dHVyZUNvb3JkaW5hdGVzIiwicGxhY2VzIiwiaW50ZXJzZWN0aW9ucyIsInNtYWxsZXJGYWNldHMiLCJnZXRWZXJ0aWNlcyIsImdldE5vcm1hbCIsImdldEVkZ2VzIiwiY2xvbmVUZXh0dXJlQ29vcmRpbmF0ZXMiLCJ0ZXh0dXJlZEZhY2V0IiwicGFyZW50VmVydGljZXMiLCJ0ZXh0dXJlQ29vcmRpbmF0ZXNGcm9tVmVydGljZXNQYXJlbnRWZXJ0aWNlc0FuZFRleHR1cmVDb29yZGluYXRlcyIsInZlcnRleENvb3JkaW5hdGVzIiwiaW5kZXhlcyIsImluZGV4IiwidmVydGljZXNGcm9tVmVydGV4Q29vcmRpbmF0ZXNBbmRJbmRleGVzIiwidGV4dHVyZUNvb3JkaW5hdGVzRnJvbVRleHR1cmVDb29yZGluYXRlc0FuZEluZGV4IiwibW9kdWxlIiwiZXhwb3J0cyIsIm1hcCIsImNvb3JkaW5hdGVzIiwidmVydGV4IiwiZnJvbUNvb3JkaW5hdGVzIiwic2xpY2UiLCJyb3RhdGlvblF1YXRlcm5pb24iLCJ0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgiLCJjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgiLCJ0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcyIsImNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc0Jhc2lzIiwiY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVzIiwiZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZSIsInNlY29uZFRleHR1cmVDb29yZGluYXRlIiwidGhpcmRUZXh0dXJlQ29vcmRpbmF0ZSIsIlAxdSIsIlAxdiIsIlAydSIsIlAydiIsIlAzdSIsIlAzdiIsImZpcnN0UGFyZW50VmVydGV4Iiwic2Vjb25kUGFyZW50VmVydGV4IiwidGhpcmRQYXJlbnRWZXJ0ZXgiLCJQMXgiLCJQMXkiLCJQMngiLCJQMnkiLCJQM3giLCJQM3kiLCJ4VmVjdG9yIiwieVZlY3RvciIsImNvbmNhdCIsImZpcnN0VmVydGV4Iiwic2Vjb25kVmVydGV4IiwidGhpcmRWZXJ0ZXgiLCJSMXgiLCJSMXkiLCJSMngiLCJSMnkiLCJSM3giLCJSM3kiLCJPeCIsIk95IiwiVXgiLCJVeSIsIlZ4IiwiVnkiLCJtYXRyaXgiLCJmaXJzdFRleHR1cmVDb29yZGluYXRlcyIsInNlY29uZFRleHR1cmVDb29yZGluYXRlcyIsInRoaXJkVGV4dHVyZUNvb3JkaW5hdGVzIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEsT0FBT0MsUUFBUSxTQUFSLENBQWI7QUFBQSxJQUNNQyxRQUFRRCxRQUFRLFVBQVIsQ0FEZDtBQUFBLElBRU1FLFNBQVNGLFFBQVEsV0FBUixDQUZmO0FBQUEsSUFHTUcsY0FBY0gsUUFBUSxpQkFBUixDQUhwQjtBQUFBLElBSU1JLGNBQWNKLFFBQVEsaUJBQVIsQ0FKcEI7QUFBQSxJQUtNSyxpQkFBaUJMLFFBQVEsb0JBQVIsQ0FMdkI7QUFBQSxJQU1NTSxpQkFBaUJOLFFBQVEsb0JBQVIsQ0FOdkI7QUFBQSxJQU9NTyxvQkFBb0JQLFFBQVEsdUJBQVIsQ0FQMUI7QUFBQSxJQVFNUSxvQkFBb0JSLFFBQVEsdUJBQVIsQ0FSMUI7QUFBQSxJQVNNUyxzQkFBc0JULFFBQVEseUJBQVIsQ0FUNUI7O0FBV00sSUFBRVUsY0FBRixHQUFxQkYsaUJBQXJCLENBQUVFLGNBQUY7QUFBQSxJQUNFQyxPQURGLEdBQ3VCUixXQUR2QixDQUNFUSxPQURGO0FBQUEsSUFDV0MsT0FEWCxHQUN1QlQsV0FEdkIsQ0FDV1MsT0FEWDtBQUFBLElBRUVDLGVBRkYsR0FFc0JOLGlCQUZ0QixDQUVFTSxlQUZGO0FBQUEsSUFHRUMsS0FIRixHQUdvQ1IsY0FIcEMsQ0FHRVEsS0FIRjtBQUFBLElBR1NDLE1BSFQsR0FHb0NULGNBSHBDLENBR1NTLE1BSFQ7QUFBQSxJQUdpQkMsS0FIakIsR0FHb0NWLGNBSHBDLENBR2lCVSxLQUhqQjtBQUFBLElBR3dCQyxRQUh4QixHQUdvQ1gsY0FIcEMsQ0FHd0JXLE9BSHhCO0FBQUEsSUFJRUMsMkJBSkYsR0FJa0NULG1CQUpsQyxDQUlFUywyQkFKRjtBQUFBLElBS0VDLElBTEYsR0FLOENmLFdBTDlDLENBS0VlLElBTEY7QUFBQSxJQUtRQyxTQUxSLEdBSzhDaEIsV0FMOUMsQ0FLUWdCLFNBTFI7QUFBQSxJQUttQkMsVUFMbkIsR0FLOENqQixXQUw5QyxDQUttQmlCLFVBTG5CO0FBQUEsSUFLK0JDLFVBTC9CLEdBSzhDbEIsV0FMOUMsQ0FLK0JrQixVQUwvQjtBQUFBLElBTUVDLFVBTkYsR0FNOEVsQixjQU45RSxDQU1Fa0IsVUFORjtBQUFBLElBTWNDLFdBTmQsR0FNOEVuQixjQU45RSxDQU1jbUIsV0FOZDtBQUFBLElBTTJCQyxhQU4zQixHQU04RXBCLGNBTjlFLENBTTJCb0IsYUFOM0I7QUFBQSxJQU0wQ0MsY0FOMUMsR0FNOEVyQixjQU45RSxDQU0wQ3FCLGNBTjFDO0FBQUEsSUFNMERDLGVBTjFELEdBTThFdEIsY0FOOUUsQ0FNMERzQixlQU4xRDs7SUFRQUMsYTs7O0FBQ0oseUJBQVlDLFFBQVosRUFBc0JDLE1BQXRCLEVBQThCQyxLQUE5QixFQUFxQ0MsU0FBckMsRUFBZ0RDLGtCQUFoRCxFQUFvRTtBQUFBOztBQUFBLDhIQUM1REosUUFENEQsRUFDbERDLE1BRGtELEVBQzFDQyxLQUQwQzs7QUFHbEUsVUFBS0MsU0FBTCxHQUFpQkEsU0FBakI7QUFDQSxVQUFLQyxrQkFBTCxHQUEwQkEsa0JBQTFCO0FBSmtFO0FBS25FOzs7O21DQUVjO0FBQ2IsYUFBTyxLQUFLRCxTQUFaO0FBQ0Q7Ozs0Q0FFdUI7QUFDdEIsYUFBTyxLQUFLQyxrQkFBWjtBQUNEOzs7a0RBRTZCO0FBQ3RCLHlCQUFlcEIsZ0JBQWdCLEtBQUttQixTQUFyQixDQUFmO0FBQUEsVUFDRUUsSUFERixHQUNrQ0MsWUFEbEMsQ0FDRUQsSUFERjtBQUFBLFVBQ1FFLE1BRFIsR0FDa0NELFlBRGxDLENBQ1FDLE1BRFI7QUFBQSxVQUNnQkMsS0FEaEIsR0FDa0NGLFlBRGxDLENBQ2dCRSxLQURoQjtBQUFBLFVBQ3VCQyxNQUR2QixHQUNrQ0gsWUFEbEMsQ0FDdUJHLE1BRHZCO0FBQUEsVUFFQUMsd0JBRkEsR0FFMkJDLDRCQUE0QixLQUFLUCxrQkFBakMsRUFBcURDLElBQXJELEVBQTJERSxNQUEzRCxFQUFtRUMsS0FBbkUsRUFBMEVDLE1BQTFFLENBRjNCOzs7QUFJTixhQUFPQyx3QkFBUDtBQUNEOzs7NEJBRU9FLE0sRUFBUTtBQUNkLDRIQUFjQSxNQUFkOztBQUVBLFdBQUtSLGtCQUFMLEdBQTBCaEIsU0FBUSxLQUFLZ0Isa0JBQWIsRUFBaUNRLE1BQWpDLENBQTFCO0FBQ0Q7OztxREFFZ0NDLGEsRUFBZUMsYSxFQUFlMUMsSyxFQUFPO0FBQUUscUpBQXVDeUMsYUFBdkMsRUFBc0RDLGFBQXRELEVBQXFFLElBQXJFO0FBQTZFLEssQ0FBQzs7OztvREFFdEhELGEsRUFBZUMsYSxFQUFlMUMsSyxFQUFPO0FBQUUsb0pBQXNDeUMsYUFBdEMsRUFBcURDLGFBQXJELEVBQW9FLElBQXBFO0FBQTRFLEssQ0FBQzs7Ozs0QkFFNUk7QUFDTixVQUFJZCxXQUFXLEtBQUtlLFdBQUwsRUFBZjtBQUFBLFVBQ0lkLFNBQVMsS0FBS2UsU0FBTCxFQURiO0FBQUEsVUFFSWQsUUFBUSxLQUFLZSxRQUFMLEVBRlo7O0FBSUFqQixpQkFBV0osY0FBY0ksUUFBZCxDQUFYO0FBQ0FDLGVBQVNOLFlBQVlNLE1BQVosQ0FBVDtBQUNBQyxjQUFRUixXQUFXUSxLQUFYLENBQVI7O0FBRUEsVUFBTUMsWUFBWSxLQUFLQSxTQUF2QjtBQUFBLFVBQ01DLHFCQUFxQmMsd0JBQXdCLEtBQUtkLGtCQUE3QixDQUQzQjtBQUFBLFVBRU1lLGdCQUFnQixJQUFJcEIsYUFBSixDQUFrQkMsUUFBbEIsRUFBNEJDLE1BQTVCLEVBQW9DQyxLQUFwQyxFQUEyQ0MsU0FBM0MsRUFBc0RDLGtCQUF0RCxDQUZ0Qjs7QUFJQSxhQUFPZSxhQUFQO0FBQ0Q7OztpQ0FFWW5CLFEsRUFBVTtBQUNyQixVQUFNQyxTQUFTSCxnQkFBZ0JFLFFBQWhCLENBQWY7QUFBQSxVQUNNRSxRQUFRTCxlQUFlRyxRQUFmLEVBQXlCOUIsSUFBekIsQ0FEZDtBQUFBLFVBRU1pQyxZQUFZLEtBQUtBLFNBRnZCO0FBQUEsVUFHTWlCLGlCQUFpQixLQUFLcEIsUUFINUI7QUFBQSxVQUdzQztBQUNoQ0ksMkJBQXFCaUIsa0VBQWtFckIsUUFBbEUsRUFBNEVvQixjQUE1RSxFQUE0RixLQUFLaEIsa0JBQWpHLENBSjNCO0FBQUEsVUFLTWUsZ0JBQWdCLElBQUlwQixhQUFKLENBQWtCQyxRQUFsQixFQUE0QkMsTUFBNUIsRUFBb0NDLEtBQXBDLEVBQTJDQyxTQUEzQyxFQUFzREMsa0JBQXRELENBTHRCOztBQU9BLGFBQU9lLGFBQVA7QUFDRDs7O3dFQUUwREcsaUIsRUFBbUJDLE8sRUFBU3BCLFMsRUFBV0Msa0IsRUFBb0JvQixLLEVBQU87QUFDM0gsVUFBTXhCLFdBQVd5Qix3Q0FBd0NILGlCQUF4QyxFQUEyREMsT0FBM0QsQ0FBakI7O0FBRUFuQiwyQkFBcUJzQixpREFBaUR0QixrQkFBakQsRUFBcUVvQixLQUFyRSxDQUFyQixDQUgySCxDQUd4Qjs7QUFFbkcsVUFBTXZCLFNBQVNILGdCQUFnQkUsUUFBaEIsQ0FBZjtBQUFBLFVBQ01FLFFBQVFMLGVBQWVHLFFBQWYsRUFBeUI5QixJQUF6QixDQURkO0FBQUEsVUFFTWlELGdCQUFnQixJQUFJcEIsYUFBSixDQUFrQkMsUUFBbEIsRUFBNEJDLE1BQTVCLEVBQW9DQyxLQUFwQyxFQUEyQ0MsU0FBM0MsRUFBc0RDLGtCQUF0RCxDQUZ0Qjs7QUFJQSxhQUFPZSxhQUFQO0FBQ0Q7Ozs7RUF2RXlCL0MsSzs7QUEwRTVCdUQsT0FBT0MsT0FBUCxHQUFpQjdCLGFBQWpCOztBQUVBLFNBQVMwQix1Q0FBVCxDQUFpREgsaUJBQWpELEVBQW9FQyxPQUFwRSxFQUE2RTtBQUFHO0FBQzlFLE1BQU12QixXQUFXdUIsUUFBUU0sR0FBUixDQUFZLFVBQVNMLEtBQVQsRUFBZ0I7QUFDM0MsUUFBTU0sY0FBY1Isa0JBQWtCRSxLQUFsQixDQUFwQjtBQUFBLFFBQThDO0FBQ3hDTyxhQUFTMUQsT0FBTzJELGVBQVAsQ0FBdUJGLFdBQXZCLENBRGY7O0FBR0EsV0FBT0MsTUFBUDtBQUNELEdBTGdCLENBQWpCOztBQU9BLFNBQU8vQixRQUFQO0FBQ0Q7O0FBRUQsU0FBUzBCLGdEQUFULENBQTBEdEIsa0JBQTFELEVBQThFb0IsS0FBOUUsRUFBcUY7QUFBRztBQUN0RnBCLHVCQUFxQkEsbUJBQW1CNkIsS0FBbkIsQ0FBeUJULFFBQVEsQ0FBakMsRUFBb0NBLFFBQVEsQ0FBUixHQUFZLENBQWhELENBQXJCLENBRG1GLENBQ1Q7O0FBRTFFLFNBQU9wQixrQkFBUDtBQUNEOztBQUVELFNBQVNjLHVCQUFULENBQWlDZCxrQkFBakMsRUFBcUQ7QUFDbkRBLHVCQUFxQkEsbUJBQW1CeUIsR0FBbkIsQ0FBdUIsVUFBU3pCLGtCQUFULEVBQTZCO0FBQUc7QUFDMUVBLHlCQUFxQkEsbUJBQW1CNkIsS0FBbkIsRUFBckI7O0FBRUEsV0FBTzdCLGtCQUFQO0FBQ0QsR0FKb0IsQ0FBckI7O0FBTUEsU0FBT0Esa0JBQVA7QUFDRDs7QUFFRCxTQUFTTywyQkFBVCxDQUFxQ1Asa0JBQXJDLEVBQXlEQyxJQUF6RCxFQUErREUsTUFBL0QsRUFBdUVDLEtBQXZFLEVBQThFQyxNQUE5RSxFQUF1RjtBQUNyRkwsdUJBQXFCQSxtQkFBbUJ5QixHQUFuQixDQUF1QixVQUFTekIsa0JBQVQsRUFBNkI7QUFBRztBQUMxRUEseUJBQXFCZCxLQUFLQyxVQUFVYSxrQkFBVixFQUE4QixDQUFFSSxLQUFGLEVBQVNDLE1BQVQsQ0FBOUIsQ0FBTCxFQUF3RCxDQUFFSixJQUFGLEVBQVFFLE1BQVIsQ0FBeEQsQ0FBckI7O0FBRUEsV0FBT0gsa0JBQVA7QUFDRCxHQUpvQixDQUFyQjs7QUFNQSxTQUFPQSxrQkFBUDtBQUNEOztBQUVELFNBQVNpQixpRUFBVCxDQUEyRXJCLFFBQTNFLEVBQXFGb0IsY0FBckYsRUFBcUdoQixrQkFBckcsRUFBeUg7QUFDdkgsTUFBTUgsU0FBU0gsZ0JBQWdCRSxRQUFoQixDQUFmO0FBQUEsTUFDTWtDLHFCQUFxQjdDLDRCQUE0QlksTUFBNUIsQ0FEM0I7O0FBR0FELGFBQVduQixlQUFlbUIsUUFBZixFQUF5QmtDLGtCQUF6QixDQUFYOztBQUVBZCxtQkFBaUJ2QyxlQUFldUMsY0FBZixFQUErQmMsa0JBQS9CLENBQWpCOztBQUVBLE1BQU1DLDJCQUEyQkMsa0NBQWtDaEMsa0JBQWxDLENBQWpDO0FBQUEsTUFDTWlDLDBCQUEwQkMsaUNBQWlDbEIsY0FBakMsRUFBaURlLHdCQUFqRCxDQURoQzs7QUFHQS9CLHVCQUFxQm1DLDRCQUE0QnZDLFFBQTVCLEVBQXNDcUMsdUJBQXRDLENBQXJCOztBQUVBLFNBQU9qQyxrQkFBUDtBQUNEOztBQUVELFNBQVNnQyxpQ0FBVCxDQUEyQ2hDLGtCQUEzQyxFQUErRDtBQUM3RCxNQUFNb0MseUJBQXlCdkQsTUFBTW1CLGtCQUFOLENBQS9CO0FBQUEsTUFDTXFDLDBCQUEwQnZELE9BQU9rQixrQkFBUCxDQURoQztBQUFBLE1BRU1zQyx5QkFBeUJ2RCxNQUFNaUIsa0JBQU4sQ0FGL0I7QUFBQSxNQUdNdUMsTUFBTUgsdUJBQXVCLENBQXZCLENBSFo7QUFBQSxNQUd1QztBQUNqQ0ksUUFBTUosdUJBQXVCLENBQXZCLENBSlo7QUFBQSxNQUl1QztBQUNqQ0ssUUFBTUosd0JBQXdCLENBQXhCLENBTFo7QUFBQSxNQUt3QztBQUNsQ0ssUUFBTUwsd0JBQXdCLENBQXhCLENBTlo7QUFBQSxNQU13QztBQUNsQ00sUUFBTUwsdUJBQXVCLENBQXZCLENBUFo7QUFBQSxNQU91QztBQUNqQ00sUUFBTU4sdUJBQXVCLENBQXZCLENBUlo7QUFBQSxNQVF1QztBQUNqQ1AsNkJBQTJCcEQsUUFBUSxDQUFFLENBQUYsRUFBSyxDQUFMLEVBQVEsQ0FBUixFQUFXNEQsR0FBWCxFQUFnQkUsR0FBaEIsRUFBcUJFLEdBQXJCLEVBQTBCSCxHQUExQixFQUErQkUsR0FBL0IsRUFBb0NFLEdBQXBDLENBQVIsQ0FUakM7O0FBV0EsU0FBT2Isd0JBQVA7QUFDRDs7QUFFRCxTQUFTRyxnQ0FBVCxDQUEwQ2xCLGNBQTFDLEVBQTBEZSx3QkFBMUQsRUFBb0Y7QUFDbEYsTUFBTWMsb0JBQW9CaEUsTUFBTW1DLGNBQU4sQ0FBMUI7QUFBQSxNQUNNOEIscUJBQXFCaEUsT0FBT2tDLGNBQVAsQ0FEM0I7QUFBQSxNQUVNK0Isb0JBQW9CaEUsTUFBTWlDLGNBQU4sQ0FGMUI7QUFBQSxNQUdNZ0MsTUFBTUgsa0JBQWtCLENBQWxCLENBSFo7QUFBQSxNQUdrQztBQUM1QkksUUFBTUosa0JBQWtCLENBQWxCLENBSlo7QUFBQSxNQUlrQztBQUM1QkssUUFBTUosbUJBQW1CLENBQW5CLENBTFo7QUFBQSxNQUttQztBQUM3QkssUUFBTUwsbUJBQW1CLENBQW5CLENBTlo7QUFBQSxNQU1tQztBQUM3Qk0sUUFBTUwsa0JBQWtCLENBQWxCLENBUFo7QUFBQSxNQU9rQztBQUM1Qk0sUUFBTU4sa0JBQWtCLENBQWxCLENBUlo7QUFBQSxNQVFrQztBQUM1Qk8sWUFBVWpFLFdBQVcsQ0FBRTJELEdBQUYsRUFBT0UsR0FBUCxFQUFZRSxHQUFaLENBQVgsRUFBOEJyQix3QkFBOUIsQ0FUaEI7QUFBQSxNQVVNd0IsVUFBVWxFLFdBQVcsQ0FBRTRELEdBQUYsRUFBT0UsR0FBUCxFQUFZRSxHQUFaLENBQVgsRUFBOEJ0Qix3QkFBOUIsQ0FWaEI7QUFBQSxNQVdNRSwwQkFBMEIsR0FBR3VCLE1BQUgsQ0FBVUYsT0FBVixFQUFtQkUsTUFBbkIsQ0FBMEJELE9BQTFCLENBWGhDOztBQWFBLFNBQU90Qix1QkFBUDtBQUNEOztBQUVELFNBQVNFLDJCQUFULENBQXFDdkMsUUFBckMsRUFBK0NxQyx1QkFBL0MsRUFBd0U7QUFDdEUsTUFBTXdCLGNBQWM1RSxNQUFNZSxRQUFOLENBQXBCO0FBQUEsTUFDTThELGVBQWU1RSxPQUFPYyxRQUFQLENBRHJCO0FBQUEsTUFFTStELGNBQWM1RSxNQUFNYSxRQUFOLENBRnBCO0FBQUEsTUFHTWdFLE1BQU1ILFlBQVksQ0FBWixDQUhaO0FBQUEsTUFHNkI7QUFDdkJJLFFBQU1KLFlBQVksQ0FBWixDQUpaO0FBQUEsTUFJNkI7QUFDdkJLLFFBQU1KLGFBQWEsQ0FBYixDQUxaO0FBQUEsTUFLNkI7QUFDdkJLLFFBQU1MLGFBQWEsQ0FBYixDQU5aO0FBQUEsTUFNNkI7QUFDdkJNLFFBQU1MLFlBQVksQ0FBWixDQVBaO0FBQUEsTUFPNkI7QUFDdkJNLFFBQU1OLFlBQVksQ0FBWixDQVJaO0FBQUEsTUFRNkI7QUFDdkJPLE9BQUtqQyx3QkFBd0IsQ0FBeEIsQ0FUWDtBQUFBLE1BU3dDO0FBQ2xDa0MsT0FBS2xDLHdCQUF3QixDQUF4QixDQVZYO0FBQUEsTUFVd0M7QUFDbENtQyxPQUFLbkMsd0JBQXdCLENBQXhCLENBWFg7QUFBQSxNQVd3QztBQUNsQ29DLE9BQUtwQyx3QkFBd0IsQ0FBeEIsQ0FaWDtBQUFBLE1BWXdDO0FBQ2xDcUMsT0FBS3JDLHdCQUF3QixDQUF4QixDQWJYO0FBQUEsTUFhd0M7QUFDbENzQyxPQUFLdEMsd0JBQXdCLENBQXhCLENBZFg7QUFBQSxNQWN3QztBQUNsQ3VDLFdBQVM5RixRQUFRLENBQUUwRixFQUFGLEVBQU1DLEVBQU4sRUFBVUMsRUFBVixFQUFjQyxFQUFkLENBQVIsQ0FmZjtBQUFBLE1BZ0JNRSwwQkFBMEJyRixXQUFXLENBQUV3RSxNQUFNTSxFQUFSLEVBQVlMLE1BQU1NLEVBQWxCLENBQVgsRUFBbUNLLE1BQW5DLENBaEJoQztBQUFBLE1BaUJNRSwyQkFBMkJ0RixXQUFXLENBQUUwRSxNQUFNSSxFQUFSLEVBQVlILE1BQU1JLEVBQWxCLENBQVgsRUFBbUNLLE1BQW5DLENBakJqQztBQUFBLE1Ba0JNRywwQkFBMEJ2RixXQUFXLENBQUU0RSxNQUFNRSxFQUFSLEVBQVlELE1BQU1FLEVBQWxCLENBQVgsRUFBbUNLLE1BQW5DLENBbEJoQztBQUFBLE1BbUJNeEUscUJBQXFCLENBQ25CeUUsdUJBRG1CLEVBRW5CQyx3QkFGbUIsRUFHbkJDLHVCQUhtQixDQW5CM0I7O0FBeUJBLFNBQU8zRSxrQkFBUDtBQUNEIiwiZmlsZSI6InRleHR1cmVkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBFZGdlID0gcmVxdWlyZSgnLi4vZWRnZScpLFxuICAgICAgRmFjZXQgPSByZXF1aXJlKCcuLi9mYWNldCcpLFxuICAgICAgVmVydGV4ID0gcmVxdWlyZSgnLi4vdmVydGV4JyksXG4gICAgICBtYXRyaXhNYXRocyA9IHJlcXVpcmUoJy4uL21hdGhzL21hdHJpeCcpLFxuICAgICAgdmVjdG9yTWF0aHMgPSByZXF1aXJlKCcuLi9tYXRocy92ZWN0b3InKSxcbiAgICAgIGZhY2V0VXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2ZhY2V0JyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgaW1hZ2VNYXBVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvaW1hZ2VNYXAnKSxcbiAgICAgIHJvdGF0aW9uVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL3JvdGF0aW9uJyksXG4gICAgICBxdWF0ZXJuaW9uVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL3F1YXRlcm5pb24nKTtcblxuY29uc3QgeyByb3RhdGVWZXJ0aWNlcyB9ID0gcm90YXRpb25VdGlsaXRpZXMsXG4gICAgICB7IGludmVydDIsIGludmVydDMgfSA9IG1hdHJpeE1hdGhzLFxuICAgICAgeyBnZXRJbWFnZURldGFpbHMgfSA9IGltYWdlTWFwVXRpbGl0aWVzLFxuICAgICAgeyBmaXJzdCwgc2Vjb25kLCB0aGlyZCwgcGVybXV0ZSB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IGNhbGN1bGF0ZVJvdGF0aW9uUXVhdGVybmlvbiB9ID0gcXVhdGVybmlvblV0aWxpdGllcyxcbiAgICAgIHsgYWRkMiwgbXVsdGlwbHkyLCB0cmFuc2Zvcm0yLCB0cmFuc2Zvcm0zIH0gPSB2ZWN0b3JNYXRocyxcbiAgICAgIHsgY2xvbmVFZGdlcywgY2xvbmVOb3JtYWwsIGNsb25lVmVydGljZXMsIGNhbGN1bGF0ZUVkZ2VzLCBjYWxjdWxhdGVOb3JtYWwgfSA9IGZhY2V0VXRpbGl0aWVzO1xuXG5jbGFzcyBUZXh0dXJlZEZhY2V0IGV4dGVuZHMgRmFjZXQge1xuICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgbm9ybWFsLCBlZGdlcywgaW1hZ2VOYW1lLCB0ZXh0dXJlQ29vcmRpbmF0ZXMpIHtcbiAgICBzdXBlcih2ZXJ0aWNlcywgbm9ybWFsLCBlZGdlcyk7XG5cbiAgICB0aGlzLmltYWdlTmFtZSA9IGltYWdlTmFtZTtcbiAgICB0aGlzLnRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlcztcbiAgfVxuXG4gIGdldEltYWdlTmFtZSgpIHtcbiAgICByZXR1cm4gdGhpcy5pbWFnZU5hbWU7XG4gIH1cblxuICBnZXRUZXh0dXJlQ29vcmRpbmF0ZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMudGV4dHVyZUNvb3JkaW5hdGVzO1xuICB9XG5cbiAgZ2V0VmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzKCkge1xuICAgIGNvbnN0IGltYWdlRGV0YWlscyA9IGdldEltYWdlRGV0YWlscyh0aGlzLmltYWdlTmFtZSksXG4gICAgICAgICAgeyBsZWZ0LCBib3R0b20sIHdpZHRoLCBoZWlnaHQgfSA9IGltYWdlRGV0YWlscyxcbiAgICAgICAgICB2ZXJ0ZXhUZXh0dXJlQ29vcmRpbmF0ZXMgPSB0cmFuc2xhdGVUZXh0dXJlQ29vcmRpbmF0ZXModGhpcy50ZXh0dXJlQ29vcmRpbmF0ZXMsIGxlZnQsIGJvdHRvbSwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICByZXR1cm4gdmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzO1xuICB9XG5cbiAgcGVybXV0ZShwbGFjZXMpIHtcbiAgICBzdXBlci5wZXJtdXRlKHBsYWNlcyk7XG5cbiAgICB0aGlzLnRleHR1cmVDb29yZGluYXRlcyA9IHBlcm11dGUodGhpcy50ZXh0dXJlQ29vcmRpbmF0ZXMsIHBsYWNlcyk7XG4gIH1cblxuICBzcGxpdFdpdGhUd29Ob25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zLCBzbWFsbGVyRmFjZXRzLCBGYWNldCkgeyBzdXBlci5zcGxpdFdpdGhUd29Ob25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zLCBzbWFsbGVyRmFjZXRzLCB0aGlzKTsgfSAvLy9cblxuICBzcGxpdFdpdGhPbmVOb25OdWxsSW50ZXJzZWN0aW9uKGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMsIEZhY2V0KSB7IHN1cGVyLnNwbGl0V2l0aE9uZU5vbk51bGxJbnRlcnNlY3Rpb24oaW50ZXJzZWN0aW9ucywgc21hbGxlckZhY2V0cywgdGhpcyk7IH0gLy8vXG5cbiAgY2xvbmUoKSB7XG4gICAgbGV0IHZlcnRpY2VzID0gdGhpcy5nZXRWZXJ0aWNlcygpLFxuICAgICAgICBub3JtYWwgPSB0aGlzLmdldE5vcm1hbCgpLFxuICAgICAgICBlZGdlcyA9IHRoaXMuZ2V0RWRnZXMoKTtcbiAgICBcbiAgICB2ZXJ0aWNlcyA9IGNsb25lVmVydGljZXModmVydGljZXMpO1xuICAgIG5vcm1hbCA9IGNsb25lTm9ybWFsKG5vcm1hbCk7XG4gICAgZWRnZXMgPSBjbG9uZUVkZ2VzKGVkZ2VzKTtcblxuICAgIGNvbnN0IGltYWdlTmFtZSA9IHRoaXMuaW1hZ2VOYW1lLFxuICAgICAgICAgIHRleHR1cmVDb29yZGluYXRlcyA9IGNsb25lVGV4dHVyZUNvb3JkaW5hdGVzKHRoaXMudGV4dHVyZUNvb3JkaW5hdGVzKSxcbiAgICAgICAgICB0ZXh0dXJlZEZhY2V0ID0gbmV3IFRleHR1cmVkRmFjZXQodmVydGljZXMsIG5vcm1hbCwgZWRnZXMsIGltYWdlTmFtZSwgdGV4dHVyZUNvb3JkaW5hdGVzKTtcblxuICAgIHJldHVybiB0ZXh0dXJlZEZhY2V0O1xuICB9XG5cbiAgZnJvbVZlcnRpY2VzKHZlcnRpY2VzKSB7XG4gICAgY29uc3Qgbm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHZlcnRpY2VzKSxcbiAgICAgICAgICBlZGdlcyA9IGNhbGN1bGF0ZUVkZ2VzKHZlcnRpY2VzLCBFZGdlKSxcbiAgICAgICAgICBpbWFnZU5hbWUgPSB0aGlzLmltYWdlTmFtZSxcbiAgICAgICAgICBwYXJlbnRWZXJ0aWNlcyA9IHRoaXMudmVydGljZXMsIC8vL1xuICAgICAgICAgIHRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlc0Zyb21WZXJ0aWNlc1BhcmVudFZlcnRpY2VzQW5kVGV4dHVyZUNvb3JkaW5hdGVzKHZlcnRpY2VzLCBwYXJlbnRWZXJ0aWNlcywgdGhpcy50ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICAgIHRleHR1cmVkRmFjZXQgPSBuZXcgVGV4dHVyZWRGYWNldCh2ZXJ0aWNlcywgbm9ybWFsLCBlZGdlcywgaW1hZ2VOYW1lLCB0ZXh0dXJlQ29vcmRpbmF0ZXMpO1xuXG4gICAgcmV0dXJuIHRleHR1cmVkRmFjZXQ7XG4gIH1cblxuICBzdGF0aWMgZnJvbVZlcnRleENvb3JkaW5hdGVzSW1hZ2VOYW1lQW5kVGV4dHVyZUNvb3JkaW5hdGVzKHZlcnRleENvb3JkaW5hdGVzLCBpbmRleGVzLCBpbWFnZU5hbWUsIHRleHR1cmVDb29yZGluYXRlcywgaW5kZXgpIHtcbiAgICBjb25zdCB2ZXJ0aWNlcyA9IHZlcnRpY2VzRnJvbVZlcnRleENvb3JkaW5hdGVzQW5kSW5kZXhlcyh2ZXJ0ZXhDb29yZGluYXRlcywgaW5kZXhlcyk7XG5cbiAgICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQ29vcmRpbmF0ZXNGcm9tVGV4dHVyZUNvb3JkaW5hdGVzQW5kSW5kZXgodGV4dHVyZUNvb3JkaW5hdGVzLCBpbmRleCk7ICAvLy9cblxuICAgIGNvbnN0IG5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCh2ZXJ0aWNlcyksXG4gICAgICAgICAgZWRnZXMgPSBjYWxjdWxhdGVFZGdlcyh2ZXJ0aWNlcywgRWRnZSksXG4gICAgICAgICAgdGV4dHVyZWRGYWNldCA9IG5ldyBUZXh0dXJlZEZhY2V0KHZlcnRpY2VzLCBub3JtYWwsIGVkZ2VzLCBpbWFnZU5hbWUsIHRleHR1cmVDb29yZGluYXRlcyk7XG5cbiAgICByZXR1cm4gdGV4dHVyZWRGYWNldDtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFRleHR1cmVkRmFjZXQ7XG5cbmZ1bmN0aW9uIHZlcnRpY2VzRnJvbVZlcnRleENvb3JkaW5hdGVzQW5kSW5kZXhlcyh2ZXJ0ZXhDb29yZGluYXRlcywgaW5kZXhlcykgeyAgLy8vXG4gIGNvbnN0IHZlcnRpY2VzID0gaW5kZXhlcy5tYXAoZnVuY3Rpb24oaW5kZXgpIHtcbiAgICBjb25zdCBjb29yZGluYXRlcyA9IHZlcnRleENvb3JkaW5hdGVzW2luZGV4XSwgLy8vXG4gICAgICAgICAgdmVydGV4ID0gVmVydGV4LmZyb21Db29yZGluYXRlcyhjb29yZGluYXRlcyk7XG5cbiAgICByZXR1cm4gdmVydGV4O1xuICB9KTtcblxuICByZXR1cm4gdmVydGljZXM7XG59XG5cbmZ1bmN0aW9uIHRleHR1cmVDb29yZGluYXRlc0Zyb21UZXh0dXJlQ29vcmRpbmF0ZXNBbmRJbmRleCh0ZXh0dXJlQ29vcmRpbmF0ZXMsIGluZGV4KSB7ICAvLy9cbiAgdGV4dHVyZUNvb3JkaW5hdGVzID0gdGV4dHVyZUNvb3JkaW5hdGVzLnNsaWNlKGluZGV4ICogMywgaW5kZXggKiAzICsgMyk7ICAvLy9cblxuICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVzO1xufVxuXG5mdW5jdGlvbiBjbG9uZVRleHR1cmVDb29yZGluYXRlcyh0ZXh0dXJlQ29vcmRpbmF0ZXMpIHtcbiAgdGV4dHVyZUNvb3JkaW5hdGVzID0gdGV4dHVyZUNvb3JkaW5hdGVzLm1hcChmdW5jdGlvbih0ZXh0dXJlQ29vcmRpbmF0ZXMpIHsgIC8vL1xuICAgIHRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlcy5zbGljZSgpO1xuXG4gICAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlcztcbiAgfSk7XG5cbiAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlcztcbn1cblxuZnVuY3Rpb24gdHJhbnNsYXRlVGV4dHVyZUNvb3JkaW5hdGVzKHRleHR1cmVDb29yZGluYXRlcywgbGVmdCwgYm90dG9tLCB3aWR0aCwgaGVpZ2h0ICkge1xuICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQ29vcmRpbmF0ZXMubWFwKGZ1bmN0aW9uKHRleHR1cmVDb29yZGluYXRlcykgeyAgLy8vXG4gICAgdGV4dHVyZUNvb3JkaW5hdGVzID0gYWRkMihtdWx0aXBseTIodGV4dHVyZUNvb3JkaW5hdGVzLCBbIHdpZHRoLCBoZWlnaHQgXSApLCBbIGxlZnQsIGJvdHRvbSBdKTtcblxuICAgIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXM7XG4gIH0pO1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXM7XG59XG5cbmZ1bmN0aW9uIHRleHR1cmVDb29yZGluYXRlc0Zyb21WZXJ0aWNlc1BhcmVudFZlcnRpY2VzQW5kVGV4dHVyZUNvb3JkaW5hdGVzKHZlcnRpY2VzLCBwYXJlbnRWZXJ0aWNlcywgdGV4dHVyZUNvb3JkaW5hdGVzKSB7XG4gIGNvbnN0IG5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCh2ZXJ0aWNlcyksXG4gICAgICAgIHJvdGF0aW9uUXVhdGVybmlvbiA9IGNhbGN1bGF0ZVJvdGF0aW9uUXVhdGVybmlvbihub3JtYWwpO1xuXG4gIHZlcnRpY2VzID0gcm90YXRlVmVydGljZXModmVydGljZXMsIHJvdGF0aW9uUXVhdGVybmlvbik7XG5cbiAgcGFyZW50VmVydGljZXMgPSByb3RhdGVWZXJ0aWNlcyhwYXJlbnRWZXJ0aWNlcywgcm90YXRpb25RdWF0ZXJuaW9uKTtcblxuICBjb25zdCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXggPSBjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgodGV4dHVyZUNvb3JkaW5hdGVzKSxcbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXMgPSBjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcyhwYXJlbnRWZXJ0aWNlcywgdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4KTtcblxuICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSBjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZXModmVydGljZXMsIHRleHR1cmVDb29yZGluYXRlc0Jhc2lzKTtcblxuICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVzO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgodGV4dHVyZUNvb3JkaW5hdGVzKSB7XG4gIGNvbnN0IGZpcnN0VGV4dHVyZUNvb3JkaW5hdGUgPSBmaXJzdCh0ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICBzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZSA9IHNlY29uZCh0ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICB0aGlyZFRleHR1cmVDb29yZGluYXRlID0gdGhpcmQodGV4dHVyZUNvb3JkaW5hdGVzKSxcbiAgICAgICAgUDF1ID0gZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZVswXSwgLy8vXG4gICAgICAgIFAxdiA9IGZpcnN0VGV4dHVyZUNvb3JkaW5hdGVbMV0sIC8vL1xuICAgICAgICBQMnUgPSBzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZVswXSwgLy8vXG4gICAgICAgIFAydiA9IHNlY29uZFRleHR1cmVDb29yZGluYXRlWzFdLCAvLy9cbiAgICAgICAgUDN1ID0gdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZVswXSwgLy8vXG4gICAgICAgIFAzdiA9IHRoaXJkVGV4dHVyZUNvb3JkaW5hdGVbMV0sIC8vL1xuICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXggPSBpbnZlcnQzKFsgMSwgMSwgMSwgUDF1LCBQMnUsIFAzdSwgUDF2LCBQMnYsIFAzdiBdKTtcblxuICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4O1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcyhwYXJlbnRWZXJ0aWNlcywgdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4KSB7XG4gIGNvbnN0IGZpcnN0UGFyZW50VmVydGV4ID0gZmlyc3QocGFyZW50VmVydGljZXMpLFxuICAgICAgICBzZWNvbmRQYXJlbnRWZXJ0ZXggPSBzZWNvbmQocGFyZW50VmVydGljZXMpLFxuICAgICAgICB0aGlyZFBhcmVudFZlcnRleCA9IHRoaXJkKHBhcmVudFZlcnRpY2VzKSxcbiAgICAgICAgUDF4ID0gZmlyc3RQYXJlbnRWZXJ0ZXhbMF0sIC8vL1xuICAgICAgICBQMXkgPSBmaXJzdFBhcmVudFZlcnRleFsxXSwgLy8vXG4gICAgICAgIFAyeCA9IHNlY29uZFBhcmVudFZlcnRleFswXSwgLy8vXG4gICAgICAgIFAyeSA9IHNlY29uZFBhcmVudFZlcnRleFsxXSwgLy8vXG4gICAgICAgIFAzeCA9IHRoaXJkUGFyZW50VmVydGV4WzBdLCAvLy9cbiAgICAgICAgUDN5ID0gdGhpcmRQYXJlbnRWZXJ0ZXhbMV0sIC8vL1xuICAgICAgICB4VmVjdG9yID0gdHJhbnNmb3JtMyhbIFAxeCwgUDJ4LCBQM3ggXSwgdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4KSxcbiAgICAgICAgeVZlY3RvciA9IHRyYW5zZm9ybTMoWyBQMXksIFAyeSwgUDN5IF0sIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCksXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlc0Jhc2lzID0gW10uY29uY2F0KHhWZWN0b3IpLmNvbmNhdCh5VmVjdG9yKTtcblxuICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXM7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlcyh2ZXJ0aWNlcywgdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXMpIHtcbiAgY29uc3QgZmlyc3RWZXJ0ZXggPSBmaXJzdCh2ZXJ0aWNlcyksXG4gICAgICAgIHNlY29uZFZlcnRleCA9IHNlY29uZCh2ZXJ0aWNlcyksXG4gICAgICAgIHRoaXJkVmVydGV4ID0gdGhpcmQodmVydGljZXMpLFxuICAgICAgICBSMXggPSBmaXJzdFZlcnRleFswXSwgIC8vL1xuICAgICAgICBSMXkgPSBmaXJzdFZlcnRleFsxXSwgIC8vL1xuICAgICAgICBSMnggPSBzZWNvbmRWZXJ0ZXhbMF0sIC8vL1xuICAgICAgICBSMnkgPSBzZWNvbmRWZXJ0ZXhbMV0sIC8vL1xuICAgICAgICBSM3ggPSB0aGlyZFZlcnRleFswXSwgIC8vL1xuICAgICAgICBSM3kgPSB0aGlyZFZlcnRleFsxXSwgIC8vL1xuICAgICAgICBPeCA9IHRleHR1cmVDb29yZGluYXRlc0Jhc2lzWzBdLCAgLy8vXG4gICAgICAgIE95ID0gdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXNbM10sICAvLy9cbiAgICAgICAgVXggPSB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpc1sxXSwgIC8vL1xuICAgICAgICBVeSA9IHRleHR1cmVDb29yZGluYXRlc0Jhc2lzWzRdLCAgLy8vXG4gICAgICAgIFZ4ID0gdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXNbMl0sICAvLy9cbiAgICAgICAgVnkgPSB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpc1s1XSwgIC8vL1xuICAgICAgICBtYXRyaXggPSBpbnZlcnQyKFsgVXgsIFV5LCBWeCwgVnkgXSksXG4gICAgICAgIGZpcnN0VGV4dHVyZUNvb3JkaW5hdGVzID0gdHJhbnNmb3JtMihbIFIxeCAtIE94LCBSMXkgLSBPeSBdLCBtYXRyaXgpLFxuICAgICAgICBzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZXMgPSB0cmFuc2Zvcm0yKFsgUjJ4IC0gT3gsIFIyeSAtIE95IF0sIG1hdHJpeCksXG4gICAgICAgIHRoaXJkVGV4dHVyZUNvb3JkaW5hdGVzID0gdHJhbnNmb3JtMihbIFIzeCAtIE94LCBSM3kgLSBPeSBdLCBtYXRyaXgpLFxuICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSBbXG4gICAgICAgICAgZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZXMsXG4gICAgICAgICAgc2Vjb25kVGV4dHVyZUNvb3JkaW5hdGVzLFxuICAgICAgICAgIHRoaXJkVGV4dHVyZUNvb3JkaW5hdGVzLFxuICAgICAgICBdO1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXM7XG59XG4iXX0=