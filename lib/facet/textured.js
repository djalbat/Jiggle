'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Edge = require('../edge'),
    Facet = require('../facet'),
    facetUtilities = require('../utilities/facet'),
    arrayUtilities = require('../utilities/array'),
    matrixUtilities = require('../utilities/matrix'),
    vectorUtilities = require('../utilities/vector'),
    imageMapUtilities = require('../utilities/imageMap'),
    rotationUtilities = require('../utilities/rotation'),
    quaternionUtilities = require('../utilities/quaternion');

var rotateVertices = rotationUtilities.rotateVertices,
    invert2 = matrixUtilities.invert2,
    invert3 = matrixUtilities.invert3,
    getImageDetails = imageMapUtilities.getImageDetails,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    _permute = arrayUtilities.permute,
    calculateRotationQuaternion = quaternionUtilities.calculateRotationQuaternion,
    add2 = vectorUtilities.add2,
    multiply2 = vectorUtilities.multiply2,
    transform2 = vectorUtilities.transform2,
    transform3 = vectorUtilities.transform3,
    cloneEdges = facetUtilities.cloneEdges,
    cloneNormal = facetUtilities.cloneNormal,
    cloneVertices = facetUtilities.cloneVertices,
    calculateEdges = facetUtilities.calculateEdges,
    calculateNormal = facetUtilities.calculateNormal;

var TexturedFacet = function (_Facet) {
  _inherits(TexturedFacet, _Facet);

  function TexturedFacet(vertices, normal, edges, imageName, textureCoordinates) {
    _classCallCheck(this, TexturedFacet);

    var _this = _possibleConstructorReturn(this, (TexturedFacet.__proto__ || Object.getPrototypeOf(TexturedFacet)).call(this, vertices, normal, edges));

    _this.imageName = imageName;
    _this.textureCoordinates = textureCoordinates;
    return _this;
  }

  _createClass(TexturedFacet, [{
    key: 'getImageName',
    value: function getImageName() {
      return this.imageName;
    }
  }, {
    key: 'getTextureCoordinates',
    value: function getTextureCoordinates() {
      return this.textureCoordinates;
    }
  }, {
    key: 'getVertexTextureCoordinates',
    value: function getVertexTextureCoordinates() {
      var imageDetails = getImageDetails(this.imageName),
          left = imageDetails.left,
          bottom = imageDetails.bottom,
          width = imageDetails.width,
          height = imageDetails.height,
          vertexTextureCoordinates = translateTextureCoordinates(this.textureCoordinates, left, bottom, width, height);


      return vertexTextureCoordinates;
    }
  }, {
    key: 'permute',
    value: function permute(places) {
      _get(TexturedFacet.prototype.__proto__ || Object.getPrototypeOf(TexturedFacet.prototype), 'permute', this).call(this, places);

      this.textureCoordinates = _permute(this.textureCoordinates, places);
    }
  }, {
    key: 'splitWithTwoNonNullIntersections',
    value: function splitWithTwoNonNullIntersections(intersections, smallerFacets, Facet) {
      _get(TexturedFacet.prototype.__proto__ || Object.getPrototypeOf(TexturedFacet.prototype), 'splitWithTwoNonNullIntersections', this).call(this, intersections, smallerFacets, this);
    } ///

  }, {
    key: 'splitWithOneNonNullIntersection',
    value: function splitWithOneNonNullIntersection(intersections, smallerFacets, Facet) {
      _get(TexturedFacet.prototype.__proto__ || Object.getPrototypeOf(TexturedFacet.prototype), 'splitWithOneNonNullIntersection', this).call(this, intersections, smallerFacets, this);
    } ///

  }, {
    key: 'clone',
    value: function clone() {
      var vertices = this.getVertices(),
          normal = this.getNormal(),
          edges = this.getEdges();

      vertices = cloneVertices(vertices);
      normal = cloneNormal(normal);
      edges = cloneEdges(edges);

      var imageName = this.imageName,
          textureCoordinates = cloneTextureCoordinates(this.textureCoordinates),
          texturedFacet = new TexturedFacet(vertices, normal, edges, imageName, textureCoordinates);

      return texturedFacet;
    }
  }, {
    key: 'fromVertices',
    value: function fromVertices(vertices) {
      var normal = calculateNormal(vertices),
          edges = calculateEdges(vertices, Edge),
          imageName = this.imageName,
          parentVertices = this.vertices,
          ///
      textureCoordinates = textureCoordinatesFromVerticesParentVerticesAndTextureCoordinates(vertices, parentVertices, this.textureCoordinates),
          texturedFacet = new TexturedFacet(vertices, normal, edges, imageName, textureCoordinates);

      return texturedFacet;
    }
  }], [{
    key: 'fromVerticesIndexesImageNameAndTextureCoordinates',
    value: function fromVerticesIndexesImageNameAndTextureCoordinates(vertices, indexes, imageName, textureCoordinates, index) {
      vertices = verticesFromVerticesAndIndexes(vertices, indexes); ///

      textureCoordinates = textureCoordinatesFromTextureCoordinatesAndIndex(textureCoordinates, index); ///

      var normal = calculateNormal(vertices),
          edges = calculateEdges(vertices, Edge),
          texturedFacet = new TexturedFacet(vertices, normal, edges, imageName, textureCoordinates);

      return texturedFacet;
    }
  }]);

  return TexturedFacet;
}(Facet);

module.exports = TexturedFacet;

function verticesFromVerticesAndIndexes(vertices, indexes) {
  ///
  vertices = indexes.map(function (index) {
    var vertex = vertices[index];

    return vertex;
  });

  return vertices;
}

function textureCoordinatesFromTextureCoordinatesAndIndex(textureCoordinates, index) {
  ///
  textureCoordinates = textureCoordinates.slice(index * 3, index * 3 + 3); ///

  return textureCoordinates;
}

function cloneTextureCoordinates(textureCoordinates) {
  textureCoordinates = textureCoordinates.map(function (textureCoordinates) {
    ///
    textureCoordinates = textureCoordinates.slice();

    return textureCoordinates;
  });

  return textureCoordinates;
}

function translateTextureCoordinates(textureCoordinates, left, bottom, width, height) {
  textureCoordinates = textureCoordinates.map(function (textureCoordinates) {
    ///
    textureCoordinates = add2(multiply2(textureCoordinates, [width, height]), [left, bottom]);

    return textureCoordinates;
  });

  return textureCoordinates;
}

function textureCoordinatesFromVerticesParentVerticesAndTextureCoordinates(vertices, parentVertices, textureCoordinates) {
  var normal = calculateNormal(vertices),
      rotationQuaternion = calculateRotationQuaternion(normal),
      verticesInXYPlane = rotateVertices(vertices, rotationQuaternion),
      parentVerticesInXYPlane = rotateVertices(parentVertices, rotationQuaternion),
      textureCoordinatesMatrix = calculateTextureCoordinatesMatrix(textureCoordinates),
      textureCoordinatesBasis = calculateTextureCoordinatesBasis(parentVerticesInXYPlane, textureCoordinatesMatrix);

  textureCoordinates = calculateTextureCoordinates(verticesInXYPlane, textureCoordinatesBasis);

  return textureCoordinates;
}

function calculateTextureCoordinatesMatrix(textureCoordinates) {
  var firstTextureCoordinate = first(textureCoordinates),
      secondTextureCoordinate = second(textureCoordinates),
      thirdTextureCoordinate = third(textureCoordinates),
      P1u = firstTextureCoordinate[0],
      ///
  P1v = firstTextureCoordinate[1],
      ///
  P2u = secondTextureCoordinate[0],
      ///
  P2v = secondTextureCoordinate[1],
      ///
  P3u = thirdTextureCoordinate[0],
      ///
  P3v = thirdTextureCoordinate[1],
      ///
  textureCoordinatesMatrix = invert3([1, 1, 1, P1u, P2u, P3u, P1v, P2v, P3v]);

  return textureCoordinatesMatrix;
}

function calculateTextureCoordinatesBasis(parentVerticesInXYPlane, textureCoordinatesMatrix) {
  var firstParentVertexInXYPlane = first(parentVerticesInXYPlane),
      secondParentVertexInXYPlane = second(parentVerticesInXYPlane),
      thirdParentVertexInXYPlane = third(parentVerticesInXYPlane),
      P1x = firstParentVertexInXYPlane[0],
      ///
  P1y = firstParentVertexInXYPlane[1],
      ///
  P2x = secondParentVertexInXYPlane[0],
      ///
  P2y = secondParentVertexInXYPlane[1],
      ///
  P3x = thirdParentVertexInXYPlane[0],
      ///
  P3y = thirdParentVertexInXYPlane[1],
      ///
  xVector = transform3([P1x, P2x, P3x], textureCoordinatesMatrix),
      yVector = transform3([P1y, P2y, P3y], textureCoordinatesMatrix),
      textureCoordinatesBasis = [].concat(xVector).concat(yVector);

  return textureCoordinatesBasis;
}

function calculateTextureCoordinates(verticesInXYPlane, textureCoordinatesBasis) {
  var firstVertexInXYPlane = first(verticesInXYPlane),
      secondVertexInXYPlane = second(verticesInXYPlane),
      thirdVertexInXYPlane = third(verticesInXYPlane),
      R1x = firstVertexInXYPlane[0],
      ///
  R1y = firstVertexInXYPlane[1],
      ///
  R2x = secondVertexInXYPlane[0],
      ///
  R2y = secondVertexInXYPlane[1],
      ///
  R3x = thirdVertexInXYPlane[0],
      ///
  R3y = thirdVertexInXYPlane[1],
      ///
  Ox = textureCoordinatesBasis[0],
      ///
  Oy = textureCoordinatesBasis[3],
      ///
  Ux = textureCoordinatesBasis[1],
      ///
  Uy = textureCoordinatesBasis[4],
      ///
  Vx = textureCoordinatesBasis[2],
      ///
  Vy = textureCoordinatesBasis[5],
      ///
  matrix = invert2([Ux, Uy, Vx, Vy]),
      firstTextureCoordinates = transform2([R1x - Ox, R1y - Oy], matrix),
      secondTextureCoordinates = transform2([R2x - Ox, R2y - Oy], matrix),
      thirdTextureCoordinates = transform2([R3x - Ox, R3y - Oy], matrix),
      textureCoordinates = [firstTextureCoordinates, secondTextureCoordinates, thirdTextureCoordinates];

  return textureCoordinates;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9mYWNldC90ZXh0dXJlZC5qcyJdLCJuYW1lcyI6WyJFZGdlIiwicmVxdWlyZSIsIkZhY2V0IiwiZmFjZXRVdGlsaXRpZXMiLCJhcnJheVV0aWxpdGllcyIsIm1hdHJpeFV0aWxpdGllcyIsInZlY3RvclV0aWxpdGllcyIsImltYWdlTWFwVXRpbGl0aWVzIiwicm90YXRpb25VdGlsaXRpZXMiLCJxdWF0ZXJuaW9uVXRpbGl0aWVzIiwicm90YXRlVmVydGljZXMiLCJpbnZlcnQyIiwiaW52ZXJ0MyIsImdldEltYWdlRGV0YWlscyIsImZpcnN0Iiwic2Vjb25kIiwidGhpcmQiLCJwZXJtdXRlIiwiY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uIiwiYWRkMiIsIm11bHRpcGx5MiIsInRyYW5zZm9ybTIiLCJ0cmFuc2Zvcm0zIiwiY2xvbmVFZGdlcyIsImNsb25lTm9ybWFsIiwiY2xvbmVWZXJ0aWNlcyIsImNhbGN1bGF0ZUVkZ2VzIiwiY2FsY3VsYXRlTm9ybWFsIiwiVGV4dHVyZWRGYWNldCIsInZlcnRpY2VzIiwibm9ybWFsIiwiZWRnZXMiLCJpbWFnZU5hbWUiLCJ0ZXh0dXJlQ29vcmRpbmF0ZXMiLCJsZWZ0IiwiaW1hZ2VEZXRhaWxzIiwiYm90dG9tIiwid2lkdGgiLCJoZWlnaHQiLCJ2ZXJ0ZXhUZXh0dXJlQ29vcmRpbmF0ZXMiLCJ0cmFuc2xhdGVUZXh0dXJlQ29vcmRpbmF0ZXMiLCJwbGFjZXMiLCJpbnRlcnNlY3Rpb25zIiwic21hbGxlckZhY2V0cyIsImdldFZlcnRpY2VzIiwiZ2V0Tm9ybWFsIiwiZ2V0RWRnZXMiLCJjbG9uZVRleHR1cmVDb29yZGluYXRlcyIsInRleHR1cmVkRmFjZXQiLCJwYXJlbnRWZXJ0aWNlcyIsInRleHR1cmVDb29yZGluYXRlc0Zyb21WZXJ0aWNlc1BhcmVudFZlcnRpY2VzQW5kVGV4dHVyZUNvb3JkaW5hdGVzIiwiaW5kZXhlcyIsImluZGV4IiwidmVydGljZXNGcm9tVmVydGljZXNBbmRJbmRleGVzIiwidGV4dHVyZUNvb3JkaW5hdGVzRnJvbVRleHR1cmVDb29yZGluYXRlc0FuZEluZGV4IiwibW9kdWxlIiwiZXhwb3J0cyIsIm1hcCIsInZlcnRleCIsInNsaWNlIiwicm90YXRpb25RdWF0ZXJuaW9uIiwidmVydGljZXNJblhZUGxhbmUiLCJwYXJlbnRWZXJ0aWNlc0luWFlQbGFuZSIsInRleHR1cmVDb29yZGluYXRlc01hdHJpeCIsImNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc01hdHJpeCIsInRleHR1cmVDb29yZGluYXRlc0Jhc2lzIiwiY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVzQmFzaXMiLCJjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZXMiLCJmaXJzdFRleHR1cmVDb29yZGluYXRlIiwic2Vjb25kVGV4dHVyZUNvb3JkaW5hdGUiLCJ0aGlyZFRleHR1cmVDb29yZGluYXRlIiwiUDF1IiwiUDF2IiwiUDJ1IiwiUDJ2IiwiUDN1IiwiUDN2IiwiZmlyc3RQYXJlbnRWZXJ0ZXhJblhZUGxhbmUiLCJzZWNvbmRQYXJlbnRWZXJ0ZXhJblhZUGxhbmUiLCJ0aGlyZFBhcmVudFZlcnRleEluWFlQbGFuZSIsIlAxeCIsIlAxeSIsIlAyeCIsIlAyeSIsIlAzeCIsIlAzeSIsInhWZWN0b3IiLCJ5VmVjdG9yIiwiY29uY2F0IiwiZmlyc3RWZXJ0ZXhJblhZUGxhbmUiLCJzZWNvbmRWZXJ0ZXhJblhZUGxhbmUiLCJ0aGlyZFZlcnRleEluWFlQbGFuZSIsIlIxeCIsIlIxeSIsIlIyeCIsIlIyeSIsIlIzeCIsIlIzeSIsIk94IiwiT3kiLCJVeCIsIlV5IiwiVngiLCJWeSIsIm1hdHJpeCIsImZpcnN0VGV4dHVyZUNvb3JkaW5hdGVzIiwic2Vjb25kVGV4dHVyZUNvb3JkaW5hdGVzIiwidGhpcmRUZXh0dXJlQ29vcmRpbmF0ZXMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxPQUFPQyxRQUFRLFNBQVIsQ0FBYjtBQUFBLElBQ01DLFFBQVFELFFBQVEsVUFBUixDQURkO0FB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QVpYO0FBQUEsTUFZd0M7QUFDbENxQyxPQUFLckMsd0JBQXdCLENBQXhCLENBYlg7QUFBQSxNQWF3QztBQUNsQ3NDLE9BQUt0Qyx3QkFBd0IsQ0FBeEIsQ0FkWDtBQUFBLE1BY3dDO0FBQ2xDdUMsV0FBUzdGLFFBQVEsQ0FBRXlGLEVBQUYsRUFBTUMsRUFBTixFQUFVQyxFQUFWLEVBQWNDLEVBQWQsQ0FBUixDQWZmO0FBQUEsTUFnQk1FLDBCQUEwQnBGLFdBQVcsQ0FBRXVFLE1BQU1NLEVBQVIsRUFBWUwsTUFBTU0sRUFBbEIsQ0FBWCxFQUFtQ0ssTUFBbkMsQ0FoQmhDO0FBQUEsTUFpQk1FLDJCQUEyQnJGLFdBQVcsQ0FBRXlFLE1BQU1JLEVBQVIsRUFBWUgsTUFBTUksRUFBbEIsQ0FBWCxFQUFtQ0ssTUFBbkMsQ0FqQmpDO0FBQUEsTUFrQk1HLDBCQUEwQnRGLFdBQVcsQ0FBRTJFLE1BQU1FLEVBQVIsRUFBWUQsTUFBTUUsRUFBbEIsQ0FBWCxFQUFtQ0ssTUFBbkMsQ0FsQmhDO0FBQUEsTUFtQk12RSxxQkFBcUIsQ0FDbkJ3RSx1QkFEbUIsRUFFbkJDLHdCQUZtQixFQUduQkMsdUJBSG1CLENBbkIzQjs7QUF5QkEsU0FBTzFFLGtCQUFQO0FBQ0QiLCJmaWxlIjoidGV4dHVyZWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IEVkZ2UgPSByZXF1aXJlKCcuLi9lZGdlJyksXG4gICAgICBGYWNldCA9IHJlcXVpcmUoJy4uL2ZhY2V0JyksXG4gICAgICBmYWNldFV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9mYWNldCcpLFxuICAgICAgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvYXJyYXknKSxcbiAgICAgIG1hdHJpeFV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9tYXRyaXgnKSxcbiAgICAgIHZlY3RvclV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy92ZWN0b3InKSxcbiAgICAgIGltYWdlTWFwVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2ltYWdlTWFwJyksXG4gICAgICByb3RhdGlvblV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9yb3RhdGlvbicpLFxuICAgICAgcXVhdGVybmlvblV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9xdWF0ZXJuaW9uJyk7XG5cbmNvbnN0IHsgcm90YXRlVmVydGljZXMgfSA9IHJvdGF0aW9uVXRpbGl0aWVzLFxuICAgICAgeyBpbnZlcnQyLCBpbnZlcnQzIH0gPSBtYXRyaXhVdGlsaXRpZXMsXG4gICAgICB7IGdldEltYWdlRGV0YWlscyB9ID0gaW1hZ2VNYXBVdGlsaXRpZXMsXG4gICAgICB7IGZpcnN0LCBzZWNvbmQsIHRoaXJkLCBwZXJtdXRlIH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uIH0gPSBxdWF0ZXJuaW9uVXRpbGl0aWVzLFxuICAgICAgeyBhZGQyLCBtdWx0aXBseTIsIHRyYW5zZm9ybTIsIHRyYW5zZm9ybTMgfSA9IHZlY3RvclV0aWxpdGllcyxcbiAgICAgIHsgY2xvbmVFZGdlcywgY2xvbmVOb3JtYWwsIGNsb25lVmVydGljZXMsIGNhbGN1bGF0ZUVkZ2VzLCBjYWxjdWxhdGVOb3JtYWwgfSA9IGZhY2V0VXRpbGl0aWVzO1xuXG5jbGFzcyBUZXh0dXJlZEZhY2V0IGV4dGVuZHMgRmFjZXQge1xuICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgbm9ybWFsLCBlZGdlcywgaW1hZ2VOYW1lLCB0ZXh0dXJlQ29vcmRpbmF0ZXMpIHtcbiAgICBzdXBlcih2ZXJ0aWNlcywgbm9ybWFsLCBlZGdlcyk7XG5cbiAgICB0aGlzLmltYWdlTmFtZSA9IGltYWdlTmFtZTtcbiAgICB0aGlzLnRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlcztcbiAgfVxuXG4gIGdldEltYWdlTmFtZSgpIHtcbiAgICByZXR1cm4gdGhpcy5pbWFnZU5hbWU7XG4gIH1cblxuICBnZXRUZXh0dXJlQ29vcmRpbmF0ZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMudGV4dHVyZUNvb3JkaW5hdGVzO1xuICB9XG5cbiAgZ2V0VmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzKCkge1xuICAgIGNvbnN0IGltYWdlRGV0YWlscyA9IGdldEltYWdlRGV0YWlscyh0aGlzLmltYWdlTmFtZSksXG4gICAgICAgICAgeyBsZWZ0LCBib3R0b20sIHdpZHRoLCBoZWlnaHQgfSA9IGltYWdlRGV0YWlscyxcbiAgICAgICAgICB2ZXJ0ZXhUZXh0dXJlQ29vcmRpbmF0ZXMgPSB0cmFuc2xhdGVUZXh0dXJlQ29vcmRpbmF0ZXModGhpcy50ZXh0dXJlQ29vcmRpbmF0ZXMsIGxlZnQsIGJvdHRvbSwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICByZXR1cm4gdmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzO1xuICB9XG5cbiAgcGVybXV0ZShwbGFjZXMpIHtcbiAgICBzdXBlci5wZXJtdXRlKHBsYWNlcyk7XG5cbiAgICB0aGlzLnRleHR1cmVDb29yZGluYXRlcyA9IHBlcm11dGUodGhpcy50ZXh0dXJlQ29vcmRpbmF0ZXMsIHBsYWNlcyk7XG4gIH1cblxuICBzcGxpdFdpdGhUd29Ob25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zLCBzbWFsbGVyRmFjZXRzLCBGYWNldCkgeyBzdXBlci5zcGxpdFdpdGhUd29Ob25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zLCBzbWFsbGVyRmFjZXRzLCB0aGlzKTsgfSAvLy9cblxuICBzcGxpdFdpdGhPbmVOb25OdWxsSW50ZXJzZWN0aW9uKGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMsIEZhY2V0KSB7IHN1cGVyLnNwbGl0V2l0aE9uZU5vbk51bGxJbnRlcnNlY3Rpb24oaW50ZXJzZWN0aW9ucywgc21hbGxlckZhY2V0cywgdGhpcyk7IH0gLy8vXG5cbiAgY2xvbmUoKSB7XG4gICAgbGV0IHZlcnRpY2VzID0gdGhpcy5nZXRWZXJ0aWNlcygpLFxuICAgICAgICBub3JtYWwgPSB0aGlzLmdldE5vcm1hbCgpLFxuICAgICAgICBlZGdlcyA9IHRoaXMuZ2V0RWRnZXMoKTtcbiAgICBcbiAgICB2ZXJ0aWNlcyA9IGNsb25lVmVydGljZXModmVydGljZXMpO1xuICAgIG5vcm1hbCA9IGNsb25lTm9ybWFsKG5vcm1hbCk7XG4gICAgZWRnZXMgPSBjbG9uZUVkZ2VzKGVkZ2VzKTtcblxuICAgIGNvbnN0IGltYWdlTmFtZSA9IHRoaXMuaW1hZ2VOYW1lLFxuICAgICAgICAgIHRleHR1cmVDb29yZGluYXRlcyA9IGNsb25lVGV4dHVyZUNvb3JkaW5hdGVzKHRoaXMudGV4dHVyZUNvb3JkaW5hdGVzKSxcbiAgICAgICAgICB0ZXh0dXJlZEZhY2V0ID0gbmV3IFRleHR1cmVkRmFjZXQodmVydGljZXMsIG5vcm1hbCwgZWRnZXMsIGltYWdlTmFtZSwgdGV4dHVyZUNvb3JkaW5hdGVzKTtcblxuICAgIHJldHVybiB0ZXh0dXJlZEZhY2V0O1xuICB9XG5cbiAgZnJvbVZlcnRpY2VzKHZlcnRpY2VzKSB7XG4gICAgY29uc3Qgbm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHZlcnRpY2VzKSxcbiAgICAgICAgICBlZGdlcyA9IGNhbGN1bGF0ZUVkZ2VzKHZlcnRpY2VzLCBFZGdlKSxcbiAgICAgICAgICBpbWFnZU5hbWUgPSB0aGlzLmltYWdlTmFtZSxcbiAgICAgICAgICBwYXJlbnRWZXJ0aWNlcyA9IHRoaXMudmVydGljZXMsIC8vL1xuICAgICAgICAgIHRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlc0Zyb21WZXJ0aWNlc1BhcmVudFZlcnRpY2VzQW5kVGV4dHVyZUNvb3JkaW5hdGVzKHZlcnRpY2VzLCBwYXJlbnRWZXJ0aWNlcywgdGhpcy50ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICAgIHRleHR1cmVkRmFjZXQgPSBuZXcgVGV4dHVyZWRGYWNldCh2ZXJ0aWNlcywgbm9ybWFsLCBlZGdlcywgaW1hZ2VOYW1lLCB0ZXh0dXJlQ29vcmRpbmF0ZXMpO1xuXG4gICAgcmV0dXJuIHRleHR1cmVkRmFjZXQ7XG4gIH1cblxuICBzdGF0aWMgZnJvbVZlcnRpY2VzSW5kZXhlc0ltYWdlTmFtZUFuZFRleHR1cmVDb29yZGluYXRlcyh2ZXJ0aWNlcywgaW5kZXhlcywgaW1hZ2VOYW1lLCB0ZXh0dXJlQ29vcmRpbmF0ZXMsIGluZGV4KSB7XG4gICAgdmVydGljZXMgPSB2ZXJ0aWNlc0Zyb21WZXJ0aWNlc0FuZEluZGV4ZXModmVydGljZXMsIGluZGV4ZXMpOyAvLy9cblxuICAgIHRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlc0Zyb21UZXh0dXJlQ29vcmRpbmF0ZXNBbmRJbmRleCh0ZXh0dXJlQ29vcmRpbmF0ZXMsIGluZGV4KTsgIC8vL1xuXG4gICAgY29uc3Qgbm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHZlcnRpY2VzKSxcbiAgICAgICAgICBlZGdlcyA9IGNhbGN1bGF0ZUVkZ2VzKHZlcnRpY2VzLCBFZGdlKSxcbiAgICAgICAgICB0ZXh0dXJlZEZhY2V0ID0gbmV3IFRleHR1cmVkRmFjZXQodmVydGljZXMsIG5vcm1hbCwgZWRnZXMsIGltYWdlTmFtZSwgdGV4dHVyZUNvb3JkaW5hdGVzKTtcblxuICAgIHJldHVybiB0ZXh0dXJlZEZhY2V0O1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gVGV4dHVyZWRGYWNldDtcblxuZnVuY3Rpb24gdmVydGljZXNGcm9tVmVydGljZXNBbmRJbmRleGVzKHZlcnRpY2VzLCBpbmRleGVzKSB7ICAvLy9cbiAgdmVydGljZXMgPSBpbmRleGVzLm1hcChmdW5jdGlvbihpbmRleCkge1xuICAgIGNvbnN0IHZlcnRleCA9IHZlcnRpY2VzW2luZGV4XTtcblxuICAgIHJldHVybiB2ZXJ0ZXg7XG4gIH0pO1xuXG4gIHJldHVybiB2ZXJ0aWNlcztcbn1cblxuZnVuY3Rpb24gdGV4dHVyZUNvb3JkaW5hdGVzRnJvbVRleHR1cmVDb29yZGluYXRlc0FuZEluZGV4KHRleHR1cmVDb29yZGluYXRlcywgaW5kZXgpIHsgIC8vL1xuICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQ29vcmRpbmF0ZXMuc2xpY2UoaW5kZXggKiAzLCBpbmRleCAqIDMgKyAzKTsgIC8vL1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXM7XG59XG5cbmZ1bmN0aW9uIGNsb25lVGV4dHVyZUNvb3JkaW5hdGVzKHRleHR1cmVDb29yZGluYXRlcykge1xuICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQ29vcmRpbmF0ZXMubWFwKGZ1bmN0aW9uKHRleHR1cmVDb29yZGluYXRlcykgeyAgLy8vXG4gICAgdGV4dHVyZUNvb3JkaW5hdGVzID0gdGV4dHVyZUNvb3JkaW5hdGVzLnNsaWNlKCk7XG5cbiAgICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVzO1xuICB9KTtcblxuICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVzO1xufVxuXG5mdW5jdGlvbiB0cmFuc2xhdGVUZXh0dXJlQ29vcmRpbmF0ZXModGV4dHVyZUNvb3JkaW5hdGVzLCBsZWZ0LCBib3R0b20sIHdpZHRoLCBoZWlnaHQgKSB7XG4gIHRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlcy5tYXAoZnVuY3Rpb24odGV4dHVyZUNvb3JkaW5hdGVzKSB7ICAvLy9cbiAgICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSBhZGQyKG11bHRpcGx5Mih0ZXh0dXJlQ29vcmRpbmF0ZXMsIFsgd2lkdGgsIGhlaWdodCBdICksIFsgbGVmdCwgYm90dG9tIF0pO1xuXG4gICAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlcztcbiAgfSk7XG5cbiAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlcztcbn1cblxuZnVuY3Rpb24gdGV4dHVyZUNvb3JkaW5hdGVzRnJvbVZlcnRpY2VzUGFyZW50VmVydGljZXNBbmRUZXh0dXJlQ29vcmRpbmF0ZXModmVydGljZXMsIHBhcmVudFZlcnRpY2VzLCB0ZXh0dXJlQ29vcmRpbmF0ZXMpIHtcbiAgY29uc3Qgbm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHZlcnRpY2VzKSxcbiAgICAgICAgcm90YXRpb25RdWF0ZXJuaW9uID0gY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uKG5vcm1hbCksXG4gICAgICAgIHZlcnRpY2VzSW5YWVBsYW5lID0gcm90YXRlVmVydGljZXModmVydGljZXMsIHJvdGF0aW9uUXVhdGVybmlvbiksXG4gICAgICAgIHBhcmVudFZlcnRpY2VzSW5YWVBsYW5lID0gcm90YXRlVmVydGljZXMocGFyZW50VmVydGljZXMsIHJvdGF0aW9uUXVhdGVybmlvbiksXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCA9IGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc01hdHJpeCh0ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcyA9IGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc0Jhc2lzKHBhcmVudFZlcnRpY2VzSW5YWVBsYW5lLCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgpO1xuXG4gIHRleHR1cmVDb29yZGluYXRlcyA9IGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlcyh2ZXJ0aWNlc0luWFlQbGFuZSwgdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXMpO1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXM7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc01hdHJpeCh0ZXh0dXJlQ29vcmRpbmF0ZXMpIHtcbiAgY29uc3QgZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZSA9IGZpcnN0KHRleHR1cmVDb29yZGluYXRlcyksXG4gICAgICAgIHNlY29uZFRleHR1cmVDb29yZGluYXRlID0gc2Vjb25kKHRleHR1cmVDb29yZGluYXRlcyksXG4gICAgICAgIHRoaXJkVGV4dHVyZUNvb3JkaW5hdGUgPSB0aGlyZCh0ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICBQMXUgPSBmaXJzdFRleHR1cmVDb29yZGluYXRlWzBdLCAvLy9cbiAgICAgICAgUDF2ID0gZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZVsxXSwgLy8vXG4gICAgICAgIFAydSA9IHNlY29uZFRleHR1cmVDb29yZGluYXRlWzBdLCAvLy9cbiAgICAgICAgUDJ2ID0gc2Vjb25kVGV4dHVyZUNvb3JkaW5hdGVbMV0sIC8vL1xuICAgICAgICBQM3UgPSB0aGlyZFRleHR1cmVDb29yZGluYXRlWzBdLCAvLy9cbiAgICAgICAgUDN2ID0gdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZVsxXSwgLy8vXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCA9IGludmVydDMoWyAxLCAxLCAxLCBQMXUsIFAydSwgUDN1LCBQMXYsIFAydiwgUDN2IF0pO1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXg7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc0Jhc2lzKHBhcmVudFZlcnRpY2VzSW5YWVBsYW5lLCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgpIHtcbiAgY29uc3QgZmlyc3RQYXJlbnRWZXJ0ZXhJblhZUGxhbmUgPSBmaXJzdChwYXJlbnRWZXJ0aWNlc0luWFlQbGFuZSksXG4gICAgICAgIHNlY29uZFBhcmVudFZlcnRleEluWFlQbGFuZSA9IHNlY29uZChwYXJlbnRWZXJ0aWNlc0luWFlQbGFuZSksXG4gICAgICAgIHRoaXJkUGFyZW50VmVydGV4SW5YWVBsYW5lID0gdGhpcmQocGFyZW50VmVydGljZXNJblhZUGxhbmUpLFxuICAgICAgICBQMXggPSBmaXJzdFBhcmVudFZlcnRleEluWFlQbGFuZVswXSwgLy8vXG4gICAgICAgIFAxeSA9IGZpcnN0UGFyZW50VmVydGV4SW5YWVBsYW5lWzFdLCAvLy9cbiAgICAgICAgUDJ4ID0gc2Vjb25kUGFyZW50VmVydGV4SW5YWVBsYW5lWzBdLCAvLy9cbiAgICAgICAgUDJ5ID0gc2Vjb25kUGFyZW50VmVydGV4SW5YWVBsYW5lWzFdLCAvLy9cbiAgICAgICAgUDN4ID0gdGhpcmRQYXJlbnRWZXJ0ZXhJblhZUGxhbmVbMF0sIC8vL1xuICAgICAgICBQM3kgPSB0aGlyZFBhcmVudFZlcnRleEluWFlQbGFuZVsxXSwgLy8vXG4gICAgICAgIHhWZWN0b3IgPSB0cmFuc2Zvcm0zKFsgUDF4LCBQMngsIFAzeCBdLCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgpLFxuICAgICAgICB5VmVjdG9yID0gdHJhbnNmb3JtMyhbIFAxeSwgUDJ5LCBQM3kgXSwgdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4KSxcbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXMgPSBbXS5jb25jYXQoeFZlY3RvcikuY29uY2F0KHlWZWN0b3IpO1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcztcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVzKHZlcnRpY2VzSW5YWVBsYW5lLCB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcykge1xuICBjb25zdCBmaXJzdFZlcnRleEluWFlQbGFuZSA9IGZpcnN0KHZlcnRpY2VzSW5YWVBsYW5lKSxcbiAgICAgICAgc2Vjb25kVmVydGV4SW5YWVBsYW5lID0gc2Vjb25kKHZlcnRpY2VzSW5YWVBsYW5lKSxcbiAgICAgICAgdGhpcmRWZXJ0ZXhJblhZUGxhbmUgPSB0aGlyZCh2ZXJ0aWNlc0luWFlQbGFuZSksXG4gICAgICAgIFIxeCA9IGZpcnN0VmVydGV4SW5YWVBsYW5lWzBdLCAgLy8vXG4gICAgICAgIFIxeSA9IGZpcnN0VmVydGV4SW5YWVBsYW5lWzFdLCAgLy8vXG4gICAgICAgIFIyeCA9IHNlY29uZFZlcnRleEluWFlQbGFuZVswXSwgLy8vXG4gICAgICAgIFIyeSA9IHNlY29uZFZlcnRleEluWFlQbGFuZVsxXSwgLy8vXG4gICAgICAgIFIzeCA9IHRoaXJkVmVydGV4SW5YWVBsYW5lWzBdLCAgLy8vXG4gICAgICAgIFIzeSA9IHRoaXJkVmVydGV4SW5YWVBsYW5lWzFdLCAgLy8vXG4gICAgICAgIE94ID0gdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXNbMF0sICAvLy9cbiAgICAgICAgT3kgPSB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpc1szXSwgIC8vL1xuICAgICAgICBVeCA9IHRleHR1cmVDb29yZGluYXRlc0Jhc2lzWzFdLCAgLy8vXG4gICAgICAgIFV5ID0gdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXNbNF0sICAvLy9cbiAgICAgICAgVnggPSB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpc1syXSwgIC8vL1xuICAgICAgICBWeSA9IHRleHR1cmVDb29yZGluYXRlc0Jhc2lzWzVdLCAgLy8vXG4gICAgICAgIG1hdHJpeCA9IGludmVydDIoWyBVeCwgVXksIFZ4LCBWeSBdKSxcbiAgICAgICAgZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZXMgPSB0cmFuc2Zvcm0yKFsgUjF4IC0gT3gsIFIxeSAtIE95IF0sIG1hdHJpeCksXG4gICAgICAgIHNlY29uZFRleHR1cmVDb29yZGluYXRlcyA9IHRyYW5zZm9ybTIoWyBSMnggLSBPeCwgUjJ5IC0gT3kgXSwgbWF0cml4KSxcbiAgICAgICAgdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZXMgPSB0cmFuc2Zvcm0yKFsgUjN4IC0gT3gsIFIzeSAtIE95IF0sIG1hdHJpeCksXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlcyA9IFtcbiAgICAgICAgICBmaXJzdFRleHR1cmVDb29yZGluYXRlcyxcbiAgICAgICAgICBzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZXMsXG4gICAgICAgICAgdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZXMsXG4gICAgICAgIF07XG5cbiAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlcztcbn1cbiJdfQ==