'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Edge = require('../edge'),
    Facet = require('../facet'),
    Normal = require('../normal'),
    Vertex = require('../vertex'),
    matrixMaths = require('../maths/matrix'),
    vectorMaths = require('../maths/vector'),
    facetUtilities = require('../utilities/facet'),
    arrayUtilities = require('../utilities/array'),
    textureUtilities = require('../utilities/texture'),
    verticesUtilities = require('../utilities/vertices'),
    imageMapUtilities = require('../utilities/imageMap'),
    rotationUtilities = require('../utilities/rotation'),
    quaternionUtilities = require('../utilities/quaternion');

var rotateVertices = rotationUtilities.rotateVertices,
    invert2 = matrixMaths.invert2,
    invert3 = matrixMaths.invert3,
    transform2 = vectorMaths.transform2,
    transform3 = vectorMaths.transform3,
    getImageDetails = imageMapUtilities.getImageDetails,
    cloneTextureCoordinates = textureUtilities.cloneTextureCoordinates,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    _permute = arrayUtilities.permute,
    calculateRotationQuaternion = quaternionUtilities.calculateRotationQuaternion,
    verticesFromVertexCoordinatesAndIndexes = verticesUtilities.verticesFromVertexCoordinatesAndIndexes,
    cloneEdges = facetUtilities.cloneEdges,
    cloneNormal = facetUtilities.cloneNormal,
    cloneVertices = facetUtilities.cloneVertices,
    calculateEdges = facetUtilities.calculateEdges,
    calculateNormal = facetUtilities.calculateNormal;

var TexturedFacet = function (_Facet) {
  _inherits(TexturedFacet, _Facet);

  function TexturedFacet(vertices, normal, edges, imageName, textureCoordinates) {
    _classCallCheck(this, TexturedFacet);

    var _this = _possibleConstructorReturn(this, (TexturedFacet.__proto__ || Object.getPrototypeOf(TexturedFacet)).call(this, vertices, normal, edges));

    _this.imageName = imageName;
    _this.textureCoordinates = textureCoordinates;
    return _this;
  }

  _createClass(TexturedFacet, [{
    key: 'clone',
    value: function clone() {
      var vertices = this.getVertices(),
          normal = this.getNormal(),
          edges = this.getEdges();

      vertices = cloneVertices(vertices);
      normal = cloneNormal(normal);
      edges = cloneEdges(edges);

      var imageName = this.imageName,
          textureCoordinates = cloneTextureCoordinates(this.textureCoordinates),
          texturedFacet = new TexturedFacet(vertices, normal, edges, imageName, textureCoordinates);

      return texturedFacet;
    }
  }, {
    key: 'getImageName',
    value: function getImageName() {
      return this.imageName;
    }
  }, {
    key: 'getTextureCoordinates',
    value: function getTextureCoordinates() {
      return this.textureCoordinates;
    }
  }, {
    key: 'getVertexTextureCoordinates',
    value: function getVertexTextureCoordinates() {
      var imageDetails = getImageDetails(this.imageName),
          left = imageDetails.left,
          bottom = imageDetails.bottom,
          width = imageDetails.width,
          height = imageDetails.height,
          vertexTextureCoordinates = translateTextureCoordinates(this.textureCoordinates, left, bottom, width, height);


      return vertexTextureCoordinates;
    }
  }, {
    key: 'permute',
    value: function permute(places) {
      _get(TexturedFacet.prototype.__proto__ || Object.getPrototypeOf(TexturedFacet.prototype), 'permute', this).call(this, places);

      this.textureCoordinates = _permute(this.textureCoordinates, places);
    }
  }, {
    key: 'fromVertices',
    value: function fromVertices(vertices) {
      var normal = calculateNormal(vertices, Normal),
          edges = calculateEdges(vertices, Edge),
          imageName = this.imageName,
          parentVertices = this.vertices,
          ///
      textureCoordinates = textureCoordinatesFromVerticesParentVerticesAndTextureCoordinates(vertices, parentVertices, this.textureCoordinates),
          texturedFacet = new TexturedFacet(vertices, normal, edges, imageName, textureCoordinates);

      return texturedFacet;
    }
  }], [{
    key: 'fromVertexCoordinatesImageNameAndTextureCoordinates',
    value: function fromVertexCoordinatesImageNameAndTextureCoordinates(vertexCoordinates, indexes, imageName, textureCoordinates, index) {
      textureCoordinates = textureCoordinatesFromTextureCoordinatesAndIndex(textureCoordinates, index); ///

      var vertices = verticesFromVertexCoordinatesAndIndexes(vertexCoordinates, indexes, Vertex),
          normal = calculateNormal(vertices, Normal),
          edges = calculateEdges(vertices, Edge),
          texturedFacet = new TexturedFacet(vertices, normal, edges, imageName, textureCoordinates);

      return texturedFacet;
    }
  }]);

  return TexturedFacet;
}(Facet);

module.exports = TexturedFacet;

function textureCoordinatesFromVerticesParentVerticesAndTextureCoordinates(vertices, parentVertices, textureCoordinates) {
  var normal = calculateNormal(vertices, Normal),
      rotationQuaternion = calculateRotationQuaternion(normal);

  vertices = rotateVertices(vertices, rotationQuaternion);

  parentVertices = rotateVertices(parentVertices, rotationQuaternion);

  var textureCoordinatesMatrix = calculateTextureCoordinatesMatrix(textureCoordinates),
      textureCoordinatesBasis = calculateTextureCoordinatesBasis(parentVertices, textureCoordinatesMatrix);

  textureCoordinates = calculateTextureCoordinates(vertices, textureCoordinatesBasis);

  return textureCoordinates;
}

function calculateTextureCoordinatesMatrix(textureCoordinates) {
  var firstTextureCoordinate = first(textureCoordinates),
      secondTextureCoordinate = second(textureCoordinates),
      thirdTextureCoordinate = third(textureCoordinates),
      P1u = firstTextureCoordinate[0],
      ///
  P1v = firstTextureCoordinate[1],
      ///
  P2u = secondTextureCoordinate[0],
      ///
  P2v = secondTextureCoordinate[1],
      ///
  P3u = thirdTextureCoordinate[0],
      ///
  P3v = thirdTextureCoordinate[1],
      ///
  textureCoordinatesMatrix = invert3([1, 1, 1, P1u, P2u, P3u, P1v, P2v, P3v]);

  return textureCoordinatesMatrix;
}

function calculateTextureCoordinatesBasis(parentVertices, textureCoordinatesMatrix) {
  var firstParentVertex = first(parentVertices),
      secondParentVertex = second(parentVertices),
      thirdParentVertex = third(parentVertices),
      P1x = firstParentVertex[0],
      ///
  P1y = firstParentVertex[1],
      ///
  P2x = secondParentVertex[0],
      ///
  P2y = secondParentVertex[1],
      ///
  P3x = thirdParentVertex[0],
      ///
  P3y = thirdParentVertex[1],
      ///
  xVector = transform3([P1x, P2x, P3x], textureCoordinatesMatrix),
      yVector = transform3([P1y, P2y, P3y], textureCoordinatesMatrix),
      textureCoordinatesBasis = [].concat(xVector).concat(yVector);

  return textureCoordinatesBasis;
}

function calculateTextureCoordinates(vertices, textureCoordinatesBasis) {
  var firstVertex = first(vertices),
      secondVertex = second(vertices),
      thirdVertex = third(vertices),
      R1x = firstVertex[0],
      ///
  R1y = firstVertex[1],
      ///
  R2x = secondVertex[0],
      ///
  R2y = secondVertex[1],
      ///
  R3x = thirdVertex[0],
      ///
  R3y = thirdVertex[1],
      ///
  Ox = textureCoordinatesBasis[0],
      ///
  Oy = textureCoordinatesBasis[3],
      ///
  Ux = textureCoordinatesBasis[1],
      ///
  Uy = textureCoordinatesBasis[4],
      ///
  Vx = textureCoordinatesBasis[2],
      ///
  Vy = textureCoordinatesBasis[5],
      ///
  matrix = invert2([Ux, Uy, Vx, Vy]),
      firstTextureCoordinates = transform2([R1x - Ox, R1y - Oy], matrix),
      secondTextureCoordinates = transform2([R2x - Ox, R2y - Oy], matrix),
      thirdTextureCoordinates = transform2([R3x - Ox, R3y - Oy], matrix),
      textureCoordinates = [firstTextureCoordinates, secondTextureCoordinates, thirdTextureCoordinates];

  return textureCoordinates;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9mYWNldC90ZXh0dXJlZC5qcyJdLCJuYW1lcyI6WyJFZGdlIiwicmVxdWlyZSIsIkZhY2V0IiwiTm9ybWFsIiwiVmVydGV4IiwibWF0cml4TWF0aHMiLCJ2ZWN0b3JNYXRocyIsImZhY2V0VXRpbGl0aWVzIiwiYXJyYXlVdGlsaXRpZXMiLCJ0ZXh0dXJlVXRpbGl0aWVzIiwidmVydGljZXNVdGlsaXRpZXMiLCJpbWFnZU1hcFV0aWxpdGllcyIsInJvdGF0aW9uVXRpbGl0aWVzIiwicXVhdGVybmlvblV0aWxpdGllcyIsInJvdGF0ZVZlcnRpY2VzIiwiaW52ZXJ0MiIsImludmVydDMiLCJ0cmFuc2Zvcm0yIiwidHJhbnNmb3JtMyIsImdldEltYWdlRGV0YWlscyIsImNsb25lVGV4dHVyZUNvb3JkaW5hdGVzIiwiZmlyc3QiLCJzZWNvbmQiLCJ0aGlyZCIsInBlcm11dGUiLCJjYWxjdWxhdGVSb3RhdGlvblF1YXRlcm5pb24iLCJ2ZXJ0aWNlc0Zyb21WZXJ0ZXhDb29yZGluYXRlc0FuZEluZGV4ZXMiLCJjbG9uZUVkZ2VzIiwiY2xvbmVOb3JtYWwiLCJjbG9uZVZlcnRpY2VzIiwiY2FsY3VsYXRlRWRnZXMiLCJjYWxjdWxhdGVOb3JtYWwiLCJUZXh0dXJlZEZhY2V0IiwidmVydGljZXMiLCJub3JtYWwiLCJlZGdlcyIsImltYWdlTmFtZSIsInRleHR1cmVDb29yZGluYXRlcyIsImdldFZlcnRpY2VzIiwiZ2V0Tm9ybWFsIiwiZ2V0RWRnZXMiLCJ0ZXh0dXJlZEZhY2V0IiwibGVmdCIsImltYWdlRGV0YWlscyIsImJvdHRvbSIsIndpZHRoIiwiaGVpZ2h0IiwidmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzIiwidHJhbnNsYXRlVGV4dHVyZUNvb3JkaW5hdGVzIiwicGxhY2VzIiwicGFyZW50VmVydGljZXMiLCJ0ZXh0dXJlQ29vcmRpbmF0ZXNGcm9tVmVydGljZXNQYXJlbnRWZXJ0aWNlc0FuZFRleHR1cmVDb29yZGluYXRlcyIsInZlcnRleENvb3JkaW5hdGVzIiwiaW5kZXhlcyIsImluZGV4IiwidGV4dHVyZUNvb3JkaW5hdGVzRnJvbVRleHR1cmVDb29yZGluYXRlc0FuZEluZGV4IiwibW9kdWxlIiwiZXhwb3J0cyIsInJvdGF0aW9uUXVhdGVybmlvbiIsInRleHR1cmVDb29yZGluYXRlc01hdHJpeCIsImNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc01hdHJpeCIsInRleHR1cmVDb29yZGluYXRlc0Jhc2lzIiwiY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVzQmFzaXMiLCJjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZXMiLCJmaXJzdFRleHR1cmVDb29yZGluYXRlIiwic2Vjb25kVGV4dHVyZUNvb3JkaW5hdGUiLCJ0aGlyZFRleHR1cmVDb29yZGluYXRlIiwiUDF1IiwiUDF2IiwiUDJ1IiwiUDJ2IiwiUDN1IiwiUDN2IiwiZmlyc3RQYXJlbnRWZXJ0ZXgiLCJzZWNvbmRQYXJlbnRWZXJ0ZXgiLCJ0aGlyZFBhcmVudFZlcnRleCIsIlAxeCIsIlAxeSIsIlAyeCIsIlAyeSIsIlAzeCIsIlAzeSIsInhWZWN0b3IiLCJ5VmVjdG9yIiwiY29uY2F0IiwiZmlyc3RWZXJ0ZXgiLCJzZWNvbmRWZXJ0ZXgiLCJ0aGlyZFZlcnRleCIsIlIxeCIsIlIxeSIsIlIyeCIsIlIyeSIsIlIzeCIsIlIzeSIsIk94IiwiT3kiLCJVeCIsIlV5IiwiVngiLCJWeSIsIm1hdHJpeCIsImZpcnN0VGV4dHVyZUNvb3JkaW5hdGVzIiwic2Vjb25kVGV4dHVyZUNvb3JkaW5hdGVzIiwidGhpcmRUZXh0dXJlQ29vcmRpbmF0ZXMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxPQUFPQyxRQUFRLFNBQVIsQ0FBYjtBQUFBLElBQ01DLFFBQVFELFFBQVEsVUFBUixDQURkO0FBQUEsSUFFTUUsU0FBU0YsUUFBUSxXQUFSLENBRmY7QUFBQSxJQUdNRyxTQUFTSCxRQUFRLFdBQVIsQ0FIZjtBQUFBLElBSU1JLGNBQWNKLFFBQVEsaUJBQVIsQ0FKcEI7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TixFQUFVQyxFQUFWLEVBQWNDLEVBQWQsQ0FBUixDQWZmO0FBQUEsTUFnQk1FLDBCQUEwQnBGLFdBQVcsQ0FBRXVFLE1BQU1NLEVBQVIsRUFBWUwsTUFBTU0sRUFBbEIsQ0FBWCxFQUFtQ0ssTUFBbkMsQ0FoQmhDO0FBQUEsTUFpQk1FLDJCQUEyQnJGLFdBQVcsQ0FBRXlFLE1BQU1JLEVBQVIsRUFBWUgsTUFBTUksRUFBbEIsQ0FBWCxFQUFtQ0ssTUFBbkMsQ0FqQmpDO0FBQUEsTUFrQk1HLDBCQUEwQnRGLFdBQVcsQ0FBRTJFLE1BQU1FLEVBQVIsRUFBWUQsTUFBTUUsRUFBbEIsQ0FBWCxFQUFtQ0ssTUFBbkMsQ0FsQmhDO0FBQUEsTUFtQk0vRCxxQkFBcUIsQ0FDbkJnRSx1QkFEbUIsRUFFbkJDLHdCQUZtQixFQUduQkMsdUJBSG1CLENBbkIzQjs7QUF5QkEsU0FBT2xFLGtCQUFQO0FBQ0QiLCJmaWxlIjoidGV4dHVyZWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IEVkZ2UgPSByZXF1aXJlKCcuLi9lZGdlJyksXG4gICAgICBGYWNldCA9IHJlcXVpcmUoJy4uL2ZhY2V0JyksXG4gICAgICBOb3JtYWwgPSByZXF1aXJlKCcuLi9ub3JtYWwnKSxcbiAgICAgIFZlcnRleCA9IHJlcXVpcmUoJy4uL3ZlcnRleCcpLFxuICAgICAgbWF0cml4TWF0aHMgPSByZXF1aXJlKCcuLi9tYXRocy9tYXRyaXgnKSxcbiAgICAgIHZlY3Rvck1hdGhzID0gcmVxdWlyZSgnLi4vbWF0aHMvdmVjdG9yJyksXG4gICAgICBmYWNldFV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9mYWNldCcpLFxuICAgICAgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvYXJyYXknKSxcbiAgICAgIHRleHR1cmVVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvdGV4dHVyZScpLFxuICAgICAgdmVydGljZXNVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvdmVydGljZXMnKSxcbiAgICAgIGltYWdlTWFwVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2ltYWdlTWFwJyksXG4gICAgICByb3RhdGlvblV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9yb3RhdGlvbicpLFxuICAgICAgcXVhdGVybmlvblV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9xdWF0ZXJuaW9uJyk7XG5cbmNvbnN0IHsgcm90YXRlVmVydGljZXMgfSA9IHJvdGF0aW9uVXRpbGl0aWVzLFxuICAgICAgeyBpbnZlcnQyLCBpbnZlcnQzIH0gPSBtYXRyaXhNYXRocyxcbiAgICAgIHsgdHJhbnNmb3JtMiwgdHJhbnNmb3JtMyB9ID0gdmVjdG9yTWF0aHMsXG4gICAgICB7IGdldEltYWdlRGV0YWlscyB9ID0gaW1hZ2VNYXBVdGlsaXRpZXMsXG4gICAgICB7IGNsb25lVGV4dHVyZUNvb3JkaW5hdGVzIH0gPSB0ZXh0dXJlVXRpbGl0aWVzLFxuICAgICAgeyBmaXJzdCwgc2Vjb25kLCB0aGlyZCwgcGVybXV0ZSB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IGNhbGN1bGF0ZVJvdGF0aW9uUXVhdGVybmlvbiB9ID0gcXVhdGVybmlvblV0aWxpdGllcyxcbiAgICAgIHsgdmVydGljZXNGcm9tVmVydGV4Q29vcmRpbmF0ZXNBbmRJbmRleGVzIH0gPSB2ZXJ0aWNlc1V0aWxpdGllcyxcbiAgICAgIHsgY2xvbmVFZGdlcywgY2xvbmVOb3JtYWwsIGNsb25lVmVydGljZXMsIGNhbGN1bGF0ZUVkZ2VzLCBjYWxjdWxhdGVOb3JtYWwgfSA9IGZhY2V0VXRpbGl0aWVzO1xuXG5jbGFzcyBUZXh0dXJlZEZhY2V0IGV4dGVuZHMgRmFjZXQge1xuICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgbm9ybWFsLCBlZGdlcywgaW1hZ2VOYW1lLCB0ZXh0dXJlQ29vcmRpbmF0ZXMpIHtcbiAgICBzdXBlcih2ZXJ0aWNlcywgbm9ybWFsLCBlZGdlcyk7XG5cbiAgICB0aGlzLmltYWdlTmFtZSA9IGltYWdlTmFtZTtcbiAgICB0aGlzLnRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlcztcbiAgfVxuXG4gIGNsb25lKCkge1xuICAgIGxldCB2ZXJ0aWNlcyA9IHRoaXMuZ2V0VmVydGljZXMoKSxcbiAgICAgICAgbm9ybWFsID0gdGhpcy5nZXROb3JtYWwoKSxcbiAgICAgICAgZWRnZXMgPSB0aGlzLmdldEVkZ2VzKCk7XG5cbiAgICB2ZXJ0aWNlcyA9IGNsb25lVmVydGljZXModmVydGljZXMpO1xuICAgIG5vcm1hbCA9IGNsb25lTm9ybWFsKG5vcm1hbCk7XG4gICAgZWRnZXMgPSBjbG9uZUVkZ2VzKGVkZ2VzKTtcblxuICAgIGNvbnN0IGltYWdlTmFtZSA9IHRoaXMuaW1hZ2VOYW1lLFxuICAgICAgICAgIHRleHR1cmVDb29yZGluYXRlcyA9IGNsb25lVGV4dHVyZUNvb3JkaW5hdGVzKHRoaXMudGV4dHVyZUNvb3JkaW5hdGVzKSxcbiAgICAgICAgICB0ZXh0dXJlZEZhY2V0ID0gbmV3IFRleHR1cmVkRmFjZXQodmVydGljZXMsIG5vcm1hbCwgZWRnZXMsIGltYWdlTmFtZSwgdGV4dHVyZUNvb3JkaW5hdGVzKTtcblxuICAgIHJldHVybiB0ZXh0dXJlZEZhY2V0O1xuICB9XG5cbiAgZ2V0SW1hZ2VOYW1lKCkge1xuICAgIHJldHVybiB0aGlzLmltYWdlTmFtZTtcbiAgfVxuXG4gIGdldFRleHR1cmVDb29yZGluYXRlcygpIHtcbiAgICByZXR1cm4gdGhpcy50ZXh0dXJlQ29vcmRpbmF0ZXM7XG4gIH1cblxuICBnZXRWZXJ0ZXhUZXh0dXJlQ29vcmRpbmF0ZXMoKSB7XG4gICAgY29uc3QgaW1hZ2VEZXRhaWxzID0gZ2V0SW1hZ2VEZXRhaWxzKHRoaXMuaW1hZ2VOYW1lKSxcbiAgICAgICAgICB7IGxlZnQsIGJvdHRvbSwgd2lkdGgsIGhlaWdodCB9ID0gaW1hZ2VEZXRhaWxzLFxuICAgICAgICAgIHZlcnRleFRleHR1cmVDb29yZGluYXRlcyA9IHRyYW5zbGF0ZVRleHR1cmVDb29yZGluYXRlcyh0aGlzLnRleHR1cmVDb29yZGluYXRlcywgbGVmdCwgYm90dG9tLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgIHJldHVybiB2ZXJ0ZXhUZXh0dXJlQ29vcmRpbmF0ZXM7XG4gIH1cblxuICBwZXJtdXRlKHBsYWNlcykge1xuICAgIHN1cGVyLnBlcm11dGUocGxhY2VzKTtcblxuICAgIHRoaXMudGV4dHVyZUNvb3JkaW5hdGVzID0gcGVybXV0ZSh0aGlzLnRleHR1cmVDb29yZGluYXRlcywgcGxhY2VzKTtcbiAgfVxuXG4gIGZyb21WZXJ0aWNlcyh2ZXJ0aWNlcykge1xuICAgIGNvbnN0IG5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCh2ZXJ0aWNlcywgTm9ybWFsKSxcbiAgICAgICAgICBlZGdlcyA9IGNhbGN1bGF0ZUVkZ2VzKHZlcnRpY2VzLCBFZGdlKSxcbiAgICAgICAgICBpbWFnZU5hbWUgPSB0aGlzLmltYWdlTmFtZSxcbiAgICAgICAgICBwYXJlbnRWZXJ0aWNlcyA9IHRoaXMudmVydGljZXMsIC8vL1xuICAgICAgICAgIHRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlc0Zyb21WZXJ0aWNlc1BhcmVudFZlcnRpY2VzQW5kVGV4dHVyZUNvb3JkaW5hdGVzKHZlcnRpY2VzLCBwYXJlbnRWZXJ0aWNlcywgdGhpcy50ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICAgIHRleHR1cmVkRmFjZXQgPSBuZXcgVGV4dHVyZWRGYWNldCh2ZXJ0aWNlcywgbm9ybWFsLCBlZGdlcywgaW1hZ2VOYW1lLCB0ZXh0dXJlQ29vcmRpbmF0ZXMpO1xuXG4gICAgcmV0dXJuIHRleHR1cmVkRmFjZXQ7XG4gIH1cblxuICBzdGF0aWMgZnJvbVZlcnRleENvb3JkaW5hdGVzSW1hZ2VOYW1lQW5kVGV4dHVyZUNvb3JkaW5hdGVzKHZlcnRleENvb3JkaW5hdGVzLCBpbmRleGVzLCBpbWFnZU5hbWUsIHRleHR1cmVDb29yZGluYXRlcywgaW5kZXgpIHtcbiAgICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQ29vcmRpbmF0ZXNGcm9tVGV4dHVyZUNvb3JkaW5hdGVzQW5kSW5kZXgodGV4dHVyZUNvb3JkaW5hdGVzLCBpbmRleCk7ICAvLy9cblxuICAgIGNvbnN0IHZlcnRpY2VzID0gdmVydGljZXNGcm9tVmVydGV4Q29vcmRpbmF0ZXNBbmRJbmRleGVzKHZlcnRleENvb3JkaW5hdGVzLCBpbmRleGVzLCBWZXJ0ZXgpLFxuICAgICAgICAgIG5vcm1hbCA9IGNhbGN1bGF0ZU5vcm1hbCh2ZXJ0aWNlcywgTm9ybWFsKSxcbiAgICAgICAgICBlZGdlcyA9IGNhbGN1bGF0ZUVkZ2VzKHZlcnRpY2VzLCBFZGdlKSxcbiAgICAgICAgICB0ZXh0dXJlZEZhY2V0ID0gbmV3IFRleHR1cmVkRmFjZXQodmVydGljZXMsIG5vcm1hbCwgZWRnZXMsIGltYWdlTmFtZSwgdGV4dHVyZUNvb3JkaW5hdGVzKTtcblxuICAgIHJldHVybiB0ZXh0dXJlZEZhY2V0O1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gVGV4dHVyZWRGYWNldDtcblxuZnVuY3Rpb24gdGV4dHVyZUNvb3JkaW5hdGVzRnJvbVZlcnRpY2VzUGFyZW50VmVydGljZXNBbmRUZXh0dXJlQ29vcmRpbmF0ZXModmVydGljZXMsIHBhcmVudFZlcnRpY2VzLCB0ZXh0dXJlQ29vcmRpbmF0ZXMpIHtcbiAgY29uc3Qgbm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHZlcnRpY2VzLCBOb3JtYWwpLFxuICAgICAgICByb3RhdGlvblF1YXRlcm5pb24gPSBjYWxjdWxhdGVSb3RhdGlvblF1YXRlcm5pb24obm9ybWFsKTtcblxuICB2ZXJ0aWNlcyA9IHJvdGF0ZVZlcnRpY2VzKHZlcnRpY2VzLCByb3RhdGlvblF1YXRlcm5pb24pO1xuXG4gIHBhcmVudFZlcnRpY2VzID0gcm90YXRlVmVydGljZXMocGFyZW50VmVydGljZXMsIHJvdGF0aW9uUXVhdGVybmlvbik7XG5cbiAgY29uc3QgdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4ID0gY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4KHRleHR1cmVDb29yZGluYXRlcyksXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlc0Jhc2lzID0gY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVzQmFzaXMocGFyZW50VmVydGljZXMsIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCk7XG5cbiAgdGV4dHVyZUNvb3JkaW5hdGVzID0gY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVzKHZlcnRpY2VzLCB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcyk7XG5cbiAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlcztcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4KHRleHR1cmVDb29yZGluYXRlcykge1xuICBjb25zdCBmaXJzdFRleHR1cmVDb29yZGluYXRlID0gZmlyc3QodGV4dHVyZUNvb3JkaW5hdGVzKSxcbiAgICAgICAgc2Vjb25kVGV4dHVyZUNvb3JkaW5hdGUgPSBzZWNvbmQodGV4dHVyZUNvb3JkaW5hdGVzKSxcbiAgICAgICAgdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZSA9IHRoaXJkKHRleHR1cmVDb29yZGluYXRlcyksXG4gICAgICAgIFAxdSA9IGZpcnN0VGV4dHVyZUNvb3JkaW5hdGVbMF0sIC8vL1xuICAgICAgICBQMXYgPSBmaXJzdFRleHR1cmVDb29yZGluYXRlWzFdLCAvLy9cbiAgICAgICAgUDJ1ID0gc2Vjb25kVGV4dHVyZUNvb3JkaW5hdGVbMF0sIC8vL1xuICAgICAgICBQMnYgPSBzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZVsxXSwgLy8vXG4gICAgICAgIFAzdSA9IHRoaXJkVGV4dHVyZUNvb3JkaW5hdGVbMF0sIC8vL1xuICAgICAgICBQM3YgPSB0aGlyZFRleHR1cmVDb29yZGluYXRlWzFdLCAvLy9cbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4ID0gaW52ZXJ0MyhbIDEsIDEsIDEsIFAxdSwgUDJ1LCBQM3UsIFAxdiwgUDJ2LCBQM3YgXSk7XG5cbiAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlc01hdHJpeDtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVzQmFzaXMocGFyZW50VmVydGljZXMsIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCkge1xuICBjb25zdCBmaXJzdFBhcmVudFZlcnRleCA9IGZpcnN0KHBhcmVudFZlcnRpY2VzKSxcbiAgICAgICAgc2Vjb25kUGFyZW50VmVydGV4ID0gc2Vjb25kKHBhcmVudFZlcnRpY2VzKSxcbiAgICAgICAgdGhpcmRQYXJlbnRWZXJ0ZXggPSB0aGlyZChwYXJlbnRWZXJ0aWNlcyksXG4gICAgICAgIFAxeCA9IGZpcnN0UGFyZW50VmVydGV4WzBdLCAvLy9cbiAgICAgICAgUDF5ID0gZmlyc3RQYXJlbnRWZXJ0ZXhbMV0sIC8vL1xuICAgICAgICBQMnggPSBzZWNvbmRQYXJlbnRWZXJ0ZXhbMF0sIC8vL1xuICAgICAgICBQMnkgPSBzZWNvbmRQYXJlbnRWZXJ0ZXhbMV0sIC8vL1xuICAgICAgICBQM3ggPSB0aGlyZFBhcmVudFZlcnRleFswXSwgLy8vXG4gICAgICAgIFAzeSA9IHRoaXJkUGFyZW50VmVydGV4WzFdLCAvLy9cbiAgICAgICAgeFZlY3RvciA9IHRyYW5zZm9ybTMoWyBQMXgsIFAyeCwgUDN4IF0sIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCksXG4gICAgICAgIHlWZWN0b3IgPSB0cmFuc2Zvcm0zKFsgUDF5LCBQMnksIFAzeSBdLCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgpLFxuICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcyA9IFtdLmNvbmNhdCh4VmVjdG9yKS5jb25jYXQoeVZlY3Rvcik7XG5cbiAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlc0Jhc2lzO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZXModmVydGljZXMsIHRleHR1cmVDb29yZGluYXRlc0Jhc2lzKSB7XG4gIGNvbnN0IGZpcnN0VmVydGV4ID0gZmlyc3QodmVydGljZXMpLFxuICAgICAgICBzZWNvbmRWZXJ0ZXggPSBzZWNvbmQodmVydGljZXMpLFxuICAgICAgICB0aGlyZFZlcnRleCA9IHRoaXJkKHZlcnRpY2VzKSxcbiAgICAgICAgUjF4ID0gZmlyc3RWZXJ0ZXhbMF0sICAvLy9cbiAgICAgICAgUjF5ID0gZmlyc3RWZXJ0ZXhbMV0sICAvLy9cbiAgICAgICAgUjJ4ID0gc2Vjb25kVmVydGV4WzBdLCAvLy9cbiAgICAgICAgUjJ5ID0gc2Vjb25kVmVydGV4WzFdLCAvLy9cbiAgICAgICAgUjN4ID0gdGhpcmRWZXJ0ZXhbMF0sICAvLy9cbiAgICAgICAgUjN5ID0gdGhpcmRWZXJ0ZXhbMV0sICAvLy9cbiAgICAgICAgT3ggPSB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpc1swXSwgIC8vL1xuICAgICAgICBPeSA9IHRleHR1cmVDb29yZGluYXRlc0Jhc2lzWzNdLCAgLy8vXG4gICAgICAgIFV4ID0gdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXNbMV0sICAvLy9cbiAgICAgICAgVXkgPSB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpc1s0XSwgIC8vL1xuICAgICAgICBWeCA9IHRleHR1cmVDb29yZGluYXRlc0Jhc2lzWzJdLCAgLy8vXG4gICAgICAgIFZ5ID0gdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXNbNV0sICAvLy9cbiAgICAgICAgbWF0cml4ID0gaW52ZXJ0MihbIFV4LCBVeSwgVngsIFZ5IF0pLFxuICAgICAgICBmaXJzdFRleHR1cmVDb29yZGluYXRlcyA9IHRyYW5zZm9ybTIoWyBSMXggLSBPeCwgUjF5IC0gT3kgXSwgbWF0cml4KSxcbiAgICAgICAgc2Vjb25kVGV4dHVyZUNvb3JkaW5hdGVzID0gdHJhbnNmb3JtMihbIFIyeCAtIE94LCBSMnkgLSBPeSBdLCBtYXRyaXgpLFxuICAgICAgICB0aGlyZFRleHR1cmVDb29yZGluYXRlcyA9IHRyYW5zZm9ybTIoWyBSM3ggLSBPeCwgUjN5IC0gT3kgXSwgbWF0cml4KSxcbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVzID0gW1xuICAgICAgICAgIGZpcnN0VGV4dHVyZUNvb3JkaW5hdGVzLFxuICAgICAgICAgIHNlY29uZFRleHR1cmVDb29yZGluYXRlcyxcbiAgICAgICAgICB0aGlyZFRleHR1cmVDb29yZGluYXRlcyxcbiAgICAgICAgXTtcblxuICByZXR1cm4gdGV4dHVyZUNvb3JkaW5hdGVzO1xufVxuIl19