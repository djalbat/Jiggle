'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Facet = require('../facet'),
    arrayUtilities = require('../utilities/array'),
    matrixUtilities = require('../utilities/matrix'),
    vectorUtilities = require('../utilities/vector'),
    verticesUtilities = require('../utilities/vertices'),
    imageMapUtilities = require('../utilities/imageMap'),
    rotationUtilities = require('../utilities/rotation');

var invert2 = matrixUtilities.invert2,
    invert3 = matrixUtilities.invert3,
    getImageDetails = imageMapUtilities.getImageDetails,
    calculateRotationQuaternion = rotationUtilities.calculateRotationQuaternion,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    third = arrayUtilities.third,
    _permute = arrayUtilities.permute,
    calculateNormal = verticesUtilities.calculateNormal,
    rotateVertices = verticesUtilities.rotateVertices,
    add2 = vectorUtilities.add2,
    multiply2 = vectorUtilities.multiply2,
    transform2 = vectorUtilities.transform2,
    transform3 = vectorUtilities.transform3;

var TexturedFacet = function (_Facet) {
  _inherits(TexturedFacet, _Facet);

  function TexturedFacet(vertices, normal, imageName, textureCoordinates) {
    _classCallCheck(this, TexturedFacet);

    var _this = _possibleConstructorReturn(this, (TexturedFacet.__proto__ || Object.getPrototypeOf(TexturedFacet)).call(this, vertices, normal));

    _this.imageName = imageName;
    _this.textureCoordinates = textureCoordinates;
    return _this;
  }

  _createClass(TexturedFacet, [{
    key: 'getImageName',
    value: function getImageName() {
      return this.imageName;
    }
  }, {
    key: 'getTextureCoordinates',
    value: function getTextureCoordinates() {
      return this.textureCoordinates;
    }
  }, {
    key: 'getVertexTextureCoordinates',
    value: function getVertexTextureCoordinates() {
      var imageDetails = getImageDetails(this.imageName),
          left = imageDetails.left,
          bottom = imageDetails.bottom,
          width = imageDetails.width,
          height = imageDetails.height,
          vertexTextureCoordinates = translateTextureCoordinates(this.textureCoordinates, left, bottom, width, height);


      return vertexTextureCoordinates;
    }
  }, {
    key: 'permute',
    value: function permute(places) {
      _get(TexturedFacet.prototype.__proto__ || Object.getPrototypeOf(TexturedFacet.prototype), 'permute', this).call(this, places);

      this.textureCoordinates = _permute(this.textureCoordinates, places);
    }
  }, {
    key: 'splitWithTwoNonNullIntersections',
    value: function splitWithTwoNonNullIntersections(intersections, smallerFacets, Facet) {
      _get(TexturedFacet.prototype.__proto__ || Object.getPrototypeOf(TexturedFacet.prototype), 'splitWithTwoNonNullIntersections', this).call(this, intersections, smallerFacets, this);
    } ///

  }, {
    key: 'splitWithOneNonNullIntersection',
    value: function splitWithOneNonNullIntersection(intersections, smallerFacets, Facet) {
      _get(TexturedFacet.prototype.__proto__ || Object.getPrototypeOf(TexturedFacet.prototype), 'splitWithOneNonNullIntersection', this).call(this, intersections, smallerFacets, this);
    } ///

  }, {
    key: 'clone',
    value: function clone() {
      var vertices = this.getVertices(),
          normal = this.getNormal();

      vertices = vertices.map(function (vertex) {
        vertex = vertex.slice(); ///

        return vertex;
      });

      normal = normal.slice(); ///

      var imageName = this.imageName,
          textureCoordinates = this.textureCoordinates.map(function (textureCoordinates) {
        textureCoordinates = textureCoordinates.slice(); ///

        return textureCoordinates;
      }),
          texturedFacet = new TexturedFacet(vertices, normal, imageName, textureCoordinates);

      return texturedFacet;
    }
  }, {
    key: 'fromVertices',
    value: function fromVertices(vertices) {
      var normal = calculateNormal(vertices),
          imageName = this.imageName,
          parentVertices = this.vertices,
          ///
      textureCoordinates = textureCoordinatesFromVerticesParentVerticesAndTextureCoordinates(vertices, parentVertices, this.textureCoordinates),
          texturedFacet = new TexturedFacet(vertices, normal, imageName, textureCoordinates);

      return texturedFacet;
    }
  }], [{
    key: 'fromVerticesIndexesImageNameAndTextureCoordinates',
    value: function fromVerticesIndexesImageNameAndTextureCoordinates(vertices, indexes, imageName, textureCoordinates, index) {
      vertices = indexes.map(function (index) {
        return vertices[index];
      }); ///

      textureCoordinates = textureCoordinates.slice(index * 3, index * 3 + 3); ///

      var normal = calculateNormal(vertices),
          texturedFacet = new TexturedFacet(vertices, normal, imageName, textureCoordinates);

      return texturedFacet;
    }
  }]);

  return TexturedFacet;
}(Facet);

module.exports = TexturedFacet;

function translateTextureCoordinates(textureCoordinates, left, bottom, width, height) {
  textureCoordinates = textureCoordinates.map(function (textureCoordinates) {
    ///
    textureCoordinates = add2(multiply2(textureCoordinates, [width, height]), [left, bottom]);

    return textureCoordinates;
  });

  return textureCoordinates;
}

function textureCoordinatesFromVerticesParentVerticesAndTextureCoordinates(vertices, parentVertices, textureCoordinates) {
  var normal = calculateNormal(vertices),
      rotationQuaternion = calculateRotationQuaternion(normal),
      verticesInXYPlane = rotateVertices(vertices, rotationQuaternion),
      parentVerticesInXYPlane = rotateVertices(parentVertices, rotationQuaternion),
      textureCoordinatesMatrix = calculateTextureCoordinatesMatrix(textureCoordinates),
      textureCoordinatesBasis = calculateTextureCoordinatesBasis(parentVerticesInXYPlane, textureCoordinatesMatrix);

  textureCoordinates = calculateTextureCoordinates(verticesInXYPlane, textureCoordinatesBasis);

  return textureCoordinates;
}

function calculateTextureCoordinatesMatrix(textureCoordinates) {
  var firstTextureCoordinate = first(textureCoordinates),
      secondTextureCoordinate = second(textureCoordinates),
      thirdTextureCoordinate = third(textureCoordinates),
      P1u = firstTextureCoordinate[0],
      ///
  P1v = firstTextureCoordinate[1],
      ///
  P2u = secondTextureCoordinate[0],
      ///
  P2v = secondTextureCoordinate[1],
      ///
  P3u = thirdTextureCoordinate[0],
      ///
  P3v = thirdTextureCoordinate[1],
      ///
  textureCoordinatesMatrix = invert3([1, 1, 1, P1u, P2u, P3u, P1v, P2v, P3v]);

  return textureCoordinatesMatrix;
}

function calculateTextureCoordinatesBasis(parentVerticesInXYPlane, textureCoordinatesMatrix) {
  var firstParentVertexInXYPlane = first(parentVerticesInXYPlane),
      secondParentVertexInXYPlane = second(parentVerticesInXYPlane),
      thirdParentVertexInXYPlane = third(parentVerticesInXYPlane),
      P1x = firstParentVertexInXYPlane[0],
      ///
  P1y = firstParentVertexInXYPlane[1],
      ///
  P2x = secondParentVertexInXYPlane[0],
      ///
  P2y = secondParentVertexInXYPlane[1],
      ///
  P3x = thirdParentVertexInXYPlane[0],
      ///
  P3y = thirdParentVertexInXYPlane[1],
      ///
  xVector = transform3([P1x, P2x, P3x], textureCoordinatesMatrix),
      yVector = transform3([P1y, P2y, P3y], textureCoordinatesMatrix),
      textureCoordinatesBasis = [].concat(xVector).concat(yVector);

  return textureCoordinatesBasis;
}

function calculateTextureCoordinates(verticesInXYPlane, textureCoordinatesBasis) {
  var firstVertexInXYPlane = first(verticesInXYPlane),
      secondVertexInXYPlane = second(verticesInXYPlane),
      thirdVertexInXYPlane = third(verticesInXYPlane),
      R1x = firstVertexInXYPlane[0],
      ///
  R1y = firstVertexInXYPlane[1],
      ///
  R2x = secondVertexInXYPlane[0],
      ///
  R2y = secondVertexInXYPlane[1],
      ///
  R3x = thirdVertexInXYPlane[0],
      ///
  R3y = thirdVertexInXYPlane[1],
      ///
  Ox = textureCoordinatesBasis[0],
      ///
  Oy = textureCoordinatesBasis[3],
      ///
  Ux = textureCoordinatesBasis[1],
      ///
  Uy = textureCoordinatesBasis[4],
      ///
  Vx = textureCoordinatesBasis[2],
      ///
  Vy = textureCoordinatesBasis[5],
      ///
  matrix = invert2([Ux, Uy, Vx, Vy]),
      firstTextureCoordinates = transform2([R1x - Ox, R1y - Oy], matrix),
      secondTextureCoordinates = transform2([R2x - Ox, R2y - Oy], matrix),
      thirdTextureCoordinates = transform2([R3x - Ox, R3y - Oy], matrix),
      textureCoordinates = [firstTextureCoordinates, secondTextureCoordinates, thirdTextureCoordinates];

  return textureCoordinates;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9mYWNldC90ZXh0dXJlZC5qcyJdLCJuYW1lcyI6WyJGYWNldCIsInJlcXVpcmUiLCJhcnJheVV0aWxpdGllcyIsIm1hdHJpeFV0aWxpdGllcyIsInZlY3RvclV0aWxpdGllcyIsInZlcnRpY2VzVXRpbGl0aWVzIiwiaW1hZ2VNYXBVdGlsaXRpZXMiLCJyb3RhdGlvblV0aWxpdGllcyIsImludmVydDIiLCJpbnZlcnQzIiwiZ2V0SW1hZ2VEZXRhaWxzIiwiY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uIiwiZmlyc3QiLCJzZWNvbmQiLCJ0aGlyZCIsInBlcm11dGUiLCJjYWxjdWxhdGVOb3JtYWwiLCJyb3RhdGVWZXJ0aWNlcyIsImFkZDIiLCJtdWx0aXBseTIiLCJ0cmFuc2Zvcm0yIiwidHJhbnNmb3JtMyIsIlRleHR1cmVkRmFjZXQiLCJ2ZXJ0aWNlcyIsIm5vcm1hbCIsImltYWdlTmFtZSIsInRleHR1cmVDb29yZGluYXRlcyIsImxlZnQiLCJpbWFnZURldGFpbHMiLCJib3R0b20iLCJ3aWR0aCIsImhlaWdodCIsInZlcnRleFRleHR1cmVDb29yZGluYXRlcyIsInRyYW5zbGF0ZVRleHR1cmVDb29yZGluYXRlcyIsInBsYWNlcyIsImludGVyc2VjdGlvbnMiLCJzbWFsbGVyRmFjZXRzIiwiZ2V0VmVydGljZXMiLCJnZXROb3JtYWwiLCJtYXAiLCJ2ZXJ0ZXgiLCJzbGljZSIsInRleHR1cmVkRmFjZXQiLCJwYXJlbnRWZXJ0aWNlcyIsInRleHR1cmVDb29yZGluYXRlc0Zyb21WZXJ0aWNlc1BhcmVudFZlcnRpY2VzQW5kVGV4dHVyZUNvb3JkaW5hdGVzIiwiaW5kZXhlcyIsImluZGV4IiwibW9kdWxlIiwiZXhwb3J0cyIsInJvdGF0aW9uUXVhdGVybmlvbiIsInZlcnRpY2VzSW5YWVBsYW5lIiwicGFyZW50VmVydGljZXNJblhZUGxhbmUiLCJ0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgiLCJjYWxjdWxhdGVUZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgiLCJ0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcyIsImNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc0Jhc2lzIiwiY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVzIiwiZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZSIsInNlY29uZFRleHR1cmVDb29yZGluYXRlIiwidGhpcmRUZXh0dXJlQ29vcmRpbmF0ZSIsIlAxdSIsIlAxdiIsIlAydSIsIlAydiIsIlAzdSIsIlAzdiIsImZpcnN0UGFyZW50VmVydGV4SW5YWVBsYW5lIiwic2Vjb25kUGFyZW50VmVydGV4SW5YWVBsYW5lIiwidGhpcmRQYXJlbnRWZXJ0ZXhJblhZUGxhbmUiLCJQMXgiLCJQMXkiLCJQMngiLCJQMnkiLCJQM3giLCJQM3kiLCJ4VmVjdG9yIiwieVZlY3RvciIsImNvbmNhdCIsImZpcnN0VmVydGV4SW5YWVBsYW5lIiwic2Vjb25kVmVydGV4SW5YWVBsYW5lIiwidGhpcmRWZXJ0ZXhJblhZUGxhbmUiLCJSMXgiLCJSMXkiLCJSMngiLCJSMnkiLCJSM3giLCJSM3kiLCJPeCIsIk95IiwiVXgiLCJVeSIsIlZ4IiwiVnkiLCJtYXRyaXgiLCJmaXJzdFRleHR1cmVDb29yZGluYXRlcyIsInNlY29uZFRleHR1cmVDb29yZGluYXRlcyIsInRoaXJkVGV4dHVyZUNvb3JkaW5hdGVzIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEsUUFBUUMsUUFBUSxVQUFSLENBQWQ7QUFBQSxJQUNNQyxpQkFBaUJELFFBQVEsb0JBQVIsQ0FEdkI7QUFBQSxJQUVNRSxrQkFBa0JGLFFBQVEscUJBQVIsQ0FGeEI7QUFBQSxJQUdNRyxrQkFBa0JILFFBQVEscUJBQVIsQ0FIeEI7QUFBQSxJQUlNSSxvQkFBb0JKLFFBQVEsdUJBQVIsQ0FKMUI7QUFBQSxJQUtNSyxvQkFBb0JMLFFBQVEsdUJBQVIsQ0FMMUI7QUFBQSxJQU1NTSxvQkFBb0JOLFFBQVEsdUJBQVIsQ0FOMUI7O0lBUVFPLE8sR0FBcUJMLGUsQ0FBckJLLE87SUFBU0MsTyxHQUFZTixlLENBQVpNLE87SUFDVEMsZSxHQUFvQkosaUIsQ0FBcEJJLGU7SUFDQUMsMkIsR0FBZ0NKLGlCLENBQWhDSSwyQjtJQUNBQyxLLEdBQWtDVixjLENBQWxDVSxLO0lBQU9DLE0sR0FBMkJYLGMsQ0FBM0JXLE07SUFBUUMsSyxHQUFtQlosYyxDQUFuQlksSztJQUFPQyxRLEdBQVliLGMsQ0FBWmEsTztJQUN0QkMsZSxHQUFvQ1gsaUIsQ0FBcENXLGU7SUFBaUJDLGMsR0FBbUJaLGlCLENBQW5CWSxjO0lBQ2pCQyxJLEdBQTRDZCxlLENBQTVDYyxJO0lBQU1DLFMsR0FBc0NmLGUsQ0FBdENlLFM7SUFBV0MsVSxHQUEyQmhCLGUsQ0FBM0JnQixVO0lBQVlDLFUsR0FBZWpCLGUsQ0FBZmlCLFU7O0lBRS9CQyxhOzs7QUFDSix5QkFBWUMsUUFBWixFQUFzQkMsTUFBdEIsRUFBOEJDLFNBQTlCLEVBQXlDQyxrQkFBekMsRUFBNkQ7QUFBQTs7QUFBQSw4SEFDckRILFFBRHFELEVBQzNDQyxNQUQyQzs7QUFHM0QsVUFBS0MsU0FBTCxHQUFpQkEsU0FBakI7QUFDQSxVQUFLQyxrQkFBTCxHQUEwQkEsa0JBQTFCO0FBSjJEO0FBSzVEOzs7O21DQUVjO0FBQ2IsYUFBTyxLQUFLRCxTQUFaO0FBQ0Q7Ozs0Q0FFdUI7QUFDdEIsYUFBTyxLQUFLQyxrQkFBWjtBQUNEOzs7a0RBRTZCO0FBQ3RCLHlCQUFlaEIsZ0JBQWdCLEtBQUtlLFNBQXJCLENBQWY7QUFBQSxVQUNFRSxJQURGLEdBQ2tDQyxZQURsQyxDQUNFRCxJQURGO0FBQUEsVUFDUUUsTUFEUixHQUNrQ0QsWUFEbEMsQ0FDUUMsTUFEUjtBQUFBLFVBQ2dCQyxLQURoQixHQUNrQ0YsWUFEbEMsQ0FDZ0JFLEtBRGhCO0FBQUEsVUFDdUJDLE1BRHZCLEdBQ2tDSCxZQURsQyxDQUN1QkcsTUFEdkI7QUFBQSxVQUVBQyx3QkFGQSxHQUUyQkMsNEJBQTRCLEtBQUtQLGtCQUFqQyxFQUFxREMsSUFBckQsRUFBMkRFLE1BQTNELEVBQW1FQyxLQUFuRSxFQUEwRUMsTUFBMUUsQ0FGM0I7OztBQUlOLGFBQU9DLHdCQUFQO0FBQ0Q7Ozs0QkFFT0UsTSxFQUFRO0FBQ2QsNEhBQWNBLE1BQWQ7O0FBRUEsV0FBS1Isa0JBQUwsR0FBMEJYLFNBQVEsS0FBS1csa0JBQWIsRUFBaUNRLE1BQWpDLENBQTFCO0FBQ0Q7OztxREFFZ0NDLGEsRUFBZUMsYSxFQUFlcEMsSyxFQUFPO0FBQUUscUpBQXVDbUMsYUFBdkMsRUFBc0RDLGFBQXRELEVBQXFFLElBQXJFO0FBQTZFLEssQ0FBQzs7OztvREFFdEhELGEsRUFBZUMsYSxFQUFlcEMsSyxFQUFPO0FBQUUsb0pBQXNDbUMsYUFBdEMsRUFBcURDLGFBQXJELEVBQW9FLElBQXBFO0FBQTRFLEssQ0FBQzs7Ozs0QkFFNUk7QUFDTixVQUFJYixXQUFXLEtBQUtjLFdBQUwsRUFBZjtBQUFBLFVBQ0liLFNBQVMsS0FBS2MsU0FBTCxFQURiOztBQUdBZixpQkFBV0EsU0FBU2dCLEdBQVQsQ0FBYSxVQUFTQyxNQUFULEVBQWlCO0FBQ3ZDQSxpQkFBU0EsT0FBT0MsS0FBUCxFQUFULENBRHVDLENBQ2I7O0FBRTFCLGVBQU9ELE1BQVA7QUFDRCxPQUpVLENBQVg7O0FBTUFoQixlQUFTQSxPQUFPaUIsS0FBUCxFQUFULENBVk0sQ0FVb0I7O0FBRTFCLFVBQU1oQixZQUFZLEtBQUtBLFNBQXZCO0FBQUEsVUFDTUMscUJBQXFCLEtBQUtBLGtCQUFMLENBQXdCYSxHQUF4QixDQUE0QixVQUFTYixrQkFBVCxFQUE2QjtBQUM1RUEsNkJBQXFCQSxtQkFBbUJlLEtBQW5CLEVBQXJCLENBRDRFLENBQzFCOztBQUVsRCxlQUFPZixrQkFBUDtBQUNELE9BSm9CLENBRDNCO0FBQUEsVUFNTWdCLGdCQUFnQixJQUFJcEIsYUFBSixDQUFrQkMsUUFBbEIsRUFBNEJDLE1BQTVCLEVBQW9DQyxTQUFwQyxFQUErQ0Msa0JBQS9DLENBTnRCOztBQVFBLGFBQU9nQixhQUFQO0FBQ0Q7OztpQ0FFWW5CLFEsRUFBVTtBQUNyQixVQUFNQyxTQUFTUixnQkFBZ0JPLFFBQWhCLENBQWY7QUFBQSxVQUNNRSxZQUFZLEtBQUtBLFNBRHZCO0FBQUEsVUFFTWtCLGlCQUFpQixLQUFLcEIsUUFGNUI7QUFBQSxVQUVzQztBQUNoQ0csMkJBQXFCa0Isa0VBQWtFckIsUUFBbEUsRUFBNEVvQixjQUE1RSxFQUE0RixLQUFLakIsa0JBQWpHLENBSDNCO0FBQUEsVUFJTWdCLGdCQUFnQixJQUFJcEIsYUFBSixDQUFrQkMsUUFBbEIsRUFBNEJDLE1BQTVCLEVBQW9DQyxTQUFwQyxFQUErQ0Msa0JBQS9DLENBSnRCOztBQU1BLGFBQU9nQixhQUFQO0FBQ0Q7OztzRUFFd0RuQixRLEVBQVVzQixPLEVBQVNwQixTLEVBQVdDLGtCLEVBQW9Cb0IsSyxFQUFPO0FBQ2hIdkIsaUJBQVdzQixRQUFRTixHQUFSLENBQVksVUFBU08sS0FBVCxFQUFnQjtBQUFFLGVBQU92QixTQUFTdUIsS0FBVCxDQUFQO0FBQXlCLE9BQXZELENBQVgsQ0FEZ0gsQ0FDMUM7O0FBRXRFcEIsMkJBQXFCQSxtQkFBbUJlLEtBQW5CLENBQXlCSyxRQUFRLENBQWpDLEVBQW9DQSxRQUFRLENBQVIsR0FBWSxDQUFoRCxDQUFyQixDQUhnSCxDQUd0Qzs7QUFFMUUsVUFBTXRCLFNBQVNSLGdCQUFnQk8sUUFBaEIsQ0FBZjtBQUFBLFVBQ01tQixnQkFBZ0IsSUFBSXBCLGFBQUosQ0FBa0JDLFFBQWxCLEVBQTRCQyxNQUE1QixFQUFvQ0MsU0FBcEMsRUFBK0NDLGtCQUEvQyxDQUR0Qjs7QUFHQSxhQUFPZ0IsYUFBUDtBQUNEOzs7O0VBNUV5QjFDLEs7O0FBK0U1QitDLE9BQU9DLE9BQVAsR0FBaUIxQixhQUFqQjs7QUFFQSxTQUFTVywyQkFBVCxDQUFxQ1Asa0JBQXJDLEVBQXlEQyxJQUF6RCxFQUErREUsTUFBL0QsRUFBdUVDLEtBQXZFLEVBQThFQyxNQUE5RSxFQUF1RjtBQUNyRkwsdUJBQXFCQSxtQkFBbUJhLEdBQW5CLENBQXVCLFVBQVNiLGtCQUFULEVBQTZCO0FBQUc7QUFDMUVBLHlCQUFxQlIsS0FBS0MsVUFBVU8sa0JBQVYsRUFBOEIsQ0FBRUksS0FBRixFQUFTQyxNQUFULENBQTlCLENBQUwsRUFBd0QsQ0FBRUosSUFBRixFQUFRRSxNQUFSLENBQXhELENBQXJCOztBQUVBLFdBQU9ILGtCQUFQO0FBQ0QsR0FKb0IsQ0FBckI7O0FBTUEsU0FBT0Esa0JBQVA7QUFDRDs7QUFFRCxTQUFTa0IsaUVBQVQsQ0FBMkVyQixRQUEzRSxFQUFxRm9CLGNBQXJGLEVBQXFHakIsa0JBQXJHLEVBQXlIO0FBQ3ZILE1BQU1GLFNBQVNSLGdCQUFnQk8sUUFBaEIsQ0FBZjtBQUFBLE1BQ00wQixxQkFBcUJ0Qyw0QkFBNEJhLE1BQTVCLENBRDNCO0FBQUEsTUFFTTBCLG9CQUFvQmpDLGVBQWVNLFFBQWYsRUFBeUIwQixrQkFBekIsQ0FGMUI7QUFBQSxNQUdNRSwwQkFBMEJsQyxlQUFlMEIsY0FBZixFQUErQk0sa0JBQS9CLENBSGhDO0FBQUEsTUFJTUcsMkJBQTJCQyxrQ0FBa0MzQixrQkFBbEMsQ0FKakM7QUFBQSxNQUtNNEIsMEJBQTBCQyxpQ0FBaUNKLHVCQUFqQyxFQUEwREMsd0JBQTFELENBTGhDOztBQU9BMUIsdUJBQXFCOEIsNEJBQTRCTixpQkFBNUIsRUFBK0NJLHVCQUEvQyxDQUFyQjs7QUFFQSxTQUFPNUIsa0JBQVA7QUFDRDs7QUFFRCxTQUFTMkIsaUNBQVQsQ0FBMkMzQixrQkFBM0MsRUFBK0Q7QUFDN0QsTUFBTStCLHlCQUF5QjdDLE1BQU1jLGtCQUFOLENBQS9CO0FBQUEsTUFDTWdDLDBCQUEwQjdDLE9BQU9hLGtCQUFQLENBRGhDO0FBQUEsTUFFTWlDLHlCQUF5QjdDLE1BQU1ZLGtCQUFOLENBRi9CO0FBQUEsTUFHTWtDLE1BQU1ILHVCQUF1QixDQUF2QixDQUhaO0FBQUEsTUFHdUM7QUFDakNJLFFBQU1KLHVCQUF1QixDQUF2QixDQUpaO0FBQUEsTUFJdUM7QUFDakNLLFFBQU1KLHdCQUF3QixDQUF4QixDQUxaO0FBQUEsTUFLd0M7QUFDbENLLFFBQU1MLHdCQUF3QixDQUF4QixDQU5aO0FBQUEsTUFNd0M7QUFDbENNLFFBQU1MLHVCQUF1QixDQUF2QixDQVBaO0FBQUEsTUFPdUM7QUFDakNNLFFBQU1OLHVCQUF1QixDQUF2QixDQVJaO0FBQUEsTUFRdUM7QUFDakNQLDZCQUEyQjNDLFFBQVEsQ0FBRSxDQUFGLEVBQUssQ0FBTCxFQUFRLENBQVIsRUFBV21ELEdBQVgsRUFBZ0JFLEdBQWhCLEVBQXFCRSxHQUFyQixFQUEwQkgsR0FBMUIsRUFBK0JFLEdBQS9CLEVBQW9DRSxHQUFwQyxDQUFSLENBVGpDOztBQVdBLFNBQU9iLHdCQUFQO0FBQ0Q7O0FBRUQsU0FBU0csZ0NBQVQsQ0FBMENKLHVCQUExQyxFQUFtRUMsd0JBQW5FLEVBQTZGO0FBQzNGLE1BQU1jLDZCQUE2QnRELE1BQU11Qyx1QkFBTixDQUFuQztBQUFBLE1BQ01nQiw4QkFBOEJ0RCxPQUFPc0MsdUJBQVAsQ0FEcEM7QUFBQSxNQUVNaUIsNkJBQTZCdEQsTUFBTXFDLHVCQUFOLENBRm5DO0FBQUEsTUFHTWtCLE1BQU1ILDJCQUEyQixDQUEzQixDQUhaO0FBQUEsTUFHMkM7QUFDckNJLFFBQU1KLDJCQUEyQixDQUEzQixDQUpaO0FBQUEsTUFJMkM7QUFDckNLLFFBQU1KLDRCQUE0QixDQUE1QixDQUxaO0FBQUEsTUFLNEM7QUFDdENLLFFBQU1MLDRCQUE0QixDQUE1QixDQU5aO0FBQUEsTUFNNEM7QUFDdENNLFFBQU1MLDJCQUEyQixDQUEzQixDQVBaO0FBQUEsTUFPMkM7QUFDckNNLFFBQU1OLDJCQUEyQixDQUEzQixDQVJaO0FBQUEsTUFRMkM7QUFDckNPLFlBQVV0RCxXQUFXLENBQUVnRCxHQUFGLEVBQU9FLEdBQVAsRUFBWUUsR0FBWixDQUFYLEVBQThCckIsd0JBQTlCLENBVGhCO0FBQUEsTUFVTXdCLFVBQVV2RCxXQUFXLENBQUVpRCxHQUFGLEVBQU9FLEdBQVAsRUFBWUUsR0FBWixDQUFYLEVBQThCdEIsd0JBQTlCLENBVmhCO0FBQUEsTUFXTUUsMEJBQTBCLEdBQUd1QixNQUFILENBQVVGLE9BQVYsRUFBbUJFLE1BQW5CLENBQTBCRCxPQUExQixDQVhoQzs7QUFhQSxTQUFPdEIsdUJBQVA7QUFDRDs7QUFFRCxTQUFTRSwyQkFBVCxDQUFxQ04saUJBQXJDLEVBQXdESSx1QkFBeEQsRUFBaUY7QUFDL0UsTUFBTXdCLHVCQUF1QmxFLE1BQU1zQyxpQkFBTixDQUE3QjtBQUFBLE1BQ002Qix3QkFBd0JsRSxPQUFPcUMsaUJBQVAsQ0FEOUI7QUFBQSxNQUVNOEIsdUJBQXVCbEUsTUFBTW9DLGlCQUFOLENBRjdCO0FBQUEsTUFHTStCLE1BQU1ILHFCQUFxQixDQUFyQixDQUhaO0FBQUEsTUFHc0M7QUFDaENJLFFBQU1KLHFCQUFxQixDQUFyQixDQUpaO0FBQUEsTUFJc0M7QUFDaENLLFFBQU1KLHNCQUFzQixDQUF0QixDQUxaO0FBQUEsTUFLc0M7QUFDaENLLFFBQU1MLHNCQUFzQixDQUF0QixDQU5aO0FBQUEsTUFNc0M7QUFDaENNLFFBQU1MLHFCQUFxQixDQUFyQixDQVBaO0FBQUEsTUFPc0M7QUFDaENNLFFBQU1OLHFCQUFxQixDQUFyQixDQVJaO0FBQUEsTUFRc0M7QUFDaENPLE9BQUtqQyx3QkFBd0IsQ0FBeEIsQ0FUWDtBQUFBLE1BU3dDO0FBQ2xDa0MsT0FBS2xDLHdCQUF3QixDQUF4QixDQVZYO0FBQUEsTUFVd0M7QUFDbENtQyxPQUFLbkMsd0JBQXdCLENBQXhCLENBWFg7QUFBQSxNQVd3QztBQUNsQ29DLE9BQUtwQyx3QkFBd0IsQ0FBeEIsQ0FaWDtBQUFBLE1BWXdDO0FBQ2xDcUMsT0FBS3JDLHdCQUF3QixDQUF4QixDQWJYO0FBQUEsTUFhd0M7QUFDbENzQyxPQUFLdEMsd0JBQXdCLENBQXhCLENBZFg7QUFBQSxNQWN3QztBQUNsQ3VDLFdBQVNyRixRQUFRLENBQUVpRixFQUFGLEVBQU1DLEVBQU4sRUFBVUMsRUFBVixFQUFjQyxFQUFkLENBQVIsQ0FmZjtBQUFBLE1BZ0JNRSwwQkFBMEIxRSxXQUFXLENBQUU2RCxNQUFNTSxFQUFSLEVBQVlMLE1BQU1NLEVBQWxCLENBQVgsRUFBbUNLLE1BQW5DLENBaEJoQztBQUFBLE1BaUJNRSwyQkFBMkIzRSxXQUFXLENBQUUrRCxNQUFNSSxFQUFSLEVBQVlILE1BQU1JLEVBQWxCLENBQVgsRUFBbUNLLE1BQW5DLENBakJqQztBQUFBLE1Ba0JNRywwQkFBMEI1RSxXQUFXLENBQUVpRSxNQUFNRSxFQUFSLEVBQVlELE1BQU1FLEVBQWxCLENBQVgsRUFBbUNLLE1BQW5DLENBbEJoQztBQUFBLE1BbUJNbkUscUJBQXFCLENBQ25Cb0UsdUJBRG1CLEVBRW5CQyx3QkFGbUIsRUFHbkJDLHVCQUhtQixDQW5CM0I7O0FBeUJBLFNBQU90RSxrQkFBUDtBQUNEIiwiZmlsZSI6InRleHR1cmVkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBGYWNldCA9IHJlcXVpcmUoJy4uL2ZhY2V0JyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgbWF0cml4VXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL21hdHJpeCcpLFxuICAgICAgdmVjdG9yVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL3ZlY3RvcicpLFxuICAgICAgdmVydGljZXNVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvdmVydGljZXMnKSxcbiAgICAgIGltYWdlTWFwVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2ltYWdlTWFwJyksXG4gICAgICByb3RhdGlvblV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9yb3RhdGlvbicpO1xuXG5jb25zdCB7IGludmVydDIsIGludmVydDMgfSA9IG1hdHJpeFV0aWxpdGllcyxcbiAgICAgIHsgZ2V0SW1hZ2VEZXRhaWxzIH0gPSBpbWFnZU1hcFV0aWxpdGllcyxcbiAgICAgIHsgY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uIH0gPSByb3RhdGlvblV0aWxpdGllcyxcbiAgICAgIHsgZmlyc3QsIHNlY29uZCwgdGhpcmQsIHBlcm11dGUgfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBjYWxjdWxhdGVOb3JtYWwsIHJvdGF0ZVZlcnRpY2VzIH0gPSB2ZXJ0aWNlc1V0aWxpdGllcyxcbiAgICAgIHsgYWRkMiwgbXVsdGlwbHkyLCB0cmFuc2Zvcm0yLCB0cmFuc2Zvcm0zIH0gPSB2ZWN0b3JVdGlsaXRpZXM7XG5cbmNsYXNzIFRleHR1cmVkRmFjZXQgZXh0ZW5kcyBGYWNldCB7XG4gIGNvbnN0cnVjdG9yKHZlcnRpY2VzLCBub3JtYWwsIGltYWdlTmFtZSwgdGV4dHVyZUNvb3JkaW5hdGVzKSB7XG4gICAgc3VwZXIodmVydGljZXMsIG5vcm1hbCk7XG5cbiAgICB0aGlzLmltYWdlTmFtZSA9IGltYWdlTmFtZTtcbiAgICB0aGlzLnRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlcztcbiAgfVxuXG4gIGdldEltYWdlTmFtZSgpIHtcbiAgICByZXR1cm4gdGhpcy5pbWFnZU5hbWU7XG4gIH1cblxuICBnZXRUZXh0dXJlQ29vcmRpbmF0ZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMudGV4dHVyZUNvb3JkaW5hdGVzO1xuICB9XG5cbiAgZ2V0VmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzKCkge1xuICAgIGNvbnN0IGltYWdlRGV0YWlscyA9IGdldEltYWdlRGV0YWlscyh0aGlzLmltYWdlTmFtZSksXG4gICAgICAgICAgeyBsZWZ0LCBib3R0b20sIHdpZHRoLCBoZWlnaHQgfSA9IGltYWdlRGV0YWlscyxcbiAgICAgICAgICB2ZXJ0ZXhUZXh0dXJlQ29vcmRpbmF0ZXMgPSB0cmFuc2xhdGVUZXh0dXJlQ29vcmRpbmF0ZXModGhpcy50ZXh0dXJlQ29vcmRpbmF0ZXMsIGxlZnQsIGJvdHRvbSwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICByZXR1cm4gdmVydGV4VGV4dHVyZUNvb3JkaW5hdGVzO1xuICB9XG5cbiAgcGVybXV0ZShwbGFjZXMpIHtcbiAgICBzdXBlci5wZXJtdXRlKHBsYWNlcyk7XG5cbiAgICB0aGlzLnRleHR1cmVDb29yZGluYXRlcyA9IHBlcm11dGUodGhpcy50ZXh0dXJlQ29vcmRpbmF0ZXMsIHBsYWNlcyk7XG4gIH1cblxuICBzcGxpdFdpdGhUd29Ob25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zLCBzbWFsbGVyRmFjZXRzLCBGYWNldCkgeyBzdXBlci5zcGxpdFdpdGhUd29Ob25OdWxsSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zLCBzbWFsbGVyRmFjZXRzLCB0aGlzKTsgfSAvLy9cblxuICBzcGxpdFdpdGhPbmVOb25OdWxsSW50ZXJzZWN0aW9uKGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMsIEZhY2V0KSB7IHN1cGVyLnNwbGl0V2l0aE9uZU5vbk51bGxJbnRlcnNlY3Rpb24oaW50ZXJzZWN0aW9ucywgc21hbGxlckZhY2V0cywgdGhpcyk7IH0gLy8vXG5cbiAgY2xvbmUoKSB7XG4gICAgbGV0IHZlcnRpY2VzID0gdGhpcy5nZXRWZXJ0aWNlcygpLFxuICAgICAgICBub3JtYWwgPSB0aGlzLmdldE5vcm1hbCgpO1xuXG4gICAgdmVydGljZXMgPSB2ZXJ0aWNlcy5tYXAoZnVuY3Rpb24odmVydGV4KSB7XG4gICAgICB2ZXJ0ZXggPSB2ZXJ0ZXguc2xpY2UoKTsgIC8vL1xuXG4gICAgICByZXR1cm4gdmVydGV4O1xuICAgIH0pO1xuXG4gICAgbm9ybWFsID0gbm9ybWFsLnNsaWNlKCk7ICAvLy9cblxuICAgIGNvbnN0IGltYWdlTmFtZSA9IHRoaXMuaW1hZ2VOYW1lLFxuICAgICAgICAgIHRleHR1cmVDb29yZGluYXRlcyA9IHRoaXMudGV4dHVyZUNvb3JkaW5hdGVzLm1hcChmdW5jdGlvbih0ZXh0dXJlQ29vcmRpbmF0ZXMpIHtcbiAgICAgICAgICAgIHRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlcy5zbGljZSgpOyAgLy8vXG5cbiAgICAgICAgICAgIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXM7XG4gICAgICAgICAgfSksXG4gICAgICAgICAgdGV4dHVyZWRGYWNldCA9IG5ldyBUZXh0dXJlZEZhY2V0KHZlcnRpY2VzLCBub3JtYWwsIGltYWdlTmFtZSwgdGV4dHVyZUNvb3JkaW5hdGVzKTtcblxuICAgIHJldHVybiB0ZXh0dXJlZEZhY2V0O1xuICB9XG5cbiAgZnJvbVZlcnRpY2VzKHZlcnRpY2VzKSB7XG4gICAgY29uc3Qgbm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHZlcnRpY2VzKSxcbiAgICAgICAgICBpbWFnZU5hbWUgPSB0aGlzLmltYWdlTmFtZSxcbiAgICAgICAgICBwYXJlbnRWZXJ0aWNlcyA9IHRoaXMudmVydGljZXMsIC8vL1xuICAgICAgICAgIHRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlc0Zyb21WZXJ0aWNlc1BhcmVudFZlcnRpY2VzQW5kVGV4dHVyZUNvb3JkaW5hdGVzKHZlcnRpY2VzLCBwYXJlbnRWZXJ0aWNlcywgdGhpcy50ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICAgIHRleHR1cmVkRmFjZXQgPSBuZXcgVGV4dHVyZWRGYWNldCh2ZXJ0aWNlcywgbm9ybWFsLCBpbWFnZU5hbWUsIHRleHR1cmVDb29yZGluYXRlcyk7XG5cbiAgICByZXR1cm4gdGV4dHVyZWRGYWNldDtcbiAgfVxuXG4gIHN0YXRpYyBmcm9tVmVydGljZXNJbmRleGVzSW1hZ2VOYW1lQW5kVGV4dHVyZUNvb3JkaW5hdGVzKHZlcnRpY2VzLCBpbmRleGVzLCBpbWFnZU5hbWUsIHRleHR1cmVDb29yZGluYXRlcywgaW5kZXgpIHtcbiAgICB2ZXJ0aWNlcyA9IGluZGV4ZXMubWFwKGZ1bmN0aW9uKGluZGV4KSB7IHJldHVybiB2ZXJ0aWNlc1tpbmRleF07IH0pOyAgLy8vXG5cbiAgICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSB0ZXh0dXJlQ29vcmRpbmF0ZXMuc2xpY2UoaW5kZXggKiAzLCBpbmRleCAqIDMgKyAzKTsgIC8vL1xuXG4gICAgY29uc3Qgbm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHZlcnRpY2VzKSxcbiAgICAgICAgICB0ZXh0dXJlZEZhY2V0ID0gbmV3IFRleHR1cmVkRmFjZXQodmVydGljZXMsIG5vcm1hbCwgaW1hZ2VOYW1lLCB0ZXh0dXJlQ29vcmRpbmF0ZXMpO1xuXG4gICAgcmV0dXJuIHRleHR1cmVkRmFjZXQ7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBUZXh0dXJlZEZhY2V0O1xuXG5mdW5jdGlvbiB0cmFuc2xhdGVUZXh0dXJlQ29vcmRpbmF0ZXModGV4dHVyZUNvb3JkaW5hdGVzLCBsZWZ0LCBib3R0b20sIHdpZHRoLCBoZWlnaHQgKSB7XG4gIHRleHR1cmVDb29yZGluYXRlcyA9IHRleHR1cmVDb29yZGluYXRlcy5tYXAoZnVuY3Rpb24odGV4dHVyZUNvb3JkaW5hdGVzKSB7ICAvLy9cbiAgICB0ZXh0dXJlQ29vcmRpbmF0ZXMgPSBhZGQyKG11bHRpcGx5Mih0ZXh0dXJlQ29vcmRpbmF0ZXMsIFsgd2lkdGgsIGhlaWdodCBdICksIFsgbGVmdCwgYm90dG9tIF0pO1xuXG4gICAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlcztcbiAgfSk7XG5cbiAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlcztcbn1cblxuZnVuY3Rpb24gdGV4dHVyZUNvb3JkaW5hdGVzRnJvbVZlcnRpY2VzUGFyZW50VmVydGljZXNBbmRUZXh0dXJlQ29vcmRpbmF0ZXModmVydGljZXMsIHBhcmVudFZlcnRpY2VzLCB0ZXh0dXJlQ29vcmRpbmF0ZXMpIHtcbiAgY29uc3Qgbm9ybWFsID0gY2FsY3VsYXRlTm9ybWFsKHZlcnRpY2VzKSxcbiAgICAgICAgcm90YXRpb25RdWF0ZXJuaW9uID0gY2FsY3VsYXRlUm90YXRpb25RdWF0ZXJuaW9uKG5vcm1hbCksXG4gICAgICAgIHZlcnRpY2VzSW5YWVBsYW5lID0gcm90YXRlVmVydGljZXModmVydGljZXMsIHJvdGF0aW9uUXVhdGVybmlvbiksXG4gICAgICAgIHBhcmVudFZlcnRpY2VzSW5YWVBsYW5lID0gcm90YXRlVmVydGljZXMocGFyZW50VmVydGljZXMsIHJvdGF0aW9uUXVhdGVybmlvbiksXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCA9IGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc01hdHJpeCh0ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcyA9IGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc0Jhc2lzKHBhcmVudFZlcnRpY2VzSW5YWVBsYW5lLCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgpO1xuXG4gIHRleHR1cmVDb29yZGluYXRlcyA9IGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlcyh2ZXJ0aWNlc0luWFlQbGFuZSwgdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXMpO1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXM7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc01hdHJpeCh0ZXh0dXJlQ29vcmRpbmF0ZXMpIHtcbiAgY29uc3QgZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZSA9IGZpcnN0KHRleHR1cmVDb29yZGluYXRlcyksXG4gICAgICAgIHNlY29uZFRleHR1cmVDb29yZGluYXRlID0gc2Vjb25kKHRleHR1cmVDb29yZGluYXRlcyksXG4gICAgICAgIHRoaXJkVGV4dHVyZUNvb3JkaW5hdGUgPSB0aGlyZCh0ZXh0dXJlQ29vcmRpbmF0ZXMpLFxuICAgICAgICBQMXUgPSBmaXJzdFRleHR1cmVDb29yZGluYXRlWzBdLCAvLy9cbiAgICAgICAgUDF2ID0gZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZVsxXSwgLy8vXG4gICAgICAgIFAydSA9IHNlY29uZFRleHR1cmVDb29yZGluYXRlWzBdLCAvLy9cbiAgICAgICAgUDJ2ID0gc2Vjb25kVGV4dHVyZUNvb3JkaW5hdGVbMV0sIC8vL1xuICAgICAgICBQM3UgPSB0aGlyZFRleHR1cmVDb29yZGluYXRlWzBdLCAvLy9cbiAgICAgICAgUDN2ID0gdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZVsxXSwgLy8vXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlc01hdHJpeCA9IGludmVydDMoWyAxLCAxLCAxLCBQMXUsIFAydSwgUDN1LCBQMXYsIFAydiwgUDN2IF0pO1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXg7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVRleHR1cmVDb29yZGluYXRlc0Jhc2lzKHBhcmVudFZlcnRpY2VzSW5YWVBsYW5lLCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgpIHtcbiAgY29uc3QgZmlyc3RQYXJlbnRWZXJ0ZXhJblhZUGxhbmUgPSBmaXJzdChwYXJlbnRWZXJ0aWNlc0luWFlQbGFuZSksXG4gICAgICAgIHNlY29uZFBhcmVudFZlcnRleEluWFlQbGFuZSA9IHNlY29uZChwYXJlbnRWZXJ0aWNlc0luWFlQbGFuZSksXG4gICAgICAgIHRoaXJkUGFyZW50VmVydGV4SW5YWVBsYW5lID0gdGhpcmQocGFyZW50VmVydGljZXNJblhZUGxhbmUpLFxuICAgICAgICBQMXggPSBmaXJzdFBhcmVudFZlcnRleEluWFlQbGFuZVswXSwgLy8vXG4gICAgICAgIFAxeSA9IGZpcnN0UGFyZW50VmVydGV4SW5YWVBsYW5lWzFdLCAvLy9cbiAgICAgICAgUDJ4ID0gc2Vjb25kUGFyZW50VmVydGV4SW5YWVBsYW5lWzBdLCAvLy9cbiAgICAgICAgUDJ5ID0gc2Vjb25kUGFyZW50VmVydGV4SW5YWVBsYW5lWzFdLCAvLy9cbiAgICAgICAgUDN4ID0gdGhpcmRQYXJlbnRWZXJ0ZXhJblhZUGxhbmVbMF0sIC8vL1xuICAgICAgICBQM3kgPSB0aGlyZFBhcmVudFZlcnRleEluWFlQbGFuZVsxXSwgLy8vXG4gICAgICAgIHhWZWN0b3IgPSB0cmFuc2Zvcm0zKFsgUDF4LCBQMngsIFAzeCBdLCB0ZXh0dXJlQ29vcmRpbmF0ZXNNYXRyaXgpLFxuICAgICAgICB5VmVjdG9yID0gdHJhbnNmb3JtMyhbIFAxeSwgUDJ5LCBQM3kgXSwgdGV4dHVyZUNvb3JkaW5hdGVzTWF0cml4KSxcbiAgICAgICAgdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXMgPSBbXS5jb25jYXQoeFZlY3RvcikuY29uY2F0KHlWZWN0b3IpO1xuXG4gIHJldHVybiB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcztcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVGV4dHVyZUNvb3JkaW5hdGVzKHZlcnRpY2VzSW5YWVBsYW5lLCB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpcykge1xuICBjb25zdCBmaXJzdFZlcnRleEluWFlQbGFuZSA9IGZpcnN0KHZlcnRpY2VzSW5YWVBsYW5lKSxcbiAgICAgICAgc2Vjb25kVmVydGV4SW5YWVBsYW5lID0gc2Vjb25kKHZlcnRpY2VzSW5YWVBsYW5lKSxcbiAgICAgICAgdGhpcmRWZXJ0ZXhJblhZUGxhbmUgPSB0aGlyZCh2ZXJ0aWNlc0luWFlQbGFuZSksXG4gICAgICAgIFIxeCA9IGZpcnN0VmVydGV4SW5YWVBsYW5lWzBdLCAgLy8vXG4gICAgICAgIFIxeSA9IGZpcnN0VmVydGV4SW5YWVBsYW5lWzFdLCAgLy8vXG4gICAgICAgIFIyeCA9IHNlY29uZFZlcnRleEluWFlQbGFuZVswXSwgLy8vXG4gICAgICAgIFIyeSA9IHNlY29uZFZlcnRleEluWFlQbGFuZVsxXSwgLy8vXG4gICAgICAgIFIzeCA9IHRoaXJkVmVydGV4SW5YWVBsYW5lWzBdLCAgLy8vXG4gICAgICAgIFIzeSA9IHRoaXJkVmVydGV4SW5YWVBsYW5lWzFdLCAgLy8vXG4gICAgICAgIE94ID0gdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXNbMF0sICAvLy9cbiAgICAgICAgT3kgPSB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpc1szXSwgIC8vL1xuICAgICAgICBVeCA9IHRleHR1cmVDb29yZGluYXRlc0Jhc2lzWzFdLCAgLy8vXG4gICAgICAgIFV5ID0gdGV4dHVyZUNvb3JkaW5hdGVzQmFzaXNbNF0sICAvLy9cbiAgICAgICAgVnggPSB0ZXh0dXJlQ29vcmRpbmF0ZXNCYXNpc1syXSwgIC8vL1xuICAgICAgICBWeSA9IHRleHR1cmVDb29yZGluYXRlc0Jhc2lzWzVdLCAgLy8vXG4gICAgICAgIG1hdHJpeCA9IGludmVydDIoWyBVeCwgVXksIFZ4LCBWeSBdKSxcbiAgICAgICAgZmlyc3RUZXh0dXJlQ29vcmRpbmF0ZXMgPSB0cmFuc2Zvcm0yKFsgUjF4IC0gT3gsIFIxeSAtIE95IF0sIG1hdHJpeCksXG4gICAgICAgIHNlY29uZFRleHR1cmVDb29yZGluYXRlcyA9IHRyYW5zZm9ybTIoWyBSMnggLSBPeCwgUjJ5IC0gT3kgXSwgbWF0cml4KSxcbiAgICAgICAgdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZXMgPSB0cmFuc2Zvcm0yKFsgUjN4IC0gT3gsIFIzeSAtIE95IF0sIG1hdHJpeCksXG4gICAgICAgIHRleHR1cmVDb29yZGluYXRlcyA9IFtcbiAgICAgICAgICBmaXJzdFRleHR1cmVDb29yZGluYXRlcyxcbiAgICAgICAgICBzZWNvbmRUZXh0dXJlQ29vcmRpbmF0ZXMsXG4gICAgICAgICAgdGhpcmRUZXh0dXJlQ29vcmRpbmF0ZXMsXG4gICAgICAgIF07XG5cbiAgcmV0dXJuIHRleHR1cmVDb29yZGluYXRlcztcbn1cbiJdfQ==