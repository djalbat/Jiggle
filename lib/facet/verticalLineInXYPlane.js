'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var arrayUtilities = require('../utilities/array'),
    vectorUtilities = require('../utilities/vector'),
    vertexUtilities = require('../utilities/vertex'),
    rotationUtilities = require('../utilities/rotation'),
    approximateUtilities = require('../utilities/approximate');

var normalise3 = vectorUtilities.normalise3,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    rotateAboutZAxis = vertexUtilities.rotateAboutZAxis,
    isApproximatelyEqualToZero = approximateUtilities.isApproximatelyEqualToZero,
    calculateForwardsRotationAboutZAxisMatrix = rotationUtilities.calculateForwardsRotationAboutZAxisMatrix,
    calculateBackwardsRotationAboutZAxisMatrix = rotationUtilities.calculateBackwardsRotationAboutZAxisMatrix;

var VerticalLineInXYPlane = function () {
  function VerticalLineInXYPlane(firstPositionComponent, rotationAboutZAxisMatrix) {
    _classCallCheck(this, VerticalLineInXYPlane);

    this.firstPositionComponent = firstPositionComponent;
    this.rotationAboutZAxisMatrix = rotationAboutZAxisMatrix;
  }

  _createClass(VerticalLineInXYPlane, [{
    key: 'getFirstPositionComponent',
    value: function getFirstPositionComponent() {
      return this.firstPositionComponent;
    }
  }, {
    key: 'getRotationAboutZAxisMatrix',
    value: function getRotationAboutZAxisMatrix() {
      return this.rotationAboutZAxisMatrix;
    }
  }, {
    key: 'splitFacets',
    value: function splitFacets(facets) {
      var smallerFacets = [],
          forwardsRotationAboutZAxisMatrix = calculateForwardsRotationAboutZAxisMatrix(this.rotationAboutZAxisMatrix),
          backwardsRotationAboutZAxisMatrix = calculateBackwardsRotationAboutZAxisMatrix(this.rotationAboutZAxisMatrix);

      facets.forEach(function (facet) {
        facet.rotateAboutZAxis(forwardsRotationAboutZAxisMatrix);

        this.splitFacet(facet, smallerFacets);
      }.bind(this));

      smallerFacets.forEach(function (smallerFacet) {
        smallerFacet.rotateAboutZAxis(backwardsRotationAboutZAxisMatrix);
      });

      return smallerFacets;
    }
  }, {
    key: 'splitFacet',
    value: function splitFacet(facet, smallerFacets) {
      var intersections = this.calculateIntersectionsWithFacet(facet);

      facet.split(intersections, smallerFacets);
    }
  }, {
    key: 'calculateIntersectionsWithFacet',
    value: function calculateIntersectionsWithFacet(facet) {
      var edges = facet.getEdges(),
          intersections = edges.map(function (edge) {
        var intersection = this.calculateIntersection(edge);

        return intersection;
      }.bind(this));

      return intersections;
    }
  }, {
    key: 'calculateIntersection',
    value: function calculateIntersection(edge) {
      var intersection = null;

      var edgeNonParallel = isEdgeNonParallel(edge);

      if (edgeNonParallel) {
        var edgeIntersection = this.calculateEdgeIntersection(edge),
            edgeIntersectionNonTrivial = isIntersectionNonTrivial(edgeIntersection);

        if (edgeIntersectionNonTrivial) {
          intersection = edgeIntersection; ///
        }
      }

      return intersection;
    }
  }, {
    key: 'calculateEdgeIntersection',
    value: function calculateEdgeIntersection(edge) {
      var edgePosition = edge.getPosition(),
          edgeExtent = edge.getExtent(),
          edgePositionComponents = edgePosition,
          ///
      edgeExtentComponents = edgeExtent,
          ///
      firstEdgePositionComponent = first(edgePositionComponents),
          firstEdgeExtentComponent = first(edgeExtentComponents),
          edgeIntersection = (this.firstPositionComponent - firstEdgePositionComponent) / firstEdgeExtentComponent;

      return edgeIntersection;
    }
  }], [{
    key: 'fromEdgeInXYPlane',
    value: function fromEdgeInXYPlane(edgeInXYPlane) {
      var edgeInXYPlanePosition = edgeInXYPlane.getPosition(),
          rotationAboutZAxisMatrix = calculateRotationAboutZAxisMatrix(edgeInXYPlane),
          position = rotateAboutZAxis(edgeInXYPlanePosition, rotationAboutZAxisMatrix),
          positionComponents = position,
          ///
      firstPositionComponent = first(positionComponents),
          verticalLineInXYPlane = new VerticalLineInXYPlane(firstPositionComponent, rotationAboutZAxisMatrix);

      return verticalLineInXYPlane;
    }
  }]);

  return VerticalLineInXYPlane;
}();

module.exports = VerticalLineInXYPlane;

function isEdgeNonParallel(edge) {
  var edgeExtent = edge.getExtent(),
      edgeExtentComponents = edgeExtent,
      ///
  firstEdgeExtentComponent = first(edgeExtentComponents),
      secondEdgeExtentComponent = second(edgeExtentComponents),
      edgeAngleTangent = firstEdgeExtentComponent / secondEdgeExtentComponent,
      edgeAngleTangentApproximatelyEqualToZero = isApproximatelyEqualToZero(edgeAngleTangent),
      edgeParallel = edgeAngleTangentApproximatelyEqualToZero,
      ///
  edgeNonParallel = !edgeParallel;

  return edgeNonParallel;
}

function isIntersectionNonTrivial(intersection) {
  var intersectionNonTrivial = intersection > 0 && intersection < 1;

  return intersectionNonTrivial;
}

function calculateRotationAboutZAxisMatrix(edgeInXYPlane) {
  var edgeInXYPlaneExtent = edgeInXYPlane.getExtent(),
      unitEdgeInXYPlaneExtent = normalise3(edgeInXYPlaneExtent),
      unitEdgeInXYPlaneExtentComponents = unitEdgeInXYPlaneExtent,
      ///
  firstUnitEdgeInXYPlaneExtentComponent = first(unitEdgeInXYPlaneExtentComponents),
      secondUnitEdgeInXYPlaneExtentComponent = second(unitEdgeInXYPlaneExtentComponents),
      angleOfRotationCosine = +secondUnitEdgeInXYPlaneExtentComponent,
      ///
  angleOfRotationSine = -firstUnitEdgeInXYPlaneExtentComponent,
      ///
  c = angleOfRotationCosine,
      s = angleOfRotationSine,
      rotationAboutZAxisMatrix = [c, -s, 0, +s, c, 0, 0, 0, 1]; ///

  return rotationAboutZAxisMatrix;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9mYWNldC92ZXJ0aWNhbExpbmVJblhZUGxhbmUuanMiXSwibmFtZXMiOlsiYXJyYXlVdGlsaXRpZXMiLCJyZXF1aXJlIiwidmVjdG9yVXRpbGl0aWVzIiwidmVydGV4VXRpbGl0aWVzIiwicm90YXRpb25VdGlsaXRpZXMiLCJhcHByb3hpbWF0ZVV0aWxpdGllcyIsIm5vcm1hbGlzZTMiLCJmaXJzdCIsInNlY29uZCIsInJvdGF0ZUFib3V0WkF4aXMiLCJpc0FwcHJveGltYXRlbHlFcXVhbFRvWmVybyIsImNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4IiwiY2FsY3VsYXRlQmFja3dhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4IiwiVmVydGljYWxMaW5lSW5YWVBsYW5lIiwiZmlyc3RQb3NpdGlvbkNvbXBvbmVudCIsInJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCIsImZhY2V0cyIsInNtYWxsZXJGYWNldHMiLCJmb3J3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCIsImJhY2t3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCIsImZvckVhY2giLCJmYWNldCIsInNwbGl0RmFjZXQiLCJiaW5kIiwic21hbGxlckZhY2V0IiwiaW50ZXJzZWN0aW9ucyIsImNhbGN1bGF0ZUludGVyc2VjdGlvbnNXaXRoRmFjZXQiLCJzcGxpdCIsImVkZ2VzIiwiZ2V0RWRnZXMiLCJtYXAiLCJlZGdlIiwiaW50ZXJzZWN0aW9uIiwiY2FsY3VsYXRlSW50ZXJzZWN0aW9uIiwiZWRnZU5vblBhcmFsbGVsIiwiaXNFZGdlTm9uUGFyYWxsZWwiLCJlZGdlSW50ZXJzZWN0aW9uIiwiY2FsY3VsYXRlRWRnZUludGVyc2VjdGlvbiIsImVkZ2VJbnRlcnNlY3Rpb25Ob25Ucml2aWFsIiwiaXNJbnRlcnNlY3Rpb25Ob25Ucml2aWFsIiwiZWRnZVBvc2l0aW9uIiwiZ2V0UG9zaXRpb24iLCJlZGdlRXh0ZW50IiwiZ2V0RXh0ZW50IiwiZWRnZVBvc2l0aW9uQ29tcG9uZW50cyIsImVkZ2VFeHRlbnRDb21wb25lbnRzIiwiZmlyc3RFZGdlUG9zaXRpb25Db21wb25lbnQiLCJmaXJzdEVkZ2VFeHRlbnRDb21wb25lbnQiLCJlZGdlSW5YWVBsYW5lIiwiZWRnZUluWFlQbGFuZVBvc2l0aW9uIiwiY2FsY3VsYXRlUm90YXRpb25BYm91dFpBeGlzTWF0cml4IiwicG9zaXRpb24iLCJwb3NpdGlvbkNvbXBvbmVudHMiLCJ2ZXJ0aWNhbExpbmVJblhZUGxhbmUiLCJtb2R1bGUiLCJleHBvcnRzIiwic2Vjb25kRWRnZUV4dGVudENvbXBvbmVudCIsImVkZ2VBbmdsZVRhbmdlbnQiLCJlZGdlQW5nbGVUYW5nZW50QXBwcm94aW1hdGVseUVxdWFsVG9aZXJvIiwiZWRnZVBhcmFsbGVsIiwiaW50ZXJzZWN0aW9uTm9uVHJpdmlhbCIsImVkZ2VJblhZUGxhbmVFeHRlbnQiLCJ1bml0RWRnZUluWFlQbGFuZUV4dGVudCIsInVuaXRFZGdlSW5YWVBsYW5lRXh0ZW50Q29tcG9uZW50cyIsImZpcnN0VW5pdEVkZ2VJblhZUGxhbmVFeHRlbnRDb21wb25lbnQiLCJzZWNvbmRVbml0RWRnZUluWFlQbGFuZUV4dGVudENvbXBvbmVudCIsImFuZ2xlT2ZSb3RhdGlvbkNvc2luZSIsImFuZ2xlT2ZSb3RhdGlvblNpbmUiLCJjIiwicyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQUVBLElBQU1BLGlCQUFpQkMsUUFBUSxvQkFBUixDQUF2QjtBQUFBLElBQ01DLGtCQUFrQkQsUUFBUSxxQkFBUixDQUR4QjtBQUFBLElBRU1FLGtCQUFrQkYsUUFBUSxxQkFBUixDQUZ4QjtBQUFBLElBR01HLG9CQUFvQkgsUUFBUSx1QkFBUixDQUgxQjtBQUFBLElBSU1JLHVCQUF1QkosUUFBUSwwQkFBUixDQUo3Qjs7QUFNTSxJQUFFSyxVQUFGLEdBQWlCSixlQUFqQixDQUFFSSxVQUFGO0FBQUEsSUFDRUMsS0FERixHQUNvQlAsY0FEcEIsQ0FDRU8sS0FERjtBQUFBLElBQ1NDLE1B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QUFDOURFLDBDQUF3Q3pELE1BQU13RCxpQ0FBTixDQUg5QztBQUFBLE1BSU1FLHlDQUF5Q3pELE9BQU91RCxpQ0FBUCxDQUovQztBQUFBLE1BS01HLHdCQUF3QixDQUFDRCxzQ0FML0I7QUFBQSxNQUt3RTtBQUNsRUUsd0JBQXNCLENBQUNILHFDQU43QjtBQUFBLE1BTW9FO0FBQzlESSxNQUFJRixxQkFQVjtBQUFBLE1BUU1HLElBQUlGLG1CQVJWO0FBQUEsTUFTTXBELDJCQUEyQixDQUFFcUQsQ0FBRixFQUFLLENBQUNDLENBQU4sRUFBUyxDQUFULEVBQVksQ0FBQ0EsQ0FBYixFQUFnQkQsQ0FBaEIsRUFBbUIsQ0FBbkIsRUFBc0IsQ0FBdEIsRUFBeUIsQ0FBekIsRUFBNEIsQ0FBNUIsQ0FUakMsQ0FEd0QsQ0FVVzs7QUFFbkUsU0FBT3JELHdCQUFQO0FBQ0QiLCJmaWxlIjoidmVydGljYWxMaW5lSW5YWVBsYW5lLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgdmVjdG9yVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL3ZlY3RvcicpLFxuICAgICAgdmVydGV4VXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL3ZlcnRleCcpLFxuICAgICAgcm90YXRpb25VdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvcm90YXRpb24nKSxcbiAgICAgIGFwcHJveGltYXRlVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2FwcHJveGltYXRlJyk7XG5cbmNvbnN0IHsgbm9ybWFsaXNlMyB9ID0gdmVjdG9yVXRpbGl0aWVzLFxuICAgICAgeyBmaXJzdCwgc2Vjb25kIH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgcm90YXRlQWJvdXRaQXhpcyB9ID0gdmVydGV4VXRpbGl0aWVzLFxuICAgICAgeyBpc0FwcHJveGltYXRlbHlFcXVhbFRvWmVybyB9ID0gYXBwcm94aW1hdGVVdGlsaXRpZXMsXG4gICAgICB7IGNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4LCBjYWxjdWxhdGVCYWNrd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXggfSA9IHJvdGF0aW9uVXRpbGl0aWVzO1xuXG5jbGFzcyBWZXJ0aWNhbExpbmVJblhZUGxhbmUge1xuICBjb25zdHJ1Y3RvcihmaXJzdFBvc2l0aW9uQ29tcG9uZW50LCByb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgpIHtcbiAgICB0aGlzLmZpcnN0UG9zaXRpb25Db21wb25lbnQgPSBmaXJzdFBvc2l0aW9uQ29tcG9uZW50O1xuICAgIHRoaXMucm90YXRpb25BYm91dFpBeGlzTWF0cml4ID0gcm90YXRpb25BYm91dFpBeGlzTWF0cml4O1xuICB9XG5cbiAgZ2V0Rmlyc3RQb3NpdGlvbkNvbXBvbmVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5maXJzdFBvc2l0aW9uQ29tcG9uZW50O1xuICB9XG4gIFxuICBnZXRSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgoKSB7XG4gICAgcmV0dXJuIHRoaXMucm90YXRpb25BYm91dFpBeGlzTWF0cml4O1xuICB9XG5cbiAgc3BsaXRGYWNldHMoZmFjZXRzKSB7XG4gICAgY29uc3Qgc21hbGxlckZhY2V0cyA9IFtdLFxuICAgICAgICAgIGZvcndhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4ID0gY2FsY3VsYXRlRm9yd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgodGhpcy5yb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgpLFxuICAgICAgICAgIGJhY2t3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCA9IGNhbGN1bGF0ZUJhY2t3YXJkc1JvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCh0aGlzLnJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCk7XG4gICAgXG4gICAgZmFjZXRzLmZvckVhY2goZnVuY3Rpb24oZmFjZXQpIHtcbiAgICAgIGZhY2V0LnJvdGF0ZUFib3V0WkF4aXMoZm9yd2FyZHNSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgpO1xuXG4gICAgICB0aGlzLnNwbGl0RmFjZXQoZmFjZXQsIHNtYWxsZXJGYWNldHMpO1xuICAgIH0uYmluZCh0aGlzKSk7XG4gICAgXG4gICAgc21hbGxlckZhY2V0cy5mb3JFYWNoKGZ1bmN0aW9uKHNtYWxsZXJGYWNldCkge1xuICAgICAgc21hbGxlckZhY2V0LnJvdGF0ZUFib3V0WkF4aXMoYmFja3dhcmRzUm90YXRpb25BYm91dFpBeGlzTWF0cml4KTtcbiAgICB9KTtcblxuICAgIHJldHVybiBzbWFsbGVyRmFjZXRzOyAgICBcbiAgfVxuXG4gIHNwbGl0RmFjZXQoZmFjZXQsIHNtYWxsZXJGYWNldHMpIHtcbiAgICBjb25zdCBpbnRlcnNlY3Rpb25zID0gdGhpcy5jYWxjdWxhdGVJbnRlcnNlY3Rpb25zV2l0aEZhY2V0KGZhY2V0KTtcblxuICAgIGZhY2V0LnNwbGl0KGludGVyc2VjdGlvbnMsIHNtYWxsZXJGYWNldHMpO1xuICB9XG5cbiAgY2FsY3VsYXRlSW50ZXJzZWN0aW9uc1dpdGhGYWNldChmYWNldCkge1xuICAgIGNvbnN0IGVkZ2VzID0gZmFjZXQuZ2V0RWRnZXMoKSxcbiAgICAgICAgICBpbnRlcnNlY3Rpb25zID0gZWRnZXMubWFwKGZ1bmN0aW9uKGVkZ2UpIHtcbiAgICAgICAgICAgIGNvbnN0IGludGVyc2VjdGlvbiA9IHRoaXMuY2FsY3VsYXRlSW50ZXJzZWN0aW9uKGVkZ2UpO1xuXG4gICAgICAgICAgICByZXR1cm4gaW50ZXJzZWN0aW9uO1xuICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICByZXR1cm4gaW50ZXJzZWN0aW9ucztcbiAgfVxuICBcbiAgY2FsY3VsYXRlSW50ZXJzZWN0aW9uKGVkZ2UpIHtcbiAgICBsZXQgaW50ZXJzZWN0aW9uID0gbnVsbDtcblxuICAgIGNvbnN0IGVkZ2VOb25QYXJhbGxlbCA9IGlzRWRnZU5vblBhcmFsbGVsKGVkZ2UpO1xuXG4gICAgaWYgKGVkZ2VOb25QYXJhbGxlbCkge1xuICAgICAgY29uc3QgZWRnZUludGVyc2VjdGlvbiA9IHRoaXMuY2FsY3VsYXRlRWRnZUludGVyc2VjdGlvbihlZGdlKSxcbiAgICAgICAgICAgIGVkZ2VJbnRlcnNlY3Rpb25Ob25Ucml2aWFsID0gaXNJbnRlcnNlY3Rpb25Ob25Ucml2aWFsKGVkZ2VJbnRlcnNlY3Rpb24pO1xuXG4gICAgICBpZiAoZWRnZUludGVyc2VjdGlvbk5vblRyaXZpYWwpIHtcbiAgICAgICAgaW50ZXJzZWN0aW9uID0gZWRnZUludGVyc2VjdGlvbjsgIC8vL1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBpbnRlcnNlY3Rpb247XG4gIH1cblxuICBjYWxjdWxhdGVFZGdlSW50ZXJzZWN0aW9uKGVkZ2UpIHtcbiAgICBjb25zdCBlZGdlUG9zaXRpb24gPSBlZGdlLmdldFBvc2l0aW9uKCksXG4gICAgICAgICAgZWRnZUV4dGVudCA9IGVkZ2UuZ2V0RXh0ZW50KCksXG4gICAgICAgICAgZWRnZVBvc2l0aW9uQ29tcG9uZW50cyA9IGVkZ2VQb3NpdGlvbiwgLy8vXG4gICAgICAgICAgZWRnZUV4dGVudENvbXBvbmVudHMgPSBlZGdlRXh0ZW50LCAvLy9cbiAgICAgICAgICBmaXJzdEVkZ2VQb3NpdGlvbkNvbXBvbmVudCA9IGZpcnN0KGVkZ2VQb3NpdGlvbkNvbXBvbmVudHMpLFxuICAgICAgICAgIGZpcnN0RWRnZUV4dGVudENvbXBvbmVudCA9IGZpcnN0KGVkZ2VFeHRlbnRDb21wb25lbnRzKSxcbiAgICAgICAgICBlZGdlSW50ZXJzZWN0aW9uID0gKHRoaXMuZmlyc3RQb3NpdGlvbkNvbXBvbmVudCAtIGZpcnN0RWRnZVBvc2l0aW9uQ29tcG9uZW50KSAvIGZpcnN0RWRnZUV4dGVudENvbXBvbmVudDtcbiAgICBcbiAgICByZXR1cm4gZWRnZUludGVyc2VjdGlvbjtcbiAgfVxuXG4gIHN0YXRpYyBmcm9tRWRnZUluWFlQbGFuZShlZGdlSW5YWVBsYW5lKSB7XG4gICAgY29uc3QgZWRnZUluWFlQbGFuZVBvc2l0aW9uID0gZWRnZUluWFlQbGFuZS5nZXRQb3NpdGlvbigpLFxuICAgICAgICAgIHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCA9IGNhbGN1bGF0ZVJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeChlZGdlSW5YWVBsYW5lKSxcbiAgICAgICAgICBwb3NpdGlvbiA9IHJvdGF0ZUFib3V0WkF4aXMoZWRnZUluWFlQbGFuZVBvc2l0aW9uLCByb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgpLFxuICAgICAgICAgIHBvc2l0aW9uQ29tcG9uZW50cyA9IHBvc2l0aW9uLCAvLy9cbiAgICAgICAgICBmaXJzdFBvc2l0aW9uQ29tcG9uZW50ID0gZmlyc3QocG9zaXRpb25Db21wb25lbnRzKSxcbiAgICAgICAgICB2ZXJ0aWNhbExpbmVJblhZUGxhbmUgPSBuZXcgVmVydGljYWxMaW5lSW5YWVBsYW5lKGZpcnN0UG9zaXRpb25Db21wb25lbnQsIHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeCk7XG5cbiAgICByZXR1cm4gdmVydGljYWxMaW5lSW5YWVBsYW5lO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gVmVydGljYWxMaW5lSW5YWVBsYW5lO1xuXG5mdW5jdGlvbiBpc0VkZ2VOb25QYXJhbGxlbChlZGdlKSB7XG4gIGNvbnN0IGVkZ2VFeHRlbnQgPSBlZGdlLmdldEV4dGVudCgpLFxuICAgICAgICBlZGdlRXh0ZW50Q29tcG9uZW50cyA9IGVkZ2VFeHRlbnQsIC8vL1xuICAgICAgICBmaXJzdEVkZ2VFeHRlbnRDb21wb25lbnQgPSBmaXJzdChlZGdlRXh0ZW50Q29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZEVkZ2VFeHRlbnRDb21wb25lbnQgPSBzZWNvbmQoZWRnZUV4dGVudENvbXBvbmVudHMpLFxuICAgICAgICBlZGdlQW5nbGVUYW5nZW50ID0gZmlyc3RFZGdlRXh0ZW50Q29tcG9uZW50IC8gc2Vjb25kRWRnZUV4dGVudENvbXBvbmVudCxcbiAgICAgICAgZWRnZUFuZ2xlVGFuZ2VudEFwcHJveGltYXRlbHlFcXVhbFRvWmVybyA9IGlzQXBwcm94aW1hdGVseUVxdWFsVG9aZXJvKGVkZ2VBbmdsZVRhbmdlbnQpLFxuICAgICAgICBlZGdlUGFyYWxsZWwgPSBlZGdlQW5nbGVUYW5nZW50QXBwcm94aW1hdGVseUVxdWFsVG9aZXJvLCAvLy9cbiAgICAgICAgZWRnZU5vblBhcmFsbGVsID0gIWVkZ2VQYXJhbGxlbDtcblxuICByZXR1cm4gZWRnZU5vblBhcmFsbGVsO1xufVxuXG5mdW5jdGlvbiBpc0ludGVyc2VjdGlvbk5vblRyaXZpYWwoaW50ZXJzZWN0aW9uKSB7XG4gIGNvbnN0IGludGVyc2VjdGlvbk5vblRyaXZpYWwgPSAoKGludGVyc2VjdGlvbiA+IDAgKSAmJiAoaW50ZXJzZWN0aW9uIDwgMSkpO1xuXG4gIHJldHVybiBpbnRlcnNlY3Rpb25Ob25Ucml2aWFsO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVSb3RhdGlvbkFib3V0WkF4aXNNYXRyaXgoZWRnZUluWFlQbGFuZSkge1xuICBjb25zdCBlZGdlSW5YWVBsYW5lRXh0ZW50ID0gZWRnZUluWFlQbGFuZS5nZXRFeHRlbnQoKSxcbiAgICAgICAgdW5pdEVkZ2VJblhZUGxhbmVFeHRlbnQgPSBub3JtYWxpc2UzKGVkZ2VJblhZUGxhbmVFeHRlbnQpLFxuICAgICAgICB1bml0RWRnZUluWFlQbGFuZUV4dGVudENvbXBvbmVudHMgPSB1bml0RWRnZUluWFlQbGFuZUV4dGVudCwgIC8vL1xuICAgICAgICBmaXJzdFVuaXRFZGdlSW5YWVBsYW5lRXh0ZW50Q29tcG9uZW50ID0gZmlyc3QodW5pdEVkZ2VJblhZUGxhbmVFeHRlbnRDb21wb25lbnRzKSxcbiAgICAgICAgc2Vjb25kVW5pdEVkZ2VJblhZUGxhbmVFeHRlbnRDb21wb25lbnQgPSBzZWNvbmQodW5pdEVkZ2VJblhZUGxhbmVFeHRlbnRDb21wb25lbnRzKSxcbiAgICAgICAgYW5nbGVPZlJvdGF0aW9uQ29zaW5lID0gK3NlY29uZFVuaXRFZGdlSW5YWVBsYW5lRXh0ZW50Q29tcG9uZW50LCAgLy8vXG4gICAgICAgIGFuZ2xlT2ZSb3RhdGlvblNpbmUgPSAtZmlyc3RVbml0RWRnZUluWFlQbGFuZUV4dGVudENvbXBvbmVudCwgLy8vXG4gICAgICAgIGMgPSBhbmdsZU9mUm90YXRpb25Db3NpbmUsXG4gICAgICAgIHMgPSBhbmdsZU9mUm90YXRpb25TaW5lLFxuICAgICAgICByb3RhdGlvbkFib3V0WkF4aXNNYXRyaXggPSBbIGMsIC1zLCAwLCArcywgYywgMCwgMCwgMCwgMSBdOyAgLy8vXG5cbiAgcmV0dXJuIHJvdGF0aW9uQWJvdXRaQXhpc01hdHJpeDtcbn1cbiJdfQ==