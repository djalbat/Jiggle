'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var arrayUtilities = require('./utilities/array'),
    verticesUtilities = require('./utilities/vertices'),
    rotationUtilities = require('./utilities/rotation'),
    EdgeInXYPlane = require('./facet/edgeInXYPlane'),
    VerticalLineInXYPlane = require('./facet/verticalLineInXYPlane');

var push = arrayUtilities.push,
    separate = arrayUtilities.separate,
    rotateVertices = verticesUtilities.rotateVertices,
    calculateRotationQuaternion = rotationUtilities.calculateRotationQuaternion,
    calculateForwardsRotationQuaternion = rotationUtilities.calculateForwardsRotationQuaternion,
    calculateBackwardsRotationQuaternion = rotationUtilities.calculateBackwardsRotationQuaternion;

var MaskingFacet = function () {
  function MaskingFacet(edgesInXYPlane, verticalLinesInXYPlane, forwardsRotationQuaternion, backwardsRotationQuaternion) {
    _classCallCheck(this, MaskingFacet);

    this.edgesInXYPlane = edgesInXYPlane;
    this.verticalLinesInXYPlane = verticalLinesInXYPlane;
    this.forwardsRotationQuaternion = forwardsRotationQuaternion;
    this.backwardsRotationQuaternion = backwardsRotationQuaternion;
  }

  _createClass(MaskingFacet, [{
    key: 'getEdgesInXYPlane',
    value: function getEdgesInXYPlane() {
      return this.edgesInXYPlane;
    }
  }, {
    key: 'getVerticalLinesInXYPlane',
    value: function getVerticalLinesInXYPlane() {
      return this.verticalLinesInXYPlane;
    }
  }, {
    key: 'getForwardsRotationQuaternion',
    value: function getForwardsRotationQuaternion() {
      return this.forwardsRotationQuaternion;
    }
  }, {
    key: 'getBackwardsRotationQuaternion',
    value: function getBackwardsRotationQuaternion() {
      return this.backwardsRotationQuaternion;
    }
  }, {
    key: 'maskFacet',
    value: function maskFacet(facet, unmaskedFacets) {
      var unmaskedFacet = facet.clone();

      facet.rotate(this.forwardsRotationQuaternion);

      var maskingFacet = this,
          ///
      smallerFacets = this.splitFacet(facet),
          maskedSmallerFacets = [],
          unmaskedSmallerFacets = [];

      separate(smallerFacets, maskedSmallerFacets, unmaskedSmallerFacets, function (smallerFacet) {
        var smallerFacetMasked = smallerFacet.isMasked(maskingFacet);

        return smallerFacetMasked;
      });

      var maskedSmallerFacetsLength = maskedSmallerFacets.length;

      if (maskedSmallerFacetsLength === 0) {
        unmaskedFacets.push(unmaskedFacet);
      } else {
        unmaskedSmallerFacets.forEach(function (unmaskedSmallerFacet) {
          unmaskedSmallerFacet.rotate(this.backwardsRotationQuaternion);
        }.bind(this));

        push(unmaskedFacets, unmaskedSmallerFacets);
      }
    }
  }, {
    key: 'splitFacet',
    value: function splitFacet(facet) {
      var facets = [facet],
          smallerFacets = facets; ///

      this.verticalLinesInXYPlane.forEach(function (verticalLineInXYPlane) {
        smallerFacets = verticalLineInXYPlane.splitFacets(facets);

        facets = smallerFacets; ///
      });

      return smallerFacets;
    }
  }], [{
    key: 'fromFacet',
    value: function fromFacet(facet) {
      var facetNormal = facet.getNormal(),
          facetVertices = facet.getVertices(),
          rotationQuaternion = calculateRotationQuaternion(facetNormal),
          vertices = rotateVertices(facetVertices, rotationQuaternion),
          edgesInXYPlane = calculateEdgesInXYPlane(vertices),
          verticalLinesInXYPlane = edgesInXYPlane.map(VerticalLineInXYPlane.fromEdgeInXYPlane),
          forwardsRotationQuaternion = calculateForwardsRotationQuaternion(rotationQuaternion),
          backwardsRotationQuaternion = calculateBackwardsRotationQuaternion(rotationQuaternion),
          maskingFacet = new MaskingFacet(edgesInXYPlane, verticalLinesInXYPlane, forwardsRotationQuaternion, backwardsRotationQuaternion);

      return maskingFacet;
    }
  }]);

  return MaskingFacet;
}();

module.exports = MaskingFacet;

function calculateEdgesInXYPlane(vertices) {
  var verticesLength = 3,
      ///
  edgesInXYPlane = vertices.map(function (vertex, index) {
    var startIndex = index,
        endIndex = (startIndex + 1) % verticesLength,
        startVertex = vertices[startIndex],
        endVertex = vertices[endIndex],
        edgeInXYPlane = EdgeInXYPlane.fromStartVertexAndEndVertex(startVertex, endVertex);

    return edgeInXYPlane;
  }.bind(this));

  return edgesInXYPlane;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9tYXNraW5nRmFjZXQuanMiXSwibmFtZXMiOlsiYXJyYXlVdGlsaXRpZXMiLCJyZXF1aXJlIiwidmVydGljZXNVdGlsaXRpZXMiLCJyb3RhdGlvblV0aWxpdGllcyIsIkVkZ2VJblhZUGxhbmUiLCJWZXJ0aWNhbExpbmVJblhZUGxhbmUiLCJwdXNoIiwic2VwYXJhdGUiLCJyb3RhdGVWZXJ0aWNlcyIsImNhbGN1bGF0ZVJvdGF0aW9uUXVhdGVybmlvbiIsImNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25RdWF0ZXJuaW9uIiwiY2FsY3VsYXRlQmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uIiwiTWFza2luZ0ZhY2V0IiwiZWRnZXNJblhZUGxhbmUiLCJ2ZXJ0aWNhbExpbmVzSW5YWVBsYW5lIiwiZm9yd2FyZHNSb3RhdGlvblF1YXRlcm5pb24iLCJiYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb24iLCJmYWNldCIsInVubWFza2VkRmFjZXRzIiwidW5tYXNrZWRGYWNldCIsImNsb25lIiwicm90YXRlIiwibWFza2luZ0ZhY2V0Iiwic21hbGxlckZhY2V0cyIsInNwbGl0RmFjZXQiLCJtYXNrZWRTbWFsbGVyRmFjZXRzIiwidW5tYXNrZWRTbWFsbGVyRmFjZXRzIiwic21hbGxlckZhY2V0Iiwic21hbGxlckZhY2V0TWFza2VkIiwiaXNNYXNrZWQiLCJtYXNrZWRTbWFsbGVyRmFjZXRzTGVuZ3RoIiwibGVuZ3RoIiwiZm9yRWFjaCIsInVubWFza2VkU21hbGxlckZhY2V0IiwiYmluZCIsImZhY2V0cyIsInZlcnRpY2FsTGluZUluWFlQbGFuZSIsInNwbGl0RmFjZXRzIiwiZmFjZXROb3JtYWwiLCJnZXROb3JtYWwiLCJmYWNldFZlcnRpY2VzIiwiZ2V0VmVydGljZXMiLCJyb3RhdGlvblF1YXRlcm5pb24iLCJ2ZXJ0aWNlcyIsImNhbGN1bGF0ZUVkZ2VzSW5YWVBsYW5lIiwibWFwIiwiZnJvbUVkZ2VJblhZUGxhbmUiLCJtb2R1bGUiLCJleHBvcnRzIiwidmVydGljZXNMZW5ndGgiLCJ2ZXJ0ZXgiLCJpbmRleCIsInN0YXJ0SW5kZXgiLCJlbmRJbmRleCIsInN0YXJ0VmVydGV4IiwiZW5kVmVydGV4IiwiZWRnZUluWFlQbGFuZSIsImZyb21TdGFydFZlcnRleEFuZEVuZFZlcnRleCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQUVBLElBQU1BLGlCQUFpQkMsUUFBUSxtQkFBUixDQUF2QjtBQUFBLElBQ01DLG9CQUFvQkQsUUFBUSxzQkFBUixDQUQxQjtBQUFBLElBRU1FLG9CQUFvQkYsUUFBUSxzQkFBUixDQUYxQjtBQUFBLElBR01HLGdCQUFnQkgsUUFBUSx1QkFBUixDQUh0QjtBQUFBLElBSU1JLHdCQUF3QkosUUFBUSwrQkFBUixDQUo5Qjs7SUFNUUssSSxHQUFtQk4sYyxDQUFuQk0sSTtJQUFNQyxRLEdBQWFQLGMsQ0FBYk8sUTtJQUNOQyxjLEdBQW1CTixpQixDQUFuQk0sYztJQUNBQywyQixHQUEyR04saUIsQ0FBM0dNLDJCO0lBQTZCQyxtQyxHQUE4RVAsaUIsQ0FBOUVPLG1DO0lBQXFDQyxvQyxHQUF5Q1IsaUIsQ0FBekNRLG9DOztJQUVwRUMsWTtBQUNKLHdCQUFZQyxjQUFaLEVBQTRCQyxzQkFBNUIsRUFBb0RDLDBCQUFwRCxFQUFnRkMsMkJBQWhGLEVBQTZHO0FBQUE7O0FBQzNHLFNBQUtILGNBQUwsR0FBc0JBLGNBQXRCO0FBQ0EsU0FBS0Msc0JBQUwsR0FBOEJBLHNCQUE5QjtBQUNBLFNBQUtDLDBCQUFMLEdBQWtDQSwwQkFBbEM7QUFDQSxTQUFLQywyQkFBTCxHQUFtQ0EsMkJBQW5DO0FBQ0Q7Ozs7d0NBRW1CO0FBQ2xCLGFBQU8sS0FBS0gsY0FBWjtBQUNEOzs7Z0RBRTJCO0FBQzFCLGFBQU8sS0FBS0Msc0JBQVo7QUFDRDs7O29EQUUrQjtBQUM5QixhQUFPLEtBQUtDLDBCQUFaO0FBQ0Q7OztxREFFZ0M7QUFDL0IsYUFBTyxLQUFLQywyQkFBWjtBQUNEOzs7OEJBRVNDLEssRUFBT0MsYyxFQUFnQjtBQUMvQixVQUFNQyxnQkFB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U0FBT3JCLGNBQVA7QUFDRCIsImZpbGUiOiJtYXNraW5nRmFjZXQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IGFycmF5VXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvYXJyYXknKSxcbiAgICAgIHZlcnRpY2VzVXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvdmVydGljZXMnKSxcbiAgICAgIHJvdGF0aW9uVXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvcm90YXRpb24nKSxcbiAgICAgIEVkZ2VJblhZUGxhbmUgPSByZXF1aXJlKCcuL2ZhY2V0L2VkZ2VJblhZUGxhbmUnKSxcbiAgICAgIFZlcnRpY2FsTGluZUluWFlQbGFuZSA9IHJlcXVpcmUoJy4vZmFjZXQvdmVydGljYWxMaW5lSW5YWVBsYW5lJyk7XG5cbmNvbnN0IHsgcHVzaCwgc2VwYXJhdGUgfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyByb3RhdGVWZXJ0aWNlcyB9ID0gdmVydGljZXNVdGlsaXRpZXMsXG4gICAgICB7IGNhbGN1bGF0ZVJvdGF0aW9uUXVhdGVybmlvbiwgY2FsY3VsYXRlRm9yd2FyZHNSb3RhdGlvblF1YXRlcm5pb24sIGNhbGN1bGF0ZUJhY2t3YXJkc1JvdGF0aW9uUXVhdGVybmlvbiB9ID0gcm90YXRpb25VdGlsaXRpZXM7XG5cbmNsYXNzIE1hc2tpbmdGYWNldCB7XG4gIGNvbnN0cnVjdG9yKGVkZ2VzSW5YWVBsYW5lLCB2ZXJ0aWNhbExpbmVzSW5YWVBsYW5lLCBmb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbiwgYmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uKSB7XG4gICAgdGhpcy5lZGdlc0luWFlQbGFuZSA9IGVkZ2VzSW5YWVBsYW5lO1xuICAgIHRoaXMudmVydGljYWxMaW5lc0luWFlQbGFuZSA9IHZlcnRpY2FsTGluZXNJblhZUGxhbmU7XG4gICAgdGhpcy5mb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbiA9IGZvcndhcmRzUm90YXRpb25RdWF0ZXJuaW9uO1xuICAgIHRoaXMuYmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uID0gYmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uO1xuICB9XG5cbiAgZ2V0RWRnZXNJblhZUGxhbmUoKSB7XG4gICAgcmV0dXJuIHRoaXMuZWRnZXNJblhZUGxhbmU7XG4gIH1cblxuICBnZXRWZXJ0aWNhbExpbmVzSW5YWVBsYW5lKCkge1xuICAgIHJldHVybiB0aGlzLnZlcnRpY2FsTGluZXNJblhZUGxhbmU7XG4gIH1cblxuICBnZXRGb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5mb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbjtcbiAgfVxuXG4gIGdldEJhY2t3YXJkc1JvdGF0aW9uUXVhdGVybmlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5iYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb247XG4gIH1cblxuICBtYXNrRmFjZXQoZmFjZXQsIHVubWFza2VkRmFjZXRzKSB7XG4gICAgY29uc3QgdW5tYXNrZWRGYWNldCA9IGZhY2V0LmNsb25lKCk7XG5cbiAgICBmYWNldC5yb3RhdGUodGhpcy5mb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbik7XG5cbiAgICBjb25zdCBtYXNraW5nRmFjZXQgPSB0aGlzLCAgLy8vXG4gICAgICAgICAgc21hbGxlckZhY2V0cyA9IHRoaXMuc3BsaXRGYWNldChmYWNldCksXG4gICAgICAgICAgbWFza2VkU21hbGxlckZhY2V0cyA9IFtdLFxuICAgICAgICAgIHVubWFza2VkU21hbGxlckZhY2V0cyA9IFtdO1xuXG4gICAgc2VwYXJhdGUoc21hbGxlckZhY2V0cywgbWFza2VkU21hbGxlckZhY2V0cywgdW5tYXNrZWRTbWFsbGVyRmFjZXRzLCBmdW5jdGlvbihzbWFsbGVyRmFjZXQpIHtcbiAgICAgIGNvbnN0IHNtYWxsZXJGYWNldE1hc2tlZCA9IHNtYWxsZXJGYWNldC5pc01hc2tlZChtYXNraW5nRmFjZXQpO1xuXG4gICAgICByZXR1cm4gc21hbGxlckZhY2V0TWFza2VkO1xuICAgIH0pO1xuXG4gICAgY29uc3QgbWFza2VkU21hbGxlckZhY2V0c0xlbmd0aCA9IG1hc2tlZFNtYWxsZXJGYWNldHMubGVuZ3RoO1xuXG4gICAgaWYgKG1hc2tlZFNtYWxsZXJGYWNldHNMZW5ndGggPT09IDApIHtcbiAgICAgIHVubWFza2VkRmFjZXRzLnB1c2godW5tYXNrZWRGYWNldCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHVubWFza2VkU21hbGxlckZhY2V0cy5mb3JFYWNoKGZ1bmN0aW9uKHVubWFza2VkU21hbGxlckZhY2V0KSB7XG4gICAgICAgIHVubWFza2VkU21hbGxlckZhY2V0LnJvdGF0ZSh0aGlzLmJhY2t3YXJkc1JvdGF0aW9uUXVhdGVybmlvbik7XG4gICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICBwdXNoKHVubWFza2VkRmFjZXRzLCB1bm1hc2tlZFNtYWxsZXJGYWNldHMpO1xuICAgIH1cbiAgfVxuICBcbiAgc3BsaXRGYWNldChmYWNldCkge1xuICAgIGxldCBmYWNldHMgPSBbXG4gICAgICAgICAgZmFjZXRcbiAgICAgICAgXSxcbiAgICAgICAgc21hbGxlckZhY2V0cyA9IGZhY2V0czsgLy8vXG5cbiAgICB0aGlzLnZlcnRpY2FsTGluZXNJblhZUGxhbmUuZm9yRWFjaChmdW5jdGlvbih2ZXJ0aWNhbExpbmVJblhZUGxhbmUpIHtcbiAgICAgIHNtYWxsZXJGYWNldHMgPSB2ZXJ0aWNhbExpbmVJblhZUGxhbmUuc3BsaXRGYWNldHMoZmFjZXRzKTtcblxuICAgICAgZmFjZXRzID0gc21hbGxlckZhY2V0czsgLy8vXG4gICAgfSk7XG5cbiAgICByZXR1cm4gc21hbGxlckZhY2V0cztcbiAgfVxuXG4gIHN0YXRpYyBmcm9tRmFjZXQoZmFjZXQpIHtcbiAgICBjb25zdCBmYWNldE5vcm1hbCA9IGZhY2V0LmdldE5vcm1hbCgpLFxuICAgICAgICAgIGZhY2V0VmVydGljZXMgPSBmYWNldC5nZXRWZXJ0aWNlcygpLFxuICAgICAgICAgIHJvdGF0aW9uUXVhdGVybmlvbiA9IGNhbGN1bGF0ZVJvdGF0aW9uUXVhdGVybmlvbihmYWNldE5vcm1hbCksXG4gICAgICAgICAgdmVydGljZXMgPSByb3RhdGVWZXJ0aWNlcyhmYWNldFZlcnRpY2VzLCByb3RhdGlvblF1YXRlcm5pb24pLFxuICAgICAgICAgIGVkZ2VzSW5YWVBsYW5lID0gY2FsY3VsYXRlRWRnZXNJblhZUGxhbmUodmVydGljZXMpLFxuICAgICAgICAgIHZlcnRpY2FsTGluZXNJblhZUGxhbmUgPSBlZGdlc0luWFlQbGFuZS5tYXAoVmVydGljYWxMaW5lSW5YWVBsYW5lLmZyb21FZGdlSW5YWVBsYW5lKSxcbiAgICAgICAgICBmb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbiA9IGNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25RdWF0ZXJuaW9uKHJvdGF0aW9uUXVhdGVybmlvbiksXG4gICAgICAgICAgYmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uID0gY2FsY3VsYXRlQmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uKHJvdGF0aW9uUXVhdGVybmlvbiksXG4gICAgICAgICAgbWFza2luZ0ZhY2V0ID0gbmV3IE1hc2tpbmdGYWNldChlZGdlc0luWFlQbGFuZSwgdmVydGljYWxMaW5lc0luWFlQbGFuZSwgZm9yd2FyZHNSb3RhdGlvblF1YXRlcm5pb24sIGJhY2t3YXJkc1JvdGF0aW9uUXVhdGVybmlvbik7XG5cbiAgICByZXR1cm4gbWFza2luZ0ZhY2V0O1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gTWFza2luZ0ZhY2V0O1xuXG5mdW5jdGlvbiBjYWxjdWxhdGVFZGdlc0luWFlQbGFuZSh2ZXJ0aWNlcykge1xuICBjb25zdCB2ZXJ0aWNlc0xlbmd0aCA9IDMsIC8vL1xuICAgICAgICBlZGdlc0luWFlQbGFuZSA9IHZlcnRpY2VzLm1hcChmdW5jdGlvbih2ZXJ0ZXgsIGluZGV4KSB7XG4gICAgICAgICAgY29uc3Qgc3RhcnRJbmRleCA9IGluZGV4LFxuICAgICAgICAgICAgICBlbmRJbmRleCA9IChzdGFydEluZGV4ICsgMSkgJSB2ZXJ0aWNlc0xlbmd0aCxcbiAgICAgICAgICAgICAgc3RhcnRWZXJ0ZXggPSB2ZXJ0aWNlc1tzdGFydEluZGV4XSxcbiAgICAgICAgICAgICAgZW5kVmVydGV4ID0gdmVydGljZXNbZW5kSW5kZXhdLFxuICAgICAgICAgICAgICBlZGdlSW5YWVBsYW5lID0gRWRnZUluWFlQbGFuZS5mcm9tU3RhcnRWZXJ0ZXhBbmRFbmRWZXJ0ZXgoc3RhcnRWZXJ0ZXgsIGVuZFZlcnRleCk7XG5cbiAgICAgICAgICByZXR1cm4gZWRnZUluWFlQbGFuZTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICByZXR1cm4gZWRnZXNJblhZUGxhbmU7XG59XG4iXX0=